const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BX5rlo-g.js","./Ca6rub8f.js","./entry.fAYuz7eT.css"])))=>i.map(i=>d[i]);
import{b as Le,u as Oe,a1 as Be,a0 as Pe,a3 as j,G as ae,h as je,C as l,D as o,P as k,M as p,R as s,W as F,O as g,S as C,N as d,U as ne,V as oe,X as N,Q as Fe,l as x,ak as Qe,t as c,B as r,al as Ue,am as Ge}from"./Ca6rub8f.js";import{u as We}from"./dzAquBM_.js";import T from"./Bc1u1-yo.js";import Xe from"./C3H3F2YC.js";import{S as He}from"./B4A1znAd.js";import{c as R}from"./Cibw3ATY.js";import"./B-wzc82F.js";import"./CkYB-R1u.js";import"./c5FhCeC0.js";const Ke=R("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const Je=R("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);const Ye=R("keyboard",[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]]);const Ze=R("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);const et=R("scan-line",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]]),tt={class:"min-h-screen bg-slate-950 text-white"},st={class:"sticky top-0 z-30 border-b border-white/10 bg-slate-950/95 px-4 py-4 backdrop-blur"},at={class:"mx-auto flex w-full max-w-3xl flex-wrap items-center justify-between gap-3"},nt={class:"space-y-1"},ot={class:"text-base text-white/80"},rt={class:"font-semibold text-emerald-300"},lt={class:"flex items-center gap-2"},it={class:"rounded-full border border-white/20 bg-white/5 px-3 py-1 text-xs font-semibold text-white/80"},ct={class:"px-4 py-5"},ut={key:0,class:"mx-auto max-w-xl space-y-4"},dt={class:"rounded-3xl border border-white/10 bg-white/5 p-6 shadow-2xl"},mt={class:"mt-5 space-y-3"},ht=["disabled"],pt=["value"],vt={key:0,class:"text-sm text-white/70"},ft={key:1,class:"text-sm text-red-300"},xt={key:2,class:"text-sm text-white/70"},yt={key:1,class:"mx-auto max-w-3xl space-y-4"},wt={class:"rounded-3xl border border-white/10 bg-white/5 p-4 shadow-2xl"},kt={class:"mt-1 text-xl font-semibold"},gt={class:"text-sm text-white/65"},bt={class:"mt-4 grid grid-cols-2 gap-2"},_t={key:0,class:"space-y-3"},Ct={key:0,class:"relative overflow-hidden rounded-3xl border border-white/10 bg-black"},Tt={key:1,class:"rounded-2xl bg-red-500/90 px-4 py-3 text-sm"},At={key:1,class:"space-y-3 rounded-3xl border border-white/10 bg-white/5 p-4 shadow-2xl"},Et={key:0,class:"text-sm text-white/70"},Vt={key:1,class:"text-sm text-red-300"},Mt={key:2,class:"text-sm text-white/70"},zt={key:3,class:"text-sm text-white/70"},St={key:4,class:"space-y-2"},$t={class:"min-w-0"},Rt={class:"truncate text-base font-semibold"},Dt={class:"truncate text-xs text-white/60"},It={class:"text-xs text-emerald-300"},Nt={class:"space-y-4"},qt={class:"mx-auto flex h-24 w-24 items-center justify-center rounded-full bg-white/15"},Lt={class:"text-3xl font-black leading-snug"},Ht=Le({__name:"index",async setup(Ot){let m,A;const D=We(),V=Oe(),{user:Q}=Be(V),re=Pe(),le=Ue(async()=>(await Ge(()=>import("./BX5rlo-g.js"),__vite__mapDeps([0,1,2]),import.meta.url)).QrcodeStream),q=new Date().toISOString().slice(0,10),{data:ie,pending:U,error:ce,refresh:ue}=([m,A]=j(()=>D.get("/api/v1/events/",{$fetch:V.apiFetch,query:{start_date:q,end_date:q,status:"scheduled",limit:100}})),m=await m,A(),m),G=c(()=>ie.value??[]),de=t=>!!(t&&t.slice(0,10)===q),W=c(()=>G.value.filter(t=>t.occurrences?.some(e=>de(e.start_time)))),L=c(()=>W.value.length?W.value:G.value),u=x(null),me=c(()=>L.value.find(t=>t.id===u.value)??null),he=t=>{const e=Array.isArray(t)?t[0]:t,a=Number(e);return Number.isFinite(a)&&a>0?a:null},pe=c(()=>he(re.query.eventId)),X=c(()=>u.value?`/api/v1/organizer/events/${u.value}/stats`:"/api/v1/organizer/events/0/stats"),{data:ve,pending:fe,refresh:O}=([m,A]=j(()=>D.get(X,{$fetch:V.apiFetch,immediate:!1,watch:[X]})),m=await m,A(),m),B=c(()=>ve.value??null),xe=c(()=>B.value?.check_in_count??0),ye=c(()=>B.value?.total_capacity??B.value?.tickets_sold??0),we=c(()=>`${xe.value} / ${ye.value||"‚Äî"}`),H=c(()=>u.value?`/api/v1/organizer/events/${u.value}/attendees`:"/api/v1/organizer/events/0/attendees"),{data:ke,pending:ge,error:be,refresh:K}=([m,A]=j(()=>D.get(H,{$fetch:V.apiFetch,immediate:!1,watch:[H],query:{limit:500,offset:0}})),m=await m,A(),m),_e=c(()=>ke.value?.items??[]),J=(t,e)=>{for(const a of e){const n=t[a];if(typeof n=="string"&&n.trim())return n.trim()}return""},Ce=c(()=>_e.value.map((t,e)=>{const a=t,n=t.user.full_name||t.user.username||`–ì–æ—Å—Ç—å #${e+1}`,i=J(a,["ticket_uuid","ticket_code","code","uuid"])||t.user.uuid,S=J(a,["ticket_type","ticket_name","type"])||"–ë–∏–ª–µ—Ç";return{id:`${t.user.id}-${i}`,name:n,ticketCode:i,ticketType:S}})),v=x("scanner"),h=x(!1),E=x(""),b=x(!1),f=x(null),M=x(null),y=x(""),z=t=>t.trim().toLowerCase().replace(/\s+/g," "),Te=t=>{if(t.length<6)return!1;const e=/\d/.test(t),a=/[a-z-]/i.test(t);return e||a},Ae=c(()=>{const t=z(y.value);return t.length<2?[]:Ce.value.filter(e=>{const a=z(e.name).includes(t),n=z(e.ticketCode).includes(t);return a||n}).slice(0,30)}),P=c(()=>{const t=y.value.trim(),e=[...Ae.value];return!t||!Te(t)?e:(e.some(n=>z(n.ticketCode)===z(t))||e.unshift({id:`typed-${t}`,name:"–ö–æ–¥ –∏–∑ –≤–≤–æ–¥–∞",ticketCode:t,ticketType:"–í–≤–æ–¥ –≤—Ä—É—á–Ω—É—é"}),e.slice(0,30))}),Ee=c(()=>Q.value?.full_name||Q.value?.username||"–û–ø–µ—Ä–∞—Ç–æ—Ä"),Y=x(""),Z=x(0),ee=()=>{M.value&&(clearTimeout(M.value),M.value=null)},Ve=t=>{try{const e=new AudioContext,a=e.currentTime;if(t==="success"){[960,1280].forEach((S,w)=>{const _=e.createOscillator(),$=e.createGain();_.type="sine",_.frequency.setValueAtTime(S,a+w*.08),$.gain.setValueAtTime(1e-4,a+w*.08),$.gain.exponentialRampToValueAtTime(.08,a+w*.08+.01),$.gain.exponentialRampToValueAtTime(1e-4,a+w*.08+.12),_.connect($),$.connect(e.destination),_.start(a+w*.08),_.stop(a+w*.08+.12)}),setTimeout(()=>{e.close()},280);return}const n=e.createOscillator(),i=e.createGain();n.type="sawtooth",n.frequency.setValueAtTime(220,a),n.frequency.linearRampToValueAtTime(120,a+.32),i.gain.setValueAtTime(1e-4,a),i.gain.exponentialRampToValueAtTime(.1,a+.02),i.gain.exponentialRampToValueAtTime(1e-4,a+.34),n.connect(i),i.connect(e.destination),n.start(a),n.stop(a+.34),setTimeout(()=>{e.close()},420)}catch{}},I=t=>{ee(),f.value=t,Ve(t.status),M.value=setTimeout(()=>{f.value=null,M.value=null},2600)},te=t=>{const e=(t||"").trim();if(!e)return"–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω";const a=e.toLowerCase();return a.includes("already")||a.includes("used")||a.includes("—É–∂–µ")?"–ë–∏–ª–µ—Ç —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!":a.includes("invalid")||a.includes("–Ω–µ–¥–µ–π—Å—Ç–≤")||a.includes("–Ω–µ–≤–∞–ª–∏–¥")?"–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω":e},Me=t=>{if(!t)return"";if(typeof t=="string")return t.trim();if(Array.isArray(t)){const e=t[0];return(e?.rawValue||e?.text||"").trim()}return""},se=async t=>{const e=t.trim();if(!(!e||b.value||!u.value)){b.value=!0;try{const{data:a,error:n}=await D.post("/api/v1/organizer/checkin/scan",{ticket_uuid:e},{$fetch:V.apiFetch});if(n.value){const _=(n.value?.data?.message||n.value?.data?.detail)??"";I({status:"error",message:te(_)});return}const i=a.value;if(!i){I({status:"error",message:"–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω"});return}if(!i.success){I({status:"error",message:te(i.message)});return}const S=i.user?.full_name||i.user?.username||"–ì–æ—Å—Ç—å",w=i.ticket_type?`${i.ticket_type} –±–∏–ª–µ—Ç`:"–ë–∏–ª–µ—Ç";I({status:"success",message:`${S}. ${w}. –ü—Ä–æ—Ö–æ–¥–∏—Ç–µ.`}),await Promise.allSettled([O(),K()])}finally{b.value=!1}}},ze=async t=>{if(v.value!=="scanner"||!h.value||b.value||f.value)return;const e=Me(t);if(!e)return;const a=Date.now();e===Y.value&&a-Z.value<2500||(Y.value=e,Z.value=a,await se(e))},Se=t=>{E.value=t instanceof Error?t.message:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É."},$e=()=>{v.value="scanner",E.value="",h.value=!0},Re=()=>{h.value=!1},De=()=>{v.value="manual",h.value=!1},Ie=()=>{v.value="scanner"},Ne=()=>{u.value=null,v.value="scanner",h.value=!1,E.value="",y.value="",f.value=null},qe=t=>{const e=Number(t.target.value);u.value=Number.isFinite(e)&&e>0?e:null};return ae(u,t=>{y.value="",E.value="",f.value=null,h.value=!1,t&&(O(),K())}),ae(pe,t=>{!t||t===u.value||(u.value=t)},{immediate:!0}),je(()=>{ee(),h.value=!1}),(t,e)=>{const a=Qe;return r(),l("div",tt,[o("header",st,[o("div",at,[o("div",nt,[e[3]||(e[3]=o("p",{class:"text-xs uppercase tracking-[0.35em] text-white/50"},"Check-in PWA",-1)),e[4]||(e[4]=o("h1",{class:"text-2xl font-black leading-tight"},"–°–∫–∞–Ω–µ—Ä –±–∏–ª–µ—Ç–æ–≤",-1)),o("p",ot,[e[2]||(e[2]=k(" –í–Ω—É—Ç—Ä–∏: ",-1)),o("span",rt,p(s(we)),1)])]),o("div",lt,[o("span",it,p(s(Ee)),1),s(u)?(r(),F(s(T),{key:0,variant:"outline",size:"sm",class:"h-10 border-white/20 text-white hover:bg-white/10",onClick:Ne},{default:g(()=>[...e[5]||(e[5]=[k(" –°–º–µ–Ω–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ ",-1)])]),_:1})):C("",!0)])])]),o("main",ct,[s(u)?(r(),l("section",yt,[o("div",wt,[e[13]||(e[13]=o("p",{class:"text-xs uppercase tracking-[0.28em] text-white/55"},"–¢–µ–∫—É—â–µ–µ —Å–æ–±—ã—Ç–∏–µ",-1)),o("h2",kt,p(s(me)?.title),1),o("p",gt,p(s(fe)?"–û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É...":"–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ –±–∏–ª–µ—Ç–æ–≤"),1),o("div",bt,[d(s(T),{class:N(["h-12 w-full",s(v)==="scanner"?"":"border-white/20 text-white hover:bg-white/10"]),variant:s(v)==="scanner"?"default":"outline",onClick:Ie},{default:g(()=>[d(s(et),{class:"mr-2 h-4 w-4"}),e[11]||(e[11]=k(" –°–∫–∞–Ω–µ—Ä ",-1))]),_:1},8,["variant","class"]),d(s(T),{class:N(["h-12 w-full",s(v)==="manual"?"":"border-white/20 text-white hover:bg-white/10"]),variant:s(v)==="manual"?"default":"outline",onClick:De},{default:g(()=>[d(s(Ye),{class:"mr-2 h-4 w-4"}),e[12]||(e[12]=k(" –†—É—á–Ω–æ–π –≤–≤–æ–¥ ",-1))]),_:1},8,["variant","class"])])]),s(v)==="scanner"?(r(),l("div",_t,[d(s(T),{class:N(["h-24 w-full rounded-3xl text-2xl font-black tracking-wide",s(h)?"bg-red-500 hover:bg-red-600":"bg-emerald-500 hover:bg-emerald-600"]),disabled:s(b),onClick:e[0]||(e[0]=n=>s(h)?Re():$e())},{default:g(()=>[k(p(s(h)?"‚èπ –û–°–¢–ê–ù–û–í–ò–¢–¨ –°–ö–ê–ù–ï–†":"üì∑ –°–ö–ê–ù–ò–†–û–í–ê–¢–¨ QR"),1)]),_:1},8,["class","disabled"]),s(h)?(r(),l("div",Ct,[d(a,null,{default:g(()=>[d(s(le),{class:"h-[55vh] w-full object-cover",paused:!!s(f)||s(b),onDetect:ze,onError:Se},null,8,["paused"])]),_:1}),e[14]||(e[14]=o("div",{class:"pointer-events-none absolute inset-0 flex items-center justify-center p-6"},[o("div",{class:"h-64 w-full max-w-[18rem] rounded-3xl border-4 border-emerald-400/80 shadow-[0_0_40px_rgba(16,185,129,0.45)]"})],-1)),e[15]||(e[15]=o("div",{class:"absolute left-3 top-3 rounded-full bg-black/50 px-3 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-white/80"}," –ù–∞–≤–µ–¥–∏ QR –≤ —Ä–∞–º–∫—É ",-1))])):C("",!0),s(E)?(r(),l("p",Tt,p(s(E)),1)):C("",!0)])):(r(),l("div",At,[e[17]||(e[17]=o("h3",{class:"text-lg font-semibold"},"–†—É—á–Ω–æ–π –ø–æ–∏—Å–∫",-1)),d(s(Xe),{modelValue:s(y),"onUpdate:modelValue":e[1]||(e[1]=n=>Fe(y)?y.value=n:null),class:"h-14 rounded-2xl border-white/20 bg-slate-900 text-base text-white placeholder:text-white/45",placeholder:"–§–∞–º–∏–ª–∏—è / –ö–æ–¥ –±–∏–ª–µ—Ç–∞"},null,8,["modelValue"]),s(ge)?(r(),l("p",Et,"–ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π...")):s(be)?(r(),l("p",Vt,"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≥–æ—Å—Ç–µ–π.")):s(y).trim().length<2?(r(),l("p",Mt," –í–≤–µ–¥–∏—Ç–µ –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞. ")):s(P).length===0?(r(),l("p",zt," –°–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. ")):C("",!0),s(P).length?(r(),l("div",St,[(r(!0),l(ne,null,oe(s(P),n=>(r(),l("div",{key:n.id,class:"flex items-center justify-between gap-3 rounded-2xl border border-white/10 bg-slate-900/70 p-3"},[o("div",$t,[o("p",Rt,p(n.name),1),o("p",Dt,"–ö–æ–¥: "+p(n.ticketCode),1),o("p",It,p(n.ticketType),1)]),d(s(T),{class:"h-11 shrink-0 px-4",disabled:s(b),onClick:i=>se(n.ticketCode)},{default:g(()=>[...e[16]||(e[16]=[k(" Check-in ",-1)])]),_:1},8,["disabled","onClick"])]))),128))])):C("",!0)])),d(s(T),{variant:"outline",class:"h-12 w-full border-white/20 text-white hover:bg-white/10",onClick:s(O)},{default:g(()=>[d(s(Ze),{class:"mr-2 h-4 w-4"}),e[18]||(e[18]=k(" –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ ",-1))]),_:1},8,["onClick"])])):(r(),l("section",ut,[o("div",dt,[d(s(He),{class:"mx-auto h-12 w-12 text-emerald-300"}),e[9]||(e[9]=o("h2",{class:"mt-4 text-center text-2xl font-semibold"},"–í—ã–±–µ—Ä–∏ —Å–æ–±—ã—Ç–∏–µ",-1)),e[10]||(e[10]=o("p",{class:"mt-2 text-center text-sm text-white/70"}," Check-in –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ. ",-1)),o("div",mt,[e[8]||(e[8]=o("label",{class:"text-xs font-semibold uppercase tracking-[0.3em] text-white/55"},"–°–æ–±—ã—Ç–∏—è",-1)),o("select",{class:"h-14 w-full rounded-2xl border border-white/15 bg-slate-900 px-4 text-lg font-semibold text-white focus:outline-none focus:ring-2 focus:ring-emerald-400",disabled:s(U),onChange:qe},[e[6]||(e[6]=o("option",{value:""},"–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏–µ",-1)),(r(!0),l(ne,null,oe(s(L),n=>(r(),l("option",{key:n.id,value:n.id},p(n.title),9,pt))),128))],40,ht),s(U)?(r(),l("p",vt,"–ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π...")):s(ce)?(r(),l("p",ft,"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–±—ã—Ç–∏—è.")):s(L).length===0?(r(),l("p",xt,"–°–µ–≥–æ–¥–Ω—è –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π.")):C("",!0),d(s(T),{variant:"outline",class:"w-full border-white/20 text-white hover:bg-white/10",onClick:s(ue)},{default:g(()=>[...e[7]||(e[7]=[k(" –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ ",-1)])]),_:1},8,["onClick"])])])]))]),s(f)?(r(),l("div",{key:0,class:N(["fixed inset-0 z-50 flex items-center justify-center px-6 text-center",s(f).status==="success"?"bg-green-500":"bg-red-600"])},[o("div",Nt,[o("div",qt,[s(f).status==="success"?(r(),F(s(Ke),{key:0,class:"h-16 w-16 text-white"})):(r(),F(s(Je),{key:1,class:"h-16 w-16 text-white"}))]),o("h2",Lt,p(s(f).message),1)])],2)):C("",!0)])}}});export{Ht as default};
