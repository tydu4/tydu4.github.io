import{u as he}from"./dzAquBM_.js";import{b as Ce,a0 as $e,u as ze,a3 as N,C as c,D as l,N as s,R as e,M as d,O as a,W as Y,Q as Le,l as M,a2 as Me,t as u,B as i,P as n,S as U,U as A,V as j,X as Ve,I as Z,$ as q,n as De}from"./Ca6rub8f.js";import y from"./Bc1u1-yo.js";import Fe from"./C3H3F2YC.js";import Pe from"./CLa6BjNG.js";import Se from"./CMZtORL8.js";import Ie from"./CEfSTzh6.js";import p from"./DrFgrZR2.js";import v from"./_K1zC7L4.js";import g from"./BdN6R0OF.js";import _ from"./B62bAjYM.js";import V from"./BETBmRDI.js";import{u as Re}from"./B-wzc82F.js";import{c as E}from"./Cibw3ATY.js";import{R as Te}from"./NezAEcU6.js";import{S as Be}from"./D7pxd-Es.js";import"./CkYB-R1u.js";import"./c5FhCeC0.js";const Ne=E("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);const Ue=E("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);const Ae=E("pencil-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),je={class:"space-y-6"},Ee={class:"sticky top-0 z-30 -mx-6 border-b border-border bg-background/95 px-6 py-4 backdrop-blur"},Qe={class:"flex flex-wrap items-center justify-between gap-4"},He={class:"space-y-2"},Oe={class:"flex flex-wrap items-center gap-3 text-sm text-muted-foreground"},Ke={class:"text-2xl font-bold text-foreground"},We={class:"flex flex-wrap items-center gap-2"},Xe={key:1,class:"space-y-6"},Ge={class:"space-y-6"},Je={class:"grid gap-4 md:grid-cols-2 xl:grid-cols-4"},Ye={class:"grid gap-4 lg:grid-cols-3"},Ze={key:0,class:"text-sm text-muted-foreground"},qe={key:1,class:"text-sm text-muted-foreground"},et={key:2,class:"space-y-4"},tt={class:"flex items-center justify-between text-sm font-semibold text-foreground"},st={class:"h-2 w-full rounded-full bg-muted"},at={class:"text-xs text-muted-foreground"},lt={class:"flex items-center justify-between text-sm"},ot={class:"text-muted-foreground"},nt={class:"font-semibold text-foreground"},rt={class:"h-2 w-full rounded-full bg-muted"},dt={class:"space-y-4"},ut={class:"flex items-center justify-between"},it={key:0,class:"text-sm text-emerald-600"},ct={key:1,class:"text-sm text-muted-foreground"},ft={key:2,class:"rounded-2xl border border-dashed border-border p-6 text-sm text-muted-foreground"},mt={key:3,class:"space-y-4"},pt={key:0,class:"rounded-xl border border-emerald-200 bg-white/80 p-3 text-sm text-emerald-700"},vt={key:1,class:"space-y-3"},gt={class:"grid gap-4 lg:grid-cols-3"},_t={class:"space-y-2"},xt={class:"flex flex-wrap gap-2"},bt={key:0,class:"text-xs text-emerald-600"},yt={class:"rounded-xl border border-border bg-background p-3"},wt={class:"text-lg font-semibold text-foreground"},kt={class:"rounded-xl border border-border bg-background p-3"},ht={class:"text-lg font-semibold text-foreground"},Ct={key:0,class:"text-xs text-muted-foreground"},Ht=Ce({__name:"index",async setup($t){let f,w;const ee=$e(),k=u(()=>String(ee.params.id||"")),Q=u(()=>Number(k.value)),h=ze(),$=he(),{data:H,error:te,pending:se}=([f,w]=N(()=>$.get(`/api/v1/organizer/events/${k.value}/analytics`,{$fetch:h.apiFetch})),f=await f,w(),f),{data:D}=([f,w]=N(()=>$.get(`/api/v1/events/${k.value}`,{$fetch:h.apiFetch})),f=await f,w(),f),{data:O}=([f,w]=N(()=>$.get("/api/v1/organizer/demand",{$fetch:h.apiFetch})),f=await f,w(),f),x=u(()=>D.value?.slug||k.value),ae=u(()=>`organizer-event-questions-${x.value}`),{data:le,pending:oe,refresh:ne}=Re(ae,()=>{if(!x.value)return Promise.resolve({items:[],total:0});const r=`/api/v1/events/${x.value}/questions`;return h.apiFetch(r,{baseURL:Me(r)})},{default:()=>({items:[],total:0}),watch:[x]}),re=u(()=>{const r=te.value;return r?.statusCode===404||r?.response?.status===404}),m=u(()=>H.value?.stats),de=u(()=>m.value?.event_title||D.value?.title||"Событие"),K=u(()=>D.value?.status||(m.value?.tickets_sold?"scheduled":"draft")),ue=u(()=>K.value==="draft"?"Черновик":"Запланирован"),ie=u(()=>K.value==="draft"?"warning":"success"),ce=u(()=>{const r=D.value?.occurrences?.[0]?.start_time;if(!r)return"Дата уточняется";const t=new Date(r);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)}),F=new Intl.NumberFormat("ru-RU"),R=r=>`${F.format(r)} ₽`,fe=u(()=>{const r=m.value?.tickets_sold??0,t=m.value?.total_capacity;return t?`${r} / ${t}`:`${r}`}),me=u(()=>R(m.value?.revenue??0)),pe=u(()=>F.format(m.value?.active_buddy_requests??0)),ve=u(()=>F.format(m.value?.view_count??0)),T=u(()=>H.value?.revenue_breakdown??[]),ge=u(()=>Math.max(1,...T.value.map(r=>r.sold||0))),W=u(()=>[{label:"Просмотры",value:m.value?.view_count??0},{label:"Лайки",value:m.value?.like_count??0},{label:"Покупки",value:m.value?.tickets_sold??0}]),B=M("overview"),_e=[{value:"overview",label:"Обзор"},{value:"qa",label:"Q&A"},{value:"marketing",label:"Маркетинг"}],X=u(()=>le.value?.items??[]),z=q({}),P=q({}),L=M(""),xe=async r=>{const t=(z[r.id]||"").trim();if(!t)return;P[r.id]=!0,L.value="";const o={answer:t};try{const{data:b,error:J}=await $.post(`/api/v1/organizer/events/${k.value}/questions/${r.id}/answer`,o,{$fetch:h.apiFetch});if(J.value)throw J.value;b.value&&(r.answer=b.value.answer,r.is_public=b.value.is_public),z[r.id]="",L.value="Ответ отправлен"}catch{L.value="Не удалось отправить ответ. Попробуй позже."}finally{P[r.id]=!1}},C=M(""),S=M(!1),be=async()=>{if(!Number.isFinite(Q.value)){C.value="Нужен корректный ID события для рассылки.";return}S.value=!0,C.value="";const r={event_id:Q.value,message:"Открыли свежий ивент — бронируй места первыми!"};try{const{error:t}=await $.post("/api/v1/organizer/demand/convert",r,{$fetch:h.apiFetch});if(t.value)throw t.value;C.value="Пуш отправлен тем, кто ждёт событие."}catch{C.value="Не удалось отправить пуш. Попробуй позже."}finally{S.value=!1}},G=u(()=>typeof window<"u"?`${window.location.origin}/e/${x.value}?ref=organizer`:`https://smartevents.app/e/${x.value}?ref=organizer`),I=M(""),ye=async()=>{navigator?.clipboard&&(await navigator.clipboard.writeText(G.value),I.value="Ссылка скопирована",setTimeout(()=>{I.value=""},2e3))},we=()=>{De(`/events/${k.value}/live`)},ke=()=>{window.open(`/e/${x.value}`,"_blank")};return(r,t)=>(i(),c("div",je,[l("section",Ee,[l("div",Qe,[l("div",He,[l("div",Oe,[s(e(Ne),{class:"h-4 w-4"}),l("span",null,d(e(ce)),1),s(e(Se),{variant:e(ie)},{default:a(()=>[n(d(e(ue)),1)]),_:1},8,["variant"])]),l("h1",Ke,d(e(de)),1)]),l("div",We,[s(e(y),{variant:"secondary",size:"sm",class:"gap-2",onClick:we},{default:a(()=>[s(e(Te),{class:"h-4 w-4"}),t[1]||(t[1]=n(" Live Console ",-1))]),_:1}),s(e(y),{variant:"outline",size:"sm",class:"gap-2",disabled:""},{default:a(()=>[s(e(Ae),{class:"h-4 w-4"}),t[2]||(t[2]=n(" Редактировать ",-1))]),_:1}),s(e(y),{variant:"link",size:"sm",class:"gap-2",onClick:ke},{default:a(()=>[s(e(Ue),{class:"h-4 w-4"}),t[3]||(t[3]=n(" Открыть на сайте ",-1))]),_:1})])])]),e(re)?(i(),Y(e(p),{key:0,class:"p-6"},{default:a(()=>[s(e(v),{class:"p-0"},{default:a(()=>[s(e(g),null,{default:a(()=>[...t[4]||(t[4]=[n("Событие не найдено",-1)])]),_:1}),s(e(_),null,{default:a(()=>[...t[5]||(t[5]=[n("Проверь ссылку или попробуй открыть другое событие.",-1)])]),_:1})]),_:1})]),_:1})):(i(),c("div",Xe,[s(e(Ie),{modelValue:e(B),"onUpdate:modelValue":t[0]||(t[0]=o=>Le(B)?B.value=o:null),tabs:_e},{overview:a(()=>[l("div",Ge,[l("section",Je,[s(e(p),null,{default:a(()=>[s(e(v),null,{default:a(()=>[s(e(_),null,{default:a(()=>[...t[6]||(t[6]=[n("Продано билетов",-1)])]),_:1}),s(e(g),null,{default:a(()=>[n(d(e(fe)),1)]),_:1})]),_:1})]),_:1}),s(e(p),null,{default:a(()=>[s(e(v),null,{default:a(()=>[s(e(_),null,{default:a(()=>[...t[7]||(t[7]=[n("Выручка",-1)])]),_:1}),s(e(g),null,{default:a(()=>[n(d(e(me)),1)]),_:1})]),_:1})]),_:1}),s(e(p),null,{default:a(()=>[s(e(v),null,{default:a(()=>[s(e(_),null,{default:a(()=>[...t[8]||(t[8]=[n("Интерес (Buddy)",-1)])]),_:1}),s(e(g),null,{default:a(()=>[n(d(e(pe)),1)]),_:1})]),_:1})]),_:1}),s(e(p),null,{default:a(()=>[s(e(v),null,{default:a(()=>[s(e(_),null,{default:a(()=>[...t[9]||(t[9]=[n("Просмотры",-1)])]),_:1}),s(e(g),null,{default:a(()=>[n(d(e(ve)),1)]),_:1})]),_:1})]),_:1})]),l("div",Ye,[s(e(p),{class:"lg:col-span-2"},{default:a(()=>[s(e(v),null,{default:a(()=>[s(e(g),null,{default:a(()=>[...t[10]||(t[10]=[n("Выручка по типам билетов",-1)])]),_:1}),s(e(_),null,{default:a(()=>[...t[11]||(t[11]=[n("Доля проданных билетов внутри каждого типа.",-1)])]),_:1})]),_:1}),s(e(V),{class:"space-y-4"},{default:a(()=>[e(se)?(i(),c("div",Ze,"Собираем данные...")):e(T).length===0?(i(),c("div",qe," Пока нет продаж по типам билетов. ")):(i(),c("div",et,[(i(!0),c(A,null,j(e(T),o=>(i(),c("div",{key:o.ticket_type_id,class:"space-y-2"},[l("div",tt,[l("span",null,d(o.ticket_name),1),l("span",null,d(R(o.revenue)),1)]),l("div",st,[l("div",{class:"h-full rounded-full bg-primary",style:Z({width:`${Math.round(o.sold/e(ge)*100)}%`})},null,4)]),l("p",at,d(o.sold)+" билетов • "+d(R(o.price)),1)]))),128))]))]),_:1})]),_:1}),s(e(p),null,{default:a(()=>[s(e(v),null,{default:a(()=>[s(e(g),null,{default:a(()=>[...t[12]||(t[12]=[n("Воронка внимания",-1)])]),_:1}),s(e(_),null,{default:a(()=>[...t[13]||(t[13]=[n("Как аудитория движется к покупке.",-1)])]),_:1})]),_:1}),s(e(V),{class:"space-y-4"},{default:a(()=>[(i(!0),c(A,null,j(e(W),o=>(i(),c("div",{key:o.label,class:"space-y-2"},[l("div",lt,[l("span",ot,d(o.label),1),l("span",nt,d(e(F).format(o.value)),1)]),l("div",rt,[l("div",{class:"h-full rounded-full bg-foreground/80",style:Z({width:`${Math.min(100,o.value/Math.max(1,e(W)[0]?.value||1)*100)}%`})},null,4)])]))),128))]),_:1})]),_:1})])])]),qa:a(()=>[l("div",dt,[l("div",ut,[t[15]||(t[15]=l("div",null,[l("h2",{class:"text-lg font-semibold text-foreground"},"Вопросы от аудитории"),l("p",{class:"text-sm text-muted-foreground"},"Отвечай быстро — ответы публикуются сразу.")],-1)),s(e(y),{variant:"outline",size:"sm",onClick:e(ne)},{default:a(()=>[...t[14]||(t[14]=[n("Обновить",-1)])]),_:1},8,["onClick"])]),e(L)?(i(),c("p",it,d(e(L)),1)):U("",!0),e(oe)?(i(),c("div",ct,"Загружаем вопросы...")):e(X).length===0?(i(),c("div",ft," Пока нет вопросов. Как только появятся — они будут здесь. ")):(i(),c("div",mt,[(i(!0),c(A,null,j(e(X),o=>(i(),Y(e(p),{key:o.id,class:Ve(o.answer?"border-emerald-200 bg-emerald-50/50":"")},{default:a(()=>[s(e(v),null,{default:a(()=>[s(e(g),{class:"text-base"},{default:a(()=>[n(d(o.question),1)]),_:2},1024),s(e(_),null,{default:a(()=>[n(d(o.user?.username?"@"+o.user?.username:"Гость")+" · "+d(new Date(o.created_at).toLocaleString("ru-RU")),1)]),_:2},1024)]),_:2},1024),s(e(V),{class:"space-y-3"},{default:a(()=>[o.answer?(i(),c("div",pt,d(o.answer),1)):(i(),c("div",vt,[s(e(Pe),{modelValue:e(z)[o.id],"onUpdate:modelValue":b=>e(z)[o.id]=b,placeholder:"Напиши ответ..."},null,8,["modelValue","onUpdate:modelValue"]),s(e(y),{class:"w-full",disabled:e(P)[o.id]||!(e(z)[o.id]||"").trim(),onClick:b=>xe(o)},{default:a(()=>[n(d(e(P)[o.id]?"Отправляем...":"Ответить"),1)]),_:2},1032,["disabled","onClick"])]))]),_:2},1024)]),_:2},1032,["class"]))),128))]))])]),marketing:a(()=>[l("div",gt,[s(e(p),{class:"lg:col-span-2"},{default:a(()=>[s(e(v),null,{default:a(()=>[s(e(g),null,{default:a(()=>[...t[16]||(t[16]=[n("Реферальная программа",-1)])]),_:1}),s(e(_),null,{default:a(()=>[...t[17]||(t[17]=[n("Стимулируй фанатов делиться ивентом.",-1)])]),_:1})]),_:1}),s(e(V),{class:"space-y-4"},{default:a(()=>[t[20]||(t[20]=l("div",{class:"grid gap-3 md:grid-cols-2"},[l("div",{class:"rounded-2xl border border-border bg-background p-4"},[l("p",{class:"text-sm font-semibold text-foreground"},"Скаут"),l("p",{class:"text-xs text-muted-foreground"},"2 приглашённых друга = мерч или скидка.")]),l("div",{class:"rounded-2xl border border-border bg-background p-4"},[l("p",{class:"text-sm font-semibold text-foreground"},"Инфлюенсер"),l("p",{class:"text-xs text-muted-foreground"},"10+ приглашений = VIP вход.")])],-1)),l("div",_t,[t[19]||(t[19]=l("label",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground"}," Реферальная ссылка ",-1)),l("div",xt,[s(e(Fe),{"model-value":e(G),class:"min-w-[240px] flex-1"},null,8,["model-value"]),s(e(y),{variant:"outline",size:"sm",onClick:ye},{default:a(()=>[...t[18]||(t[18]=[n("Скопировать",-1)])]),_:1})]),e(I)?(i(),c("p",bt,d(e(I)),1)):U("",!0)])]),_:1})]),_:1}),s(e(p),null,{default:a(()=>[s(e(v),null,{default:a(()=>[s(e(g),null,{default:a(()=>[...t[21]||(t[21]=[n("Спрос",-1)])]),_:1}),s(e(_),null,{default:a(()=>[...t[22]||(t[22]=[n("Горячие пользователи, которые ждут ивент.",-1)])]),_:1})]),_:1}),s(e(V),{class:"space-y-3"},{default:a(()=>[l("div",yt,[t[23]||(t[23]=l("p",{class:"text-xs uppercase tracking-[0.2em] text-muted-foreground"},"Ждут событие",-1)),l("p",wt,d(e(O)?.waiting_count??0),1)]),l("div",kt,[t[24]||(t[24]=l("p",{class:"text-xs uppercase tracking-[0.2em] text-muted-foreground"},"Новых за неделю",-1)),l("p",ht,d(e(O)?.recent_waiting_count??0),1)]),s(e(y),{class:"w-full gap-2",disabled:e(S),onClick:be},{default:a(()=>[s(e(Be),{class:"h-4 w-4"}),n(" "+d(e(S)?"Отправляем...":"Отправить пуш ждущим"),1)]),_:1},8,["disabled"]),e(C)?(i(),c("p",Ct,d(e(C)),1)):U("",!0)]),_:1})]),_:1})])]),_:1},8,["modelValue"])]))]))}});export{Ht as default};
