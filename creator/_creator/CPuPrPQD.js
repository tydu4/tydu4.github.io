const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DDryAGrK.js","./D9Gj93nn.js","./entry.DPjpTCFc.css"])))=>i.map(i=>d[i]);
import{b as Re,u as Le,a1 as qe,a3 as j,G as Ne,h as Oe,C as r,D as o,P as k,M as p,R as s,W as F,O as g,S as C,N as u,U as ae,V as ne,X as q,Q as Ie,l as f,am as Be,t as c,B as l,an as Pe,ao as je}from"./D9Gj93nn.js";import{u as Fe}from"./ehuJmiRb.js";import T from"./BTl0NxUM.js";import Qe from"./CFXH2yXk.js";import{S as Ue}from"./CLW889pg.js";import{c as D}from"./ZqIlnLQN.js";import"./Dg2pdhbl.js";import"./CkYB-R1u.js";import"./c5FhCeC0.js";const Ge=D("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const We=D("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);const Xe=D("keyboard",[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]]);const He=D("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);const Ke=D("scan-line",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]]),Je={class:"min-h-screen bg-slate-950 text-white"},Ye={class:"sticky top-0 z-30 border-b border-white/10 bg-slate-950/95 px-4 py-4 backdrop-blur"},Ze={class:"mx-auto flex w-full max-w-3xl flex-wrap items-center justify-between gap-3"},et={class:"space-y-1"},tt={class:"text-base text-white/80"},st={class:"font-semibold text-emerald-300"},at={class:"flex items-center gap-2"},nt={class:"rounded-full border border-white/20 bg-white/5 px-3 py-1 text-xs font-semibold text-white/80"},ot={class:"px-4 py-5"},lt={key:0,class:"mx-auto max-w-xl space-y-4"},rt={class:"rounded-3xl border border-white/10 bg-white/5 p-6 shadow-2xl"},it={class:"mt-5 space-y-3"},ct=["disabled"],ut=["value"],dt={key:0,class:"text-sm text-white/70"},ht={key:1,class:"text-sm text-red-300"},mt={key:2,class:"text-sm text-white/70"},pt={key:1,class:"mx-auto max-w-3xl space-y-4"},vt={class:"rounded-3xl border border-white/10 bg-white/5 p-4 shadow-2xl"},xt={class:"mt-1 text-xl font-semibold"},ft={class:"text-sm text-white/65"},yt={class:"mt-4 grid grid-cols-2 gap-2"},wt={key:0,class:"space-y-3"},kt={key:0,class:"relative overflow-hidden rounded-3xl border border-white/10 bg-black"},gt={key:1,class:"rounded-2xl bg-red-500/90 px-4 py-3 text-sm"},bt={key:1,class:"space-y-3 rounded-3xl border border-white/10 bg-white/5 p-4 shadow-2xl"},_t={key:0,class:"text-sm text-white/70"},Ct={key:1,class:"text-sm text-red-300"},Tt={key:2,class:"text-sm text-white/70"},At={key:3,class:"text-sm text-white/70"},Mt={key:4,class:"space-y-2"},Vt={class:"min-w-0"},zt={class:"truncate text-base font-semibold"},Et={class:"truncate text-xs text-white/60"},St={class:"text-xs text-emerald-300"},$t={class:"space-y-4"},Dt={class:"mx-auto flex h-24 w-24 items-center justify-center rounded-full bg-white/15"},Rt={class:"text-3xl font-black leading-snug"},Ut=Re({__name:"index",async setup(Lt){let d,A;const R=Fe(),V=Le(),{user:Q}=qe(V),oe=Pe(async()=>(await je(()=>import("./DDryAGrK.js"),__vite__mapDeps([0,1,2]),import.meta.url)).QrcodeStream),N=new Date().toISOString().slice(0,10),{data:le,pending:U,error:re,refresh:ie}=([d,A]=j(()=>R.get("/api/v1/events/",{$fetch:V.apiFetch,query:{start_date:N,end_date:N,status:"scheduled",limit:100}})),d=await d,A(),d),G=c(()=>le.value??[]),ce=t=>!!(t&&t.slice(0,10)===N),W=c(()=>G.value.filter(t=>t.occurrences?.some(e=>ce(e.start_time)))),O=c(()=>W.value.length?W.value:G.value),h=f(null),ue=c(()=>O.value.find(t=>t.id===h.value)??null),X=c(()=>h.value?`/api/v1/organizer/events/${h.value}/stats`:"/api/v1/organizer/events/0/stats"),{data:de,pending:he,refresh:I}=([d,A]=j(()=>R.get(X,{$fetch:V.apiFetch,immediate:!1,watch:[X]})),d=await d,A(),d),B=c(()=>de.value??null),me=c(()=>B.value?.check_in_count??0),pe=c(()=>B.value?.total_capacity??B.value?.tickets_sold??0),ve=c(()=>`${me.value} / ${pe.value||"‚Äî"}`),H=c(()=>h.value?`/api/v1/organizer/events/${h.value}/attendees`:"/api/v1/organizer/events/0/attendees"),{data:xe,pending:fe,error:ye,refresh:K}=([d,A]=j(()=>R.get(H,{$fetch:V.apiFetch,immediate:!1,watch:[H],query:{limit:500,offset:0}})),d=await d,A(),d),we=c(()=>xe.value?.items??[]),J=(t,e)=>{for(const a of e){const n=t[a];if(typeof n=="string"&&n.trim())return n.trim()}return""},ke=c(()=>we.value.map((t,e)=>{const a=t,n=t.user.full_name||t.user.username||`–ì–æ—Å—Ç—å #${e+1}`,i=J(a,["ticket_uuid","ticket_code","code","uuid"])||t.user.uuid,S=J(a,["ticket_type","ticket_name","type"])||"–ë–∏–ª–µ—Ç";return{id:`${t.user.id}-${i}`,name:n,ticketCode:i,ticketType:S}})),v=f("scanner"),m=f(!1),M=f(""),b=f(!1),x=f(null),z=f(null),y=f(""),E=t=>t.trim().toLowerCase().replace(/\s+/g," "),ge=t=>{if(t.length<6)return!1;const e=/\d/.test(t),a=/[a-z-]/i.test(t);return e||a},be=c(()=>{const t=E(y.value);return t.length<2?[]:ke.value.filter(e=>{const a=E(e.name).includes(t),n=E(e.ticketCode).includes(t);return a||n}).slice(0,30)}),P=c(()=>{const t=y.value.trim(),e=[...be.value];return!t||!ge(t)?e:(e.some(n=>E(n.ticketCode)===E(t))||e.unshift({id:`typed-${t}`,name:"–ö–æ–¥ –∏–∑ –≤–≤–æ–¥–∞",ticketCode:t,ticketType:"–í–≤–æ–¥ –≤—Ä—É—á–Ω—É—é"}),e.slice(0,30))}),_e=c(()=>Q.value?.full_name||Q.value?.username||"–û–ø–µ—Ä–∞—Ç–æ—Ä"),Y=f(""),Z=f(0),ee=()=>{z.value&&(clearTimeout(z.value),z.value=null)},Ce=t=>{try{const e=new AudioContext,a=e.currentTime;if(t==="success"){[960,1280].forEach((S,w)=>{const _=e.createOscillator(),$=e.createGain();_.type="sine",_.frequency.setValueAtTime(S,a+w*.08),$.gain.setValueAtTime(1e-4,a+w*.08),$.gain.exponentialRampToValueAtTime(.08,a+w*.08+.01),$.gain.exponentialRampToValueAtTime(1e-4,a+w*.08+.12),_.connect($),$.connect(e.destination),_.start(a+w*.08),_.stop(a+w*.08+.12)}),setTimeout(()=>{e.close()},280);return}const n=e.createOscillator(),i=e.createGain();n.type="sawtooth",n.frequency.setValueAtTime(220,a),n.frequency.linearRampToValueAtTime(120,a+.32),i.gain.setValueAtTime(1e-4,a),i.gain.exponentialRampToValueAtTime(.1,a+.02),i.gain.exponentialRampToValueAtTime(1e-4,a+.34),n.connect(i),i.connect(e.destination),n.start(a),n.stop(a+.34),setTimeout(()=>{e.close()},420)}catch{}},L=t=>{ee(),x.value=t,Ce(t.status),z.value=setTimeout(()=>{x.value=null,z.value=null},2600)},te=t=>{const e=(t||"").trim();if(!e)return"–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω";const a=e.toLowerCase();return a.includes("already")||a.includes("used")||a.includes("—É–∂–µ")?"–ë–∏–ª–µ—Ç —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!":a.includes("invalid")||a.includes("–Ω–µ–¥–µ–π—Å—Ç–≤")||a.includes("–Ω–µ–≤–∞–ª–∏–¥")?"–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω":e},Te=t=>{if(!t)return"";if(typeof t=="string")return t.trim();if(Array.isArray(t)){const e=t[0];return(e?.rawValue||e?.text||"").trim()}return""},se=async t=>{const e=t.trim();if(!(!e||b.value||!h.value)){b.value=!0;try{const{data:a,error:n}=await R.post("/api/v1/organizer/checkin/scan",{ticket_uuid:e},{$fetch:V.apiFetch});if(n.value){const _=(n.value?.data?.message||n.value?.data?.detail)??"";L({status:"error",message:te(_)});return}const i=a.value;if(!i){L({status:"error",message:"–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω"});return}if(!i.success){L({status:"error",message:te(i.message)});return}const S=i.user?.full_name||i.user?.username||"–ì–æ—Å—Ç—å",w=i.ticket_type?`${i.ticket_type} –±–∏–ª–µ—Ç`:"–ë–∏–ª–µ—Ç";L({status:"success",message:`${S}. ${w}. –ü—Ä–æ—Ö–æ–¥–∏—Ç–µ.`}),await Promise.allSettled([I(),K()])}finally{b.value=!1}}},Ae=async t=>{if(v.value!=="scanner"||!m.value||b.value||x.value)return;const e=Te(t);if(!e)return;const a=Date.now();e===Y.value&&a-Z.value<2500||(Y.value=e,Z.value=a,await se(e))},Me=t=>{M.value=t instanceof Error?t.message:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É."},Ve=()=>{v.value="scanner",M.value="",m.value=!0},ze=()=>{m.value=!1},Ee=()=>{v.value="manual",m.value=!1},Se=()=>{v.value="scanner"},$e=()=>{h.value=null,v.value="scanner",m.value=!1,M.value="",y.value="",x.value=null},De=t=>{const e=Number(t.target.value);h.value=Number.isFinite(e)&&e>0?e:null};return Ne(h,t=>{y.value="",M.value="",x.value=null,m.value=!1,t&&(I(),K())}),Oe(()=>{ee(),m.value=!1}),(t,e)=>{const a=Be;return l(),r("div",Je,[o("header",Ye,[o("div",Ze,[o("div",et,[e[3]||(e[3]=o("p",{class:"text-xs uppercase tracking-[0.35em] text-white/50"},"Check-in PWA",-1)),e[4]||(e[4]=o("h1",{class:"text-2xl font-black leading-tight"},"–°–∫–∞–Ω–µ—Ä –±–∏–ª–µ—Ç–æ–≤",-1)),o("p",tt,[e[2]||(e[2]=k(" –í–Ω—É—Ç—Ä–∏: ",-1)),o("span",st,p(s(ve)),1)])]),o("div",at,[o("span",nt,p(s(_e)),1),s(h)?(l(),F(s(T),{key:0,variant:"outline",size:"sm",class:"h-10 border-white/20 text-white hover:bg-white/10",onClick:$e},{default:g(()=>[...e[5]||(e[5]=[k(" –°–º–µ–Ω–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ ",-1)])]),_:1})):C("",!0)])])]),o("main",ot,[s(h)?(l(),r("section",pt,[o("div",vt,[e[13]||(e[13]=o("p",{class:"text-xs uppercase tracking-[0.28em] text-white/55"},"–¢–µ–∫—É—â–µ–µ —Å–æ–±—ã—Ç–∏–µ",-1)),o("h2",xt,p(s(ue)?.title),1),o("p",ft,p(s(he)?"–û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É...":"–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ –±–∏–ª–µ—Ç–æ–≤"),1),o("div",yt,[u(s(T),{class:q(["h-12 w-full",s(v)==="scanner"?"":"border-white/20 text-white hover:bg-white/10"]),variant:s(v)==="scanner"?"default":"outline",onClick:Se},{default:g(()=>[u(s(Ke),{class:"mr-2 h-4 w-4"}),e[11]||(e[11]=k(" –°–∫–∞–Ω–µ—Ä ",-1))]),_:1},8,["variant","class"]),u(s(T),{class:q(["h-12 w-full",s(v)==="manual"?"":"border-white/20 text-white hover:bg-white/10"]),variant:s(v)==="manual"?"default":"outline",onClick:Ee},{default:g(()=>[u(s(Xe),{class:"mr-2 h-4 w-4"}),e[12]||(e[12]=k(" –†—É—á–Ω–æ–π –≤–≤–æ–¥ ",-1))]),_:1},8,["variant","class"])])]),s(v)==="scanner"?(l(),r("div",wt,[u(s(T),{class:q(["h-24 w-full rounded-3xl text-2xl font-black tracking-wide",s(m)?"bg-red-500 hover:bg-red-600":"bg-emerald-500 hover:bg-emerald-600"]),disabled:s(b),onClick:e[0]||(e[0]=n=>s(m)?ze():Ve())},{default:g(()=>[k(p(s(m)?"‚èπ –û–°–¢–ê–ù–û–í–ò–¢–¨ –°–ö–ê–ù–ï–†":"üì∑ –°–ö–ê–ù–ò–†–û–í–ê–¢–¨ QR"),1)]),_:1},8,["class","disabled"]),s(m)?(l(),r("div",kt,[u(a,null,{default:g(()=>[u(s(oe),{class:"h-[55vh] w-full object-cover",paused:!!s(x)||s(b),onDetect:Ae,onError:Me},null,8,["paused"])]),_:1}),e[14]||(e[14]=o("div",{class:"pointer-events-none absolute inset-0 flex items-center justify-center p-6"},[o("div",{class:"h-64 w-full max-w-[18rem] rounded-3xl border-4 border-emerald-400/80 shadow-[0_0_40px_rgba(16,185,129,0.45)]"})],-1)),e[15]||(e[15]=o("div",{class:"absolute left-3 top-3 rounded-full bg-black/50 px-3 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-white/80"}," –ù–∞–≤–µ–¥–∏ QR –≤ —Ä–∞–º–∫—É ",-1))])):C("",!0),s(M)?(l(),r("p",gt,p(s(M)),1)):C("",!0)])):(l(),r("div",bt,[e[17]||(e[17]=o("h3",{class:"text-lg font-semibold"},"–†—É—á–Ω–æ–π –ø–æ–∏—Å–∫",-1)),u(s(Qe),{modelValue:s(y),"onUpdate:modelValue":e[1]||(e[1]=n=>Ie(y)?y.value=n:null),class:"h-14 rounded-2xl border-white/20 bg-slate-900 text-base text-white placeholder:text-white/45",placeholder:"–§–∞–º–∏–ª–∏—è / –ö–æ–¥ –±–∏–ª–µ—Ç–∞"},null,8,["modelValue"]),s(fe)?(l(),r("p",_t,"–ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π...")):s(ye)?(l(),r("p",Ct,"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≥–æ—Å—Ç–µ–π.")):s(y).trim().length<2?(l(),r("p",Tt," –í–≤–µ–¥–∏—Ç–µ –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞. ")):s(P).length===0?(l(),r("p",At," –°–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. ")):C("",!0),s(P).length?(l(),r("div",Mt,[(l(!0),r(ae,null,ne(s(P),n=>(l(),r("div",{key:n.id,class:"flex items-center justify-between gap-3 rounded-2xl border border-white/10 bg-slate-900/70 p-3"},[o("div",Vt,[o("p",zt,p(n.name),1),o("p",Et,"–ö–æ–¥: "+p(n.ticketCode),1),o("p",St,p(n.ticketType),1)]),u(s(T),{class:"h-11 shrink-0 px-4",disabled:s(b),onClick:i=>se(n.ticketCode)},{default:g(()=>[...e[16]||(e[16]=[k(" Check-in ",-1)])]),_:1},8,["disabled","onClick"])]))),128))])):C("",!0)])),u(s(T),{variant:"outline",class:"h-12 w-full border-white/20 text-white hover:bg-white/10",onClick:s(I)},{default:g(()=>[u(s(He),{class:"mr-2 h-4 w-4"}),e[18]||(e[18]=k(" –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ ",-1))]),_:1},8,["onClick"])])):(l(),r("section",lt,[o("div",rt,[u(s(Ue),{class:"mx-auto h-12 w-12 text-emerald-300"}),e[9]||(e[9]=o("h2",{class:"mt-4 text-center text-2xl font-semibold"},"–í—ã–±–µ—Ä–∏ —Å–æ–±—ã—Ç–∏–µ",-1)),e[10]||(e[10]=o("p",{class:"mt-2 text-center text-sm text-white/70"}," Check-in –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ. ",-1)),o("div",it,[e[8]||(e[8]=o("label",{class:"text-xs font-semibold uppercase tracking-[0.3em] text-white/55"},"–°–æ–±—ã—Ç–∏—è",-1)),o("select",{class:"h-14 w-full rounded-2xl border border-white/15 bg-slate-900 px-4 text-lg font-semibold text-white focus:outline-none focus:ring-2 focus:ring-emerald-400",disabled:s(U),onChange:De},[e[6]||(e[6]=o("option",{value:""},"–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏–µ",-1)),(l(!0),r(ae,null,ne(s(O),n=>(l(),r("option",{key:n.id,value:n.id},p(n.title),9,ut))),128))],40,ct),s(U)?(l(),r("p",dt,"–ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π...")):s(re)?(l(),r("p",ht,"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–±—ã—Ç–∏—è.")):s(O).length===0?(l(),r("p",mt,"–°–µ–≥–æ–¥–Ω—è –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π.")):C("",!0),u(s(T),{variant:"outline",class:"w-full border-white/20 text-white hover:bg-white/10",onClick:s(ie)},{default:g(()=>[...e[7]||(e[7]=[k(" –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ ",-1)])]),_:1},8,["onClick"])])])]))]),s(x)?(l(),r("div",{key:0,class:q(["fixed inset-0 z-50 flex items-center justify-center px-6 text-center",s(x).status==="success"?"bg-green-500":"bg-red-600"])},[o("div",$t,[o("div",Dt,[s(x).status==="success"?(l(),F(s(Ge),{key:0,class:"h-16 w-16 text-white"})):(l(),F(s(We),{key:1,class:"h-16 w-16 text-white"}))]),o("h2",Rt,p(s(x).message),1)])],2)):C("",!0)])}}});export{Ut as default};
