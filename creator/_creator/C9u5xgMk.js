import{b as Z,an as re,G as be,C as f,D as l,M as F,S as H,N as v,R as s,O as z,W as k,ao as xe,l as b,B as d,P as _,a as Se,u as Fe,a1 as Me,a2 as D,t as P,$ as Pe,U as ne,V as he,J as we,Z as Ue,X as ze,F as je,Q as le}from"./Ca6rub8f.js";import j from"./Bc1u1-yo.js";import M from"./C3H3F2YC.js";import He from"./CLa6BjNG.js";import{c as W}from"./Cibw3ATY.js";import{X as ye}from"./HPLaWeW_.js";import{S as Be}from"./B4A1znAd.js";import"./CkYB-R1u.js";import"./c5FhCeC0.js";const Ie=W("image-plus",[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]]);const N=W("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);const Ee=W("locate-fixed",[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const $e=W("shield-alert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);const Re=W("shield-ellipsis",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M8 12h.01",key:"czm47f"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M16 12h.01",key:"1l6xoz"}]]);const ke=W("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),Ge={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},Oe={key:0,class:"mt-4 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-sm text-rose-700"},Ae={class:"mt-6 grid gap-4 md:grid-cols-2"},qe={class:"rounded-xl border border-slate-200 p-4"},Ne={class:"mt-3 flex h-40 items-center justify-center overflow-hidden rounded-lg border border-dashed border-slate-300 bg-slate-50"},Te=["src"],De={key:1,class:"text-xs text-slate-500"},We={class:"mt-3 flex gap-2"},Je={class:"rounded-xl border border-slate-200 p-4"},Ke={class:"mt-3 flex h-40 items-center justify-center overflow-hidden rounded-lg border border-dashed border-slate-300 bg-slate-50"},Xe=["src"],Qe={key:1,class:"text-xs text-slate-500"},Ye={class:"mt-3 flex gap-2"},Ze={class:"mt-6 grid gap-4 md:grid-cols-2"},et={class:"space-y-2"},tt={class:"space-y-2"},lt={class:"space-y-2 md:col-span-2"},at=Z({__name:"ProfileGeneralBlock",props:xe({uploadHandlers:{}},{form:{required:!0},formModifiers:{}}),emits:["update:form"],setup(o){const t=re(o,"form"),n=o,e=b(null),m=b(null),$=b(!1),V=h=>h.toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");be(()=>t.value.name,h=>{$.value||(t.value.slug=V(h))});const r=h=>{$.value=!0,t.value.slug=h},c=()=>{$.value=!0,t.value.slug=V(t.value.slug||t.value.name)},p=()=>e.value?.click(),w=()=>m.value?.click(),E=async h=>{const u=h.target,x=u?.files?.[0];x&&(await n.uploadHandlers.uploadLogo(x),u&&(u.value=""))},R=async h=>{const u=h.target,x=u?.files?.[0];x&&(await n.uploadHandlers.uploadCover(x),u&&(u.value=""))};return(h,u)=>(d(),f("section",Ge,[u[11]||(u[11]=l("h3",{class:"text-base font-semibold text-slate-900"},"Общие настройки",-1)),u[12]||(u[12]=l("p",{class:"mt-1 text-sm text-slate-600"}," Логотип, обложка, название и описание. ",-1)),o.uploadHandlers.mediaError?(d(),f("p",Oe,F(o.uploadHandlers.mediaError),1)):H("",!0),l("div",Ae,[l("div",qe,[u[4]||(u[4]=l("p",{class:"text-sm font-semibold text-slate-900"},"Логотип",-1)),l("div",Ne,[t.value.logoUrl?(d(),f("img",{key:0,src:t.value.logoUrl,alt:"Logo",class:"h-full w-full object-cover"},null,8,Te)):(d(),f("span",De,"Нет загруженного логотипа"))]),l("input",{ref_key:"logoInputRef",ref:e,type:"file",class:"hidden",accept:"image/*",onChange:E},null,544),l("div",We,[v(s(j),{type:"button",variant:"outline",class:"gap-2",disabled:o.uploadHandlers.uploadingLogo,onClick:p},{default:z(()=>[o.uploadHandlers.uploadingLogo?(d(),k(s(N),{key:0,class:"h-4 w-4 animate-spin"})):(d(),k(s(ke),{key:1,class:"h-4 w-4"})),u[2]||(u[2]=_(" Загрузить ",-1))]),_:1},8,["disabled"]),t.value.logoUrl?(d(),k(s(j),{key:0,type:"button",variant:"ghost",class:"gap-2 text-slate-600",onClick:o.uploadHandlers.clearLogo},{default:z(()=>[v(s(ye),{class:"h-4 w-4"}),u[3]||(u[3]=_(" Очистить ",-1))]),_:1},8,["onClick"])):H("",!0)])]),l("div",Je,[u[7]||(u[7]=l("p",{class:"text-sm font-semibold text-slate-900"},"Обложка",-1)),l("div",Ke,[t.value.coverUrl?(d(),f("img",{key:0,src:t.value.coverUrl,alt:"Cover",class:"h-full w-full object-cover"},null,8,Xe)):(d(),f("span",Qe,"Нет загруженной обложки"))]),l("input",{ref_key:"coverInputRef",ref:m,type:"file",class:"hidden",accept:"image/*",onChange:R},null,544),l("div",Ye,[v(s(j),{type:"button",variant:"outline",class:"gap-2",disabled:o.uploadHandlers.uploadingCover,onClick:w},{default:z(()=>[o.uploadHandlers.uploadingCover?(d(),k(s(N),{key:0,class:"h-4 w-4 animate-spin"})):(d(),k(s(Ie),{key:1,class:"h-4 w-4"})),u[5]||(u[5]=_(" Загрузить ",-1))]),_:1},8,["disabled"]),t.value.coverUrl?(d(),k(s(j),{key:0,type:"button",variant:"ghost",class:"gap-2 text-slate-600",onClick:o.uploadHandlers.clearCover},{default:z(()=>[v(s(ye),{class:"h-4 w-4"}),u[6]||(u[6]=_(" Очистить ",-1))]),_:1},8,["onClick"])):H("",!0)])])]),l("div",Ze,[l("div",et,[u[8]||(u[8]=l("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Название ",-1)),v(s(M),{modelValue:t.value.name,"onUpdate:modelValue":u[0]||(u[0]=x=>t.value.name=x),placeholder:"Smart Events"},null,8,["modelValue"])]),l("div",tt,[l("div",{class:"flex items-center justify-between gap-2"},[u[9]||(u[9]=l("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Slug ",-1)),l("button",{type:"button",class:"text-xs font-medium text-cyan-700 hover:text-cyan-800",onClick:c}," Нормализовать ")]),v(s(M),{"model-value":t.value.slug,placeholder:"smart-events","onUpdate:modelValue":r},null,8,["model-value"])]),l("div",lt,[u[10]||(u[10]=l("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Описание ",-1)),v(s(He),{modelValue:t.value.bio,"onUpdate:modelValue":u[1]||(u[1]=x=>t.value.bio=x),rows:4,placeholder:"Кратко расскажите о деятельности."},null,8,["modelValue"])])])]))}}),st=Object.assign(at,{__name:"SettingsProfileGeneralBlock"}),oe=[{key:"telegram",label:"Telegram",placeholder:"https://t.me/brand"},{key:"vk",label:"VK",placeholder:"https://vk.com/brand"},{key:"instagram",label:"Instagram",placeholder:"https://instagram.com/brand"},{key:"youtube",label:"YouTube",placeholder:"https://youtube.com/@brand"}],Ve=()=>({name:"",slug:"",bio:"",phone:"",website:"",email:"",logoUrl:"",coverUrl:"",address:"",city:"",lat:"",lon:"",capacity:"",parking:!1,wifi:!1,galleryUrls:[],socialLinks:{telegram:"",vk:"",instagram:"",youtube:""}}),ot=o=>o.toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),I=o=>o.trim()||null,ae=o=>{const t=o.trim().replace(",",".");if(!t)return null;const n=Number(t);return Number.isFinite(n)?n:null},Ce=o=>{if(!o)return!1;const t=o.toLowerCase();return t==="true"||t==="1"||t==="yes"||t==="on"},_e=o=>{if(!o||typeof o!="object")return{};const t=o,n={};for(const[e,m]of Object.entries(t)){if(typeof m=="string"&&m.trim()){n[e]=m.trim();continue}(typeof m=="number"||typeof m=="boolean")&&(n[e]=String(m))}return n},rt=o=>{if(typeof o=="string")return o;if(!o||typeof o!="object")return"";const t=o;if(typeof t.url=="string")return t.url;if(typeof t.image_url=="string")return t.image_url;const n=t.data;if(n&&typeof n=="object"){const e=n;if(typeof e.url=="string")return e.url;if(typeof e.image_url=="string")return e.image_url}return""},se=(o,t)=>{const n=o;if(typeof n?.data?.detail=="string"&&n.data.detail.trim())return n.data.detail;if(Array.isArray(n?.data?.detail)&&n.data?.detail.length){const e=n.data.detail[0];if(typeof e?.msg=="string"&&e.msg.trim())return e.msg}return typeof n?.data?.message=="string"&&n.data.message.trim()?n.data.message:typeof n?.statusMessage=="string"&&n.statusMessage.trim()?n.statusMessage:typeof n?.message=="string"&&n.message.trim()?n.message:t},nt=o=>o<1024?`${o} B`:o<1024*1024?`${Math.round(o/1024)} KB`:`${(o/(1024*1024)).toFixed(1)} MB`,it=()=>{const o=Se(),t=Fe(),{currentContext:n}=Me(o),e=Pe(Ve()),m=b(!1),$=b(""),V=b(!1),r=b(""),c=b(""),p=b(""),w=b(!1),E=b(!1),R=b(!1),h=b(!1),u=b("unverified"),x=b([]),J=b(!1),G=b(""),B=b(""),ie=P(()=>!!n.value),K=P(()=>n.value?.type==="venue"),ee=P(()=>K.value?"площадки":"организатора"),de=P(()=>{const a=ae(e.lat),i=ae(e.lon);if(a!==null&&i!==null)return`https://www.google.com/maps?q=${a},${i}&z=16&output=embed`;const g=[e.address.trim(),e.city.trim()].filter(Boolean).join(", ");return g?`https://www.google.com/maps?q=${encodeURIComponent(g)}&output=embed`:"https://www.google.com/maps?q=Moscow&output=embed"}),ue=()=>{Object.assign(e,Ve()),p.value="",u.value="unverified"},te=a=>{for(const i of oe)e.socialLinks[i.key]=a[i.key]||"";e.email=a.email||""},ce=a=>{const i=_e(a.social_links);if(e.name=a.name||"",e.slug=a.slug||"",e.bio=a.description||"",e.logoUrl=a.logo_url||"",e.coverUrl=a.cover_image_url||"",e.website=a.website||"",e.phone=i.phone||"",te(i),a.is_verified){u.value="verified";return}const g=i.verification_status;u.value=g==="pending"?"pending":"unverified"},me=a=>{const i=_e(a.social_links);e.name=a.name||"",e.slug=a.slug||"",e.bio=a.description||"",e.address=a.address||"",e.city=a.city||"",e.lat=a.lat!==void 0&&a.lat!==null?String(a.lat):"",e.lon=a.lon!==void 0&&a.lon!==null?String(a.lon):"",e.phone=a.contact_phone||i.phone||"",e.website=i.website||"",e.logoUrl=i.logo_url||"",e.coverUrl=i.cover_image_url||"",e.galleryUrls=Array.isArray(a.images)?[...a.images]:[],e.capacity=i.capacity||"",e.parking=Ce(i.parking),e.wifi=Ce(i.wifi),te(i);const g=i.verification_status;u.value=g==="verified"?"verified":g==="pending"?"pending":"unverified"},pe=()=>{const a=n.value;a&&(e.name=a.data?.name||"",e.slug=a.data?.slug||"",e.logoUrl=a.data?.logo_url||"")};let O=0;const X=async()=>{const a=n.value;if(ue(),$.value="",r.value="",c.value="",G.value="",B.value="",x.value=[],!a)return;const i=++O;m.value=!0,pe();try{const g=a.data?.slug;if(!g)return;if(a.type==="organizer"){const q=await t.apiFetch(`/api/v1/public/organizers/${g}`,{baseURL:D("/api/v1/public/organizers")});if(i!==O)return;ce(q);return}const U=await t.apiFetch(`/api/v1/public/venues/${g}`,{baseURL:D("/api/v1/public/venues")});if(i!==O)return;me(U)}catch(g){if(i!==O)return;$.value=se(g,"Не удалось загрузить полный профиль. Показаны базовые данные из текущего контекста.")}finally{i===O&&(m.value=!1)}};be(()=>[n.value?.type,n.value?.id,n.value?.data?.slug],()=>{X()},{immediate:!0});const A=async a=>{if(!a.type.startsWith("image/"))return p.value="Поддерживаются только изображения.",null;if(a.size>10*1024*1024)return p.value="Максимальный размер файла: 10 MB.",null;try{const i=new FormData;i.append("file",a);const g=await t.apiFetch("/api/v1/events/upload-image",{method:"POST",baseURL:D("/api/v1/events/upload-image"),body:i}),U=rt(g);return U||(p.value="Сервер не вернул URL загруженного файла.",null)}catch(i){return p.value=se(i,"Ошибка загрузки файла."),null}},L=async a=>{p.value="",w.value=!0;try{const i=await A(a);i&&(e.logoUrl=i)}finally{w.value=!1}},Q=async a=>{p.value="",E.value=!0;try{const i=await A(a);i&&(e.coverUrl=i)}finally{E.value=!1}},ge=async a=>{if(a.length){p.value="",R.value=!0;try{for(const i of a){const g=await A(i);g&&!e.galleryUrls.includes(g)&&e.galleryUrls.push(g)}}finally{R.value=!1}}},fe=()=>{e.logoUrl=""},T=()=>{e.coverUrl=""},y=a=>{e.galleryUrls.splice(a,1)},S=()=>{if(!navigator.geolocation){c.value="Геолокация недоступна в текущем браузере.";return}h.value=!0,c.value="",navigator.geolocation.getCurrentPosition(({coords:a})=>{e.lat=a.latitude.toFixed(6),e.lon=a.longitude.toFixed(6),h.value=!1},()=>{h.value=!1,c.value="Не удалось получить координаты. Проверьте доступ к геолокации."},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},Le=()=>{const a={};for(const g of oe){const U=e.socialLinks[g.key].trim();U&&(a[g.key]=U)}const i=e.email.trim();return i&&(a.email=i),u.value!=="unverified"&&(a.verification_status=u.value),a};return{form:e,hasContext:ie,isVenueContext:K,contextLabel:ee,mapEmbedUrl:de,pageLoading:m,pageError:$,saving:V,saveMessage:r,saveError:c,mediaError:p,uploadingLogo:w,uploadingCover:E,uploadingGallery:R,loadingLocation:h,verificationStatus:u,verificationFiles:x,verificationSubmitting:J,verificationMessage:G,verificationError:B,socialFields:oe,loadProfile:X,saveProfile:async()=>{const a=n.value;if(!a)return;r.value="",c.value="",p.value="";const i=e.name.trim();if(!i){c.value="Введите название.";return}const g=ot(e.slug||e.name);if(!g){c.value="Slug может содержать только латиницу и цифры.";return}e.slug=g;const U=ae(e.lat),q=ae(e.lon);if(e.lat.trim()&&U===null){c.value="Некорректный формат latitude.";return}if(e.lon.trim()&&q===null){c.value="Некорректный формат longitude.";return}if(K.value){if(!e.address.trim()){c.value="Для площадки укажите адрес.";return}if(!e.city.trim()){c.value="Для площадки укажите город.";return}}V.value=!0;try{const C=Le();if(a.type==="organizer"){const Y=e.phone.trim();Y&&(C.phone=Y);const ve={name:i,slug:g,description:I(e.bio),logo_url:I(e.logoUrl),cover_image_url:I(e.coverUrl),website:I(e.website),social_links:Object.keys(C).length?C:null};await t.apiFetch(`/api/v1/management/organizers/${a.id}`,{method:"PATCH",baseURL:D("/api/v1/management/organizers"),body:ve})}else{const Y=e.website.trim();Y&&(C.website=Y),e.logoUrl.trim()&&(C.logo_url=e.logoUrl.trim()),e.coverUrl.trim()&&(C.cover_image_url=e.coverUrl.trim()),e.capacity.trim()&&(C.capacity=e.capacity.trim()),C.parking=e.parking,C.wifi=e.wifi;const ve={name:i,slug:g,address:I(e.address),city:I(e.city),lat:U,lon:q,description:I(e.bio),contact_phone:I(e.phone),images:e.galleryUrls.length?[...e.galleryUrls]:null,social_links:Object.keys(C).length?C:null};await t.apiFetch(`/api/v1/management/venues/${a.id}`,{method:"PATCH",baseURL:D("/api/v1/management/venues"),body:ve})}await o.fetchMyEntities({force:!0}),await X(),r.value="Изменения сохранены."}catch(C){c.value=se(C,"Не удалось сохранить изменения.")}finally{V.value=!1}},uploadImage:A,detectLocation:S,submitVerification:async()=>{const a=n.value;if(a){if(!x.value.length){B.value="Добавьте документы перед отправкой запроса.";return}J.value=!0,G.value="",B.value="";try{const i=[];for(const U of x.value){let q=null;U.type.startsWith("image/")&&(q=await A(U)),i.push({name:U.name,size:U.size,type:U.type||"application/octet-stream",url:q})}const g=JSON.stringify({source:"organizer-profile-settings",requested_at:new Date().toISOString(),context_type:a.type,documents:i});await t.apiFetch("/api/v1/management/claim",{method:"POST",baseURL:D("/api/v1/management/claim"),body:{entity_type:a.type,entity_id:a.id,proof_data:g}}),u.value="pending",G.value="Запрос на верификацию отправлен.",x.value=[]}catch(i){B.value=se(i,"Не удалось отправить запрос на верификацию.")}finally{J.value=!1}}},uploadLogoFile:L,uploadCoverFile:Q,uploadGalleryFiles:ge,removeGalleryImage:y,clearLogo:fe,clearCover:T,setVerificationFiles:a=>{x.value=a,G.value="",B.value=""}}},dt={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},ut={class:"mt-4 grid gap-4 md:grid-cols-3"},ct={class:"space-y-2"},mt={class:"space-y-2"},pt={class:"space-y-2"},gt={class:"mt-6 grid gap-4 md:grid-cols-2"},ft={class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"},vt=Z({__name:"ProfileSocialsBlock",props:{form:{required:!0},formModifiers:{}},emits:["update:form"],setup(o){const t=re(o,"form");return(n,e)=>(d(),f("section",dt,[e[6]||(e[6]=l("h3",{class:"text-base font-semibold text-slate-900"},"Контакты и социальные сети",-1)),e[7]||(e[7]=l("p",{class:"mt-1 text-sm text-slate-600"}," Телефон, сайт, email и ссылки на соцсети. ",-1)),l("div",ut,[l("div",ct,[e[3]||(e[3]=l("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Телефон ",-1)),v(s(M),{modelValue:t.value.phone,"onUpdate:modelValue":e[0]||(e[0]=m=>t.value.phone=m),type:"tel",placeholder:"+7 (900) 000-00-00"},null,8,["modelValue"])]),l("div",mt,[e[4]||(e[4]=l("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Сайт ",-1)),v(s(M),{modelValue:t.value.website,"onUpdate:modelValue":e[1]||(e[1]=m=>t.value.website=m),type:"url",placeholder:"https://example.com"},null,8,["modelValue"])]),l("div",pt,[e[5]||(e[5]=l("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Email ",-1)),v(s(M),{modelValue:t.value.email,"onUpdate:modelValue":e[2]||(e[2]=m=>t.value.email=m),type:"email",placeholder:"team@example.com"},null,8,["modelValue"])])]),l("div",gt,[(d(!0),f(ne,null,he(s(oe),m=>(d(),f("div",{key:m.key,class:"space-y-2"},[l("label",ft,F(m.label),1),v(s(M),{modelValue:t.value.socialLinks[m.key],"onUpdate:modelValue":$=>t.value.socialLinks[m.key]=$,placeholder:m.placeholder,type:"url"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]))),128))])]))}}),yt=Object.assign(vt,{__name:"SettingsProfileSocialsBlock"}),bt={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},xt={class:"mt-4 grid gap-4 md:grid-cols-2"},ht={class:"space-y-2"},kt={class:"space-y-2"},wt={class:"mt-4 grid gap-4 lg:grid-cols-[1fr_280px]"},Ut={class:"overflow-hidden rounded-xl border border-slate-200"},$t=["src"],Vt={class:"space-y-3 rounded-xl border border-slate-200 p-4"},Ct={class:"space-y-2"},_t={class:"space-y-2"},Lt={class:"mt-4 grid gap-4 md:grid-cols-3"},St={class:"space-y-2"},Ft={class:"flex items-center gap-3 rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700"},Mt={class:"flex items-center gap-3 rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700"},Pt={class:"mt-6"},zt={class:"flex items-center justify-between gap-3"},jt={key:0,class:"mt-3 grid gap-3 sm:grid-cols-2 lg:grid-cols-3"},Ht=["src","alt"],Bt=["onClick"],It={key:1,class:"mt-3 text-sm text-slate-500"},Et=Z({__name:"ProfileVenueSpecifics",props:xe({mapEmbedUrl:{},loadingLocation:{type:Boolean},venueHandlers:{}},{form:{required:!0},formModifiers:{}}),emits:["update:form"],setup(o){const t=re(o,"form"),n=o,e=b(null),m=()=>e.value?.click(),$=async V=>{const r=V.target,c=r?.files?Array.from(r.files):[];c.length&&(await n.venueHandlers.uploadGalleryFiles(c),r&&(r.value=""))};return(V,r)=>(d(),f("section",bt,[r[17]||(r[17]=l("h3",{class:"text-base font-semibold text-slate-900"},"Параметры площадки",-1)),r[18]||(r[18]=l("p",{class:"mt-1 text-sm text-slate-600"}," Адрес, пин на карте, характеристики и галерея интерьера. ",-1)),l("div",xt,[l("div",ht,[r[7]||(r[7]=l("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Город ",-1)),v(s(M),{modelValue:t.value.city,"onUpdate:modelValue":r[0]||(r[0]=c=>t.value.city=c),placeholder:"Москва"},null,8,["modelValue"])]),l("div",kt,[r[8]||(r[8]=l("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Адрес ",-1)),v(s(M),{modelValue:t.value.address,"onUpdate:modelValue":r[1]||(r[1]=c=>t.value.address=c),placeholder:"ул. Пример, 10"},null,8,["modelValue"])])]),l("div",wt,[l("div",Ut,[l("iframe",{class:"h-[260px] w-full",src:o.mapEmbedUrl,loading:"lazy",referrerpolicy:"no-referrer-when-downgrade"},null,8,$t)]),l("div",Vt,[l("div",Ct,[r[9]||(r[9]=l("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Latitude ",-1)),v(s(M),{modelValue:t.value.lat,"onUpdate:modelValue":r[2]||(r[2]=c=>t.value.lat=c),type:"text",placeholder:"55.7558"},null,8,["modelValue"])]),l("div",_t,[r[10]||(r[10]=l("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Longitude ",-1)),v(s(M),{modelValue:t.value.lon,"onUpdate:modelValue":r[3]||(r[3]=c=>t.value.lon=c),type:"text",placeholder:"37.6173"},null,8,["modelValue"])]),v(s(j),{type:"button",variant:"outline",class:"w-full gap-2",disabled:o.loadingLocation,onClick:o.venueHandlers.detectLocation},{default:z(()=>[o.loadingLocation?(d(),k(s(N),{key:0,class:"h-4 w-4 animate-spin"})):(d(),k(s(Ee),{key:1,class:"h-4 w-4"})),r[11]||(r[11]=_(" Использовать геопозицию ",-1))]),_:1},8,["disabled","onClick"])])]),l("div",Lt,[l("div",St,[r[12]||(r[12]=l("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Вместимость ",-1)),v(s(M),{modelValue:t.value.capacity,"onUpdate:modelValue":r[4]||(r[4]=c=>t.value.capacity=c),type:"number",placeholder:"250"},null,8,["modelValue"])]),l("label",Ft,[we(l("input",{"onUpdate:modelValue":r[5]||(r[5]=c=>t.value.parking=c),type:"checkbox",class:"h-4 w-4 rounded border-slate-300 text-cyan-600 focus:ring-cyan-500"},null,512),[[Ue,t.value.parking]]),r[13]||(r[13]=_(" Парковка ",-1))]),l("label",Mt,[we(l("input",{"onUpdate:modelValue":r[6]||(r[6]=c=>t.value.wifi=c),type:"checkbox",class:"h-4 w-4 rounded border-slate-300 text-cyan-600 focus:ring-cyan-500"},null,512),[[Ue,t.value.wifi]]),r[14]||(r[14]=_(" Wi-Fi ",-1))])]),l("div",Pt,[l("div",zt,[r[16]||(r[16]=l("h4",{class:"text-sm font-semibold text-slate-900"},"Галерея интерьера",-1)),v(s(j),{type:"button",variant:"outline",class:"gap-2",disabled:o.venueHandlers.uploadingGallery,onClick:m},{default:z(()=>[o.venueHandlers.uploadingGallery?(d(),k(s(N),{key:0,class:"h-4 w-4 animate-spin"})):(d(),k(s(ke),{key:1,class:"h-4 w-4"})),r[15]||(r[15]=_(" Добавить фото ",-1))]),_:1},8,["disabled"])]),l("input",{ref_key:"galleryInputRef",ref:e,type:"file",class:"hidden",accept:"image/*",multiple:"",onChange:$},null,544),t.value.galleryUrls.length?(d(),f("div",jt,[(d(!0),f(ne,null,he(t.value.galleryUrls,(c,p)=>(d(),f("div",{key:`${c}-${p}`,class:"group relative overflow-hidden rounded-xl border border-slate-200"},[l("img",{src:c,alt:`Gallery ${p+1}`,class:"h-28 w-full object-cover"},null,8,Ht),l("button",{type:"button",class:"absolute right-2 top-2 rounded-full bg-black/60 p-1 text-white opacity-0 transition group-hover:opacity-100",onClick:w=>o.venueHandlers.removeGalleryImage(p)},[v(s(ye),{class:"h-3 w-3"})],8,Bt)]))),128))])):(d(),f("p",It,"Фотографии интерьера пока не добавлены."))])]))}}),Rt=Object.assign(Et,{__name:"SettingsProfileVenueSpecifics"}),Gt={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},Ot={class:"mt-4 flex flex-wrap items-center gap-3"},At={key:0,class:"mt-4 space-y-2 rounded-xl border border-slate-200 bg-slate-50 p-3 text-sm text-slate-700"},qt={class:"truncate"},Nt={class:"text-xs text-slate-500"},Tt={key:1,class:"mt-4 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-sm text-rose-700"},Dt={key:2,class:"mt-4 rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm text-emerald-700"},Wt={class:"mt-4 flex justify-end"},Jt=Z({__name:"ProfileVerificationBlock",props:xe({status:{},submitHandler:{type:Function},loading:{type:Boolean},message:{},error:{}},{files:{required:!0},filesModifiers:{}}),emits:["update:files"],setup(o){const t=re(o,"files"),n=o,e=b(null),m=P(()=>n.status==="verified"?"Подтвержден":n.status==="pending"?"На проверке":"Не подтвержден"),$=P(()=>n.status==="verified"?"border-emerald-200 bg-emerald-50 text-emerald-700":n.status==="pending"?"border-amber-200 bg-amber-50 text-amber-700":"border-slate-200 bg-slate-100 text-slate-700"),V=()=>e.value?.click(),r=c=>{const p=c.target,w=p?.files?Array.from(p.files):[];t.value=w};return be(()=>t.value.length,c=>{c===0&&e.value&&(e.value.value="")}),(c,p)=>(d(),f("section",Gt,[p[2]||(p[2]=l("h3",{class:"text-base font-semibold text-slate-900"},"Верификация",-1)),p[3]||(p[3]=l("p",{class:"mt-1 text-sm text-slate-600"}," Загрузите документы и отправьте запрос на верификацию сущности. ",-1)),l("div",Ot,[l("span",{class:ze(["inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-semibold",s($)])},[o.status==="verified"?(d(),k(s(Be),{key:0,class:"h-3.5 w-3.5"})):o.status==="pending"?(d(),k(s(Re),{key:1,class:"h-3.5 w-3.5"})):(d(),k(s($e),{key:2,class:"h-3.5 w-3.5"})),_(" "+F(s(m)),1)],2),v(s(j),{type:"button",variant:"outline",class:"gap-2",onClick:V},{default:z(()=>[v(s(ke),{class:"h-4 w-4"}),p[0]||(p[0]=_(" Загрузить документы ",-1))]),_:1}),l("input",{ref_key:"verificationInputRef",ref:e,type:"file",class:"hidden",accept:".pdf,image/*",multiple:"",onChange:r},null,544)]),t.value.length?(d(),f("ul",At,[(d(!0),f(ne,null,he(t.value,w=>(d(),f("li",{key:`${w.name}-${w.size}`,class:"flex items-center justify-between gap-3"},[l("span",qt,F(w.name),1),l("span",Nt,F(s(nt)(w.size)),1)]))),128))])):H("",!0),o.error?(d(),f("p",Tt,F(o.error),1)):H("",!0),o.message?(d(),f("p",Dt,F(o.message),1)):H("",!0),l("div",Wt,[v(s(j),{type:"button",class:"gap-2",disabled:o.loading||!t.value.length,onClick:o.submitHandler},{default:z(()=>[o.loading?(d(),k(s(N),{key:0,class:"h-4 w-4 animate-spin"})):(d(),k(s($e),{key:1,class:"h-4 w-4"})),p[1]||(p[1]=_(" Запросить верификацию ",-1))]),_:1},8,["disabled","onClick"])])]))}}),Kt=Object.assign(Jt,{__name:"SettingsProfileVerificationBlock"}),Xt={class:"space-y-6"},Qt={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},Yt={class:"text-xl font-semibold tracking-tight text-slate-900"},Zt={key:0,class:"rounded-2xl border border-dashed border-slate-300 bg-white p-8 text-center"},el={key:0,class:"rounded-2xl border border-slate-200 bg-white p-8"},tl={class:"flex items-center gap-3 text-sm text-slate-600"},ll={key:0,class:"rounded-xl border border-amber-200 bg-amber-50 px-3 py-2 text-sm text-amber-700"},al={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},sl={class:"flex flex-wrap items-center justify-between gap-3"},ol={key:0,class:"text-sm text-rose-600"},rl={key:1,class:"text-sm text-emerald-600"},nl={key:2,class:"text-sm text-slate-500"},hl=Z({__name:"index",setup(o){const{form:t,hasContext:n,isVenueContext:e,contextLabel:m,mapEmbedUrl:$,pageLoading:V,pageError:r,saving:c,saveMessage:p,saveError:w,mediaError:E,uploadingLogo:R,uploadingCover:h,uploadingGallery:u,loadingLocation:x,verificationStatus:J,verificationFiles:G,verificationSubmitting:B,verificationMessage:ie,verificationError:K,saveProfile:ee,detectLocation:de,submitVerification:ue,uploadLogoFile:te,uploadCoverFile:ce,uploadGalleryFiles:me,removeGalleryImage:pe,clearLogo:O,clearCover:X,setVerificationFiles:A}=it(),L=P({get:()=>t,set:T=>{Object.assign(t,T)}}),Q=P({get:()=>G.value,set:T=>{A(T)}}),ge=P(()=>({uploadLogo:te,uploadCover:ce,clearLogo:O,clearCover:X,uploadingLogo:R.value,uploadingCover:h.value,mediaError:E.value})),fe=P(()=>({detectLocation:de,uploadGalleryFiles:me,removeGalleryImage:pe,uploadingGallery:u.value}));return(T,y)=>(d(),f("div",Xt,[l("section",Qt,[l("h2",Yt," Профиль "+F(s(m)),1),y[5]||(y[5]=l("p",{class:"mt-1 text-sm text-slate-600"}," Обновляйте публичные данные и контактную информацию текущей сущности. ",-1))]),s(n)?(d(),f(ne,{key:1},[s(V)?(d(),f("section",el,[l("div",tl,[v(s(N),{class:"h-4 w-4 animate-spin"}),y[7]||(y[7]=_(" Загрузка профиля... ",-1))])])):(d(),f("form",{key:1,class:"space-y-6",onSubmit:y[4]||(y[4]=je((...S)=>s(ee)&&s(ee)(...S),["prevent"]))},[s(r)?(d(),f("p",ll,F(s(r)),1)):H("",!0),v(st,{form:s(L),"onUpdate:form":y[0]||(y[0]=S=>le(L)?L.value=S:null),"upload-handlers":s(ge)},null,8,["form","upload-handlers"]),v(yt,{form:s(L),"onUpdate:form":y[1]||(y[1]=S=>le(L)?L.value=S:null)},null,8,["form"]),s(e)?(d(),k(Rt,{key:1,form:s(L),"onUpdate:form":y[2]||(y[2]=S=>le(L)?L.value=S:null),"map-embed-url":s($),"loading-location":s(x),"venue-handlers":s(fe)},null,8,["form","map-embed-url","loading-location","venue-handlers"])):H("",!0),v(Kt,{files:s(Q),"onUpdate:files":y[3]||(y[3]=S=>le(Q)?Q.value=S:null),status:s(J),"submit-handler":s(ue),loading:s(B),message:s(ie),error:s(K)},null,8,["files","status","submit-handler","loading","message","error"]),l("section",al,[l("div",sl,[l("div",null,[s(w)?(d(),f("p",ol,F(s(w)),1)):s(p)?(d(),f("p",rl,F(s(p)),1)):(d(),f("p",nl,"Сохраните изменения, чтобы обновить профиль."))]),v(s(j),{type:"submit",class:"gap-2",disabled:s(c)},{default:z(()=>[s(c)?(d(),k(s(N),{key:0,class:"h-4 w-4 animate-spin"})):H("",!0),y[8]||(y[8]=_(" Сохранить изменения ",-1))]),_:1},8,["disabled"])])])],32))],64)):(d(),f("section",Zt,[...y[6]||(y[6]=[l("p",{class:"text-sm text-slate-600"},"Текущий контекст не выбран.",-1)])]))]))}});export{hl as default};
