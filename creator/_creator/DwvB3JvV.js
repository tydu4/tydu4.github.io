import{b as Q,a0 as X,a as J,u as K,a1 as Y,l as o,G as Z,C as S,D as s,M as B,R as t,X as M,N as n,U as D,Q as i,S as U,W as h,O as L,F as _,B as x,P as q,n as T,a2 as A}from"./Ca6rub8f.js";import P from"./Bc1u1-yo.js";import c from"./C3H3F2YC.js";import W from"./CLa6BjNG.js";import{S as ee}from"./D7pxd-Es.js";import{B as te}from"./DQfA8YvW.js";import"./CkYB-R1u.js";import"./c5FhCeC0.js";import"./Cibw3ATY.js";const se={class:"space-y-5"},le={class:"space-y-2 text-center"},ae={class:"text-2xl font-semibold tracking-tight text-slate-900"},oe={class:"grid gap-3 sm:grid-cols-2"},ne={class:"inline-flex rounded-xl bg-cyan-100 p-2 text-cyan-700"},re={class:"inline-flex rounded-xl bg-amber-100 p-2 text-amber-700"},ie={class:"space-y-2"},ue={class:"space-y-2"},de={class:"space-y-2"},me={class:"space-y-2"},pe={class:"space-y-2"},ve={class:"grid gap-3 sm:grid-cols-2"},ge={class:"space-y-2"},ce={class:"space-y-2"},xe={class:"space-y-2"},be={key:2,class:"text-xs text-red-600"},fe={class:"flex flex-wrap justify-end gap-2"},Ee=Q({__name:"index",setup(ye){const C=X(),d=J(),E=K(),{hasEntities:N}=Y(d),r=o(C.query.create==="venue"?"venue":C.query.create==="organizer"?"organizer":null),m=o(""),p=o(""),b=o(""),v=o(""),g=o(""),f=o(""),y=o(""),V=o(""),k=o(!1),u=o("");Z(()=>C.query.create,a=>{(a==="organizer"||a==="venue")&&(r.value=a)});const w=a=>a.toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),R=a=>{if(a==="organizer"){p.value=w(p.value||m.value);return}g.value=w(g.value||v.value)},O=()=>{u.value=""},$=a=>{r.value=a,O()},j=async()=>{const a=m.value.trim(),e=w(p.value||m.value),l=b.value.trim();if(!a||!e){u.value="Укажите название и slug для организатора.";return}const z=await E.apiFetch("/api/v1/management/organizers",{method:"POST",baseURL:A("/api/v1/management/organizers"),body:{name:a,slug:e,...l?{description:l}:{}}});await d.fetchMyEntities({force:!0}),d.selectContext("organizer",z.id),await T("/")},G=async()=>{const a=v.value.trim(),e=w(g.value||v.value),l=f.value.trim(),z=y.value.trim(),F=V.value.trim();if(!a||!e||!l||!z){u.value="Для площадки нужны: название, slug, адрес и город.";return}const I=await E.apiFetch("/api/v1/management/venues",{method:"POST",baseURL:A("/api/v1/management/venues"),body:{name:a,slug:e,address:l,city:z,...F?{description:F}:{}}});await d.fetchMyEntities({force:!0}),d.selectContext("venue",I.id),await T("/venue/overview")},H=async()=>{if(O(),!r.value){u.value="Выберите роль: организатор или площадка.";return}k.value=!0;try{if(r.value==="organizer"){await j();return}await G()}catch(a){console.warn("[onboarding] Failed to create entity",a),u.value="Не удалось создать сущность. Проверьте данные и повторите попытку."}finally{k.value=!1}};return(a,e)=>(x(),S("div",se,[s("div",le,[e[13]||(e[13]=s("p",{class:"text-xs font-semibold uppercase tracking-[0.28em] text-slate-500"},"Workspace setup",-1)),s("h1",ae,B(t(N)?"Добавить новую сущность":"Создайте первый workspace"),1),e[14]||(e[14]=s("p",{class:"text-sm text-slate-600"}," Выберите тип аккаунта и заполните базовые данные. ",-1))]),s("div",oe,[s("button",{class:M(["rounded-2xl border p-4 text-left transition",t(r)==="organizer"?"border-cyan-300 bg-cyan-50":"border-slate-200 bg-white hover:border-slate-300"]),onClick:e[0]||(e[0]=l=>$("organizer"))},[s("div",ne,[n(t(ee),{class:"h-4 w-4"})]),e[15]||(e[15]=s("p",{class:"mt-3 text-sm font-semibold text-slate-900"},"Я Организатор",-1)),e[16]||(e[16]=s("p",{class:"mt-1 text-xs text-slate-600"},"Бренд ивентов, маркетинг и продажи билетов.",-1))],2),s("button",{class:M(["rounded-2xl border p-4 text-left transition",t(r)==="venue"?"border-amber-300 bg-amber-50":"border-slate-200 bg-white hover:border-slate-300"]),onClick:e[1]||(e[1]=l=>$("venue"))},[s("div",re,[n(t(te),{class:"h-4 w-4"})]),e[17]||(e[17]=s("p",{class:"mt-3 text-sm font-semibold text-slate-900"},"Я Площадка",-1)),e[18]||(e[18]=s("p",{class:"mt-1 text-xs text-slate-600"},"Календарь занятости, доступность и настройки venue.",-1))],2)]),s("form",{class:"space-y-4 rounded-2xl border border-slate-200 bg-white p-4",onSubmit:_(H,["prevent"])},[t(r)==="organizer"?(x(),S(D,{key:0},[s("div",ie,[e[19]||(e[19]=s("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Название организатора ",-1)),n(t(c),{modelValue:t(m),"onUpdate:modelValue":e[2]||(e[2]=l=>i(m)?m.value=l:null),placeholder:"Signal Events",onBlur:e[3]||(e[3]=l=>R("organizer"))},null,8,["modelValue"])]),s("div",ue,[e[20]||(e[20]=s("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Slug ",-1)),n(t(c),{modelValue:t(p),"onUpdate:modelValue":e[4]||(e[4]=l=>i(p)?p.value=l:null),placeholder:"signal-events"},null,8,["modelValue"])]),s("div",de,[e[21]||(e[21]=s("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Описание ",-1)),n(t(W),{modelValue:t(b),"onUpdate:modelValue":e[5]||(e[5]=l=>i(b)?b.value=l:null),placeholder:"Коротко опишите ваш бренд и форматы мероприятий."},null,8,["modelValue"])])],64)):t(r)==="venue"?(x(),S(D,{key:1},[s("div",me,[e[22]||(e[22]=s("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Название площадки ",-1)),n(t(c),{modelValue:t(v),"onUpdate:modelValue":e[6]||(e[6]=l=>i(v)?v.value=l:null),placeholder:"Loft Hall East",onBlur:e[7]||(e[7]=l=>R("venue"))},null,8,["modelValue"])]),s("div",pe,[e[23]||(e[23]=s("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Slug ",-1)),n(t(c),{modelValue:t(g),"onUpdate:modelValue":e[8]||(e[8]=l=>i(g)?g.value=l:null),placeholder:"loft-hall-east"},null,8,["modelValue"])]),s("div",ve,[s("div",ge,[e[24]||(e[24]=s("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Город ",-1)),n(t(c),{modelValue:t(y),"onUpdate:modelValue":e[9]||(e[9]=l=>i(y)?y.value=l:null),placeholder:"Москва"},null,8,["modelValue"])]),s("div",ce,[e[25]||(e[25]=s("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Адрес ",-1)),n(t(c),{modelValue:t(f),"onUpdate:modelValue":e[10]||(e[10]=l=>i(f)?f.value=l:null),placeholder:"ул. Пример, 10"},null,8,["modelValue"])])]),s("div",xe,[e[26]||(e[26]=s("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-slate-500"}," Описание ",-1)),n(t(W),{modelValue:t(V),"onUpdate:modelValue":e[11]||(e[11]=l=>i(V)?V.value=l:null),placeholder:"Опишите вместимость, оборудование и особенности площадки."},null,8,["modelValue"])])],64)):U("",!0),t(u)?(x(),S("p",be,B(t(u)),1)):U("",!0),s("div",fe,[t(N)?(x(),h(t(P),{key:0,type:"button",variant:"outline",onClick:e[12]||(e[12]=l=>("navigateTo"in a?a.navigateTo:t(T))(t(d).defaultRoute))},{default:L(()=>[...e[27]||(e[27]=[q(" Назад ",-1)])]),_:1})):U("",!0),n(t(P),{type:"submit",disabled:t(k)||!t(r)},{default:L(()=>[q(B(t(k)?"Создаем...":"Продолжить"),1)]),_:1},8,["disabled"])])],32)]))}});export{Ee as default};
