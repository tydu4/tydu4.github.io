import{f as xe,N as ee,k as Oe,G as f,H as o,K as g,L as k,O as a,W,J as y,P as le,Q as oe,S as O,v,F as u,M as _,U as fe,V as ye,y as F,Y as Q,R as ge,T as K,c as De,X as ve,$ as Re}from"./DS7VCCSK.js";import C from"./Cjqy7nvW.js";import Z from"./Deu-aWO1.js";import he from"./CdVBsagh.js";import ie from"./BpcaaFkG.js";import"./DTeGA_vW.js";import"./D7xuzdeO.js";import"./BhfHb__k.js";import"./E0wZJRpp.js";import"./BxcSwu-R.js";import"./DU6-7vYD.js";import"./DmH-Mve6.js";import Pe from"./Bmm7Yk8C.js";import"./DF8zk2qc.js";import"./CeJFYvzK.js";import"./CfKVNkxc.js";import"./CFbK2b2T.js";import"./BBd-v6Ar.js";import"./DsmWHQFD.js";import{c as de}from"./C6XcSUeA.js";import{u as Ne}from"./Xa2-jkLM.js";import"./CkYB-R1u.js";import"./c5FhCeC0.js";import"./Bkp_y7T4.js";const Me=de("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const Fe=de("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);const Ue=de("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),Le={class:"space-y-6"},je={class:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm"},$e={class:"flex flex-wrap items-start justify-between gap-4"},ze={class:"flex flex-wrap items-center gap-2"},Be={class:"mt-4 max-w-lg"},Ke={key:0,class:"mt-4 rounded-xl border border-slate-200 bg-slate-50 px-4 py-3"},Ge={class:"text-sm font-medium text-slate-700"},Je={key:0,class:"mt-2 space-y-1 text-xs text-red-600"},We={key:0,class:"rounded-2xl border border-amber-200/70 bg-amber-50/80 p-5 shadow-sm"},He={class:"flex flex-wrap items-center justify-between gap-4"},Ye={class:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"},qe={class:"flex flex-wrap gap-2"},Xe=["onClick"],Qe={class:"mt-4 rounded-xl border border-slate-200 bg-slate-50/50 p-4"},Ze={class:"flex flex-wrap items-start justify-between gap-3"},et={class:"text-lg font-semibold text-slate-900"},tt={class:"text-xs text-slate-500"},st={class:"text-xs text-slate-500"},at={key:0,class:"py-10 text-center text-sm text-slate-500"},nt={key:1,class:"mt-4 rounded-xl border border-dashed border-slate-200 bg-white px-4 py-8 text-center text-sm text-slate-500"},lt={key:0},ot={key:1},it={key:2,class:"mt-4 grid gap-4 lg:grid-cols-2"},rt={class:"flex flex-wrap items-start justify-between gap-3"},dt={class:"min-w-0"},ut={class:"truncate text-sm font-semibold text-slate-900"},ct={class:"mt-1 text-xs text-slate-500"},pt={class:"flex flex-wrap items-center gap-1"},mt={class:"mt-3"},ft=["onUpdate:modelValue","onChange"],yt={key:0,class:"mt-2 text-xs text-slate-500"},gt={class:"mt-4 flex flex-wrap items-center justify-between gap-2"},vt={class:"flex flex-wrap items-center gap-2"},ht={key:2,class:"text-xs text-slate-400"},xt={class:"space-y-4"},kt={class:"flex items-start justify-between gap-4"},bt={class:"grid gap-3"},_t={class:"flex items-center justify-end gap-2"},St={key:1,class:"fixed bottom-6 right-6 z-50 rounded-xl bg-slate-900 px-4 py-3 text-sm text-white shadow-2xl"},Ct={key:2,class:"rounded-2xl border border-red-200 bg-red-50 p-4 text-sm text-red-700"},Tt=xe({__name:"SettingsManagerBlock",props:{settings:{},pending:{type:Boolean},hasError:{type:Boolean},isAdmin:{type:Boolean},seeding:{type:Boolean},onRefresh:{type:Function},onSaveSetting:{type:Function},onDeleteSetting:{type:Function},onCreateSetting:{type:Function},onExportSettings:{type:Function},onImportSettings:{type:Function},onSeedDatabase:{type:Function}},setup(ue){const h=ue,D=[{id:"payments",label:"Payments",hint:"PAYMENT_, CRYPTOBOT, MOCK_TOPUP",tokens:["PAYMENT_","CRYPTOBOT","MOCK_TOPUP"]},{id:"security",label:"Security",hint:"JWT_, SECRET, TOKEN, ADMIN_",tokens:["JWT_","SECRET","TOKEN","ADMIN_"]},{id:"storage",label:"Storage",hint:"S3_, GCP_, LOCAL_STORAGE",tokens:["S3_","GCP_","LOCAL_STORAGE"]},{id:"game",label:"Game",hint:"XP_, LEVEL_, TICKET",tokens:["XP_","LEVEL_","TICKET"]},{id:"general",label:"General",hint:"DOMAIN, MAINTENANCE, APP_MODE and all unmatched keys",tokens:[]}],c=v([]),m=Q({}),b=Q({}),S=Q({}),A=Q({}),G=v("");let R=null;const U=v(""),V=v("payments"),P=v(!1),N=v(!1),J=v(!1),M=v(""),L=v(""),j=v("string"),$=v(""),I=v(!1),z=v(!1),T=v(""),E=v([]),H=v(null),Y=s=>{if(!s)return s;let e=s;const t=s.trim();if(t.startsWith('"')&&t.endsWith('"'))try{const d=JSON.parse(t);typeof d=="string"&&(e=d)}catch{}return e.includes("\\u")&&(e=e.replace(/\\u([0-9a-fA-F]{4})/g,(d,B)=>String.fromCharCode(parseInt(B,16)))),e},q=s=>({...s,value:Y(String(s.value??"")),description:s.description==null?null:Y(s.description)}),te=()=>{const s=new Set(c.value.map(e=>e.key));Object.keys(m).forEach(e=>{s.has(e)||(delete m[e],delete b[e],delete S[e],delete A[e])}),c.value.forEach(e=>{m[e.key]=e.value??"",b[e.key]=!1})};ee(()=>h.settings,s=>{c.value=s?s.map(e=>q(e)).sort((e,t)=>e.key.localeCompare(t.key)):[],te()},{immediate:!0,deep:!0});const x=s=>{G.value=s,R&&clearTimeout(R),R=setTimeout(()=>{G.value="",R=null},2500)};Oe(()=>{R&&clearTimeout(R)});const se=s=>{const e=s.toUpperCase();return D[0].tokens.some(t=>e.includes(t))?"payments":D[1].tokens.some(t=>e.includes(t))?"security":D[2].tokens.some(t=>e.includes(t))?"storage":D[3].tokens.some(t=>e.includes(t))?"game":"general"},X=F(()=>U.value.trim().toLowerCase()),n=F(()=>X.value?c.value.filter(s=>{const e=s.key.toLowerCase(),t=String(m[s.key]??s.value??"").toLowerCase();return e.includes(X.value)||t.includes(X.value)}):c.value),l=F(()=>{const s={payments:[],security:[],storage:[],game:[],general:[]};return n.value.forEach(e=>{const t=se(e.key);s[t].push(e)}),Object.keys(s).forEach(e=>{s[e].sort((t,d)=>t.key.localeCompare(d.key))}),s}),r=F(()=>D.map(s=>({...s,count:l.value[s.id].length}))),i=F(()=>r.value.find(s=>s.id===V.value)??r.value[0]),p=F(()=>l.value[V.value]??[]);ee(l,s=>{if(s[V.value]?.length)return;const e=D.find(t=>s[t.id].length>0);e&&(V.value=e.id)},{deep:!0});const w=s=>{if(s==null)return null;const e=Y(s).trim();if(!e)return null;const t=e.replace(/\s+/g,"");if(/^[?\uFFFD]+$/.test(t))return null;const d=/[A-Za-z0-9\u0400-\u04FF]/.test(e),B=(t.match(/[?\uFFFD]/g)??[]).length;return!d&&B>0?null:e},ce=F(()=>{const s={};return c.value.forEach(e=>{s[e.key]=w(e.description)}),s}),ae=s=>{const e=c.value.find(t=>t.key===s)?.value??"";b[s]=(m[s]??"")!==e},ke=s=>{const e=c.value.find(t=>t.key===s)?.value??"";m[s]=e,b[s]=!1},pe=s=>{const e=c.value.findIndex(d=>d.key===s.key);if(e===-1){c.value=[s,...c.value].sort((d,B)=>d.key.localeCompare(B.key));return}const t=[...c.value];t[e]=s,c.value=t.sort((d,B)=>d.key.localeCompare(B.key))},be=s=>{c.value=c.value.filter(e=>e.key!==s),delete m[s],delete b[s],delete S[s],delete A[s]},_e=async()=>{if(!P.value){P.value=!0;try{await h.onRefresh(),x("Settings refreshed")}catch{x("Failed to refresh settings")}finally{P.value=!1}}},Se=async s=>{if(!(!b[s.key]||S[s.key])){S[s.key]=!0;try{const e=await h.onSaveSetting({key:s.key,value:m[s.key]??"",description:s.description??null,is_public:s.is_public??!1}),t=q(e);pe(t),m[s.key]=t.value??"",b[s.key]=!1,x(`Saved ${s.key}`)}catch{x(`Failed to save ${s.key}`)}finally{S[s.key]=!1}}},Ce=async s=>{if(!A[s.key]&&window.confirm(`Delete setting ${s.key}?`)){A[s.key]=!0;try{await h.onDeleteSetting(s.key),be(s.key),x(`Deleted ${s.key}`)}catch{x(`Failed to delete ${s.key}`)}finally{A[s.key]=!1}}},Te=()=>{N.value=!0},ne=()=>{N.value=!1,M.value="",L.value="",j.value="string",$.value=""},Ee=async()=>{const s=M.value.trim().toUpperCase();if(s){J.value=!0;try{const e=await h.onCreateSetting({key:s,value:L.value,value_type:j.value,description:$.value.trim()||null,is_public:!1}),t=q(e);pe(t),m[t.key]=t.value??"",b[t.key]=!1,x(`Created ${t.key}`),ne()}catch{x("Failed to create setting")}finally{J.value=!1}}},we=async()=>{if(!I.value){I.value=!0,T.value="",E.value=[];try{const s=await h.onExportSettings();x(s||"Settings exported")}catch(s){x(`Export failed: ${me(s)}`)}finally{I.value=!1}}},Ae=()=>{H.value?.click()},me=s=>{const e=s?.data?.detail;if(typeof e=="string"&&e)return e;const t=s?.message;return typeof t=="string"&&t?t:"request failed"},Ve=async s=>{const e=s.target,t=e.files?.[0];if(t){if(z.value){e.value="";return}z.value=!0,T.value="",E.value=[];try{const d=await h.onImportSettings(t);T.value=d||`Imported ${t.name}`,E.value=[],x(T.value||"Import completed")}catch(d){T.value=`Import failed: ${me(d)}`,E.value=[],x(T.value||"Import failed")}finally{z.value=!1,e.value=""}}},Ie=async()=>{try{await h.onSeedDatabase(),x("Database seeded")}catch{x("Failed to seed database")}};return(s,e)=>(u(),f("div",Le,[o("section",je,[o("div",$e,[e[7]||(e[7]=o("div",null,[o("p",{class:"text-xs uppercase tracking-[0.3em] text-slate-500"},"System Config"),o("h2",{class:"text-lg font-semibold"},"System settings"),o("p",{class:"text-sm text-slate-500"},"Find, edit and backup key-value configuration safely.")],-1)),o("div",ze,[g(a(C),{variant:"outline",size:"sm",disabled:a(P),onClick:_e},{default:k(()=>[_(y(a(P)?"Refreshing...":"Refresh"),1)]),_:1},8,["disabled"]),g(a(C),{variant:"outline",size:"sm",disabled:a(I),onClick:we},{default:k(()=>[_(y(a(I)?"Exporting...":"Export"),1)]),_:1},8,["disabled"]),g(a(C),{variant:"outline",size:"sm",disabled:a(z),onClick:Ae},{default:k(()=>[_(y(a(z)?"Importing...":"Import"),1)]),_:1},8,["disabled"]),o("input",{ref_key:"importInputRef",ref:H,type:"file",accept:"application/json,.json",class:"hidden",onChange:Ve},null,544),g(a(C),{size:"sm",class:"gap-2",onClick:Te},{default:k(()=>[g(a(Me),{class:"h-4 w-4"}),e[6]||(e[6]=_(" Add Config ",-1))]),_:1})])]),o("div",Be,[e[8]||(e[8]=o("label",{class:"text-xs uppercase tracking-[0.2em] text-slate-500"},"Search",-1)),g(a(Z),{modelValue:a(U),"onUpdate:modelValue":e[0]||(e[0]=t=>W(U)?U.value=t:null),type:"search",placeholder:"Search by key or value",class:"mt-2"},null,8,["modelValue"])]),a(T)?(u(),f("div",Ke,[o("p",Ge,y(a(T)),1),a(E).length?(u(),f("ul",Je,[(u(!0),f(le,null,oe(a(E),t=>(u(),f("li",{key:t},y(t),1))),128))])):O("",!0)])):O("",!0)]),h.isAdmin?(u(),f("section",We,[o("div",He,[e[9]||(e[9]=o("div",null,[o("p",{class:"text-xs uppercase tracking-[0.3em] text-amber-700"},"Developer Tools"),o("h2",{class:"text-lg font-semibold text-amber-900"},"Developer Tools"),o("p",{class:"text-sm text-amber-800/80"},"Danger zone: fill the database with fake data.")],-1)),g(a(C),{variant:"destructive",size:"sm",disabled:h.seeding,onClick:Ie},{default:k(()=>[_(y(h.seeding?"Seeding...":"Fill Database with Fake Data"),1)]),_:1},8,["disabled"])])])):O("",!0),o("section",Ye,[o("div",qe,[(u(!0),f(le,null,oe(a(r),t=>(u(),f("button",{key:t.id,type:"button",class:ge(["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.15em] transition",a(V)===t.id?"border-slate-900 bg-slate-900 text-white":"border-slate-200 bg-white text-slate-600 hover:border-slate-300 hover:text-slate-900"]),onClick:d=>V.value=t.id},[o("span",null,y(t.label),1),o("span",{class:ge(["inline-flex min-w-[22px] items-center justify-center rounded-full px-1.5 py-0.5 text-[10px]",a(V)===t.id?"bg-white/20 text-white":"bg-slate-100 text-slate-600"])},y(t.count),3)],10,Xe))),128))]),o("div",Qe,[o("div",Ze,[o("div",null,[e[10]||(e[10]=o("p",{class:"text-xs uppercase tracking-[0.2em] text-slate-500"},"Category",-1)),o("h3",et,y(a(i).label),1),o("p",tt,"Match rules: "+y(a(i).hint),1)]),o("p",st,y(a(p).length)+" settings",1)]),h.pending&&a(c).length===0?(u(),f("div",at," Loading settings... ")):a(p).length===0?(u(),f("div",nt,[a(U)?(u(),f("span",lt,"No settings found for the current search.")):(u(),f("span",ot,"No settings in this category."))])):(u(),f("div",it,[(u(!0),f(le,null,oe(a(p),t=>(u(),f("article",{key:t.key,class:"rounded-xl border border-slate-200 bg-white p-4 shadow-sm"},[o("div",rt,[o("div",dt,[o("p",ut,y(t.key),1),o("p",ct,"Type: "+y(t.value_type),1)]),o("div",pt,[g(a(ie),{variant:"outline"},{default:k(()=>[_(y(t.value_type),1)]),_:2},1024),t.is_public?(u(),K(a(ie),{key:0,variant:"success"},{default:k(()=>[...e[11]||(e[11]=[_("Public",-1)])]),_:1})):O("",!0),t.is_encrypted?(u(),K(a(ie),{key:1,variant:"warning"},{default:k(()=>[...e[12]||(e[12]=[_("Encrypted",-1)])]),_:1})):O("",!0)])]),o("div",mt,[t.value_type==="json"?(u(),K(a(he),{key:0,"model-value":a(m)[t.key],class:"min-h-[92px] text-xs font-mono","onUpdate:modelValue":d=>{a(m)[t.key]=d,ae(t.key)}},null,8,["model-value","onUpdate:modelValue"])):t.value_type==="boolean"?fe((u(),f("select",{key:1,"onUpdate:modelValue":d=>a(m)[t.key]=d,class:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm",onChange:d=>ae(t.key)},[...e[13]||(e[13]=[o("option",{value:"true"},"true",-1),o("option",{value:"false"},"false",-1)])],40,ft)),[[ye,a(m)[t.key]]]):(u(),K(a(Z),{key:2,"model-value":a(m)[t.key],class:"h-10 text-sm","onUpdate:modelValue":d=>{a(m)[t.key]=d,ae(t.key)}},null,8,["model-value","onUpdate:modelValue"]))]),a(ce)[t.key]?(u(),f("p",yt,y(a(ce)[t.key]),1)):O("",!0),o("div",gt,[o("div",vt,[a(b)[t.key]?(u(),K(a(C),{key:0,variant:"outline",size:"sm",class:"gap-2",disabled:a(S)[t.key],onClick:d=>Se(t)},{default:k(()=>[g(a(Fe),{class:"h-4 w-4"}),_(" "+y(a(S)[t.key]?"Saving...":"Save"),1)]),_:2},1032,["disabled","onClick"])):O("",!0),a(b)[t.key]?(u(),K(a(C),{key:1,variant:"ghost",size:"sm",onClick:d=>ke(t.key)},{default:k(()=>[...e[14]||(e[14]=[_(" Reset ",-1)])]),_:1},8,["onClick"])):(u(),f("span",ht,"No changes"))]),g(a(C),{variant:"outline",size:"sm",class:"gap-2 text-red-600",disabled:a(A)[t.key],onClick:d=>Ce(t)},{default:k(()=>[g(a(Ue),{class:"h-4 w-4"}),_(" "+y(a(A)[t.key]?"Deleting...":"Delete"),1)]),_:2},1032,["disabled","onClick"])])]))),128))]))])]),g(a(Pe),{modelValue:a(N),"onUpdate:modelValue":e[5]||(e[5]=t=>W(N)?N.value=t:null)},{default:k(()=>[o("div",xt,[o("div",kt,[e[16]||(e[16]=o("div",null,[o("h3",{class:"text-lg font-semibold text-foreground"},"Add Config"),o("p",{class:"text-sm text-muted-foreground"},"Create a new system setting.")],-1)),g(a(C),{variant:"ghost",size:"sm",onClick:ne},{default:k(()=>[...e[15]||(e[15]=[_("Close",-1)])]),_:1})]),o("div",bt,[o("div",null,[e[17]||(e[17]=o("label",{class:"text-xs uppercase tracking-[0.2em] text-muted-foreground"},"Key",-1)),g(a(Z),{modelValue:a(M),"onUpdate:modelValue":e[1]||(e[1]=t=>W(M)?M.value=t:null),placeholder:"AI_GENERATION_ENABLED"},null,8,["modelValue"])]),o("div",null,[e[18]||(e[18]=o("label",{class:"text-xs uppercase tracking-[0.2em] text-muted-foreground"},"Value",-1)),g(a(Z),{modelValue:a(L),"onUpdate:modelValue":e[2]||(e[2]=t=>W(L)?L.value=t:null),placeholder:"true"},null,8,["modelValue"])]),o("div",null,[e[20]||(e[20]=o("label",{class:"text-xs uppercase tracking-[0.2em] text-muted-foreground"},"Type",-1)),fe(o("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>W(j)?j.value=t:null),class:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm"},[...e[19]||(e[19]=[o("option",{value:"string"},"String",-1),o("option",{value:"json"},"JSON",-1),o("option",{value:"boolean"},"Boolean",-1)])],512),[[ye,a(j)]])]),o("div",null,[e[21]||(e[21]=o("label",{class:"text-xs uppercase tracking-[0.2em] text-muted-foreground"},"Description",-1)),g(a(he),{modelValue:a($),"onUpdate:modelValue":e[4]||(e[4]=t=>W($)?$.value=t:null),placeholder:"Short description"},null,8,["modelValue"])])]),o("div",_t,[g(a(C),{variant:"outline",onClick:ne},{default:k(()=>[...e[22]||(e[22]=[_("Cancel",-1)])]),_:1}),g(a(C),{disabled:a(J),onClick:Ee},{default:k(()=>[_(y(a(J)?"Creating...":"Create"),1)]),_:1},8,["disabled"])])])]),_:1},8,["modelValue"]),a(G)?(u(),f("div",St,y(a(G)),1)):O("",!0),h.hasError?(u(),f("div",Ct," Failed to load settings. ")):O("",!0)]))}}),re="/api/v1/admin/settings",Et="/api/v1/admin/settings/export",wt="/api/v1/admin/settings/import",At="/api/v1/debug/seed",Zt=xe({__name:"index",setup(ue){const h=De(),D=F(()=>h.user?.role==="admin"),c=v([]),m=v(!1),b=async n=>{const l=new Headers(n??{}),r=await h.ensureAccessToken();return r&&l.set("Authorization",`Bearer ${r}`),l},S=async(n,l={})=>{const r=await b(l.headers);return await $fetch(n,{baseURL:ve(n),...l,headers:r})},{data:A,pending:G,error:R,refresh:U,execute:V}=Ne(re,{server:!1,immediate:!1,baseURL:ve(re),onRequest:async({options:n})=>{n.headers=await b(n.headers)}},"$ayBzSOJfuO");ee(()=>h.user?.role,async n=>{n==="admin"&&await V()},{immediate:!0}),ee(A,n=>{c.value=Array.isArray(n)?[...n]:[]},{immediate:!0});const P=async()=>{await U()},N=n=>{const l=c.value.findIndex(i=>i.key===n.key);if(l===-1){c.value=[n,...c.value];return}const r=[...c.value];r[l]=n,c.value=r},J=n=>{c.value=c.value.filter(l=>l.key!==n)},M=n=>`/api/v1/admin/settings/${encodeURIComponent(n)}`,L=async n=>{const l=M(n.key),r={value:String(n.value??""),description:n.description??null,is_public:n.is_public??!1},i=await S(l,{method:"PUT",body:r});return N(i),i},j=async n=>{const l=M(n);await S(l,{method:"DELETE"}),J(n)},$=async n=>{const l=await S(re,{method:"POST",body:n});return N(l),l},I=n=>!n||typeof n!="object"||Array.isArray(n)?null:n,z=n=>{if(typeof n=="string")return n;if(n==null)return"";if(typeof n=="object")try{return JSON.stringify(n)}catch{return String(n)}return String(n)},T=n=>{const l=n.trim().toLowerCase();return l==="true"||l==="false"?"boolean":l.startsWith("{")&&l.endsWith("}")||l.startsWith("[")&&l.endsWith("]")?"json":"string"},E=n=>{const l=I(n);if(!l)return null;const i=(typeof l.key=="string"?l.key:typeof l.name=="string"?l.name:"").trim().toUpperCase();if(!i)return null;const p=z(l.value),w=typeof l.value_type=="string"?l.value_type.trim():"";return{key:i,value:p,value_type:w||T(p),description:typeof l.description=="string"?l.description:null,is_public:typeof l.is_public=="boolean"?l.is_public:!1}},H=n=>{if(Array.isArray(n))return n.map(i=>E(i)).filter(i=>i!==null);const l=I(n);if(!l)return[];const r=l.settings??l.configs??l.items;return Array.isArray(r)?H(r):Object.entries(l).map(([i,p])=>{const w=I(p);return E(w?{key:i,...w}:{key:i,value:p})}).filter(i=>i!==null)},Y=(n,l)=>{if(!n)return l;const r=n.match(/filename\*\s*=\s*UTF-8''([^;]+)/i);if(r?.[1])return decodeURIComponent(r[1].trim());const i=n.match(/filename\s*=\s*\"?([^\";]+)\"?/i);return i?.[1]?i[1].trim():l},q=(n,l)=>{const r=URL.createObjectURL(n),i=document.createElement("a");i.href=r,i.download=l,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)},te=n=>{const l=n?.data;if(typeof l?.detail=="string"&&l.detail)return l.detail;if(l?.detail&&typeof l.detail=="object")try{return JSON.stringify(l.detail)}catch{return"Request failed"}const r=n?.message;return typeof r=="string"&&r?r:"Request failed"},x=async()=>{const n=await b(),l=await fetch(Re(Et),{method:"GET",headers:n});if(!l.ok){const w=await l.text();throw new Error(w||`Export failed (${l.status})`)}const r=await l.blob(),i=`settings-export-${new Date().toISOString().slice(0,19).replace(/[:]/g,"-")}.json`;let p=Y(l.headers.get("content-disposition"),i);return p.toLowerCase().endsWith(".json")||(p=`${p}.json`),q(r,p),`${p} downloaded`},se=async n=>{const l=await n.text();let r;try{r=JSON.parse(l)}catch{throw new Error("Invalid JSON file")}const i=H(r);if(!i.length)throw new Error("No valid settings found in file");const p=await S(wt,{method:"POST",body:i});await P();const w=typeof p?.imported=="number"?p.imported:typeof p?.updated=="number"?p.updated:typeof p?.total=="number"?p.total:i.length;return p?.message||`Imported ${w} settings`},X=async()=>{if(!m.value){m.value=!0;try{await S(At,{method:"POST"})}catch(n){throw new Error(te(n))}finally{m.value=!1}}};return(n,l)=>(u(),K(Tt,{settings:a(c),pending:a(G),"has-error":!!a(R),"is-admin":a(D),seeding:a(m),"on-refresh":P,"on-save-setting":L,"on-delete-setting":j,"on-create-setting":$,"on-export-settings":x,"on-import-settings":se,"on-seed-database":X},null,8,["settings","pending","has-error","is-admin","seeding"]))}});export{Zt as default};
