import{f as ae,c as se,N as D,G as A,H as s,K as l,O as e,W as _,U as F,V as M,L as a,J as r,M as n,S as j,v as d,X as S,y as H,F as m,T as k,P as oe,Q as ie}from"./Bdjb0SXm.js";import p from"./B4TyZ_bU.js";import ne from"./cRrWWQur.js";import"./Da0WQd-O.js";import I from"./BEYAt5ls.js";import"./DS_fG_uV.js";import re from"./DeHUBOuf.js";import de from"./MI7OGpUw.js";import ue from"./BKfwxZk3.js";import $ from"./C60XlcZO.js";import b from"./CKmkznge.js";import c from"./B0YsM2uZ.js";import me from"./Bh3fyw7B.js";import"./BsWIP-yW.js";import"./BNLw-KlI.js";import"./B4yhBorQ.js";import"./BcuCH1ZM.js";import"./Bkl1Gi2Q.js";import"./B3ikXpdR.js";import ce from"./CBAXUXrF.js";import"./C-AT-e_2.js";import ve from"./Df0XMdEe.js";import{u as fe}from"./CL3jLyeF.js";import{c as y}from"./t7OZfVNK.js";import"./CkYB-R1u.js";import"./c5FhCeC0.js";const pe=y("crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);const xe=y("lock-open",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);const be=y("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);const he=y("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);const ge=y("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const ye=y("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),_e={class:"flex h-[calc(100vh-11rem)] min-h-[32rem] flex-col gap-6"},ke={class:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm"},we={class:"flex flex-wrap items-center justify-between gap-4"},Ce={class:"flex flex-1 flex-wrap items-center gap-3"},ze={class:"relative w-full max-w-md"},Te={class:"flex min-h-0 flex-1 flex-col overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm"},Ve={class:"min-h-0 flex-1 overflow-auto"},Ue={class:"flex items-center gap-3"},Ae=["href"],$e={class:"flex items-center justify-end gap-2"},Be={class:"flex items-center justify-between border-t border-slate-200 px-4 py-3 text-sm text-slate-500"},Le={class:"flex items-center gap-2"},De={class:"space-y-4"},Fe={class:"flex items-start justify-between gap-4"},Me={class:"text-sm text-muted-foreground"},je={class:"space-y-2"},Se={class:"flex items-center justify-end gap-2"},He={key:0,class:"fixed bottom-6 right-6 z-50 rounded-xl bg-slate-900 px-4 py-3 text-sm text-white shadow-2xl"},Ne={class:"flex items-center gap-2"},Oe={key:1,class:"rounded-2xl border border-red-200 bg-red-50 p-4 text-sm text-red-700"},N=20,ft=ae({__name:"index",setup(Pe){const B=se(),w=d(""),C=d(""),v=d("all"),f=d("all"),u=d(0);let L=null;D(w,i=>{L&&clearTimeout(L),L=setTimeout(()=>{C.value=i.trim(),u.value=0},350)}),D([v,f],()=>{u.value=0});const q=H(()=>`admin-users-${u.value}-${C.value}-${v.value}-${f.value}`),E=()=>B.apiFetch("/api/v1/admin/users",{baseURL:S("/api/v1/admin/users"),query:{search:C.value||void 0,role:v.value==="all"?void 0:v.value,is_active:f.value==="all"?void 0:f.value==="active",limit:N,offset:u.value*N}}),{data:K,pending:X,error:G,refresh:J}=fe(q,E,{default:()=>[],watch:[u,v,f,C]}),z=d([]);D(K,i=>{z.value=i?[...i]:[]},{immediate:!0});const Q=H(()=>u.value>0),W=H(()=>z.value.length===N),Y=i=>new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"short",year:"numeric"}).format(new Date(i)),Z=i=>i.slice(0,2).toUpperCase(),T=d(""),V=i=>{T.value=i,setTimeout(()=>{T.value=""},2500)},R=async i=>{const t=!i.is_active;try{await B.apiFetch(`/api/v1/admin/users/${i.id}/ban`,{method:"PATCH",baseURL:S(`/api/v1/admin/users/${i.id}/ban`),query:{is_active:t}}),i.is_active=t,V(t?"Пользователь разблокирован":"Пользователь забанен")}catch{V("Не удалось изменить статус пользователя")}},h=d(!1),x=d(null),g=d("user"),U=d(!1),ee=i=>{x.value=i,g.value=i.role||"user",h.value=!0},O=()=>{h.value=!1,x.value=null},te=async()=>{if(!x.value)return;U.value=!0;const i={role:g.value};try{await B.apiFetch(`/api/v1/admin/users/${x.value.id}/role`,{method:"PATCH",baseURL:S(`/api/v1/admin/users/${x.value.id}/role`),body:i}),x.value.role=g.value,V("Роль пользователя обновлена"),h.value=!1}catch{V("Не удалось изменить роль пользователя")}finally{U.value=!1}},P=i=>i==="admin"?{label:"Admin",variant:"default"}:i==="organizer"?{label:"Organizer",variant:"secondary"}:{label:"User",variant:"outline"};return(i,t)=>(m(),A("div",_e,[s("section",ke,[s("div",we,[s("div",Ce,[s("div",ze,[l(e(he),{class:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-500"}),l(e(ne),{modelValue:e(w),"onUpdate:modelValue":t[0]||(t[0]=o=>_(w)?w.value=o:null),class:"h-10 pl-9 text-sm",placeholder:"Поиск по username или email"},null,8,["modelValue"])]),F(s("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>_(v)?v.value=o:null),class:"h-10 rounded-md border border-slate-200 bg-white px-3 text-sm text-slate-700"},[...t[7]||(t[7]=[s("option",{value:"all"},"Все роли",-1),s("option",{value:"user"},"User",-1),s("option",{value:"organizer"},"Organizer",-1),s("option",{value:"admin"},"Admin",-1)])],512),[[M,e(v)]]),F(s("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>_(f)?f.value=o:null),class:"h-10 rounded-md border border-slate-200 bg-white px-3 text-sm text-slate-700"},[...t[8]||(t[8]=[s("option",{value:"all"},"Все статусы",-1),s("option",{value:"active"},"Active",-1),s("option",{value:"banned"},"Banned",-1)])],512),[[M,e(f)]])]),l(e(p),{variant:"outline",size:"sm",onClick:e(J)},{default:a(()=>[...t[9]||(t[9]=[n("Обновить",-1)])]),_:1},8,["onClick"])])]),s("section",Te,[s("div",Ve,[l(e(re),{class:"w-max min-w-full"},{default:a(()=>[l(e(de),{class:"[&_th]:sticky [&_th]:top-0 [&_th]:z-10 [&_th]:bg-white"},{default:a(()=>[l(e($),null,{default:a(()=>[l(e(b),null,{default:a(()=>[...t[10]||(t[10]=[n("ID",-1)])]),_:1}),l(e(b),null,{default:a(()=>[...t[11]||(t[11]=[n("User",-1)])]),_:1}),l(e(b),null,{default:a(()=>[...t[12]||(t[12]=[n("Email",-1)])]),_:1}),l(e(b),null,{default:a(()=>[...t[13]||(t[13]=[n("Роль",-1)])]),_:1}),l(e(b),null,{default:a(()=>[...t[14]||(t[14]=[n("Статус",-1)])]),_:1}),l(e(b),null,{default:a(()=>[...t[15]||(t[15]=[n("Дата регистрации",-1)])]),_:1}),l(e(b),{class:"text-right"},{default:a(()=>[...t[16]||(t[16]=[n("Действия",-1)])]),_:1})]),_:1})]),_:1}),l(e(ue),null,{default:a(()=>[e(X)?(m(),k(e($),{key:0},{default:a(()=>[l(e(c),{colspan:"7",class:"py-10 text-center text-sm text-slate-500"},{default:a(()=>[...t[17]||(t[17]=[n(" Загружаем пользователей... ",-1)])]),_:1})]),_:1})):e(z).length===0?(m(),k(e($),{key:1},{default:a(()=>[l(e(c),{colspan:"7",class:"py-10 text-center text-sm text-slate-500"},{default:a(()=>[...t[18]||(t[18]=[n(" Пользователи не найдены ",-1)])]),_:1})]),_:1})):j("",!0),(m(!0),A(oe,null,ie(e(z),o=>(m(),k(e($),{key:o.id},{default:a(()=>[l(e(c),{class:"text-xs text-slate-500"},{default:a(()=>[n(r(o.id),1)]),_:2},1024),l(e(c),null,{default:a(()=>[s("div",Ue,[l(e(ce),{class:"h-8 w-8"},{default:a(()=>[l(e(ve),{class:"bg-slate-200 text-xs font-semibold text-slate-700"},{default:a(()=>[n(r(Z(o.username)),1)]),_:2},1024)]),_:2},1024),s("div",null,[s("a",{class:"text-sm font-semibold text-slate-900 hover:underline",href:`/u/${o.username}`,target:"_blank",rel:"noreferrer"},r(o.username),9,Ae)])])]),_:2},1024),l(e(c),{class:"text-sm text-slate-600"},{default:a(()=>[n(r(o.email||"—"),1)]),_:2},1024),l(e(c),null,{default:a(()=>[l(e(I),{variant:P(o.role).variant},{default:a(()=>[n(r(P(o.role).label),1)]),_:2},1032,["variant"])]),_:2},1024),l(e(c),null,{default:a(()=>[l(e(I),{variant:o.is_active?"success":"warning"},{default:a(()=>[n(r(o.is_active?"Active":"Banned"),1)]),_:2},1032,["variant"])]),_:2},1024),l(e(c),{class:"text-sm text-slate-600"},{default:a(()=>[n(r(Y(o.created_at)),1)]),_:2},1024),l(e(c),{class:"text-right"},{default:a(()=>[s("div",$e,[l(e(p),{variant:"outline",size:"icon",class:"h-8 w-8",onClick:le=>R(o)},{default:a(()=>[o.is_active?(m(),k(e(be),{key:0,class:"h-4 w-4"})):(m(),k(e(xe),{key:1,class:"h-4 w-4"}))]),_:2},1032,["onClick"]),l(e(p),{variant:"outline",size:"icon",class:"h-8 w-8",onClick:le=>ee(o)},{default:a(()=>[l(e(pe),{class:"h-4 w-4"})]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),s("div",Be,[s("span",null,"Страница "+r(e(u)+1),1),s("div",Le,[l(e(p),{variant:"outline",size:"sm",disabled:!e(Q),onClick:t[3]||(t[3]=o=>u.value--)},{default:a(()=>[...t[19]||(t[19]=[n("Назад",-1)])]),_:1},8,["disabled"]),l(e(p),{variant:"outline",size:"sm",disabled:!e(W),onClick:t[4]||(t[4]=o=>u.value++)},{default:a(()=>[...t[20]||(t[20]=[n("Вперед",-1)])]),_:1},8,["disabled"])])])]),l(e(me),{modelValue:e(h),"onUpdate:modelValue":t[6]||(t[6]=o=>_(h)?h.value=o:null)},{default:a(()=>[s("div",De,[s("div",Fe,[s("div",null,[t[21]||(t[21]=s("h3",{class:"text-lg font-semibold text-foreground"},"Смена роли",-1)),s("p",Me," Пользователь: "+r(e(x)?.username||"—"),1)]),l(e(p),{variant:"ghost",size:"icon",class:"h-9 w-9 rounded-full","aria-label":"Закрыть модальное окно",onClick:O},{default:a(()=>[l(e(ye),{class:"h-4 w-4"})]),_:1})]),s("div",je,[t[23]||(t[23]=s("label",{class:"text-xs uppercase tracking-[0.2em] text-muted-foreground"},"Роль",-1)),F(s("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>_(g)?g.value=o:null),class:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm"},[...t[22]||(t[22]=[s("option",{value:"user"},"User",-1),s("option",{value:"organizer"},"Organizer",-1),s("option",{value:"admin"},"Admin",-1)])],512),[[M,e(g)]])]),s("div",Se,[l(e(p),{variant:"outline",onClick:O},{default:a(()=>[...t[24]||(t[24]=[n("Отмена",-1)])]),_:1}),l(e(p),{disabled:e(U),onClick:te},{default:a(()=>[n(r(e(U)?"Сохраняем...":"Сохранить"),1)]),_:1},8,["disabled"])])])]),_:1},8,["modelValue"]),e(T)?(m(),A("div",He,[s("div",Ne,[l(e(ge),{class:"h-4 w-4 text-emerald-300"}),n(" "+r(e(T)),1)])])):j("",!0),e(G)?(m(),A("div",Oe," Не удалось загрузить список пользователей. ")):j("",!0)]))}});export{ft as default};
