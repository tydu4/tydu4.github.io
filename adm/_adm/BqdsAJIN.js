import{f as ke,N as ae,k as Oe,G as c,H as i,K as g,L as x,O as a,W as H,J as p,P as oe,Q as re,S as F,v,F as u,M as _,U as me,V as fe,y as I,Y as se,R as ye,T as K,c as Fe,X as ge,$ as ve}from"./DIZEteV9.js";import E from"./BLRRhdP8.js";import ne from"./DdstQMVl.js";import he from"./D5bKVmWl.js";import de from"./8wp3HBB2.js";import"./cDmEP3g8.js";import"./fwZTpFsi.js";import"./D2OYhHbD.js";import"./DY8q8zZl.js";import"./DrS9-dzY.js";import"./Gv2rAKSg.js";import"./CPg7whAV.js";import Re from"./ndzoT83F.js";import"./CjNsL2Uk.js";import"./B3bG68Mx.js";import"./DEv1dFTV.js";import"./15n3hb76.js";import"./D8ZLDjl0.js";import"./B297zo46.js";import{c as ue}from"./0vfjiBTb.js";import{u as we}from"./-P7Drmee.js";import"./CkYB-R1u.js";import"./c5FhCeC0.js";import"./CbuGzaEx.js";const Ue=ue("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const Pe=ue("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);const Me=ue("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),Ne={class:"space-y-6"},Le={class:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm"},je={class:"flex flex-wrap items-start justify-between gap-4"},ze={class:"flex flex-wrap items-center gap-2"},$e={class:"mt-4 max-w-lg"},Be={key:0,class:"mt-4 rounded-xl border border-slate-200 bg-slate-50 px-4 py-3"},Ke={class:"text-sm font-medium text-slate-700"},Ge={key:0,class:"mt-2 space-y-1 text-xs text-red-600"},Je={key:0,class:"rounded-2xl border border-amber-200/70 bg-amber-50/80 p-5 shadow-sm"},We={class:"flex flex-wrap items-center justify-between gap-4"},He={class:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"},Ye={class:"flex flex-wrap gap-2"},Xe=["onClick"],qe={class:"mt-4 rounded-xl border border-slate-200 bg-slate-50/50 p-4"},Qe={class:"flex flex-wrap items-start justify-between gap-3"},Ze={class:"text-lg font-semibold text-slate-900"},et={class:"text-xs text-slate-500"},tt={class:"text-xs text-slate-500"},st={key:0,class:"py-10 text-center text-sm text-slate-500"},nt={key:1,class:"mt-4 rounded-xl border border-dashed border-slate-200 bg-white px-4 py-8 text-center text-sm text-slate-500"},at={key:0},lt={key:1},it={key:2,class:"mt-4 grid gap-4 lg:grid-cols-2"},ot={class:"flex flex-wrap items-start justify-between gap-3"},rt={class:"min-w-0"},dt={class:"truncate text-sm font-semibold text-slate-900"},ut={class:"mt-1 text-xs text-slate-500"},ct={class:"flex flex-wrap items-center gap-1"},pt={class:"mt-3"},mt=["onUpdate:modelValue","onChange"],ft={key:0,class:"mt-2 text-xs text-slate-500"},yt={class:"mt-4 flex flex-wrap items-center justify-between gap-2"},gt={class:"flex flex-wrap items-center gap-2"},vt={key:2,class:"text-xs text-slate-400"},ht={class:"space-y-4"},kt={class:"flex items-start justify-between gap-4"},xt={class:"grid gap-3"},bt={class:"flex items-center justify-end gap-2"},_t={key:1,class:"fixed bottom-6 right-6 z-50 rounded-xl bg-slate-900 px-4 py-3 text-sm text-white shadow-2xl"},Ct={key:2,class:"rounded-2xl border border-red-200 bg-red-50 p-4 text-sm text-red-700"},St=ke({__name:"SettingsManagerBlock",props:{settings:{},pending:{type:Boolean},hasError:{type:Boolean},isAdmin:{type:Boolean},seeding:{type:Boolean},onRefresh:{type:Function},onSaveSetting:{type:Function},onDeleteSetting:{type:Function},onCreateSetting:{type:Function},onExportSettings:{type:Function},onImportSettings:{type:Function},onSeedDatabase:{type:Function}},setup(ce){const m=ce,R=[{id:"payments",label:"Payments",hint:"PAYMENT_, CRYPTOBOT, MOCK_TOPUP",tokens:["PAYMENT_","CRYPTOBOT","MOCK_TOPUP"]},{id:"security",label:"Security",hint:"JWT_, SECRET, TOKEN, ADMIN_",tokens:["JWT_","SECRET","TOKEN","ADMIN_"]},{id:"storage",label:"Storage",hint:"S3_, GCP_, LOCAL_STORAGE",tokens:["S3_","GCP_","LOCAL_STORAGE"]},{id:"game",label:"Game",hint:"XP_, LEVEL_, TICKET",tokens:["XP_","LEVEL_","TICKET"]},{id:"general",label:"General",hint:"DOMAIN, MAINTENANCE, APP_MODE and all unmatched keys",tokens:[]}],f=v([]),y=se({}),C=se({}),T=se({}),h=se({}),G=v("");let D=null;const M=v(""),S=v("payments"),w=v(!1),U=v(!1),N=v(!1),L=v(!1),j=v(""),z=v(""),$=v("string"),B=v(""),J=v(!1),O=v(""),V=v([]),Y=v(null),X=s=>{if(!s)return s;let e=s;const t=s.trim();if(t.startsWith('"')&&t.endsWith('"'))try{const d=JSON.parse(t);typeof d=="string"&&(e=d)}catch{}return e.includes("\\u")&&(e=e.replace(/\\u([0-9a-fA-F]{4})/g,(d,A)=>String.fromCharCode(parseInt(A,16)))),e},q=s=>({...s,value:X(String(s.value??"")),description:s.description==null?null:X(s.description)}),te=()=>{const s=new Set(f.value.map(e=>e.key));Object.keys(y).forEach(e=>{s.has(e)||(delete y[e],delete C[e],delete T[e],delete h[e])}),f.value.forEach(e=>{y[e.key]=e.value??"",C[e.key]=!1})};ae(()=>m.settings,s=>{f.value=s?s.map(e=>q(e)).sort((e,t)=>e.key.localeCompare(t.key)):[],te()},{immediate:!0,deep:!0});const k=s=>{G.value=s,D&&clearTimeout(D),D=setTimeout(()=>{G.value="",D=null},2500)};Oe(()=>{D&&clearTimeout(D)});const le=s=>{const e=s.toUpperCase();return R[0].tokens.some(t=>e.includes(t))?"payments":R[1].tokens.some(t=>e.includes(t))?"security":R[2].tokens.some(t=>e.includes(t))?"storage":R[3].tokens.some(t=>e.includes(t))?"game":"general"},Q=I(()=>M.value.trim().toLowerCase()),W=I(()=>Q.value?f.value.filter(s=>{const e=s.key.toLowerCase(),t=String(y[s.key]??s.value??"").toLowerCase();return e.includes(Q.value)||t.includes(Q.value)}):f.value),Z=I(()=>{const s={payments:[],security:[],storage:[],game:[],general:[]};return W.value.forEach(e=>{const t=le(e.key);s[t].push(e)}),Object.keys(s).forEach(e=>{s[e].sort((t,d)=>t.key.localeCompare(d.key))}),s}),ee=I(()=>R.map(s=>({...s,count:Z.value[s.id].length}))),n=I(()=>ee.value.find(s=>s.id===S.value)??ee.value[0]),l=I(()=>Z.value[S.value]??[]);ae(Z,s=>{if(s[S.value]?.length)return;const e=R.find(t=>s[t.id].length>0);e&&(S.value=e.id)},{deep:!0});const r=s=>{if(s==null)return null;const e=X(s).trim();if(!e)return null;const t=e.replace(/\s+/g,"");if(/^[?\uFFFD]+$/.test(t))return null;const d=/[A-Za-z0-9\u0400-\u04FF]/.test(e),A=(t.match(/[?\uFFFD]/g)??[]).length;return!d&&A>0?null:e},o=I(()=>{const s={};return f.value.forEach(e=>{s[e.key]=r(e.description)}),s}),b=s=>{const e=f.value.find(t=>t.key===s)?.value??"";C[s]=(y[s]??"")!==e},P=s=>{const e=f.value.find(t=>t.key===s)?.value??"";y[s]=e,C[s]=!1},pe=s=>{const e=f.value.findIndex(d=>d.key===s.key);if(e===-1){f.value=[s,...f.value].sort((d,A)=>d.key.localeCompare(A.key));return}const t=[...f.value];t[e]=s,f.value=t.sort((d,A)=>d.key.localeCompare(A.key))},xe=s=>{f.value=f.value.filter(e=>e.key!==s),delete y[s],delete C[s],delete T[s],delete h[s]},be=async()=>{if(!w.value){w.value=!0;try{await m.onRefresh(),k("Settings refreshed")}catch{k("Failed to refresh settings")}finally{w.value=!1}}},_e=async s=>{if(!(!C[s.key]||T[s.key])){T[s.key]=!0;try{const e=await m.onSaveSetting({key:s.key,value:y[s.key]??"",description:s.description??null,is_public:s.is_public??!1}),t=q(e);pe(t),y[s.key]=t.value??"",C[s.key]=!1,k(`Saved ${s.key}`)}catch{k(`Failed to save ${s.key}`)}finally{T[s.key]=!1}}},Ce=async s=>{if(!h[s.key]&&window.confirm(`Delete setting ${s.key}?`)){h[s.key]=!0;try{await m.onDeleteSetting(s.key),xe(s.key),k(`Deleted ${s.key}`)}catch{k(`Failed to delete ${s.key}`)}finally{h[s.key]=!1}}},Se=()=>{N.value=!0},ie=()=>{N.value=!1,j.value="",z.value="",$.value="string",B.value=""},Ee=async()=>{const s=j.value.trim().toUpperCase();if(s){L.value=!0;try{const e=await m.onCreateSetting({key:s,value:z.value,value_type:$.value,description:B.value.trim()||null,is_public:!1}),t=q(e);pe(t),y[t.key]=t.value??"",C[t.key]=!1,k(`Created ${t.key}`),ie()}catch{k("Failed to create setting")}finally{L.value=!1}}},Te=async()=>{if(!U.value){U.value=!0;try{await m.onExportSettings(),k("Settings export ready")}catch{k("Failed to export settings")}finally{U.value=!1}}},De=()=>{Y.value?.click()},Ve=s=>{const e=s?.data?.detail;if(typeof e=="string"&&e)return e;const t=s?.message;return typeof t=="string"&&t?t:"request failed"},Ae=async s=>{const e=s.target,t=e.files?.[0];if(t){O.value="",V.value=[],J.value=!0;try{const d=await m.onImportSettings(t);d?(O.value=d.summary,V.value=d.errors??[]):(O.value="Import completed.",V.value=[]),k(O.value)}catch(d){const A=`Import failed: ${Ve(d)}`;O.value=A,V.value=[],k(A)}finally{J.value=!1,e.value=""}}},Ie=async()=>{try{await m.onSeedDatabase(),k("Database seeded")}catch{k("Failed to seed database")}};return(s,e)=>(u(),c("div",Ne,[i("section",Le,[i("div",je,[e[7]||(e[7]=i("div",null,[i("p",{class:"text-xs uppercase tracking-[0.3em] text-slate-500"},"System Config"),i("h2",{class:"text-lg font-semibold"},"System settings"),i("p",{class:"text-sm text-slate-500"},"Find, edit and backup key-value configuration safely.")],-1)),i("div",ze,[g(a(E),{variant:"outline",size:"sm",disabled:a(w),onClick:be},{default:x(()=>[_(p(a(w)?"Refreshing...":"Refresh"),1)]),_:1},8,["disabled"]),g(a(E),{variant:"outline",size:"sm",disabled:a(U),onClick:Te},{default:x(()=>[_(p(a(U)?"Exporting...":"Export"),1)]),_:1},8,["disabled"]),g(a(E),{variant:"outline",size:"sm",disabled:a(J),onClick:De},{default:x(()=>[_(p(a(J)?"Importing...":"Import"),1)]),_:1},8,["disabled"]),i("input",{ref_key:"importInputRef",ref:Y,type:"file",accept:"application/json,.json",class:"hidden",onChange:Ae},null,544),g(a(E),{size:"sm",class:"gap-2",onClick:Se},{default:x(()=>[g(a(Ue),{class:"h-4 w-4"}),e[6]||(e[6]=_(" Add Config ",-1))]),_:1})])]),i("div",$e,[e[8]||(e[8]=i("label",{class:"text-xs uppercase tracking-[0.2em] text-slate-500"},"Search",-1)),g(a(ne),{modelValue:a(M),"onUpdate:modelValue":e[0]||(e[0]=t=>H(M)?M.value=t:null),type:"search",placeholder:"Search by key or value",class:"mt-2"},null,8,["modelValue"])]),a(O)?(u(),c("div",Be,[i("p",Ke,p(a(O)),1),a(V).length?(u(),c("ul",Ge,[(u(!0),c(oe,null,re(a(V),t=>(u(),c("li",{key:t},p(t),1))),128))])):F("",!0)])):F("",!0)]),m.isAdmin?(u(),c("section",Je,[i("div",We,[e[9]||(e[9]=i("div",null,[i("p",{class:"text-xs uppercase tracking-[0.3em] text-amber-700"},"Developer Tools"),i("h2",{class:"text-lg font-semibold text-amber-900"},"Developer Tools"),i("p",{class:"text-sm text-amber-800/80"},"Danger zone: fill the database with fake data.")],-1)),g(a(E),{variant:"destructive",size:"sm",disabled:m.seeding,onClick:Ie},{default:x(()=>[_(p(m.seeding?"Seeding...":"Fill Database with Fake Data"),1)]),_:1},8,["disabled"])])])):F("",!0),i("section",He,[i("div",Ye,[(u(!0),c(oe,null,re(a(ee),t=>(u(),c("button",{key:t.id,type:"button",class:ye(["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.15em] transition",a(S)===t.id?"border-slate-900 bg-slate-900 text-white":"border-slate-200 bg-white text-slate-600 hover:border-slate-300 hover:text-slate-900"]),onClick:d=>S.value=t.id},[i("span",null,p(t.label),1),i("span",{class:ye(["inline-flex min-w-[22px] items-center justify-center rounded-full px-1.5 py-0.5 text-[10px]",a(S)===t.id?"bg-white/20 text-white":"bg-slate-100 text-slate-600"])},p(t.count),3)],10,Xe))),128))]),i("div",qe,[i("div",Qe,[i("div",null,[e[10]||(e[10]=i("p",{class:"text-xs uppercase tracking-[0.2em] text-slate-500"},"Category",-1)),i("h3",Ze,p(a(n).label),1),i("p",et,"Match rules: "+p(a(n).hint),1)]),i("p",tt,p(a(l).length)+" settings",1)]),m.pending&&a(f).length===0?(u(),c("div",st," Loading settings... ")):a(l).length===0?(u(),c("div",nt,[a(M)?(u(),c("span",at,"No settings found for the current search.")):(u(),c("span",lt,"No settings in this category."))])):(u(),c("div",it,[(u(!0),c(oe,null,re(a(l),t=>(u(),c("article",{key:t.key,class:"rounded-xl border border-slate-200 bg-white p-4 shadow-sm"},[i("div",ot,[i("div",rt,[i("p",dt,p(t.key),1),i("p",ut,"Type: "+p(t.value_type),1)]),i("div",ct,[g(a(de),{variant:"outline"},{default:x(()=>[_(p(t.value_type),1)]),_:2},1024),t.is_public?(u(),K(a(de),{key:0,variant:"success"},{default:x(()=>[...e[11]||(e[11]=[_("Public",-1)])]),_:1})):F("",!0),t.is_encrypted?(u(),K(a(de),{key:1,variant:"warning"},{default:x(()=>[...e[12]||(e[12]=[_("Encrypted",-1)])]),_:1})):F("",!0)])]),i("div",pt,[t.value_type==="json"?(u(),K(a(he),{key:0,"model-value":a(y)[t.key],class:"min-h-[92px] text-xs font-mono","onUpdate:modelValue":d=>{a(y)[t.key]=d,b(t.key)}},null,8,["model-value","onUpdate:modelValue"])):t.value_type==="boolean"?me((u(),c("select",{key:1,"onUpdate:modelValue":d=>a(y)[t.key]=d,class:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm",onChange:d=>b(t.key)},[...e[13]||(e[13]=[i("option",{value:"true"},"true",-1),i("option",{value:"false"},"false",-1)])],40,mt)),[[fe,a(y)[t.key]]]):(u(),K(a(ne),{key:2,"model-value":a(y)[t.key],class:"h-10 text-sm","onUpdate:modelValue":d=>{a(y)[t.key]=d,b(t.key)}},null,8,["model-value","onUpdate:modelValue"]))]),a(o)[t.key]?(u(),c("p",ft,p(a(o)[t.key]),1)):F("",!0),i("div",yt,[i("div",gt,[a(C)[t.key]?(u(),K(a(E),{key:0,variant:"outline",size:"sm",class:"gap-2",disabled:a(T)[t.key],onClick:d=>_e(t)},{default:x(()=>[g(a(Pe),{class:"h-4 w-4"}),_(" "+p(a(T)[t.key]?"Saving...":"Save"),1)]),_:2},1032,["disabled","onClick"])):F("",!0),a(C)[t.key]?(u(),K(a(E),{key:1,variant:"ghost",size:"sm",onClick:d=>P(t.key)},{default:x(()=>[...e[14]||(e[14]=[_(" Reset ",-1)])]),_:1},8,["onClick"])):(u(),c("span",vt,"No changes"))]),g(a(E),{variant:"outline",size:"sm",class:"gap-2 text-red-600",disabled:a(h)[t.key],onClick:d=>Ce(t)},{default:x(()=>[g(a(Me),{class:"h-4 w-4"}),_(" "+p(a(h)[t.key]?"Deleting...":"Delete"),1)]),_:2},1032,["disabled","onClick"])])]))),128))]))])]),g(a(Re),{modelValue:a(N),"onUpdate:modelValue":e[5]||(e[5]=t=>H(N)?N.value=t:null)},{default:x(()=>[i("div",ht,[i("div",kt,[e[16]||(e[16]=i("div",null,[i("h3",{class:"text-lg font-semibold text-foreground"},"Add Config"),i("p",{class:"text-sm text-muted-foreground"},"Create a new system setting.")],-1)),g(a(E),{variant:"ghost",size:"sm",onClick:ie},{default:x(()=>[...e[15]||(e[15]=[_("Close",-1)])]),_:1})]),i("div",xt,[i("div",null,[e[17]||(e[17]=i("label",{class:"text-xs uppercase tracking-[0.2em] text-muted-foreground"},"Key",-1)),g(a(ne),{modelValue:a(j),"onUpdate:modelValue":e[1]||(e[1]=t=>H(j)?j.value=t:null),placeholder:"AI_GENERATION_ENABLED"},null,8,["modelValue"])]),i("div",null,[e[18]||(e[18]=i("label",{class:"text-xs uppercase tracking-[0.2em] text-muted-foreground"},"Value",-1)),g(a(ne),{modelValue:a(z),"onUpdate:modelValue":e[2]||(e[2]=t=>H(z)?z.value=t:null),placeholder:"true"},null,8,["modelValue"])]),i("div",null,[e[20]||(e[20]=i("label",{class:"text-xs uppercase tracking-[0.2em] text-muted-foreground"},"Type",-1)),me(i("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>H($)?$.value=t:null),class:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm"},[...e[19]||(e[19]=[i("option",{value:"string"},"String",-1),i("option",{value:"json"},"JSON",-1),i("option",{value:"boolean"},"Boolean",-1)])],512),[[fe,a($)]])]),i("div",null,[e[21]||(e[21]=i("label",{class:"text-xs uppercase tracking-[0.2em] text-muted-foreground"},"Description",-1)),g(a(he),{modelValue:a(B),"onUpdate:modelValue":e[4]||(e[4]=t=>H(B)?B.value=t:null),placeholder:"Short description"},null,8,["modelValue"])])]),i("div",bt,[g(a(E),{variant:"outline",onClick:ie},{default:x(()=>[...e[22]||(e[22]=[_("Cancel",-1)])]),_:1}),g(a(E),{disabled:a(L),onClick:Ee},{default:x(()=>[_(p(a(L)?"Creating...":"Create"),1)]),_:1},8,["disabled"])])])]),_:1},8,["modelValue"]),a(G)?(u(),c("div",_t,p(a(G)),1)):F("",!0),m.hasError?(u(),c("div",Ct," Failed to load settings. ")):F("",!0)]))}}),Yt=ke({__name:"index",setup(ce){const m=Fe(),R=I(()=>!!m.user),{data:f,pending:y,error:C,refresh:T}=we("/api/v1/admin/settings",{key:"admin-settings",baseURL:ge("/api/v1/admin/settings"),$fetch:m.apiFetch,server:!1,immediate:!1,default:()=>[]},"$ayBzSOJfuO");ae(R,n=>{n&&T()},{immediate:!0});const h=v([]);ae(f,n=>{h.value=n?[...n]:[]},{immediate:!0});const G=I(()=>m.user?.role==="admin"),D=async()=>{const n=await m.ensureAccessToken();return n?{Authorization:`Bearer ${n}`}:{}},M=(n,l)=>{if(!l)return n;if(l instanceof Headers){const r={...n};return l.forEach((o,b)=>{r[b]=o}),r}return Array.isArray(l)?l.reduce((r,[o,b])=>(r[o]=b,r),{...n}):{...n,...l}},S=async(n,l={})=>{const r=await D(),o=M(r,l.headers);return await $fetch(n,{...l,baseURL:ge(n),headers:o})},w=async()=>{await T()},U=n=>{const l=h.value.findIndex(o=>o.key===n.key);if(l===-1){h.value=[n,...h.value];return}const r=[...h.value];r[l]=n,h.value=r},N=n=>{h.value=h.value.filter(l=>l.key!==n)},L=n=>`/api/v1/admin/settings/${encodeURIComponent(n)}`,j=async n=>{const l=L(n.key),r={value:String(n.value??""),description:n.description??null,is_public:n.is_public??!1},o=await S(l,{method:"PUT",body:r});return U(o),o},z=async n=>{const l=L(n);await S(l,{method:"DELETE"}),N(n)},$=async n=>{const l=await S("/api/v1/admin/settings",{method:"POST",body:n});return U(l),l},B=(n,l)=>{const r=URL.createObjectURL(n),o=document.createElement("a");o.href=r,o.download=l,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r)},J=(n,l)=>{if(!n)return l;const r=n.match(/filename\*?=(?:UTF-8'')?\"?([^\";]+)\"?/i);return r?.[1]?decodeURIComponent(r[1]):l},O=async()=>{const n=await D(),l=await fetch(ve("/api/v1/admin/settings/export"),{headers:n});if(!l.ok)throw new Error(`Export failed with status ${l.status}`);const r=await l.blob(),o=`settings_backup_${new Date().toISOString().slice(0,10)}.json`,b=J(l.headers.get("content-disposition"),o);B(r,b)},V=n=>!n||typeof n!="object"||Array.isArray(n)?null:n,Y=n=>n.trim().toUpperCase(),X=n=>{const l=V(n);if(!l)return null;const r=l.key??l.name;if(typeof r!="string")return null;const o=Y(r);return o?{key:o,value:l.value??"",description:typeof l.description=="string"?l.description:null,value_type:typeof l.value_type=="string"?l.value_type:null,is_public:typeof l.is_public=="boolean"?l.is_public:null}:null},q=(n,l)=>{const r=Y(n);if(!r)return null;const o=V(l);return o&&("value"in o||"description"in o||"value_type"in o||"is_public"in o)?{key:r,value:o.value??"",description:typeof o.description=="string"?o.description:null,value_type:typeof o.value_type=="string"?o.value_type:null,is_public:typeof o.is_public=="boolean"?o.is_public:null}:{key:r,value:l,description:null,value_type:null,is_public:null}},te=n=>{if(Array.isArray(n))return n.map(o=>X(o)).filter(o=>o!==null);const l=V(n);if(!l)return[];const r=l.settings??l.items;return Array.isArray(r)?te(r):Object.entries(l).map(([o,b])=>q(o,b)).filter(o=>o!==null)},k=n=>{if(typeof n=="string")return n;if(n==null)return"";if(typeof n=="object")try{return JSON.stringify(n)}catch{return String(n)}return String(n)},le=n=>{if(typeof n=="boolean")return"boolean";if(n&&typeof n=="object")return"json";const l=k(n).trim().toLowerCase();return l==="true"||l==="false"?"boolean":l.startsWith("{")&&l.endsWith("}")||l.startsWith("[")&&l.endsWith("]")?"json":"string"},Q=async n=>{const l=await n.text();let r;try{r=JSON.parse(l)}catch{throw new Error("Invalid JSON file")}const o=te(r);if(!o.length)return{summary:"No valid settings found in file.",errors:[]};const b=o.map(P=>({key:P.key.trim().toUpperCase(),value:k(P.value),value_type:P.value_type?.trim()||le(P.value),description:P.description??null,is_public:!!P.is_public}));return await S("/api/v1/admin/settings/import",{method:"POST",body:b}),await w(),{summary:`Imported ${b.length} settings.`,errors:[]}},W=v(!1),Z=I(()=>ve("/api/v1/debug/seed")),ee=async()=>{if(!W.value){W.value=!0;try{await $fetch(Z.value,{method:"POST",headers:await D()})}finally{W.value=!1}}};return(n,l)=>(u(),K(St,{settings:a(h),pending:a(y),"has-error":!!a(C),"is-admin":a(G),seeding:a(W),"on-refresh":w,"on-save-setting":j,"on-delete-setting":z,"on-create-setting":$,"on-export-settings":O,"on-import-settings":Q,"on-seed-database":ee},null,8,["settings","pending","has-error","is-admin","seeding"]))}});export{Yt as default};
