import{f as B,T as S,L as t,O as e,F as v,K as s,H as o,M as m,J as b,ai as I,a3 as M,R as G,G as $,S as K,v as x,y as q,Q,P as V,c as W}from"./Cu9pBwV9.js";import R from"./19XThGzF.js";import"./qtYjwcMh.js";import"./FpDCiqsp.js";import"./DZFHlsC0.js";import"./CZ5eJ5C_.js";import J from"./BRYvvQpL.js";import X from"./CLBxTCuQ.js";import Y from"./Dxox8W-8.js";import O from"./VECgceg4.js";import T from"./BBGM9ROk.js";import C from"./CNyPXozD.js";import"./BMPggNyw.js";import A from"./1MT8oc-r.js";import z from"./TWMK2zgj.js";import H from"./Byzpnqrt.js";import"./CFHGTpjn.js";import L from"./Btik6d0e.js";import"./31q3d9H4.js";import"./CkYB-R1u.js";import"./c5FhCeC0.js";const Z=["onKeydown"],ee={class:"text-sm font-medium"},te={key:0,class:"text-xs text-red-600"},se=B({__name:"DbDumpBlock",props:{downloadingDump:{type:Boolean},uploadingDump:{type:Boolean}},emits:["download-db","restore-file"],setup(_,{emit:f}){const i=_,w=f,d=x(!1),n=x(""),p=x(null),a=()=>{p.value?.click()},u=r=>{if(r){if(!r.name.toLowerCase().endsWith(".sql")){n.value="Only .sql files are allowed.";return}n.value="",w("restore-file",r)}},y=r=>{const g=r.target;u(g?.files?.[0]),g&&(g.value="")},D=r=>{r.preventDefault(),d.value=!0},k=r=>{r.preventDefault(),d.value=!1},h=r=>{r.preventDefault(),d.value=!1,u(r.dataTransfer?.files?.[0])};return(r,g)=>(v(),S(e(A),{class:"rounded-2xl border-slate-200 shadow-sm"},{default:t(()=>[s(e(z),{class:"flex flex-row items-start justify-between gap-4 space-y-0"},{default:t(()=>[o("div",null,[g[2]||(g[2]=o("p",{class:"text-xs uppercase tracking-[0.2em] text-slate-500"},"Dump",-1)),s(e(H),{class:"mt-1 text-lg text-slate-900"},{default:t(()=>[...g[1]||(g[1]=[m("Import / Export",-1)])]),_:1})]),s(e(R),{size:"sm",variant:"outline",class:"border-slate-300 bg-white hover:bg-slate-50",disabled:i.downloadingDump,onClick:g[0]||(g[0]=F=>w("download-db"))},{default:t(()=>[m(b(i.downloadingDump?"Preparing...":"Download DB"),1)]),_:1},8,["disabled"])]),_:1}),s(e(L),{class:"space-y-3"},{default:t(()=>[o("div",{role:"button",tabindex:"0",class:G(["rounded-xl border-2 border-dashed px-4 py-8 text-center transition",e(d)?"border-orange-500 bg-orange-50 text-orange-700":"border-slate-300 bg-slate-50 text-slate-600"]),onClick:a,onKeydown:[I(M(a,["prevent"]),["enter"]),I(M(a,["prevent"]),["space"])],onDragover:D,onDragleave:k,onDrop:h},[o("p",ee,b(i.uploadingDump?"Uploading SQL file...":"Drop SQL file here or click to upload"),1),g[3]||(g[3]=o("p",{class:"mt-1 text-xs text-slate-500"},"Restore from file",-1))],42,Z),o("input",{ref_key:"fileInput",ref:p,type:"file",class:"hidden",accept:".sql,application/sql,text/plain",onChange:y},null,544),e(n)?(v(),$("p",te,b(e(n)),1)):K("",!0)]),_:1})]),_:1}))}}),ae={class:"rounded-lg border border-slate-200 bg-slate-50 px-3 py-2"},re={class:"mt-1 font-mono text-sm text-slate-900"},oe=B({__name:"DbMigrationsBlock",props:{currentRevision:{},upgradingHead:{type:Boolean}},emits:["upgrade-head"],setup(_,{emit:f}){const i=_,w=f;return(d,n)=>(v(),S(e(A),{class:"rounded-2xl border-slate-200 shadow-sm"},{default:t(()=>[s(e(z),{class:"flex flex-row items-start justify-between gap-4 space-y-0"},{default:t(()=>[o("div",null,[n[2]||(n[2]=o("p",{class:"text-xs uppercase tracking-[0.2em] text-slate-500"},"Alembic",-1)),s(e(H),{class:"mt-1 text-lg text-slate-900"},{default:t(()=>[...n[1]||(n[1]=[m("Migrations",-1)])]),_:1})]),s(e(R),{size:"sm",class:"bg-orange-600 text-white hover:bg-orange-700",disabled:i.upgradingHead,onClick:n[0]||(n[0]=p=>w("upgrade-head"))},{default:t(()=>[m(b(i.upgradingHead?"Applying...":"Upgrade Head"),1)]),_:1},8,["disabled"])]),_:1}),s(e(L),{class:"space-y-3"},{default:t(()=>[o("div",ae,[n[3]||(n[3]=o("p",{class:"text-[11px] uppercase tracking-[0.2em] text-slate-500"},"Current Revision",-1)),o("p",re,b(i.currentRevision),1)]),n[4]||(n[4]=o("p",{class:"text-xs text-amber-700"}," Apply with caution. Upgrading schema can impact active traffic. ",-1))]),_:1})]),_:1}))}}),ne={class:"max-h-[280px] overflow-auto bg-slate-950 p-4 font-mono text-xs leading-relaxed text-emerald-300"},le={class:"m-0 whitespace-pre-wrap"},ie=B({__name:"DbOperationLogBlock",props:{logs:{}},setup(_){const f=_,i=q(()=>f.logs.length===0?["[--:--:--] Waiting for operations..."]:f.logs);return(w,d)=>(v(),S(e(A),{class:"overflow-hidden rounded-2xl border-slate-200 shadow-sm"},{default:t(()=>[s(e(z),{class:"border-b border-slate-200 bg-slate-900 text-slate-100"},{default:t(()=>[d[1]||(d[1]=o("p",{class:"text-xs uppercase tracking-[0.2em] text-slate-400"},"Console",-1)),s(e(H),{class:"text-lg text-white"},{default:t(()=>[...d[0]||(d[0]=[m("Operation Logs",-1)])]),_:1})]),_:1}),s(e(L),{class:"p-0"},{default:t(()=>[o("div",ne,[o("pre",le,b(e(i).join(`
`)),1)])]),_:1})]),_:1}))}}),de=B({__name:"DbSnapshotsBlock",props:{snapshots:{},creatingSnapshot:{type:Boolean},restoringSnapshotId:{}},emits:["create-snapshot","restore-snapshot"],setup(_,{emit:f}){const i=_,w=f,d=p=>p==="ready"?"border-emerald-200 bg-emerald-50 text-emerald-700":p==="failed"?"border-red-200 bg-red-50 text-red-700":"border-amber-200 bg-amber-50 text-amber-700",n=p=>{window.confirm(`DANGER: Restore snapshot ${p}? This will overwrite current database state.`)&&w("restore-snapshot",p)};return(p,a)=>(v(),S(e(A),{class:"rounded-2xl border-slate-200 shadow-sm"},{default:t(()=>[s(e(z),{class:"flex flex-row items-start justify-between gap-4 space-y-0"},{default:t(()=>[o("div",null,[a[2]||(a[2]=o("p",{class:"text-xs uppercase tracking-[0.2em] text-slate-500"},"Snapshots",-1)),s(e(H),{class:"mt-1 text-lg text-slate-900"},{default:t(()=>[...a[1]||(a[1]=[m("Backups",-1)])]),_:1})]),s(e(R),{size:"sm",class:"bg-orange-500 text-white hover:bg-orange-600",disabled:i.creatingSnapshot,onClick:a[0]||(a[0]=u=>w("create-snapshot"))},{default:t(()=>[m(b(i.creatingSnapshot?"Creating...":"Create Snapshot"),1)]),_:1},8,["disabled"])]),_:1}),s(e(L),null,{default:t(()=>[s(e(J),null,{default:t(()=>[s(e(X),null,{default:t(()=>[s(e(O),null,{default:t(()=>[s(e(T),null,{default:t(()=>[...a[3]||(a[3]=[m("Date",-1)])]),_:1}),s(e(T),null,{default:t(()=>[...a[4]||(a[4]=[m("Size",-1)])]),_:1}),s(e(T),null,{default:t(()=>[...a[5]||(a[5]=[m("Status",-1)])]),_:1}),s(e(T),{class:"text-right"},{default:t(()=>[...a[6]||(a[6]=[m("Action",-1)])]),_:1})]),_:1})]),_:1}),s(e(Y),null,{default:t(()=>[i.snapshots.length===0?(v(),S(e(O),{key:0},{default:t(()=>[s(e(C),{colspan:4,class:"py-6 text-center text-sm text-slate-500"},{default:t(()=>[...a[7]||(a[7]=[m(" No snapshots yet. ",-1)])]),_:1})]),_:1})):K("",!0),(v(!0),$(V,null,Q(i.snapshots,u=>(v(),S(e(O),{key:u.id},{default:t(()=>[s(e(C),{class:"text-xs text-slate-600"},{default:t(()=>[m(b(u.createdAt),1)]),_:2},1024),s(e(C),{class:"text-xs text-slate-600"},{default:t(()=>[m(b(u.size),1)]),_:2},1024),s(e(C),null,{default:t(()=>[o("span",{class:G(["inline-flex rounded-full border px-2 py-0.5 text-[11px] font-medium",d(u.status)])},b(u.status),3)]),_:2},1024),s(e(C),{class:"text-right"},{default:t(()=>[s(e(R),{size:"sm",class:"bg-red-600 text-white hover:bg-red-700",disabled:i.restoringSnapshotId===u.id,onClick:y=>n(u.id)},{default:t(()=>[m(b(i.restoringSnapshotId===u.id?"Restoring...":"Restore"),1)]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}))}}),ue={key:0,class:"rounded-2xl border border-slate-200 bg-white p-4 text-sm text-slate-500"},pe={key:1,class:"rounded-2xl border border-red-200 bg-red-50 p-4 text-sm text-red-700"},ce={key:2,class:"space-y-6"},me={class:"grid gap-6 xl:grid-cols-2"},Ue=B({__name:"orchestration",setup(_){const f=W(),i=q(()=>!!f.user),w=q(()=>f.user?.role==="admin"),d=x([{id:"snap-2026-02-16-03-15",createdAt:"2026-02-16 03:15 UTC",size:"1.4 GB",status:"ready"},{id:"snap-2026-02-16-01-00",createdAt:"2026-02-16 01:00 UTC",size:"1.3 GB",status:"ready"},{id:"snap-2026-02-15-22-45",createdAt:"2026-02-15 22:45 UTC",size:"1.3 GB",status:"failed"}]),n=x("8d2f9a1f23c0"),p=x(["[00:00:00] DB orchestration dashboard loaded."]),a=x(!1),u=x(null),y=x(!1),D=x(!1),k=x(!1),h=l=>new Promise(c=>setTimeout(c,l)),r=l=>{const c=new Date().toTimeString().slice(0,8);p.value.push(`[${c}] ${l}`),p.value.length>200&&p.value.splice(0,p.value.length-200)},g=l=>{const c=l.toISOString();return`${c.slice(0,10)} ${c.slice(11,16)} UTC`},F=async()=>{if(a.value)return;a.value=!0,r("Backup started...");const l=new Date,c=`snap-${l.toISOString().replace(/[:.]/g,"-").slice(0,19)}`;d.value.unshift({id:c,createdAt:g(l),size:"Pending",status:"in-progress"}),await h(1200),d.value=d.value.map(U=>U.id===c?{...U,size:"1.4 GB",status:"ready"}:U),r(`Backup finished: ${c}.`),a.value=!1},N=async l=>{u.value||(u.value=l,r(`Restore requested for ${l}.`),await h(900),r("Restore in progress..."),await h(1200),r(`Restore completed for ${l}.`),u.value=null)},P=async()=>{y.value||(y.value=!0,r("Full SQL dump requested."),await h(1e3),r("Dump package is ready for download (stub)."),y.value=!1)},j=async l=>{if(D.value)return;D.value=!0;const c=Math.max(1,Math.round(l.size/1024));r(`Upload started: ${l.name} (${c} KB).`),await h(1e3),r("Upload finished."),await h(700),r(`Restore from file queued: ${l.name}.`),D.value=!1},E=async()=>{if(k.value)return;k.value=!0,r("Alembic upgrade head started..."),await h(1300);const l=new Date().toISOString().slice(0,16).replace(/[-:T]/g,"");n.value=`head-${l}`,r(`Alembic upgrade finished. Current revision: ${n.value}.`),k.value=!1};return(l,c)=>e(i)?e(w)?(v(),$("div",ce,[c[0]||(c[0]=o("section",{class:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm"},[o("p",{class:"text-xs uppercase tracking-[0.3em] text-slate-500"},"Database Operations"),o("h2",{class:"mt-2 text-xl font-semibold text-slate-900"},"DB Management"),o("p",{class:"mt-2 text-sm text-slate-600"}," Create snapshots, restore database dumps, run Alembic migrations, and track operation logs. ")],-1)),o("div",me,[s(de,{snapshots:e(d),"creating-snapshot":e(a),"restoring-snapshot-id":e(u),onCreateSnapshot:F,onRestoreSnapshot:N},null,8,["snapshots","creating-snapshot","restoring-snapshot-id"]),s(se,{"downloading-dump":e(y),"uploading-dump":e(D),onDownloadDb:P,onRestoreFile:j},null,8,["downloading-dump","uploading-dump"])]),s(oe,{"current-revision":e(n),"upgrading-head":e(k),onUpgradeHead:E},null,8,["current-revision","upgrading-head"]),s(ie,{logs:e(p)},null,8,["logs"])])):(v(),$("div",pe," Access denied. This page is available for super admin only. ")):(v(),$("div",ue," Checking access... "))}});export{Ue as default};
