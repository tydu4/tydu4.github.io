import{f as N,T as k,L as a,O as t,F as f,K as n,H as o,M as u,J as v,ai as ce,a3 as fe,R as ie,G as C,S as ee,v as D,y as A,Q as Z,P as j,W as Ne,c as Fe,X as Y,N as oe}from"./DIZEteV9.js";import T from"./BLRRhdP8.js";import"./DdstQMVl.js";import"./D5bKVmWl.js";import je from"./8wp3HBB2.js";import"./cDmEP3g8.js";import me from"./fwZTpFsi.js";import ge from"./D2OYhHbD.js";import be from"./DY8q8zZl.js";import B from"./DrS9-dzY.js";import E from"./Gv2rAKSg.js";import $ from"./CPg7whAV.js";import He from"./ndzoT83F.js";import H from"./CjNsL2Uk.js";import q from"./B3bG68Mx.js";import P from"./DEv1dFTV.js";import"./15n3hb76.js";import I from"./D8ZLDjl0.js";import"./B297zo46.js";import{u as le}from"./-P7Drmee.js";import"./CkYB-R1u.js";import"./c5FhCeC0.js";import"./CbuGzaEx.js";const qe=["onKeydown"],Pe={class:"text-sm font-medium"},Ie={key:0,class:"text-xs text-red-600"},Me=N({__name:"DbDumpBlock",props:{downloadingDump:{type:Boolean},uploadingDump:{type:Boolean},disableActions:{type:Boolean}},emits:["download-db","restore-file"],setup(S,{emit:x}){const l=S,w=x,b=D(!1),m=D(""),i=D(null),g=()=>{l.disableActions||l.uploadingDump||i.value?.click()},R=p=>{if(!(l.disableActions||l.uploadingDump)&&p){if(!p.name.toLowerCase().endsWith(".sql")){m.value="Only .sql files are allowed.";return}m.value="",w("restore-file",p)}},L=p=>{const h=p.target;R(h?.files?.[0]),h&&(h.value="")},M=p=>{l.disableActions||l.uploadingDump||(p.preventDefault(),b.value=!0)},_=p=>{l.disableActions||l.uploadingDump||(p.preventDefault(),b.value=!1)},d=p=>{l.disableActions||l.uploadingDump||(p.preventDefault(),b.value=!1,R(p.dataTransfer?.files?.[0]))};return(p,h)=>(f(),k(t(H),{class:"rounded-2xl border-slate-200 shadow-sm"},{default:a(()=>[n(t(q),{class:"flex flex-row items-start justify-between gap-4 space-y-0"},{default:a(()=>[o("div",null,[h[2]||(h[2]=o("p",{class:"text-xs uppercase tracking-[0.2em] text-slate-500"},"Dump",-1)),n(t(P),{class:"mt-1 text-lg text-slate-900"},{default:a(()=>[...h[1]||(h[1]=[u("Import / Export",-1)])]),_:1})]),n(t(T),{size:"sm",variant:"outline",class:"border-slate-300 bg-white hover:bg-slate-50",disabled:l.downloadingDump,onClick:h[0]||(h[0]=F=>w("download-db"))},{default:a(()=>[u(v(l.downloadingDump?"Preparing...":"Download DB"),1)]),_:1},8,["disabled"])]),_:1}),n(t(I),{class:"space-y-3"},{default:a(()=>[o("div",{role:"button",tabindex:"0",class:ie(["rounded-xl border-2 border-dashed px-4 py-8 text-center transition",l.disableActions?"cursor-not-allowed border-slate-200 bg-slate-100 text-slate-400 opacity-70":t(b)?"border-orange-500 bg-orange-50 text-orange-700":"border-slate-300 bg-slate-50 text-slate-600"]),onClick:g,onKeydown:[ce(fe(g,["prevent"]),["enter"]),ce(fe(g,["prevent"]),["space"])],onDragover:M,onDragleave:_,onDrop:d},[o("p",Pe,v(l.uploadingDump?"Uploading SQL file...":l.disableActions?"Restore disabled while operation is running":"Drop SQL file here or click to upload"),1),h[3]||(h[3]=o("p",{class:"mt-1 text-xs text-slate-500"},"Restore from file",-1))],42,qe),o("input",{ref_key:"fileInput",ref:i,type:"file",class:"hidden",accept:".sql,application/sql,text/plain",onChange:L},null,544),t(m)?(f(),C("p",Ie,v(t(m)),1)):ee("",!0)]),_:1})]),_:1}))}}),Ke={class:"max-h-[280px] overflow-auto bg-red-950 p-4 font-mono text-xs leading-relaxed text-red-200"},Ve={class:"m-0 whitespace-pre-wrap"},We=N({__name:"DbErrorConsoleBlock",props:{errors:{}},setup(S){const x=S,l=A(()=>x.errors.length===0?["[--:--:--] No errors recorded."]:x.errors);return(w,b)=>(f(),k(t(H),{class:"overflow-hidden rounded-2xl border-red-200 shadow-sm"},{default:a(()=>[n(t(q),{class:"border-b border-red-200 bg-red-900 text-red-100"},{default:a(()=>[b[1]||(b[1]=o("p",{class:"text-xs uppercase tracking-[0.2em] text-red-300"},"Error Console",-1)),n(t(P),{class:"text-lg text-white"},{default:a(()=>[...b[0]||(b[0]=[u("Failure Output",-1)])]),_:1})]),_:1}),n(t(I),{class:"p-0"},{default:a(()=>[o("div",Ke,[o("pre",Ve,v(t(l).join(`
`)),1)])]),_:1})]),_:1}))}}),Ge={class:"rounded-lg border border-slate-200 bg-slate-50 px-3 py-2"},Qe={class:"mt-1 font-mono text-sm text-slate-900"},Je=N({__name:"DbMigrationsBlock",props:{currentRevision:{},upgradingHead:{type:Boolean},disableActions:{type:Boolean},loading:{type:Boolean}},emits:["upgrade-head"],setup(S,{emit:x}){const l=S,w=x;return(b,m)=>(f(),k(t(H),{class:"rounded-2xl border-slate-200 shadow-sm"},{default:a(()=>[n(t(q),{class:"flex flex-row items-start justify-between gap-4 space-y-0"},{default:a(()=>[o("div",null,[m[2]||(m[2]=o("p",{class:"text-xs uppercase tracking-[0.2em] text-slate-500"},"Alembic",-1)),n(t(P),{class:"mt-1 text-lg text-slate-900"},{default:a(()=>[...m[1]||(m[1]=[u("Migrations",-1)])]),_:1})]),n(t(T),{size:"sm",class:"bg-orange-600 text-white hover:bg-orange-700",disabled:l.upgradingHead||l.disableActions,onClick:m[0]||(m[0]=i=>w("upgrade-head"))},{default:a(()=>[u(v(l.upgradingHead?"Applying...":"Upgrade Head"),1)]),_:1},8,["disabled"])]),_:1}),n(t(I),{class:"space-y-3"},{default:a(()=>[o("div",Ge,[m[3]||(m[3]=o("p",{class:"text-[11px] uppercase tracking-[0.2em] text-slate-500"},"Current Revision",-1)),o("p",Qe,v(l.loading?"Loading...":l.currentRevision),1)]),m[4]||(m[4]=o("p",{class:"text-xs text-amber-700"}," Apply with caution. Upgrading schema can impact active traffic. ",-1))]),_:1})]),_:1}))}}),Xe={class:"max-h-[280px] overflow-auto bg-slate-950 p-4 font-mono text-xs leading-relaxed text-emerald-300"},Ye={class:"m-0 whitespace-pre-wrap"},Ze=N({__name:"DbOperationLogBlock",props:{logs:{}},setup(S){const x=S,l=A(()=>x.logs.length===0?["[--:--:--] Waiting for operations..."]:x.logs);return(w,b)=>(f(),k(t(H),{class:"overflow-hidden rounded-2xl border-slate-200 shadow-sm"},{default:a(()=>[n(t(q),{class:"border-b border-slate-200 bg-slate-900 text-slate-100"},{default:a(()=>[b[1]||(b[1]=o("p",{class:"text-xs uppercase tracking-[0.2em] text-slate-400"},"Console",-1)),n(t(P),{class:"text-lg text-white"},{default:a(()=>[...b[0]||(b[0]=[u("Execution Console",-1)])]),_:1})]),_:1}),n(t(I),{class:"p-0"},{default:a(()=>[o("div",Xe,[o("pre",Ye,v(t(l).join(`
`)),1)])]),_:1})]),_:1}))}}),et={class:"space-y-2"},tt={key:1,class:"text-xs text-slate-400"},st=N({__name:"DbOperationsListBlock",props:{logs:{},loading:{type:Boolean},hasError:{type:Boolean}},emits:["refresh"],setup(S,{emit:x}){const l=S,w=x,b=m=>{const i=(m??"").toLowerCase();return i?i.includes("fail")||i.includes("error")?"border-red-200 bg-red-50 text-red-700":i.includes("success")||i.includes("done")||i.includes("ready")?"border-emerald-200 bg-emerald-50 text-emerald-700":i.includes("run")||i.includes("progress")?"border-amber-200 bg-amber-50 text-amber-700":"border-slate-200 bg-slate-50 text-slate-600":"border-slate-200 bg-slate-50 text-slate-600"};return(m,i)=>(f(),k(t(H),{class:"rounded-2xl border-slate-200 shadow-sm"},{default:a(()=>[n(t(q),{class:"flex flex-row items-start justify-between gap-4 space-y-0"},{default:a(()=>[o("div",null,[i[2]||(i[2]=o("p",{class:"text-xs uppercase tracking-[0.2em] text-slate-500"},"Operations",-1)),n(t(P),{class:"mt-1 text-lg text-slate-900"},{default:a(()=>[...i[1]||(i[1]=[u("Operation Logs",-1)])]),_:1})]),n(t(T),{size:"sm",variant:"outline",disabled:l.loading,onClick:i[0]||(i[0]=g=>w("refresh"))},{default:a(()=>[...i[3]||(i[3]=[u(" Refresh ",-1)])]),_:1},8,["disabled"])]),_:1}),n(t(I),null,{default:a(()=>[n(t(me),null,{default:a(()=>[n(t(ge),null,{default:a(()=>[n(t(B),null,{default:a(()=>[n(t(E),null,{default:a(()=>[...i[4]||(i[4]=[u("Timestamp",-1)])]),_:1}),n(t(E),null,{default:a(()=>[...i[5]||(i[5]=[u("Message",-1)])]),_:1}),n(t(E),{class:"text-right"},{default:a(()=>[...i[6]||(i[6]=[u("Status",-1)])]),_:1})]),_:1})]),_:1}),n(t(be),null,{default:a(()=>[l.loading?(f(),k(t(B),{key:0},{default:a(()=>[n(t($),{colspan:3,class:"py-6"},{default:a(()=>[o("div",et,[(f(),C(j,null,Z(4,g=>o("div",{key:g,class:"flex items-center gap-4"},[...i[7]||(i[7]=[o("div",{class:"h-3 w-28 animate-pulse rounded bg-slate-200"},null,-1),o("div",{class:"h-3 w-full animate-pulse rounded bg-slate-200"},null,-1),o("div",{class:"h-5 w-16 animate-pulse rounded bg-slate-200"},null,-1)])])),64))])]),_:1})]),_:1})):l.hasError?(f(),k(t(B),{key:1},{default:a(()=>[n(t($),{colspan:3,class:"py-6 text-center text-sm text-red-600"},{default:a(()=>[...i[8]||(i[8]=[u(" Failed to load operation logs. ",-1)])]),_:1})]),_:1})):l.logs.length===0?(f(),k(t(B),{key:2},{default:a(()=>[n(t($),{colspan:3,class:"py-6 text-center text-sm text-slate-500"},{default:a(()=>[...i[9]||(i[9]=[u(" No operations logged yet. ",-1)])]),_:1})]),_:1})):ee("",!0),(f(!0),C(j,null,Z(l.logs,g=>(f(),k(t(B),{key:g.id},{default:a(()=>[n(t($),{class:"text-xs text-slate-600"},{default:a(()=>[u(v(g.timestamp),1)]),_:2},1024),n(t($),{class:"text-xs text-slate-700"},{default:a(()=>[u(v(g.message),1)]),_:2},1024),n(t($),{class:"text-right"},{default:a(()=>[g.status?(f(),k(t(je),{key:0,variant:"outline",class:ie(["text-[11px]",b(g.status)])},{default:a(()=>[u(v(g.status),1)]),_:2},1032,["class"])):(f(),C("span",tt,"-"))]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}))}}),rt={class:"space-y-2"},at={class:"space-y-4"},nt={class:"flex items-start justify-between gap-4"},ot={class:"rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700"},lt={class:"font-mono"},it={class:"flex items-center justify-end gap-2"},dt=N({__name:"DbSnapshotsBlock",props:{snapshots:{},creatingSnapshot:{type:Boolean},restoringSnapshotId:{},loading:{type:Boolean},disableActions:{type:Boolean}},emits:["create-snapshot","restore-snapshot"],setup(S,{emit:x}){const l=S,w=x,b=_=>_==="ready"?"border-emerald-200 bg-emerald-50 text-emerald-700":_==="failed"?"border-red-200 bg-red-50 text-red-700":"border-amber-200 bg-amber-50 text-amber-700",m=_=>_==="ready"?"Ready":_==="failed"?"Failed":"In Progress",i=D(!1),g=D(null),R=_=>{g.value=_,i.value=!0},L=()=>{i.value=!1,g.value=null},M=()=>{g.value&&(w("restore-snapshot",g.value.filename),L())};return(_,d)=>(f(),C(j,null,[n(t(H),{class:"rounded-2xl border-slate-200 shadow-sm"},{default:a(()=>[n(t(q),{class:"flex flex-row items-start justify-between gap-4 space-y-0"},{default:a(()=>[o("div",null,[d[3]||(d[3]=o("p",{class:"text-xs uppercase tracking-[0.2em] text-slate-500"},"Snapshots",-1)),n(t(P),{class:"mt-1 text-lg text-slate-900"},{default:a(()=>[...d[2]||(d[2]=[u("Backups",-1)])]),_:1})]),n(t(T),{size:"sm",class:"bg-orange-500 text-white hover:bg-orange-600",disabled:l.creatingSnapshot||l.disableActions,onClick:d[0]||(d[0]=p=>w("create-snapshot"))},{default:a(()=>[u(v(l.creatingSnapshot?"Creating...":"Create Snapshot"),1)]),_:1},8,["disabled"])]),_:1}),n(t(I),null,{default:a(()=>[n(t(me),null,{default:a(()=>[n(t(ge),null,{default:a(()=>[n(t(B),null,{default:a(()=>[n(t(E),null,{default:a(()=>[...d[4]||(d[4]=[u("Date",-1)])]),_:1}),n(t(E),null,{default:a(()=>[...d[5]||(d[5]=[u("Size",-1)])]),_:1}),n(t(E),null,{default:a(()=>[...d[6]||(d[6]=[u("Status",-1)])]),_:1}),n(t(E),{class:"text-right"},{default:a(()=>[...d[7]||(d[7]=[u("Action",-1)])]),_:1})]),_:1})]),_:1}),n(t(be),null,{default:a(()=>[l.loading?(f(),k(t(B),{key:0},{default:a(()=>[n(t($),{colspan:4,class:"py-6"},{default:a(()=>[o("div",rt,[(f(),C(j,null,Z(3,p=>o("div",{key:p,class:"grid grid-cols-[1.5fr_1fr_1fr_120px] items-center gap-4"},[...d[8]||(d[8]=[o("div",{class:"h-3 w-32 animate-pulse rounded bg-slate-200"},null,-1),o("div",{class:"h-3 w-20 animate-pulse rounded bg-slate-200"},null,-1),o("div",{class:"h-3 w-16 animate-pulse rounded bg-slate-200"},null,-1),o("div",{class:"h-8 w-24 animate-pulse rounded bg-slate-200"},null,-1)])])),64))])]),_:1})]),_:1})):l.snapshots.length===0?(f(),k(t(B),{key:1},{default:a(()=>[n(t($),{colspan:4,class:"py-6 text-center text-sm text-slate-500"},{default:a(()=>[...d[9]||(d[9]=[u(" No snapshots yet. ",-1)])]),_:1})]),_:1})):ee("",!0),(f(!0),C(j,null,Z(l.snapshots,p=>(f(),k(t(B),{key:p.filename},{default:a(()=>[n(t($),{class:"text-xs text-slate-600"},{default:a(()=>[u(v(p.createdAt),1)]),_:2},1024),n(t($),{class:"text-xs text-slate-600"},{default:a(()=>[u(v(p.size),1)]),_:2},1024),n(t($),null,{default:a(()=>[o("span",{class:ie(["inline-flex rounded-full border px-2 py-0.5 text-[11px] font-medium",b(p.status)])},v(m(p.status)),3)]),_:2},1024),n(t($),{class:"text-right"},{default:a(()=>[n(t(T),{size:"sm",class:"bg-red-600 text-white hover:bg-red-700",disabled:l.disableActions||l.restoringSnapshotId===p.filename,onClick:h=>R(p)},{default:a(()=>[u(v(l.restoringSnapshotId===p.filename?"Restoring...":"Restore"),1)]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),n(t(He),{modelValue:t(i),"onUpdate:modelValue":d[1]||(d[1]=p=>Ne(i)?i.value=p:null)},{default:a(()=>[o("div",at,[o("div",nt,[d[11]||(d[11]=o("div",null,[o("h3",{class:"text-lg font-semibold text-foreground"},"Confirm Restore"),o("p",{class:"text-sm text-muted-foreground"}," This will overwrite the current database state. ")],-1)),n(t(T),{variant:"ghost",size:"sm",onClick:L},{default:a(()=>[...d[10]||(d[10]=[u("Close",-1)])]),_:1})]),o("div",ot,[d[12]||(d[12]=u(" Restore snapshot ",-1)),o("span",lt,v(t(g)?.filename),1),d[13]||(d[13]=u("? ",-1))]),o("div",it,[n(t(T),{variant:"outline",onClick:L},{default:a(()=>[...d[14]||(d[14]=[u("Cancel",-1)])]),_:1}),n(t(T),{class:"bg-red-600 text-white hover:bg-red-700",disabled:l.disableActions||!t(g),onClick:M},{default:a(()=>[...d[15]||(d[15]=[u(" Restore Snapshot ",-1)])]),_:1},8,["disabled"])])])]),_:1},8,["modelValue"])],64))}}),ut={key:0,class:"rounded-2xl border border-slate-200 bg-white p-4 text-sm text-slate-500"},pt={key:1,class:"rounded-2xl border border-red-200 bg-red-50 p-4 text-sm text-red-700"},ct={key:2,class:"space-y-6"},ft={class:"grid gap-6 xl:grid-cols-2"},mt={class:"grid gap-6 xl:grid-cols-2"},gt={key:3,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-950/80 px-4"},bt={class:"rounded-2xl border border-slate-800 bg-slate-900 px-6 py-5 text-center text-slate-100 shadow-2xl"},xt={class:"mt-1 text-xs text-slate-400"},qt=N({__name:"orchestration",setup(S){const x=Fe(),l=A(()=>!!x.user),w=A(()=>x.user?.role==="admin"),b=A(()=>l.value&&w.value),{data:m,pending:i,error:g,refresh:R}=le("/api/v1/admin/database/snapshots",{key:"admin-db-snapshots",baseURL:Y("/api/v1/admin/database/snapshots"),$fetch:x.apiFetch,server:!1,immediate:!1,default:()=>[]},"$wBfKAiYlGD"),{data:L,pending:M,refresh:_}=le("/api/v1/admin/database/migrations/current",{key:"admin-db-revision",baseURL:Y("/api/v1/admin/database/migrations/current"),$fetch:x.apiFetch,server:!1,immediate:!1,default:()=>null},"$DahtjvqONk"),{data:d,pending:p,error:h,refresh:F}=le("/api/v1/admin/database/operations/logs",{key:"admin-db-operations",baseURL:Y("/api/v1/admin/database/operations/logs"),$fetch:x.apiFetch,server:!1,immediate:!1,refreshInterval:1e4,default:()=>[]},"$rcXaNtjSx5");oe(b,e=>{e&&(R(),_(),F())},{immediate:!0});const xe=e=>{if(!Number.isFinite(e))return"—";const s=["B","KB","MB","GB","TB"];let r=e,c=0;for(;r>=1024&&c<s.length-1;)r/=1024,c+=1;return`${r.toFixed(r>=10||c===0?0:1)} ${s[c]}`},te=e=>{if(!e)return"—";if(e instanceof Date)return`${e.toISOString().slice(0,16).replace("T"," ")} UTC`;if(typeof e=="number"){const s=new Date(e);if(!Number.isNaN(s.getTime()))return`${s.toISOString().slice(0,16).replace("T"," ")} UTC`}if(typeof e=="string"){const s=new Date(e);return Number.isNaN(s.getTime())?e:`${s.toISOString().slice(0,16).replace("T"," ")} UTC`}return String(e)},ve=e=>{const s=String(e??"").toLowerCase();return s.includes("fail")?"failed":s.includes("progress")||s.includes("running")?"in-progress":"ready"},he=e=>{const s=Array.isArray(e)?e:e?.items??e?.snapshots??e?.data;return!s||!Array.isArray(s)?[]:s.map((r,c)=>{const U=String(r.filename??r.file??r.id??r.name??`snapshot-${c}`),X=te(r.created_at??r.createdAt??r.date??r.timestamp),ne=typeof r.size=="number"?xe(r.size):r.size?String(r.size):"—",pe=ve(r.status??r.state);return{filename:U,createdAt:X,size:ne,status:pe}}).filter(r=>r.filename)},ye=e=>{if(typeof e=="string")return e;if(e&&typeof e=="object"){const s=e.revision??e.current_revision??e.head??e.value??e.version;if(s)return String(s)}return"unknown"},we=e=>te(e||new Date),_e=e=>{const s=Array.isArray(e)?e:e?.items??e?.logs??e?.data;return!s||!Array.isArray(s)?[]:s.map((r,c)=>{const U=String(r.message??r.log??r.detail??r.output??"—"),X=we(r.timestamp??r.created_at??r.time??r.date),ne=r.status??r.state??null;return{id:String(r.id??`${X}-${c}`),timestamp:X,message:U,status:ne}})},ke=A(()=>he(m.value)),Se=A(()=>ye(L.value)),De=A(()=>_e(d.value)),K=D(!1),O=D(null),V=D(!1),W=D(!1),G=D(!1),$e=A(()=>K.value||!!O.value||V.value||W.value||G.value),se=A(()=>$e.value),re=D(["[--:--:--] DB orchestration console ready."]),de=D([]),ae=(e,s,r=250)=>{e.push(s),e.length>r&&e.splice(0,e.length-r)},y=e=>{const s=new Date().toTimeString().slice(0,8);ae(re.value,`[${s}] ${e}`)},Ce=e=>{const s=new Date().toTimeString().slice(0,8);ae(de.value,`[${s}] ${e}`)},ue=e=>{if(!e)return[];if(typeof e=="string")return e.split(/\r?\n/).filter(s=>s.trim().length>0);if(Array.isArray(e))return e.map(s=>typeof s=="string"?s:JSON.stringify(s)).filter(s=>s&&s.trim().length>0);if(typeof e=="object"){const s=e,r=s.log??s.logs??s.output??s.stdout??s.detail??s.message;return ue(r)}return[String(e)]},J=e=>{const s=ue(e);s.length&&s.forEach(r=>{r.trim().startsWith("[")?ae(re.value,r.trim()):y(r.trim())})},Ae=e=>{if(!e)return["Unknown error"];if(typeof e=="string")return e.split(/\r?\n/);const s=e,r=s.data??s.response??s;if(typeof r=="string")return r.split(/\r?\n/);if(r&&typeof r=="object"){const c=r.detail??r.error??r.traceback??r;if(typeof c=="string")return c.split(/\r?\n/);try{return[JSON.stringify(c,null,2)]}catch{return["Unknown error"]}}return s.message&&typeof s.message=="string"?s.message.split(/\r?\n/):[String(e)]},z=e=>{Ae(e).forEach(r=>Ce(r))};oe(g,e=>{e&&z(e)}),oe(h,e=>{e&&z(e)});const Be=async()=>{const e=await x.ensureAccessToken();return e?{Authorization:`Bearer ${e}`}:{}},Re=(e,s)=>{if(!s)return e;if(s instanceof Headers){const r={...e};return s.forEach((c,U)=>{r[U]=c}),r}return Array.isArray(s)?s.reduce((r,[c,U])=>(r[c]=U,r),{...e}):{...e,...s}},Q=async(e,s={})=>{const r=await Be(),c=Re(r,s.headers);return await $fetch(e,{...s,baseURL:Y(e),headers:c})},Te=(e,s)=>{const r=URL.createObjectURL(e),c=document.createElement("a");c.href=r,c.download=s,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(r)},Le=async()=>{if(!K.value){K.value=!0,y("Snapshot creation requested.");try{const e=await Q("/api/v1/admin/database/snapshots",{method:"POST"});J(e),y("Snapshot creation finished."),await R()}catch(e){y("Snapshot creation failed."),z(e)}finally{K.value=!1}}},Oe=async e=>{if(!O.value){O.value=e,y(`Restore requested for ${e}.`);try{const s=encodeURIComponent(e),r=await Q(`/api/v1/admin/database/snapshots/${s}/restore`,{method:"POST"});J(r),y(`Restore completed for ${e}.`),await R(),await F()}catch(s){y(`Restore failed for ${e}.`),z(s)}finally{O.value=null}}},ze=async()=>{if(!V.value){V.value=!0,y("SQL dump download requested.");try{const e=await Q("/api/v1/admin/database/dump/download",{method:"GET",responseType:"blob"}),s=new Date().toISOString().slice(0,19).replace(/[:T]/g,"-");Te(e,`database_dump_${s}.sql`),y("Dump download ready.")}catch(e){y("Dump download failed."),z(e)}finally{V.value=!1}}},Ue=async e=>{if(W.value)return;W.value=!0;const s=Math.max(1,Math.round(e.size/1024));y(`Upload started: ${e.name} (${s} KB).`);try{const r=new FormData;r.append("file",e);const c=await Q("/api/v1/admin/database/dump/upload",{method:"POST",body:r});J(c),y(`Restore queued: ${e.name}.`),await F()}catch(r){y(`Restore failed for ${e.name}.`),z(r)}finally{W.value=!1}},Ee=async()=>{if(!G.value){G.value=!0,y("Alembic upgrade head started...");try{const e=await Q("/api/v1/admin/database/migrations/upgrade",{method:"POST"});J(e),y("Alembic upgrade finished."),await _(),await F()}catch(e){y("Alembic upgrade failed."),z(e)}finally{G.value=!1}}};return(e,s)=>(f(),C(j,null,[t(l)?t(w)?(f(),C("div",ct,[s[0]||(s[0]=o("section",{class:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm"},[o("p",{class:"text-xs uppercase tracking-[0.3em] text-slate-500"},"Database Operations"),o("h2",{class:"mt-2 text-xl font-semibold text-slate-900"},"DB Management"),o("p",{class:"mt-2 text-sm text-slate-600"}," Create snapshots, restore database dumps, run Alembic migrations, and track operation logs. ")],-1)),o("div",ft,[n(dt,{snapshots:t(ke),"creating-snapshot":t(K),"restoring-snapshot-id":t(O),loading:t(i),"disable-actions":t(se),onCreateSnapshot:Le,onRestoreSnapshot:Oe},null,8,["snapshots","creating-snapshot","restoring-snapshot-id","loading","disable-actions"]),n(Me,{"downloading-dump":t(V),"uploading-dump":t(W),"disable-actions":t(se),onDownloadDb:ze,onRestoreFile:Ue},null,8,["downloading-dump","uploading-dump","disable-actions"])]),n(Je,{"current-revision":t(Se),"upgrading-head":t(G),"disable-actions":t(se),loading:t(M),onUpgradeHead:Ee},null,8,["current-revision","upgrading-head","disable-actions","loading"]),o("div",mt,[n(Ze,{logs:t(re)},null,8,["logs"]),n(We,{errors:t(de)},null,8,["errors"])]),n(st,{logs:t(De),loading:t(p),"has-error":!!t(h),onRefresh:t(F)},null,8,["logs","loading","has-error","onRefresh"])])):(f(),C("div",pt," Access denied. This page is available for super admin only. ")):(f(),C("div",ut," Checking access... ")),t(O)?(f(),C("div",gt,[o("div",bt,[s[1]||(s[1]=o("p",{class:"text-xs uppercase tracking-[0.3em] text-slate-400"},"Restoring",-1)),s[2]||(s[2]=o("p",{class:"mt-2 text-lg font-semibold"},"Database restore in progress...",-1)),o("p",xt,"Snapshot: "+v(t(O)),1)])])):ee("",!0)],64))}});export{qt as default};
