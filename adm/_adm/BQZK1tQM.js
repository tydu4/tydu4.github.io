import{f as he,N as X,k as Ve,G as m,H as n,K as f,L as h,O as a,W as K,J as y,P as ne,Q as le,S as w,v as g,F as d,M as k,U as me,V as fe,y as M,Y,R as ye,T as j,c as Pe,X as ge,$ as Re}from"./Bdjb0SXm.js";import S from"./B4TyZ_bU.js";import W from"./cRrWWQur.js";import ve from"./Da0WQd-O.js";import oe from"./BEYAt5ls.js";import"./DS_fG_uV.js";import"./DeHUBOuf.js";import"./MI7OGpUw.js";import"./BKfwxZk3.js";import"./C60XlcZO.js";import"./CKmkznge.js";import"./B0YsM2uZ.js";import Me from"./Bh3fyw7B.js";import"./BsWIP-yW.js";import"./BNLw-KlI.js";import"./B4yhBorQ.js";import"./BcuCH1ZM.js";import"./Bkl1Gi2Q.js";import"./B3ikXpdR.js";import{c as J}from"./t7OZfVNK.js";import{u as Fe}from"./DI7PMaLP.js";import"./CkYB-R1u.js";import"./c5FhCeC0.js";import"./CL3jLyeF.js";const Ne=J("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);const Ie=J("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const Ue=J("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);const Le=J("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);const $e=J("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),ze={class:"space-y-6"},je={class:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm"},Be={class:"flex flex-wrap items-start justify-between gap-4"},Ge={class:"flex flex-wrap items-center gap-2"},Ke={class:"mt-4 max-w-lg"},He={key:0,class:"mt-4 rounded-xl border border-slate-200 bg-slate-50 px-4 py-3"},Je={class:"text-sm font-medium text-slate-700"},qe={key:0,class:"mt-2 space-y-1 text-xs text-red-600"},Ye={key:0,class:"rounded-2xl border border-amber-200/70 bg-amber-50/80 p-5 shadow-sm"},We={class:"flex flex-wrap items-center justify-between gap-4"},Xe={class:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"},Qe={class:"flex flex-wrap gap-2"},Ze=["onClick"],et={class:"mt-4 rounded-xl border border-slate-200 bg-slate-50/50 p-4"},tt={class:"flex flex-wrap items-start justify-between gap-3"},st={class:"text-lg font-semibold text-slate-900"},at={class:"text-xs text-slate-500"},nt={class:"text-xs text-slate-500"},lt={key:0,class:"py-10 text-center text-sm text-slate-500"},ot={key:1,class:"mt-4 rounded-xl border border-dashed border-slate-200 bg-white px-4 py-8 text-center text-sm text-slate-500"},it={key:0},rt={key:1},dt={key:2,class:"mt-4 grid gap-4 lg:grid-cols-2"},ut={class:"flex flex-wrap items-start justify-between gap-3"},ct={class:"min-w-0"},pt={class:"truncate text-sm font-semibold text-slate-900"},mt={class:"mt-1 text-xs text-slate-500"},ft={class:"flex flex-wrap items-center gap-1"},yt={class:"mt-3"},gt=["onUpdate:modelValue","onChange"],vt={key:0,class:"mt-2 text-xs text-slate-500"},ht={class:"mt-4 flex flex-wrap items-center justify-between gap-2"},xt={class:"flex flex-wrap items-center gap-2"},kt={key:2,class:"text-xs text-slate-400"},bt={class:"space-y-4"},_t={class:"flex items-start justify-between gap-4"},St={class:"grid gap-3"},Ct={class:"flex items-center justify-end gap-2"},Tt={key:1,class:"fixed bottom-6 right-6 z-50 rounded-xl bg-slate-900 px-4 py-3 text-sm text-white shadow-2xl"},Et={key:2,class:"rounded-2xl border border-red-200 bg-red-50 p-4 text-sm text-red-700"},wt=he({__name:"SettingsManagerBlock",props:{settings:{},pending:{type:Boolean},hasError:{type:Boolean},isAdmin:{type:Boolean},seeding:{type:Boolean},onRefresh:{type:Function},onSaveSetting:{type:Function},onDeleteSetting:{type:Function},onCreateSetting:{type:Function},onExportSettings:{type:Function},onImportSettings:{type:Function},onSeedDatabase:{type:Function}},setup(re){const v=re,D=[{id:"payments",label:"Payments",hint:"PAYMENT_, CRYPTOBOT, MOCK_TOPUP",tokens:["PAYMENT_","CRYPTOBOT","MOCK_TOPUP"]},{id:"security",label:"Security",hint:"JWT_, SECRET, TOKEN, ADMIN_",tokens:["JWT_","SECRET","TOKEN","ADMIN_"]},{id:"storage",label:"Storage",hint:"S3_, GCP_, LOCAL_STORAGE",tokens:["S3_","GCP_","LOCAL_STORAGE"]},{id:"game",label:"Game",hint:"XP_, LEVEL_, TICKET",tokens:["XP_","LEVEL_","TICKET"]},{id:"general",label:"General",hint:"DOMAIN, MAINTENANCE, APP_MODE and all unmatched keys",tokens:[]}],u=g([]),p=Y({}),x=Y({}),b=Y({}),T=Y({}),B=g("");let A=null;const F=g(""),E=g("payments"),O=g(!1),V=g(!1),G=g(!1),P=g(""),N=g(""),I=g("string"),U=g(""),L=g(!1),$=g(!1),C=g(""),R=g([]),q=g(null),H=s=>{if(!s)return s;let e=s;const t=s.trim();if(t.startsWith('"')&&t.endsWith('"'))try{const r=JSON.parse(t);typeof r=="string"&&(e=r)}catch{}return e.includes("\\u")&&(e=e.replace(/\\u([0-9a-fA-F]{4})/g,(r,z)=>String.fromCharCode(parseInt(z,16)))),e},l=s=>({...s,value:H(String(s.value??"")),description:s.description==null?null:H(s.description)}),i=()=>{const s=new Set(u.value.map(e=>e.key));Object.keys(p).forEach(e=>{s.has(e)||(delete p[e],delete x[e],delete b[e],delete T[e])}),u.value.forEach(e=>{p[e.key]=e.value??"",x[e.key]=!1})};X(()=>v.settings,s=>{u.value=s?s.map(e=>l(e)).sort((e,t)=>e.key.localeCompare(t.key)):[],i()},{immediate:!0,deep:!0});const o=s=>{B.value=s,A&&clearTimeout(A),A=setTimeout(()=>{B.value="",A=null},2500)};Ve(()=>{A&&clearTimeout(A)});const c=s=>{const e=s.toUpperCase();return D[0].tokens.some(t=>e.includes(t))?"payments":D[1].tokens.some(t=>e.includes(t))?"security":D[2].tokens.some(t=>e.includes(t))?"storage":D[3].tokens.some(t=>e.includes(t))?"game":"general"},_=M(()=>F.value.trim().toLowerCase()),Q=M(()=>_.value?u.value.filter(s=>{const e=s.key.toLowerCase(),t=String(p[s.key]??s.value??"").toLowerCase();return e.includes(_.value)||t.includes(_.value)}):u.value),Z=M(()=>{const s={payments:[],security:[],storage:[],game:[],general:[]};return Q.value.forEach(e=>{const t=c(e.key);s[t].push(e)}),Object.keys(s).forEach(e=>{s[e].sort((t,r)=>t.key.localeCompare(r.key))}),s}),ee=M(()=>D.map(s=>({...s,count:Z.value[s.id].length}))),de=M(()=>ee.value.find(s=>s.id===E.value)??ee.value[0]),te=M(()=>Z.value[E.value]??[]);X(Z,s=>{if(s[E.value]?.length)return;const e=D.find(t=>s[t.id].length>0);e&&(E.value=e.id)},{deep:!0});const xe=s=>{if(s==null)return null;const e=H(s).trim();if(!e)return null;const t=e.replace(/\s+/g,"");if(/^[?\uFFFD]+$/.test(t))return null;const r=/[A-Za-z0-9\u0400-\u04FF]/.test(e),z=(t.match(/[?\uFFFD]/g)??[]).length;return!r&&z>0?null:e},ue=M(()=>{const s={};return u.value.forEach(e=>{s[e.key]=xe(e.description)}),s}),se=s=>{const e=u.value.find(t=>t.key===s)?.value??"";x[s]=(p[s]??"")!==e},ke=s=>{const e=u.value.find(t=>t.key===s)?.value??"";p[s]=e,x[s]=!1},ce=s=>{const e=u.value.findIndex(r=>r.key===s.key);if(e===-1){u.value=[s,...u.value].sort((r,z)=>r.key.localeCompare(z.key));return}const t=[...u.value];t[e]=s,u.value=t.sort((r,z)=>r.key.localeCompare(z.key))},be=s=>{u.value=u.value.filter(e=>e.key!==s),delete p[s],delete x[s],delete b[s],delete T[s]},_e=async()=>{if(!O.value){O.value=!0;try{await v.onRefresh(),o("Settings refreshed")}catch{o("Failed to refresh settings")}finally{O.value=!1}}},Se=async s=>{if(!(!x[s.key]||b[s.key])){b[s.key]=!0;try{const e=await v.onSaveSetting({key:s.key,value:p[s.key]??"",description:s.description??null,is_public:s.is_public??!1}),t=l(e);ce(t),p[s.key]=t.value??"",x[s.key]=!1,o(`Saved ${s.key}`)}catch{o(`Failed to save ${s.key}`)}finally{b[s.key]=!1}}},Ce=async s=>{if(!T[s.key]&&window.confirm(`Delete setting ${s.key}?`)){T[s.key]=!0;try{await v.onDeleteSetting(s.key),be(s.key),o(`Deleted ${s.key}`)}catch{o(`Failed to delete ${s.key}`)}finally{T[s.key]=!1}}},Te=()=>{V.value=!0},ae=()=>{V.value=!1,P.value="",N.value="",I.value="string",U.value=""},Ee=async()=>{const s=P.value.trim().toUpperCase();if(s){G.value=!0;try{const e=await v.onCreateSetting({key:s,value:N.value,value_type:I.value,description:U.value.trim()||null,is_public:!1}),t=l(e);ce(t),p[t.key]=t.value??"",x[t.key]=!1,o(`Created ${t.key}`),ae()}catch{o("Failed to create setting")}finally{G.value=!1}}},we=async()=>{if(!L.value){L.value=!0,C.value="",R.value=[];try{const s=await v.onExportSettings();o(s||"Settings exported")}catch(s){o(`Export failed: ${pe(s)}`)}finally{L.value=!1}}},De=()=>{q.value?.click()},pe=s=>{const e=s?.data?.detail;if(typeof e=="string"&&e)return e;const t=s?.message;return typeof t=="string"&&t?t:"request failed"},Ae=async s=>{const e=s.target,t=e.files?.[0];if(t){if($.value){e.value="";return}$.value=!0,C.value="",R.value=[];try{const r=await v.onImportSettings(t);C.value=r||`Imported ${t.name}`,R.value=[],o(C.value||"Import completed")}catch(r){C.value=`Import failed: ${pe(r)}`,R.value=[],o(C.value||"Import failed")}finally{$.value=!1,e.value=""}}},Oe=async()=>{try{await v.onSeedDatabase(),o("Database seeded")}catch{o("Failed to seed database")}};return(s,e)=>(d(),m("div",ze,[n("section",je,[n("div",Be,[e[7]||(e[7]=n("div",null,[n("p",{class:"text-xs uppercase tracking-[0.3em] text-slate-500"},"System Config"),n("h2",{class:"text-lg font-semibold"},"System settings"),n("p",{class:"text-sm text-slate-500"},"Find, edit and backup key-value configuration safely.")],-1)),n("div",Ge,[f(a(S),{variant:"outline",size:"sm",disabled:a(O),onClick:_e},{default:h(()=>[k(y(a(O)?"Refreshing...":"Refresh"),1)]),_:1},8,["disabled"]),f(a(S),{variant:"outline",size:"sm",class:"gap-2",disabled:a(L),onClick:we},{default:h(()=>[f(a(Ne),{class:"h-4 w-4"}),k(" "+y(a(L)?"Экспорт...":"Экспорт конфигурации (JSON)"),1)]),_:1},8,["disabled"]),f(a(S),{variant:"outline",size:"sm",class:"gap-2",disabled:a($),onClick:De},{default:h(()=>[f(a($e),{class:"h-4 w-4"}),k(" "+y(a($)?"Импорт...":"Импорт конфигурации"),1)]),_:1},8,["disabled"]),n("input",{ref_key:"importInputRef",ref:q,type:"file",accept:".json,application/json",class:"hidden",onChange:Ae},null,544),f(a(S),{size:"sm",class:"gap-2",onClick:Te},{default:h(()=>[f(a(Ie),{class:"h-4 w-4"}),e[6]||(e[6]=k(" Add Config ",-1))]),_:1})])]),n("div",Ke,[e[8]||(e[8]=n("label",{class:"text-xs uppercase tracking-[0.2em] text-slate-500"},"Search",-1)),f(a(W),{modelValue:a(F),"onUpdate:modelValue":e[0]||(e[0]=t=>K(F)?F.value=t:null),type:"search",placeholder:"Search by key or value",class:"mt-2"},null,8,["modelValue"])]),a(C)?(d(),m("div",He,[n("p",Je,y(a(C)),1),a(R).length?(d(),m("ul",qe,[(d(!0),m(ne,null,le(a(R),t=>(d(),m("li",{key:t},y(t),1))),128))])):w("",!0)])):w("",!0)]),v.isAdmin?(d(),m("section",Ye,[n("div",We,[e[9]||(e[9]=n("div",null,[n("p",{class:"text-xs uppercase tracking-[0.3em] text-amber-700"},"Developer Tools"),n("h2",{class:"text-lg font-semibold text-amber-900"},"Developer Tools"),n("p",{class:"text-sm text-amber-800/80"},"Danger zone: fill the database with fake data.")],-1)),f(a(S),{variant:"destructive",size:"sm",disabled:v.seeding,onClick:Oe},{default:h(()=>[k(y(v.seeding?"Seeding...":"Fill Database with Fake Data"),1)]),_:1},8,["disabled"])])])):w("",!0),n("section",Xe,[n("div",Qe,[(d(!0),m(ne,null,le(a(ee),t=>(d(),m("button",{key:t.id,type:"button",class:ye(["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.15em] transition",a(E)===t.id?"border-slate-900 bg-slate-900 text-white":"border-slate-200 bg-white text-slate-600 hover:border-slate-300 hover:text-slate-900"]),onClick:r=>E.value=t.id},[n("span",null,y(t.label),1),n("span",{class:ye(["inline-flex min-w-[22px] items-center justify-center rounded-full px-1.5 py-0.5 text-[10px]",a(E)===t.id?"bg-white/20 text-white":"bg-slate-100 text-slate-600"])},y(t.count),3)],10,Ze))),128))]),n("div",et,[n("div",tt,[n("div",null,[e[10]||(e[10]=n("p",{class:"text-xs uppercase tracking-[0.2em] text-slate-500"},"Category",-1)),n("h3",st,y(a(de).label),1),n("p",at,"Match rules: "+y(a(de).hint),1)]),n("p",nt,y(a(te).length)+" settings",1)]),v.pending&&a(u).length===0?(d(),m("div",lt," Loading settings... ")):a(te).length===0?(d(),m("div",ot,[a(F)?(d(),m("span",it,"No settings found for the current search.")):(d(),m("span",rt,"No settings in this category."))])):(d(),m("div",dt,[(d(!0),m(ne,null,le(a(te),t=>(d(),m("article",{key:t.key,class:"rounded-xl border border-slate-200 bg-white p-4 shadow-sm"},[n("div",ut,[n("div",ct,[n("p",pt,y(t.key),1),n("p",mt,"Type: "+y(t.value_type),1)]),n("div",ft,[f(a(oe),{variant:"outline"},{default:h(()=>[k(y(t.value_type),1)]),_:2},1024),t.is_public?(d(),j(a(oe),{key:0,variant:"success"},{default:h(()=>[...e[11]||(e[11]=[k("Public",-1)])]),_:1})):w("",!0),t.is_encrypted?(d(),j(a(oe),{key:1,variant:"warning"},{default:h(()=>[...e[12]||(e[12]=[k("Encrypted",-1)])]),_:1})):w("",!0)])]),n("div",yt,[t.value_type==="json"?(d(),j(a(ve),{key:0,"model-value":a(p)[t.key],class:"min-h-[92px] text-xs font-mono","onUpdate:modelValue":r=>{a(p)[t.key]=r,se(t.key)}},null,8,["model-value","onUpdate:modelValue"])):t.value_type==="boolean"?me((d(),m("select",{key:1,"onUpdate:modelValue":r=>a(p)[t.key]=r,class:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm",onChange:r=>se(t.key)},[...e[13]||(e[13]=[n("option",{value:"true"},"true",-1),n("option",{value:"false"},"false",-1)])],40,gt)),[[fe,a(p)[t.key]]]):(d(),j(a(W),{key:2,"model-value":a(p)[t.key],class:"h-10 text-sm","onUpdate:modelValue":r=>{a(p)[t.key]=r,se(t.key)}},null,8,["model-value","onUpdate:modelValue"]))]),a(ue)[t.key]?(d(),m("p",vt,y(a(ue)[t.key]),1)):w("",!0),n("div",ht,[n("div",xt,[a(x)[t.key]?(d(),j(a(S),{key:0,variant:"outline",size:"sm",class:"gap-2",disabled:a(b)[t.key],onClick:r=>Se(t)},{default:h(()=>[f(a(Ue),{class:"h-4 w-4"}),k(" "+y(a(b)[t.key]?"Saving...":"Save"),1)]),_:2},1032,["disabled","onClick"])):w("",!0),a(x)[t.key]?(d(),j(a(S),{key:1,variant:"ghost",size:"sm",onClick:r=>ke(t.key)},{default:h(()=>[...e[14]||(e[14]=[k(" Reset ",-1)])]),_:1},8,["onClick"])):(d(),m("span",kt,"No changes"))]),f(a(S),{variant:"outline",size:"sm",class:"gap-2 text-red-600",disabled:a(T)[t.key],onClick:r=>Ce(t)},{default:h(()=>[f(a(Le),{class:"h-4 w-4"}),k(" "+y(a(T)[t.key]?"Deleting...":"Delete"),1)]),_:2},1032,["disabled","onClick"])])]))),128))]))])]),f(a(Me),{modelValue:a(V),"onUpdate:modelValue":e[5]||(e[5]=t=>K(V)?V.value=t:null)},{default:h(()=>[n("div",bt,[n("div",_t,[e[16]||(e[16]=n("div",null,[n("h3",{class:"text-lg font-semibold text-foreground"},"Add Config"),n("p",{class:"text-sm text-muted-foreground"},"Create a new system setting.")],-1)),f(a(S),{variant:"ghost",size:"sm",onClick:ae},{default:h(()=>[...e[15]||(e[15]=[k("Close",-1)])]),_:1})]),n("div",St,[n("div",null,[e[17]||(e[17]=n("label",{class:"text-xs uppercase tracking-[0.2em] text-muted-foreground"},"Key",-1)),f(a(W),{modelValue:a(P),"onUpdate:modelValue":e[1]||(e[1]=t=>K(P)?P.value=t:null),placeholder:"AI_GENERATION_ENABLED"},null,8,["modelValue"])]),n("div",null,[e[18]||(e[18]=n("label",{class:"text-xs uppercase tracking-[0.2em] text-muted-foreground"},"Value",-1)),f(a(W),{modelValue:a(N),"onUpdate:modelValue":e[2]||(e[2]=t=>K(N)?N.value=t:null),placeholder:"true"},null,8,["modelValue"])]),n("div",null,[e[20]||(e[20]=n("label",{class:"text-xs uppercase tracking-[0.2em] text-muted-foreground"},"Type",-1)),me(n("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>K(I)?I.value=t:null),class:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm"},[...e[19]||(e[19]=[n("option",{value:"string"},"String",-1),n("option",{value:"json"},"JSON",-1),n("option",{value:"boolean"},"Boolean",-1)])],512),[[fe,a(I)]])]),n("div",null,[e[21]||(e[21]=n("label",{class:"text-xs uppercase tracking-[0.2em] text-muted-foreground"},"Description",-1)),f(a(ve),{modelValue:a(U),"onUpdate:modelValue":e[4]||(e[4]=t=>K(U)?U.value=t:null),placeholder:"Short description"},null,8,["modelValue"])])]),n("div",Ct,[f(a(S),{variant:"outline",onClick:ae},{default:h(()=>[...e[22]||(e[22]=[k("Cancel",-1)])]),_:1}),f(a(S),{disabled:a(G),onClick:Ee},{default:h(()=>[k(y(a(G)?"Creating...":"Create"),1)]),_:1},8,["disabled"])])])]),_:1},8,["modelValue"]),a(B)?(d(),m("div",Tt,y(a(B)),1)):w("",!0),v.hasError?(d(),m("div",Et," Failed to load settings. ")):w("",!0)]))}}),ie="/api/v1/admin/settings",Dt="/api/v1/admin/settings/export",At="/api/v1/admin/settings/import",Ot="/api/v1/debug/seed",ts=he({__name:"index",setup(re){const v=Pe(),D=M(()=>v.user?.role==="admin"),u=g([]),p=g(!1),x=async l=>{const i=new Headers(l??{}),o=await v.ensureAccessToken();return o&&i.set("Authorization",`Bearer ${o}`),i},b=async(l,i={})=>{const o=await x(i.headers);return await $fetch(l,{baseURL:ge(l),...i,headers:o})},{data:T,pending:B,error:A,refresh:F,execute:E}=Fe(ie,{server:!1,immediate:!1,baseURL:ge(ie),onRequest:async({options:l})=>{l.headers=await x(l.headers)}},"$ayBzSOJfuO");X(()=>v.user?.role,async l=>{l==="admin"&&await E()},{immediate:!0}),X(T,l=>{u.value=Array.isArray(l)?[...l]:[]},{immediate:!0});const O=async()=>{await F()},V=l=>{const i=u.value.findIndex(c=>c.key===l.key);if(i===-1){u.value=[l,...u.value];return}const o=[...u.value];o[i]=l,u.value=o},G=l=>{u.value=u.value.filter(i=>i.key!==l)},P=l=>`/api/v1/admin/settings/${encodeURIComponent(l)}`,N=async l=>{const i=P(l.key),o={value:String(l.value??""),description:l.description??null,is_public:l.is_public??!1},c=await b(i,{method:"PUT",body:o});return V(c),c},I=async l=>{const i=P(l);await b(i,{method:"DELETE"}),G(l)},U=async l=>{const i=await b(ie,{method:"POST",body:l});return V(i),i},L=(l,i)=>{const o=URL.createObjectURL(l),c=document.createElement("a");c.href=o,c.download=i,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(o)},$=l=>{const i=l?.data;if(typeof i?.detail=="string"&&i.detail)return i.detail;if(i?.detail&&typeof i.detail=="object")try{return JSON.stringify(i.detail)}catch{return"Request failed"}const o=l?.message;return typeof o=="string"&&o?o:"Request failed"},C=l=>new Promise((i,o)=>{const c=new FileReader;c.onload=()=>{if(typeof c.result=="string"){i(c.result);return}o(new Error("Failed to read selected file"))},c.onerror=()=>{o(new Error("Failed to read selected file"))},c.readAsText(l,"utf-8")}),R=async()=>{const l=await x(),i=await fetch(Re(Dt),{method:"GET",headers:l});if(!i.ok){const c=await i.text();throw new Error(c||`Export failed (${i.status})`)}const o=await i.blob();return L(o,"config_export.json"),"Конфигурация экспортирована (config_export.json)"},q=async l=>{const i=await C(l);let o;try{o=JSON.parse(i)}catch{throw new Error("Invalid JSON file")}if(!Array.isArray(o))throw new Error("JSON must be an array of settings");const c=o;if(!c.length)throw new Error("No settings provided for import");const _=await b(At,{method:"POST",body:c});await O();const Q=typeof _?.imported=="number"?_.imported:typeof _?.updated=="number"?_.updated:typeof _?.total=="number"?_.total:c.length;return _?.message||`Импортировано настроек: ${Q}`},H=async()=>{if(!p.value){p.value=!0;try{await b(Ot,{method:"POST"})}catch(l){throw new Error($(l))}finally{p.value=!1}}};return(l,i)=>(d(),j(wt,{settings:a(u),pending:a(B),"has-error":!!a(A),"is-admin":a(D),seeding:a(p),"on-refresh":O,"on-save-setting":N,"on-delete-setting":I,"on-create-setting":U,"on-export-settings":R,"on-import-settings":q,"on-seed-database":H},null,8,["settings","pending","has-error","is-admin","seeding"]))}});export{ts as default};
