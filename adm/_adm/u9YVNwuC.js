import{f as ue,c as ce,N as fe,F as r,G as i,O as a,H as l,K as u,L as n,M as f,J as x,P as R,Q as S,R as me,S as P,T as v,U as pe,V as be,W as xe,v as p,y as z,X as D,Y as X}from"./DS7VCCSK.js";import h from"./Cjqy7nvW.js";import Q from"./Deu-aWO1.js";import ve from"./CdVBsagh.js";import"./BpcaaFkG.js";import"./DTeGA_vW.js";import ye from"./D7xuzdeO.js";import he from"./BhfHb__k.js";import ge from"./E0wZJRpp.js";import j from"./BxcSwu-R.js";import W from"./DU6-7vYD.js";import E from"./DmH-Mve6.js";import _e from"./Bmm7Yk8C.js";import"./DF8zk2qc.js";import"./CeJFYvzK.js";import"./CfKVNkxc.js";import"./CFbK2b2T.js";import"./BBd-v6Ar.js";import"./DsmWHQFD.js";import"./CkYB-R1u.js";import"./c5FhCeC0.js";const we={key:0,class:"rounded-2xl border border-slate-200 bg-white p-4 text-sm text-slate-500"},ke={key:1,class:"rounded-2xl border border-red-200 bg-red-50 p-4 text-sm text-red-700"},Ce={key:2,class:"grid h-[calc(100vh-11rem)] min-h-[32rem] gap-6 lg:grid-cols-[240px_1fr]"},Ve={class:"flex h-full min-h-0 flex-col rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"},Re={class:"flex items-center justify-between gap-2"},Te={class:"mt-4 flex min-h-0 flex-1 flex-col space-y-1"},Se={key:0,class:"rounded-lg border border-dashed border-slate-200 px-3 py-3 text-xs text-slate-400"},je={key:1,class:"rounded-lg border border-red-200 bg-red-50 px-3 py-3 text-xs text-red-600"},Ee={key:2,class:"rounded-lg border border-dashed border-slate-200 px-3 py-3 text-xs text-slate-400"},Ue={key:3,class:"min-h-0 flex-1 space-y-1 overflow-auto pr-1"},Ae=["onClick"],$e={class:"truncate"},Ne={key:0,class:"text-xs text-white/60"},Le={class:"flex h-full min-h-0 flex-col overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm"},Oe={class:"flex flex-wrap items-center justify-between gap-3 border-b border-slate-200 px-4 py-3"},Pe={class:"text-lg font-semibold"},ze={class:"flex items-center gap-2"},De={class:"min-h-0 flex-1 overflow-auto"},Fe={class:"flex items-center justify-end gap-2"},Be={key:0,class:"border-t border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700"},Ie={class:"space-y-4"},He={class:"flex items-start justify-between gap-4"},Je={class:"text-sm text-muted-foreground"},Ke={class:"max-h-[60vh] space-y-3 overflow-auto pr-1"},Me={class:"text-xs uppercase tracking-[0.2em] text-muted-foreground"},qe=["onUpdate:modelValue"],Ge={class:"flex items-center justify-end gap-2"},Xe={key:3,class:"fixed bottom-6 right-6 z-50 rounded-xl bg-slate-900 px-4 py-3 text-sm text-white shadow-2xl"},Y=120,yt=ue({__name:"index",setup(Qe){const y=ce(),g=p([]),c=p(null),_=p([]),U=p(!1),F=p(!1),A=p(""),$=p(""),N=p(""),w=s=>{N.value=s,setTimeout(()=>{N.value=""},2500)},H=z(()=>y.user?.role==="admin"),Z=z(()=>!!y.user),ee=s=>{if(Array.isArray(s))return s.map(e=>String(e));if(s&&typeof s=="object"){const e=s,t=e.tables??e.items??e.data;if(Array.isArray(t))return t.map(o=>String(o))}return[]},te=s=>{if(Array.isArray(s))return s.filter(e=>e&&typeof e=="object");if(s&&typeof s=="object"){const e=s,t=e.items??e.rows??e.data??e.results;if(Array.isArray(t))return t.filter(o=>o&&typeof o=="object")}return[]},J=async()=>{U.value=!0,A.value="";try{const s=await y.apiFetch("/api/v1/admin/database/tables",{baseURL:D("/api/v1/admin/database/tables")});g.value=ee(s),!c.value&&g.value.length&&await K(g.value[0])}catch{A.value="Failed to load tables."}finally{U.value=!1}},L=async()=>{if(!c.value)return;const s=encodeURIComponent(c.value);F.value=!0,$.value="";try{const e=await y.apiFetch(`/api/v1/admin/database/${s}`,{baseURL:D(`/api/v1/admin/database/${s}`),query:{limit:50}});_.value=te(e)}catch{$.value="Failed to load table rows.",_.value=[]}finally{F.value=!1}},K=async s=>{c.value!==s&&(_.value=[]),c.value=s,await L()};fe(()=>y.user,s=>{s&&H.value&&(U.value||g.value.length>0||J())},{immediate:!0});const k=z(()=>{const s=new Set;_.value.forEach(d=>{Object.keys(d).forEach(de=>s.add(de))});const e=["id","uuid","pk","created_at","updated_at"],t=e.filter(d=>s.has(d)),o=Array.from(s).filter(d=>!e.includes(d)).sort();return[...t,...o]}),M=s=>{if(s==null)return"";if(typeof s=="object")try{return JSON.stringify(s)}catch{return"Object"}return String(s)},se=s=>{if(s==null)return"-";const e=M(s);return e?e.length>Y?`${e.slice(0,Y)}...`:e:"-"},C=s=>{const e=["id","uuid","pk"];for(const t of e)if(s[t]!==null&&s[t]!==void 0)return s[t];return null},ae=(s,e)=>C(s)??e,B=p(null),oe=async s=>{if(!c.value)return;const e=encodeURIComponent(c.value),t=C(s);if(t==null){w("Primary key not found for this row.");return}const o=encodeURIComponent(String(t));if(window.confirm(`Delete row ${t} from ${c.value}?`)){B.value=String(t);try{await y.apiFetch(`/api/v1/admin/database/${e}/${o}`,{method:"DELETE",baseURL:D(`/api/v1/admin/database/${e}/${o}`)}),w("Row deleted."),await L()}catch{w("Failed to delete row.")}finally{B.value=null}}},T=p(!1),O=p(!1),V=p(null),m=X({}),b=X({}),q=()=>{Object.keys(m).forEach(s=>delete m[s]),Object.keys(b).forEach(s=>delete b[s])},re=s=>{if(s==null)return"";if(typeof s=="object")try{return JSON.stringify(s,null,2)}catch{return"Object"}return String(s)},le=s=>{V.value=s,q(),Object.entries(s).forEach(([e,t])=>{m[e]=re(t),t===null?b[e]="null":Array.isArray(t)?b[e]="array":b[e]=typeof t}),T.value=!0},I=()=>{T.value=!1,V.value=null,q()},ne=(s,e)=>{const t=b[s];if(t==="number"){const o=Number(e);return Number.isNaN(o)?e:o}if(t==="boolean")return e==="true"||e==="1";if(t==="array"||t==="object"||t==="null"){if(!e.trim())return null;try{return JSON.parse(e)}catch{return e}}return e},G=z(()=>{if(!V.value)return[];const s=Object.keys(V.value),e=k.value.filter(o=>s.includes(o)),t=s.filter(o=>!e.includes(o));return[...e,...t]}),ie=async()=>{if(!c.value||!V.value)return;const s=encodeURIComponent(c.value),e=C(V.value);if(e==null){w("Primary key not found for this row.");return}const t=encodeURIComponent(String(e));O.value=!0;const o={};G.value.forEach(d=>{o[d]=ne(d,m[d])});try{await y.apiFetch(`/api/v1/admin/database/${s}/${t}`,{method:"PUT",baseURL:D(`/api/v1/admin/database/${s}/${t}`),body:o}),w("Row updated."),I(),await L()}catch{w("Failed to update row.")}finally{O.value=!1}};return(s,e)=>(r(),i(R,null,[a(Z)?a(H)?(r(),i("div",Ce,[l("aside",Ve,[l("div",Re,[e[2]||(e[2]=l("div",null,[l("p",{class:"text-xs uppercase tracking-[0.3em] text-slate-400"},"Tables"),l("h2",{class:"text-lg font-semibold"},"Database")],-1)),u(a(h),{variant:"outline",size:"sm",onClick:J},{default:n(()=>[...e[1]||(e[1]=[f("Refresh",-1)])]),_:1})]),l("div",Te,[a(U)?(r(),i("div",Se," Loading tables... ")):a(A)?(r(),i("div",je,x(a(A)),1)):a(g).length===0?(r(),i("div",Ee," No tables found. ")):(r(),i("div",Ue,[(r(!0),i(R,null,S(a(g),t=>(r(),i("button",{key:t,type:"button",class:me(["flex w-full items-center justify-between rounded-lg px-3 py-2 text-left text-sm transition",t===a(c)?"bg-slate-900 text-white":"text-slate-700 hover:bg-slate-100"]),onClick:o=>K(t)},[l("span",$e,x(t),1),t===a(c)?(r(),i("span",Ne,"active")):P("",!0)],10,Ae))),128))]))])]),l("section",Le,[l("header",Oe,[l("div",null,[e[3]||(e[3]=l("p",{class:"text-xs uppercase tracking-[0.3em] text-slate-400"},"Records",-1)),l("h2",Pe,x(a(c)||"Select a table"),1),e[4]||(e[4]=l("p",{class:"text-xs text-slate-500"},"Showing up to 50 rows per request.",-1))]),l("div",ze,[u(a(h),{variant:"outline",size:"sm",disabled:!a(c),onClick:L},{default:n(()=>[...e[5]||(e[5]=[f(" Refresh ",-1)])]),_:1},8,["disabled"])])]),l("div",De,[u(a(ye),{class:"w-max min-w-full"},{default:n(()=>[u(a(he),null,{default:n(()=>[u(a(j),null,{default:n(()=>[(r(!0),i(R,null,S(a(k),t=>(r(),v(a(W),{key:t,class:"sticky top-0 z-10 bg-white"},{default:n(()=>[f(x(t),1)]),_:2},1024))),128)),u(a(W),{class:"sticky top-0 z-10 bg-white text-right"},{default:n(()=>[...e[6]||(e[6]=[f("Actions",-1)])]),_:1})]),_:1})]),_:1}),u(a(ge),null,{default:n(()=>[a(c)?a(F)?(r(),v(a(j),{key:1},{default:n(()=>[u(a(E),{colspan:a(k).length+1,class:"py-10 text-center text-sm text-slate-500"},{default:n(()=>[...e[8]||(e[8]=[f(" Loading rows... ",-1)])]),_:1},8,["colspan"])]),_:1})):a(_).length===0?(r(),v(a(j),{key:2},{default:n(()=>[u(a(E),{colspan:a(k).length+1,class:"py-10 text-center text-sm text-slate-500"},{default:n(()=>[...e[9]||(e[9]=[f(" No rows found. ",-1)])]),_:1},8,["colspan"])]),_:1})):P("",!0):(r(),v(a(j),{key:0},{default:n(()=>[u(a(E),{colspan:a(k).length+1,class:"py-10 text-center text-sm text-slate-500"},{default:n(()=>[...e[7]||(e[7]=[f(" Select a table to view its rows. ",-1)])]),_:1},8,["colspan"])]),_:1})),(r(!0),i(R,null,S(a(_),(t,o)=>(r(),v(a(j),{key:ae(t,o)},{default:n(()=>[(r(!0),i(R,null,S(a(k),d=>(r(),v(a(E),{key:`${d}-${o}`,class:"max-w-[260px] truncate text-xs text-slate-600",title:M(t[d])},{default:n(()=>[f(x(se(t[d])),1)]),_:2},1032,["title"]))),128)),u(a(E),{class:"text-right"},{default:n(()=>[l("div",Fe,[u(a(h),{variant:"outline",size:"icon",class:"h-8 w-8",disabled:C(t)===null,onClick:d=>le(t)},{default:n(()=>[...e[10]||(e[10]=[f(" âœï¸ ",-1)])]),_:1},8,["disabled","onClick"]),u(a(h),{variant:"outline",size:"icon",class:"h-8 w-8 text-red-600",disabled:C(t)===null||a(B)===String(C(t)),onClick:d=>oe(t)},{default:n(()=>[...e[11]||(e[11]=[f(" ðŸ—‘ ",-1)])]),_:1},8,["disabled","onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),a($)?(r(),i("div",Be,x(a($)),1)):P("",!0)])])):(r(),i("div",ke," Access denied. This page is available for super admin only. ")):(r(),i("div",we," Checking access... ")),u(a(_e),{modelValue:a(T),"onUpdate:modelValue":e[0]||(e[0]=t=>xe(T)?T.value=t:null)},{default:n(()=>[l("div",Ie,[l("div",He,[l("div",null,[e[12]||(e[12]=l("h3",{class:"text-lg font-semibold text-foreground"},"Edit row",-1)),l("p",Je,x(a(c)||"Table"),1)]),u(a(h),{variant:"ghost",size:"sm",onClick:I},{default:n(()=>[...e[13]||(e[13]=[f("Close",-1)])]),_:1})]),l("div",Ke,[(r(!0),i(R,null,S(a(G),t=>(r(),i("div",{key:t,class:"space-y-1"},[l("label",Me,x(t),1),a(b)[t]==="boolean"?pe((r(),i("select",{key:0,"onUpdate:modelValue":o=>a(m)[t]=o,class:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm"},[...e[14]||(e[14]=[l("option",{value:"true"},"true",-1),l("option",{value:"false"},"false",-1)])],8,qe)),[[be,a(m)[t]]]):a(b)[t]==="number"?(r(),v(a(Q),{key:1,modelValue:a(m)[t],"onUpdate:modelValue":o=>a(m)[t]=o,type:"number",class:"text-sm"},null,8,["modelValue","onUpdate:modelValue"])):a(b)[t]==="object"||a(b)[t]==="array"?(r(),v(a(ve),{key:2,modelValue:a(m)[t],"onUpdate:modelValue":o=>a(m)[t]=o,rows:4,class:"text-xs font-mono"},null,8,["modelValue","onUpdate:modelValue"])):(r(),v(a(Q),{key:3,modelValue:a(m)[t],"onUpdate:modelValue":o=>a(m)[t]=o,class:"text-sm"},null,8,["modelValue","onUpdate:modelValue"]))]))),128))]),l("div",Ge,[u(a(h),{variant:"outline",onClick:I},{default:n(()=>[...e[15]||(e[15]=[f("Cancel",-1)])]),_:1}),u(a(h),{disabled:a(O),onClick:ie},{default:n(()=>[f(x(a(O)?"Saving...":"Save"),1)]),_:1},8,["disabled"])])])]),_:1},8,["modelValue"]),a(N)?(r(),i("div",Xe,x(a(N)),1)):P("",!0)],64))}});export{yt as default};
