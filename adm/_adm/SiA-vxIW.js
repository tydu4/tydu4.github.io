import{f as ae,c as se,N as D,G as A,H as s,K as l,O as e,W as k,U as F,V as j,L as a,J as r,M as n,S as M,v as d,X as S,y as H,F as m,T as h,P as oe,Q as ie}from"./CJct0Du1.js";import f from"./CrKAO1Du.js";import ne from"./BCmSOTEA.js";import"./B5uDJmdT.js";import I from"./D96hOBhx.js";import"./CTF75BhX.js";import re from"./-ph6IaWM.js";import de from"./B9WBDtYp.js";import ue from"./DwUrod7N.js";import $ from"./nvNydXzv.js";import b from"./5Tvz58Fd.js";import v from"./3luMke7s.js";import me from"./DBN8MR29.js";import"./otl20aZW.js";import"./DZdvKC0b.js";import"./VXFjAwDO.js";import"./DVEWYwXv.js";import"./Cv6uNvyJ.js";import"./Xz7cpnIQ.js";import ve from"./vd7obiN3.js";import"./DE57YzBN.js";import pe from"./Ct_IM2Ou.js";import{u as ce}from"./DBhd_BX4.js";import{c as _}from"./C1FMIx73.js";import"./CkYB-R1u.js";import"./c5FhCeC0.js";const fe=_("crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);const xe=_("lock-open",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);const be=_("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);const ge=_("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);const ye=_("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),ke={class:"space-y-6"},he={class:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm"},_e={class:"flex flex-wrap items-center justify-between gap-4"},we={class:"flex flex-1 flex-wrap items-center gap-3"},Ce={class:"relative w-full max-w-md"},ze={class:"rounded-2xl border border-slate-200 bg-white shadow-sm"},Te={class:"flex items-center gap-3"},Ve=["href"],Ue={class:"flex items-center justify-end gap-2"},Ae={class:"flex items-center justify-between border-t border-slate-200 px-4 py-3 text-sm text-slate-500"},$e={class:"flex items-center gap-2"},Be={class:"space-y-4"},Le={class:"flex items-start justify-between gap-4"},De={class:"text-sm text-muted-foreground"},Fe={class:"space-y-2"},je={class:"flex items-center justify-end gap-2"},Me={key:0,class:"fixed bottom-6 right-6 z-50 rounded-xl bg-slate-900 px-4 py-3 text-sm text-white shadow-2xl"},Se={class:"flex items-center gap-2"},He={key:1,class:"rounded-2xl border border-red-200 bg-red-50 p-4 text-sm text-red-700"},N=20,vt=ae({__name:"index",setup(Ne){const B=se(),w=d(""),C=d(""),p=d("all"),c=d("all"),u=d(0);let L=null;D(w,i=>{L&&clearTimeout(L),L=setTimeout(()=>{C.value=i.trim(),u.value=0},350)}),D([p,c],()=>{u.value=0});const q=H(()=>`admin-users-${u.value}-${C.value}-${p.value}-${c.value}`),E=()=>B.apiFetch("/api/v1/admin/users",{baseURL:S("/api/v1/admin/users"),query:{search:C.value||void 0,role:p.value==="all"?void 0:p.value,is_active:c.value==="all"?void 0:c.value==="active",limit:N,offset:u.value*N}}),{data:K,pending:G,error:J,refresh:Q}=ce(q,E,{default:()=>[],watch:[u,p,c,C]}),z=d([]);D(K,i=>{z.value=i?[...i]:[]},{immediate:!0});const W=H(()=>u.value>0),X=H(()=>z.value.length===N),Y=i=>new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"short",year:"numeric"}).format(new Date(i)),Z=i=>i.slice(0,2).toUpperCase(),T=d(""),V=i=>{T.value=i,setTimeout(()=>{T.value=""},2500)},R=async i=>{const t=!i.is_active;try{await B.apiFetch(`/api/v1/admin/users/${i.id}/ban`,{method:"PATCH",baseURL:S(`/api/v1/admin/users/${i.id}/ban`),query:{is_active:t}}),i.is_active=t,V(t?"Пользователь разблокирован":"Пользователь забанен")}catch{V("Не удалось изменить статус пользователя")}},g=d(!1),x=d(null),y=d("user"),U=d(!1),ee=i=>{x.value=i,y.value=i.role||"user",g.value=!0},O=()=>{g.value=!1,x.value=null},te=async()=>{if(!x.value)return;U.value=!0;const i={role:y.value};try{await B.apiFetch(`/api/v1/admin/users/${x.value.id}/role`,{method:"PATCH",baseURL:S(`/api/v1/admin/users/${x.value.id}/role`),body:i}),x.value.role=y.value,V("Роль пользователя обновлена"),g.value=!1}catch{V("Не удалось изменить роль пользователя")}finally{U.value=!1}},P=i=>i==="admin"?{label:"Admin",variant:"default"}:i==="organizer"?{label:"Organizer",variant:"secondary"}:{label:"User",variant:"outline"};return(i,t)=>(m(),A("div",ke,[s("section",he,[s("div",_e,[s("div",we,[s("div",Ce,[l(e(ge),{class:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-500"}),l(e(ne),{modelValue:e(w),"onUpdate:modelValue":t[0]||(t[0]=o=>k(w)?w.value=o:null),class:"h-10 pl-9 text-sm",placeholder:"Поиск по username или email"},null,8,["modelValue"])]),F(s("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>k(p)?p.value=o:null),class:"h-10 rounded-md border border-slate-200 bg-white px-3 text-sm text-slate-700"},[...t[7]||(t[7]=[s("option",{value:"all"},"Все роли",-1),s("option",{value:"user"},"User",-1),s("option",{value:"organizer"},"Organizer",-1),s("option",{value:"admin"},"Admin",-1)])],512),[[j,e(p)]]),F(s("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>k(c)?c.value=o:null),class:"h-10 rounded-md border border-slate-200 bg-white px-3 text-sm text-slate-700"},[...t[8]||(t[8]=[s("option",{value:"all"},"Все статусы",-1),s("option",{value:"active"},"Active",-1),s("option",{value:"banned"},"Banned",-1)])],512),[[j,e(c)]])]),l(e(f),{variant:"outline",size:"sm",onClick:e(Q)},{default:a(()=>[...t[9]||(t[9]=[n("Обновить",-1)])]),_:1},8,["onClick"])])]),s("section",ze,[l(e(re),null,{default:a(()=>[l(e(de),null,{default:a(()=>[l(e($),null,{default:a(()=>[l(e(b),null,{default:a(()=>[...t[10]||(t[10]=[n("ID",-1)])]),_:1}),l(e(b),null,{default:a(()=>[...t[11]||(t[11]=[n("User",-1)])]),_:1}),l(e(b),null,{default:a(()=>[...t[12]||(t[12]=[n("Email",-1)])]),_:1}),l(e(b),null,{default:a(()=>[...t[13]||(t[13]=[n("Роль",-1)])]),_:1}),l(e(b),null,{default:a(()=>[...t[14]||(t[14]=[n("Статус",-1)])]),_:1}),l(e(b),null,{default:a(()=>[...t[15]||(t[15]=[n("Дата регистрации",-1)])]),_:1}),l(e(b),{class:"text-right"},{default:a(()=>[...t[16]||(t[16]=[n("Действия",-1)])]),_:1})]),_:1})]),_:1}),l(e(ue),null,{default:a(()=>[e(G)?(m(),h(e($),{key:0},{default:a(()=>[l(e(v),{colspan:"7",class:"py-10 text-center text-sm text-slate-500"},{default:a(()=>[...t[17]||(t[17]=[n(" Загружаем пользователей... ",-1)])]),_:1})]),_:1})):e(z).length===0?(m(),h(e($),{key:1},{default:a(()=>[l(e(v),{colspan:"7",class:"py-10 text-center text-sm text-slate-500"},{default:a(()=>[...t[18]||(t[18]=[n(" Пользователи не найдены ",-1)])]),_:1})]),_:1})):M("",!0),(m(!0),A(oe,null,ie(e(z),o=>(m(),h(e($),{key:o.id},{default:a(()=>[l(e(v),{class:"text-xs text-slate-500"},{default:a(()=>[n(r(o.id),1)]),_:2},1024),l(e(v),null,{default:a(()=>[s("div",Te,[l(e(ve),{class:"h-8 w-8"},{default:a(()=>[l(e(pe),{class:"bg-slate-200 text-xs font-semibold text-slate-700"},{default:a(()=>[n(r(Z(o.username)),1)]),_:2},1024)]),_:2},1024),s("div",null,[s("a",{class:"text-sm font-semibold text-slate-900 hover:underline",href:`/u/${o.username}`,target:"_blank",rel:"noreferrer"},r(o.username),9,Ve)])])]),_:2},1024),l(e(v),{class:"text-sm text-slate-600"},{default:a(()=>[n(r(o.email||"—"),1)]),_:2},1024),l(e(v),null,{default:a(()=>[l(e(I),{variant:P(o.role).variant},{default:a(()=>[n(r(P(o.role).label),1)]),_:2},1032,["variant"])]),_:2},1024),l(e(v),null,{default:a(()=>[l(e(I),{variant:o.is_active?"success":"warning"},{default:a(()=>[n(r(o.is_active?"Active":"Banned"),1)]),_:2},1032,["variant"])]),_:2},1024),l(e(v),{class:"text-sm text-slate-600"},{default:a(()=>[n(r(Y(o.created_at)),1)]),_:2},1024),l(e(v),{class:"text-right"},{default:a(()=>[s("div",Ue,[l(e(f),{variant:"outline",size:"icon",class:"h-8 w-8",onClick:le=>R(o)},{default:a(()=>[o.is_active?(m(),h(e(be),{key:0,class:"h-4 w-4"})):(m(),h(e(xe),{key:1,class:"h-4 w-4"}))]),_:2},1032,["onClick"]),l(e(f),{variant:"outline",size:"icon",class:"h-8 w-8",onClick:le=>ee(o)},{default:a(()=>[l(e(fe),{class:"h-4 w-4"})]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),s("div",Ae,[s("span",null,"Страница "+r(e(u)+1),1),s("div",$e,[l(e(f),{variant:"outline",size:"sm",disabled:!e(W),onClick:t[3]||(t[3]=o=>u.value--)},{default:a(()=>[...t[19]||(t[19]=[n("Назад",-1)])]),_:1},8,["disabled"]),l(e(f),{variant:"outline",size:"sm",disabled:!e(X),onClick:t[4]||(t[4]=o=>u.value++)},{default:a(()=>[...t[20]||(t[20]=[n("Вперед",-1)])]),_:1},8,["disabled"])])])]),l(e(me),{modelValue:e(g),"onUpdate:modelValue":t[6]||(t[6]=o=>k(g)?g.value=o:null)},{default:a(()=>[s("div",Be,[s("div",Le,[s("div",null,[t[21]||(t[21]=s("h3",{class:"text-lg font-semibold text-foreground"},"Смена роли",-1)),s("p",De," Пользователь: "+r(e(x)?.username||"—"),1)]),l(e(f),{variant:"ghost",size:"sm",onClick:O},{default:a(()=>[...t[22]||(t[22]=[n("Закрыть",-1)])]),_:1})]),s("div",Fe,[t[24]||(t[24]=s("label",{class:"text-xs uppercase tracking-[0.2em] text-muted-foreground"},"Роль",-1)),F(s("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>k(y)?y.value=o:null),class:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm"},[...t[23]||(t[23]=[s("option",{value:"user"},"User",-1),s("option",{value:"organizer"},"Organizer",-1),s("option",{value:"admin"},"Admin",-1)])],512),[[j,e(y)]])]),s("div",je,[l(e(f),{variant:"outline",onClick:O},{default:a(()=>[...t[25]||(t[25]=[n("Отмена",-1)])]),_:1}),l(e(f),{disabled:e(U),onClick:te},{default:a(()=>[n(r(e(U)?"Сохраняем...":"Сохранить"),1)]),_:1},8,["disabled"])])])]),_:1},8,["modelValue"]),e(T)?(m(),A("div",Me,[s("div",Se,[l(e(ye),{class:"h-4 w-4 text-emerald-300"}),n(" "+r(e(T)),1)])])):M("",!0),e(J)?(m(),A("div",He," Не удалось загрузить список пользователей. ")):M("",!0)]))}});export{vt as default};
