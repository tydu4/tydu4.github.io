import Y from"./BWfLvG5w.js";import Z from"./Eq0LRX7C.js";import ee from"./4K1Spg6Y.js";import{d as E,m as te,I as se,x as ae,C as oe,o as n,c as i,b as l,w as r,a as o,f as u,u as s,B as le,t as C,a2 as re,G as ne,a3 as ie,k as ue,L,e as T,_ as de,j as _,r as p,q as A,O as ce,v as pe}from"./D4tOOpea.js";import me from"./DitAOtD7.js";import fe from"./CR483DM9.js";import ge from"./aAO3yGtp.js";import{e as B}from"./Cv8_oF2L.js";import{_ as ve}from"./DlAUqK2U.js";const _e={class:"flex min-h-[calc(100vh-8rem)] items-center justify-center px-4 py-8"},xe={key:0},he={key:1},be={class:"space-y-3"},ye={key:0,class:"mr-2 h-5 w-5 animate-spin rounded-full border-2 border-white border-t-transparent"},we={key:1,viewBox:"0 0 24 24","aria-hidden":"true",class:"mr-2 h-5 w-5 fill-current"},ke={class:"space-y-3"},Ce={class:"space-y-2"},Be={class:"space-y-2"},Ge={key:0,class:"mr-2 h-5 w-5 animate-spin rounded-full border-2 border-white border-t-transparent"},ze={key:0,class:"mr-2 h-5 w-5 animate-spin rounded-full border-2 border-muted-foreground border-t-transparent"},Te={class:"text-center text-sm text-muted-foreground"},Ve={key:0,class:"rounded-lg border border-destructive/20 bg-destructive/10 px-4 py-3 text-sm text-destructive"},Me=E({__name:"LoginMainBlock",setup(N){const d=te(),c=se(),V=ae(),R=pe(),I=_(()=>!!R.public.googleClientId),m=p(""),f=p(""),x=p(!1),h=p(!1),b=p(!1),w=p(!1),t=p(""),g=_(()=>x.value||h.value||b.value||w.value),S=_(()=>d.isAuthenticated&&d.user?.role==="guest"),$=a=>["/profile","/wallet","/tickets","/notifications","/organizer"].some(v=>a===v?!0:a.startsWith(`${v}/`)),k=_(()=>{const a=V.query.redirect;if(typeof a!="string")return"/profile/me";try{const e=decodeURIComponent(a);if(e.startsWith("/"))return e}catch{return"/profile/me"}return"/profile/me"}),j=_(()=>{const a=k.value;return $(a)?"/":a}),G=async a=>{await ce(),await A(a)};oe([m,f],()=>{t.value&&(t.value="")});const q=_(()=>({path:"/auth/register",query:V.query})),H=async()=>{if(!m.value.trim()||!f.value){t.value="Введите почту и пароль.",c.push({level:"warning",title:"Вход",message:t.value,ttlMs:3500});return}x.value=!0,t.value="";try{await d.login(m.value.trim(),f.value),await G(k.value)}catch(a){t.value=B(a,"Не удалось войти. Проверь данные и попробуй снова."),c.push({level:"error",title:"Вход",message:t.value})}finally{x.value=!1}},P=async()=>{h.value=!0,t.value="";try{await d.loginAsGuest(),await A(j.value)}catch(a){t.value=B(a,"Не удалось войти как гость. Попробуй позже."),c.push({level:"error",title:"Гостевой вход",message:t.value})}finally{h.value=!1}},W=async()=>{b.value=!0,t.value="";try{await d.loginWithTelegram(),await G(k.value)}catch(a){t.value=B(a,"Не удалось войти через Telegram. Попробуй еще раз."),c.push({level:"error",title:"Telegram",message:t.value})}finally{b.value=!1}},D=async a=>{const e=a?.credential;if(!e){t.value="Не удалось получить токен Google.";return}w.value=!0,t.value="";try{await d.loginWithGoogle(e),await G(k.value)}catch(v){t.value=B(v,"Не удалось войти через Google. Попробуй еще раз."),c.push({level:"error",title:"Google",message:t.value})}finally{w.value=!1}},U=()=>{t.value="Google вход не удался. Попробуй еще раз.",c.push({level:"error",title:"Google",message:t.value})};return(a,e)=>{const v=Y,F=Z,O=ee,y=le,J=re,M=me,K=de,Q=fe,X=ge;return n(),i("div",_e,[l(X,{class:"w-full max-w-md rounded-2xl border-border bg-white shadow-xl dark:bg-slate-900"},{default:r(()=>[l(O,{class:"space-y-2 text-center"},{default:r(()=>[e[3]||(e[3]=o("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-primary"}," Сохраните свой прогресс ",-1)),l(v,{class:"text-2xl font-bold text-foreground"},{default:r(()=>[...e[2]||(e[2]=[u(" Вход в SmartEvents ",-1)])]),_:1}),l(F,{class:"text-base text-muted-foreground"},{default:r(()=>[s(S)?(n(),i("span",xe," Превратите гостевой аккаунт в постоянный, чтобы не потерять билеты и историю ")):(n(),i("span",he,"Найди свою компанию"))]),_:1})]),_:1}),l(Q,{class:"space-y-4"},{default:r(()=>[o("div",be,[l(y,{class:"w-full bg-[#24A1DE] text-white hover:bg-[#208bbf]",size:"lg",disabled:s(g),onClick:W},{default:r(()=>[s(b)?(n(),i("span",ye)):(n(),i("svg",we,[...e[4]||(e[4]=[o("path",{d:"M20.665 3.717l-17.73 6.837c-1.21.486-1.203 1.161-.222 1.462l4.552 1.42 10.532-6.645c.498-.303.953-.14.577.193l-8.534 7.703-.33 4.946c.483 0 .697-.222.969-.485l2.333-2.27 4.857 3.589c.895.493 1.538.239 1.761-.832l3.185-15.008c.326-1.307-.5-1.902-1.356-1.514z"},null,-1)])])),u(" "+C(s(b)?"Подключаемся...":"Войти через Telegram"),1)]),_:1},8,["disabled"]),l(J,null,{fallback:r(()=>[l(y,{variant:"outline",size:"lg",class:"w-full",disabled:""},{default:r(()=>[...e[6]||(e[6]=[u(" Загрузка Google... ",-1)])]),_:1})]),default:r(()=>[s(I)?(n(),i("div",{key:0,class:ne(["google-btn-wrapper flex w-full justify-center",{"pointer-events-none opacity-60":s(w)||s(g)}])},[l(s(ie),{theme:"outline",size:"large",shape:"rectangular",text:"signin_with","logo-alignment":"left",width:384,locale:"ru",onSuccess:D,onError:U})],2)):(n(),ue(y,{key:1,variant:"outline",size:"lg",class:"w-full border-gray-200 bg-white text-gray-700 hover:bg-gray-50",disabled:""},{default:r(()=>[...e[5]||(e[5]=[o("svg",{class:"mr-2 h-5 w-5",viewBox:"0 0 24 24","aria-hidden":"true"},[o("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),o("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),o("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),o("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})],-1),u(" Google (не настроено) ",-1)])]),_:1}))]),_:1})]),e[11]||(e[11]=o("div",{class:"relative"},[o("div",{class:"absolute inset-0 flex items-center"},[o("span",{class:"w-full border-t border-border"})]),o("div",{class:"relative flex justify-center text-xs uppercase"},[o("span",{class:"rounded-full bg-card px-3 py-0.5 text-muted-foreground ring-1 ring-border/60"}," или ")])],-1)),o("div",ke,[o("div",Ce,[e[7]||(e[7]=o("label",{for:"email",class:"text-sm font-medium text-foreground"}," Почта или логин ",-1)),l(M,{id:"email",modelValue:s(m),"onUpdate:modelValue":e[0]||(e[0]=z=>L(m)?m.value=z:null),type:"text",placeholder:"example@site.ru",disabled:s(g)},null,8,["modelValue","disabled"])]),o("div",Be,[e[8]||(e[8]=o("label",{for:"password",class:"text-sm font-medium text-foreground"}," Пароль ",-1)),l(M,{id:"password",modelValue:s(f),"onUpdate:modelValue":e[1]||(e[1]=z=>L(f)?f.value=z:null),type:"password",placeholder:"••••••••",disabled:s(g)},null,8,["modelValue","disabled"])])]),l(y,{class:"w-full",size:"lg",disabled:s(g),onClick:H},{default:r(()=>[s(x)?(n(),i("span",Ge)):T("",!0),u(" "+C(s(x)?"Входим...":"Войти"),1)]),_:1},8,["disabled"]),l(y,{variant:"ghost",size:"lg",class:"w-full",disabled:s(g),onClick:P},{default:r(()=>[s(h)?(n(),i("span",ze)):T("",!0),u(" "+C(s(h)?"Заходим...":"Я только посмотреть"),1)]),_:1},8,["disabled"]),o("div",Te,[e[10]||(e[10]=u(" Ещё не зарегистрированы? ",-1)),l(K,{to:s(q),class:"font-semibold text-primary hover:underline"},{default:r(()=>[...e[9]||(e[9]=[u(" Зарегистрироваться ",-1)])]),_:1},8,["to"])]),s(t)?(n(),i("div",Ve,C(s(t)),1)):T("",!0)]),_:1})]),_:1})])}}}),Le=ve(Me,[["__scopeId","data-v-608193f5"]]),Ae={class:"page-wrapper"},Pe=E({__name:"index",setup(N){return(d,c)=>(n(),i("div",Ae,[l(Le)]))}});export{Pe as default};
