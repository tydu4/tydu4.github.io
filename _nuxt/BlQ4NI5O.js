import{c as A}from"./ChLhOB94.js";import{n as U,r as c,q as f,z as d}from"./BO0_OeXi.js";const x=A("wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),h=s=>({...s,amount:Number(s.amount||0)}),z=U("billing",()=>{const s=c(0),o=c([]),p=c(!1),v=c(!1),u=c(!1),l=c(""),y=e=>{e&&(typeof e.balance=="number"&&(s.value=e.balance),Array.isArray(e.transactions)&&(o.value=e.transactions.map(h)))},b=e=>{if(!e)return;const t=h(e),n=[...o.value],a=n.findIndex(i=>String(i.id)===String(t.id));a>=0?n[a]={...n[a],...t}:n.unshift(t),o.value=n},w=async()=>{const e=f();if(!p.value){p.value=!0,l.value="";try{const t=await e.apiFetch("/api/v1/me/wallet",{baseURL:d("/api/v1/me/wallet")});y(t),u.value=!0}catch{l.value="Failed to load wallet."}finally{p.value=!1}}},m=async(e=50,t=0)=>{const a=await f().apiFetch("/api/v1/me/wallet/history",{method:"POST",baseURL:d("/api/v1/me/wallet/history"),body:{limit:e,offset:t}}),i=Array.isArray(a?.items)?a.items.map(h):[];return o.value=i,u.value=!0,a};return{balance:s,transactions:o,loading:p,topUpPending:v,loaded:u,error:l,fetchWallet:w,fetchHistory:m,topUp:async(e,t={})=>{if(!e||e<=0)return null;const n=f();v.value=!0,l.value="";try{const a=t.provider||"sbp",i={amount:e,provider_data:{provider:a}},r=await n.apiFetch("/api/v1/me/wallet/topup",{method:"POST",baseURL:d("/api/v1/me/wallet/topup"),body:i});return typeof r?.balance=="number"&&(s.value=r.balance),b(r?.transaction||null),u.value=!0,r}catch(a){throw l.value="Failed to top up wallet.",a}finally{v.value=!1}},getTopUpStatus:async(e,t)=>{const n=await m(50,0);return(Array.isArray(n?.items)?n.items:[]).find(r=>{const S=e&&String(r.id)===String(e),g=t&&r.reference_id&&String(r.reference_id)===String(t);return!!(S||g)})?.status?.toLowerCase?.()||null},clear:()=>{s.value=0,o.value=[],u.value=!1,l.value=""}}});export{x as W,z as u};
