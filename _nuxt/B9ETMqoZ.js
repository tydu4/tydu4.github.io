import{d as X,J as he,z as ge,O as be,P as ye,n as xe,G as F,g as we,a2 as ke,K as q,o as p,c as m,u as a,X as _e,a as o,k as Pe,w,f as _,B as P,e as Ae,F as Ce,b as d,t as H,r as v,j as i}from"./vvrMSRdc.js";import{P as $e,a as Ue,b as Se,c as Ee,d as Me}from"./D00N-LJR.js";import{e as Te}from"./Cv8_oF2L.js";import{_ as Ne}from"./DlAUqK2U.js";import"./K80UCnzw.js";const Le={class:"mx-auto w-full max-w-5xl space-y-6 pb-10"},Fe={key:0,class:"space-y-4"},Re={key:1,class:"rounded-3xl border border-destructive/20 bg-destructive/10 p-6 text-sm text-destructive shadow-soft"},Be={class:"mt-3 flex flex-wrap items-center gap-3"},Ie={key:2,class:"rounded-3xl border border-white/30 bg-white/60 p-6 text-sm text-slate-700 shadow-soft backdrop-blur-sm"},ze={class:"profile-highlights-grid grid gap-4 lg:grid-cols-2"},Ve={class:"achievements-container"},We={class:"recent-activity-container"},Oe={class:"grid gap-4 lg:grid-cols-2"},De={class:"rounded-3xl border border-white/30 bg-white/60 p-5 shadow-soft backdrop-blur-sm"},je={class:"mt-3 text-sm text-slate-700"},qe=X({__name:"PublicProfileMainBlock",async setup(J){let A,C;const l=he(),n=ge(),$=be(),k=v(""),R=v("/"),B=v(""),I=v(!1),z=v(!1),V=v(!1),c=i(()=>{const e=$.params.uuid;return Array.isArray(e)?e[0]||"":e||""});l.isAuthInitialized||([A,C]=ye(()=>l.initAuth()),await A,C());const U=i(()=>{const e=l.user?.uuid,t=c.value;return!!(e&&t&&e===t)});xe(()=>[l.isAuthInitialized,U.value],([e,t])=>{!e||!t||F("/profile/me",{replace:!0})},{immediate:!0}),we(()=>{k.value=window.location.origin,R.value=window.location.pathname,B.value=navigator.userAgent||"",I.value=navigator.maxTouchPoints>0,z.value=window.matchMedia?.("(pointer: coarse)").matches??!1,V.value=typeof navigator.share=="function"});const{data:K,pending:G,error:Q,refresh:W}=ke(()=>`public-profile-${c.value}`,async()=>!c.value||U.value?null:await l.apiFetch(`/api/v1/me/users/${c.value}`,{baseURL:q(`/api/v1/me/users/${c.value}`)}),{server:!1,default:()=>null,watch:[c,()=>l.token,()=>l.isAuthInitialized,U]}),r=i(()=>K.value??null),O=i(()=>r.value?.full_name?.trim()||r.value?.username||"User"),D=i(()=>r.value?.bio?.trim()||""),Y=i(()=>r.value?.city?.trim()||""),Z=i(()=>r.value?.role==="organizer"?"Organizer":"Participant"),S=i(()=>r.value?.level??1),E=i(()=>r.value?.exp??0),ee=i(()=>r.value?.next_level_exp??null),te=i(()=>Math.max(0,Math.round(S.value*100+E.value/10))),f=e=>typeof e=="string"?e.trim():"",M=i(()=>{const e=r.value?.social_links;return!e||typeof e!="object"?{}:e}),h=i(()=>f(M.value.telegram)),g=i(()=>f(M.value.vk)),b=i(()=>f(M.value.instagram)),y=i(()=>f(r.value?.social_contact_type)),u=i(()=>f(r.value?.social_contact_value)),ae=e=>e.replace(/^@/,"").trim(),T=(e,t)=>{if(t.startsWith("http://")||t.startsWith("https://"))return t;const s=ae(t);return s?e==="telegram"?`https://t.me/${s}`:e==="vk"?`https://vk.com/${s}`:`https://instagram.com/${s}`:""},j=i(()=>u.value?{type:y.value||"contact",value:u.value}:h.value?{type:"telegram",value:h.value}:g.value?{type:"vk",value:g.value}:b.value?{type:"instagram",value:b.value}:null),ie=i(()=>{const e=[];if(h.value&&e.push({key:"telegram",label:"Telegram",value:h.value,href:T("telegram",h.value)}),g.value&&e.push({key:"vk",label:"VK",value:g.value,href:T("vk",g.value)}),b.value&&e.push({key:"instagram",label:"Instagram",value:b.value,href:T("instagram",b.value)}),u.value){let t="";y.value==="email"&&(t=`mailto:${u.value}`),y.value==="phone"&&(t=`tel:${u.value}`),!t&&(u.value.startsWith("http://")||u.value.startsWith("https://"))&&(t=u.value),e.push({key:"primary-contact",label:y.value?`Contact (${y.value})`:"Primary Contact",value:u.value,href:t||void 0})}return e}),x=v(!1),re=()=>{if(l.isFullUser)return!0;const e=encodeURIComponent($.fullPath||"/");return F(`/login?redirect=${e}`),!1},se=()=>{const e=encodeURIComponent($.fullPath||"/");F(`/login?redirect=${e}`)},le=async()=>{if(!(!c.value||x.value)&&re()){x.value=!0;try{await l.apiFetch(`/api/v1/me/follow/${c.value}`,{method:"POST",baseURL:q(`/api/v1/me/follow/${c.value}`)}),n.push({level:"success",message:"Friend request sent."})}catch(e){n.push({level:"error",message:Te(e,"Unable to send friend request.")})}finally{x.value=!1}}},N=e=>{window.open(e,"_blank","noopener")},oe=async()=>{const e=j.value;if(!e){n.push({level:"info",message:"No contact details are available yet."});return}const t=e.value;if(e.type==="telegram"){const s=t.replace("@","");if(s)return N(`https://t.me/${s}`)}if(e.type==="vk"){const s=t.replace("@",""),L=t.startsWith("http")?t:`https://vk.com/${s}`;return N(L)}if(e.type==="instagram"){const s=t.replace("@",""),L=t.startsWith("http")?t:`https://instagram.com/${s}`;return N(L)}if(e.type==="email"){window.location.href=`mailto:${t}`;return}if(e.type==="phone"){window.location.href=`tel:${t}`;return}try{await navigator.clipboard.writeText(t),n.push({level:"success",message:"Contact copied."})}catch{n.push({level:"error",message:"Unable to copy contact."})}},ne=()=>{const e=/Android|iPhone|iPad|iPod|Mobile|Opera Mini|IEMobile/i.test(B.value);return I.value&&(z.value||e)},ce=()=>V.value,ue=()=>{if(!k.value)return"";const e=r.value?.uuid?`/u/${r.value.uuid}`:R.value;try{return new URL(e,k.value).toString()}catch{return`${k.value}${e.startsWith("/")?e:`/${e}`}`}},de=e=>{const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly","true"),t.style.position="fixed",t.style.opacity="0",t.style.pointerEvents="none",t.style.left="-9999px",document.body.appendChild(t),t.focus(),t.select();const s=document.execCommand("copy");return document.body.removeChild(t),s},ve=async e=>window.isSecureContext&&navigator.clipboard?.writeText?(await navigator.clipboard.writeText(e),!0):(console.warn("[public-profile] Clipboard API unavailable in the current context. Falling back to execCommand copy."),de(e)),pe=async()=>{const e=ue();if(!e){n.push({level:"error",message:"Unable to share profile link."});return}if(ce()&&ne())try{await navigator.share({title:O.value,url:e});return}catch(t){if(t instanceof Error&&t.name==="AbortError")return;console.warn("[public-profile] Native share failed. Falling back to clipboard copy.",t)}try{if(await ve(e)){n.push({level:"success",message:"Profile link copied."});return}n.push({level:"error",message:"Unable to copy profile link."})}catch(t){console.warn("[public-profile] Clipboard copy failed.",t),n.push({level:"error",message:"Unable to copy profile link."})}},me=[{id:"early-adopter",title:"Early Adopter",description:"Joined before the first major release.",badge:"EA",tone:"gold"},{id:"verified",title:"Verified",description:"Profile identity has been confirmed.",badge:"V",tone:"blue"},{id:"event-master",title:"Event Master",description:"Shows consistent event participation.",badge:"EM",tone:"green"}],fe=i(()=>[{id:"pub-1",title:`Reached profile level ${S.value}`,details:`Current XP is ${E.value}. Progress increases with event activity.`,timeLabel:"Recently"},{id:"pub-2",title:"Attended Event X",details:"Mock activity placeholder until backend timeline arrives.",timeLabel:"This week"},{id:"pub-3",title:"Unlocked achievement progress",details:"Social activity helps unlock profile milestones.",timeLabel:"This month"}]);return(e,t)=>(p(),m("div",Le,[a(G)?(p(),m("section",Fe,[...t[1]||(t[1]=[_e('<div class="h-48 animate-pulse rounded-3xl bg-muted/70" data-v-78ee15d5></div><div class="grid gap-3 sm:grid-cols-2 xl:grid-cols-4" data-v-78ee15d5><div class="h-32 animate-pulse rounded-3xl bg-muted/70" data-v-78ee15d5></div><div class="h-32 animate-pulse rounded-3xl bg-muted/70" data-v-78ee15d5></div><div class="h-32 animate-pulse rounded-3xl bg-muted/70" data-v-78ee15d5></div><div class="h-32 animate-pulse rounded-3xl bg-muted/70" data-v-78ee15d5></div></div>',2)])])):a(Q)?(p(),m("section",Re,[t[3]||(t[3]=o("p",null,"Unable to load this profile.",-1)),o("div",Be,[o("button",{type:"button",class:"underline",onClick:t[0]||(t[0]=(...s)=>a(W)&&a(W)(...s))},"Refresh"),a(l).isFullUser?Ae("",!0):(p(),Pe(a(P),{key:0,variant:"outline",size:"sm",onClick:se},{default:w(()=>[...t[2]||(t[2]=[_(" Log in ",-1)])]),_:1}))])])):a(r)?(p(),m(Ce,{key:3},[d($e,{"avatar-url":a(r).avatar_url,"display-name":a(O),username:a(r).username,city:a(Y),bio:a(D)},{actions:w(()=>[d(a(P),{class:"rounded-full",disabled:a(x),onClick:le},{default:w(()=>[_(H(a(x)?"Sending...":"Add Friend"),1)]),_:1},8,["disabled"]),d(a(P),{variant:"outline",class:"rounded-full border-white/50 bg-white/70",disabled:!a(j),onClick:oe},{default:w(()=>[...t[4]||(t[4]=[_(" Message ",-1)])]),_:1},8,["disabled"]),d(a(P),{variant:"outline",class:"rounded-full border-white/50 bg-white/70",onClick:pe},{default:w(()=>[...t[5]||(t[5]=[_(" Share ",-1)])]),_:1})]),_:1},8,["avatar-url","display-name","username","city","bio"]),d(Ue,{level:a(S),exp:a(E),"next-level-exp":a(ee),status:a(Z),"extra-stat-label":"Reputation","extra-stat-value":a(te),"extra-stat-hint":"Calculated from level and experience"},null,8,["level","exp","next-level-exp","status","extra-stat-value"]),o("section",ze,[o("div",Ve,[d(Se,{items:me})]),o("div",We,[d(Ee,{items:a(fe)},null,8,["items"])])]),o("section",Oe,[o("section",De,[t[6]||(t[6]=o("h2",{class:"text-sm font-semibold uppercase tracking-[0.18em] text-slate-700"},"About",-1)),o("p",je,H(a(D)||"No profile summary added yet."),1)]),d(Me,{items:a(ie),"empty-text":"No social links available."},null,8,["items"])])],64)):(p(),m("section",Ie," User not found or profile is not available. "))]))}}),He=Ne(qe,[["__scopeId","data-v-78ee15d5"]]),Xe={class:"page-wrapper"},Ze=X({__name:"index",setup(J){return(A,C)=>(p(),m("div",Xe,[d(He)]))}});export{Ze as default};
