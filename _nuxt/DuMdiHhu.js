import{d as q,ac as Be,g as ee,o as a,k as B,w as o,b as e,T as E,u as s,c as r,a as t,t as C,_ as H,f as b,e as M,r as S,j as m,a3 as ae,x as me,y as te,n as Q,F,G as R,E as W,H as K,A as Ie,B as $,V as pe,Z as ve,D as J,P as Ue,K as Te,W as Pe,aa as Ne,ad as ie,p as he,s as ue,ae as Oe,v as De}from"./DUSKV69B.js";import{Q as Ge}from"./YKlWW6_s.js";import{S as Ee}from"./CDWeW08I.js";import{X}from"./Cp4bn7EH.js";import{H as be}from"./CTg2c_gH.js";import{C as xe,W as Y,U as ye,a as ge,S as _e}from"./D_fppIDC.js";import{U as we}from"./DyhqVQhY.js";import{a as ne,G as Fe}from"./qJqhhafh.js";import ke from"./DjmnqlvP.js";import $e from"./CtYfy4gs.js";import Ce from"./XErQRTKJ.js";import{u as Me}from"./9SUX9GUh.js";import{C as ze}from"./CzeTsOmc.js";import{c as Z}from"./DvKiIxB7.js";import{L as qe}from"./C0F7xrmQ.js";import{u as We}from"./BmgBZjLW.js";import{B as de}from"./BeZcSrQ4.js";import{C as Re}from"./C5svCJa4.js";import{T as He}from"./lZkJpDnY.js";const Ve=Z("log-in",[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]]);const Le=Z("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);const Ke=Z("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);const Se=Z("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]);const je=Z("sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),Qe={key:0,class:"pointer-events-none fixed inset-x-0 bottom-[4.75rem] z-30 px-3 md:bottom-4 md:px-6","aria-live":"polite"},Xe={class:"pointer-events-auto mx-auto flex max-w-2xl items-center gap-3 rounded-2xl border border-white/20 bg-black/60 p-3 text-white shadow-2xl backdrop-blur-md"},Ze={class:"flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-white/15"},Je={class:"min-w-0 flex-1 text-sm font-medium leading-tight"},Ye=q({__name:"AppInstallBanner",props:{message:{default:"Better experience in the App"},appLink:{default:"/app"}},setup(I){const f=I,d=me(),v=Be("hide_app_banner",{sameSite:"lax",path:"/",maxAge:3600*24}),p=S(!1),y=S(!1),z=S(!1),_=()=>{const U=navigator.userAgent||"",T=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|Tablet/i.test(U),w=window.matchMedia("(max-width: 1024px)").matches;return T||w},x=()=>{const U=window.Capacitor;if(!U||typeof U.isNativePlatform!="function")return!1;try{return U.isNativePlatform()}catch{return!1}},n=m(()=>d.public.enableAppPromotions!==!1),u=m(()=>v.value==="1"),L=m(()=>z.value&&n.value&&!y.value&&p.value&&!u.value);ee(()=>{p.value=_(),y.value=x(),z.value=!0});const h=()=>{v.value="1"};return(U,T)=>{const w=H,j=ae;return a(),B(j,null,{default:o(()=>[e(E,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-2 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-2 opacity-0"},{default:o(()=>[s(L)?(a(),r("aside",Qe,[t("div",Xe,[t("div",Ze,[e(s(Ee),{class:"h-5 w-5"})]),t("p",Je,C(f.message),1),e(w,{to:f.appLink,class:"inline-flex shrink-0 items-center rounded-lg bg-white px-3 py-1.5 text-sm font-semibold text-black transition hover:bg-white/90"},{default:o(()=>[...T[0]||(T[0]=[b(" Get ",-1)])]),_:1},8,["to"]),t("button",{type:"button",class:"inline-flex h-8 w-8 shrink-0 items-center justify-center rounded-lg text-white/80 transition hover:bg-white/10 hover:text-white","aria-label":"Dismiss app banner",onClick:h},[e(s(X),{class:"h-4 w-4"})])])])):M("",!0)]),_:1})]),_:1})}}}),et=Object.assign(Ye,{__name:"CommonAppInstallBanner"}),tt={class:"fixed bottom-0 left-0 right-0 z-50 border-t border-border bg-white surface-soft shadow-elevated dark:bg-neutral-900 md:hidden","aria-label":"Нижняя навигация"},st={class:"flex h-[60px] items-center justify-around px-2"},ot={class:"relative flex h-8 w-8 items-center justify-center transition-transform duration-150 group-active:scale-90"},at=q({__name:"BottomNav",setup(I){const f=te(),d=Q(),v=m(()=>!d.isAuthInitialized||d.isGuest),p=m(()=>({path:"/auth/login",query:{redirect:f.fullPath}})),y=[{id:"home",to:"/",icon:be,label:"Home"},{id:"discovery",to:"/discovery/trends",icon:xe,label:"Discovery"},{id:"community",to:"/community/feed",icon:we,label:"Community"},{id:"wallet",to:"/profile/wallet",icon:Y,label:"Wallet"},{id:"profile",to:"/profile/me",icon:ye,label:"Profile"}],z=n=>n==="wallet"||n==="profile",_=(n,u)=>v.value&&z(n)?p.value:u,x=n=>{const u=f.path;return n==="home"?u==="/":n==="discovery"?u.startsWith("/discovery"):n==="community"?u.startsWith("/community"):n==="wallet"?u.startsWith("/profile/wallet"):n==="profile"?u.startsWith("/profile")&&!u.startsWith("/profile/wallet"):!1};return(n,u)=>{const L=H;return a(),r("nav",tt,[t("div",st,[(a(),r(F,null,R(y,h=>e(L,{key:h.id,to:_(h.id,h.to),class:K(["group flex flex-1 flex-col items-center justify-center gap-1 text-[10px] font-medium transition-colors",x(h.id)?"text-primary":"text-muted-foreground"])},{default:o(()=>[t("span",ot,[(a(),B(W(h.icon),{class:K(["h-5 w-5",x(h.id)?"text-primary":"text-muted-foreground"]),fill:x(h.id)?"currentColor":"none","stroke-width":x(h.id)?1.5:2},null,8,["class","fill","stroke-width"]))]),t("span",null,C(h.label),1)]),_:2},1032,["to","class"])),64))])])}}}),nt=Object.assign(at,{__name:"LayoutBottomNav"}),lt={key:0,class:"pointer-events-none fixed inset-x-0 bottom-16 z-[85] flex justify-center px-3 md:bottom-4"},rt={class:"pointer-events-auto flex w-full max-w-2xl items-center gap-3 rounded-2xl border border-border bg-card/95 px-4 py-3 shadow-elevated backdrop-blur"},it={class:"flex h-9 w-9 shrink-0 items-center justify-center rounded-full bg-primary/10 text-primary"},ut={class:"min-w-0 flex-1 text-sm text-foreground"},dt=q({__name:"GuestModeBanner",setup(I){const f=Q(),d=Ie(),v=te(),p=S(!1);ee(()=>{p.value=!0});const y=m(()=>p.value&&f.isAuthInitialized&&f.isGuest&&!d.bannerDismissed&&!v.path.startsWith("/auth/")),z=m(()=>({path:"/auth/register",query:{redirect:v.fullPath}})),_=()=>{d.setBannerDismissed(!0)};return(x,n)=>{const u=H,L=ae;return a(),B(L,null,{default:o(()=>[e(E,{"enter-active-class":"transition duration-250 ease-out","enter-from-class":"translate-y-2 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-2 opacity-0"},{default:o(()=>[s(y)?(a(),r("div",lt,[t("div",rt,[t("div",it,[e(s(ne),{class:"h-4 w-4"})]),t("p",ut,[n[1]||(n[1]=b(" Вы в режиме просмотра. ",-1)),e(u,{to:s(z),class:"font-semibold text-primary hover:underline"},{default:o(()=>[...n[0]||(n[0]=[b(" Создать аккаунт ",-1)])]),_:1},8,["to"]),n[2]||(n[2]=b(" , чтобы сохранить избранное. ",-1))]),e(s($),{variant:"ghost",size:"icon",class:"h-8 w-8 shrink-0 rounded-full text-muted-foreground","aria-label":"Закрыть баннер гостя",onClick:_},{default:o(()=>[e(s(X),{class:"h-4 w-4"})]),_:1})])])):M("",!0)]),_:1})]),_:1})}}}),ct=Object.assign(dt,{__name:"LayoutGuestModeBanner"}),ft={class:"flex shrink-0 items-center justify-between px-5 pt-4 pb-2"},mt={class:"flex-1 overflow-y-auto px-4 py-2 space-y-6 [&::-webkit-scrollbar]:hidden [-ms-overflow-style:'none'] [scrollbar-width:'none']"},pt={class:"space-y-1"},vt={class:"space-y-1"},ht={class:"shrink-0 border-t border-border bg-card/30 p-4 pb-8 backdrop-blur-sm"},bt={key:0,class:"space-y-2"},xt={class:"min-w-0 flex-1"},yt={class:"truncate text-sm font-semibold text-foreground"},gt={key:1,class:"space-y-3"},_t={class:"flex items-center gap-3 px-2"},wt={class:"flex h-10 w-10 items-center justify-center rounded-full bg-muted"},kt=q({__name:"MobileSidebar",props:{isOpen:{type:Boolean}},emits:["close"],setup(I,{emit:f}){const d=f,v=Q(),p=te(),y=Me(),z=m(()=>!v.isAuthInitialized||v.isGuest),_=m(()=>({path:"/auth/login",query:{redirect:p.fullPath}})),x=m(()=>({path:"/auth/register",query:{redirect:p.fullPath}})),n=m(()=>v.user?.full_name||v.user?.username||"Гость"),u=m(()=>v.user?.avatar_url||""),L=m(()=>n.value.trim().charAt(0).toUpperCase()),h=m(()=>y.value==="dark"),U=()=>{y.preference=h.value?"light":"dark"},T=[{id:"home",label:"Главная",icon:be,to:"/"},{id:"discovery",label:"Интересное",icon:xe,to:"/discovery/trends"},{id:"community",label:"Сообщество",icon:we,to:"/community/feed"}],w=[{id:"wallet",label:"Кошелек",icon:Y,to:"/profile/wallet"},{id:"settings",label:"Настройки",icon:ge,to:"/profile/settings"},{id:"help",label:"Помощь",icon:ze,to:"/help"}],j=N=>p.path===N,D=N=>p.path.startsWith(N),V=async()=>{d("close"),await v.logout()};return(N,l)=>{const P=H;return a(),B(ve,{to:"body"},[e(E,{"enter-active-class":"transition-opacity duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:o(()=>[I.isOpen?(a(),r("div",{key:0,class:"fixed inset-0 z-[150] bg-black/60 backdrop-blur-sm",onClick:l[0]||(l[0]=i=>d("close"))})):M("",!0)]),_:1}),e(E,{"enter-active-class":"transition-transform duration-300 ease-out","enter-from-class":"translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"transition-transform duration-200 ease-in","leave-from-class":"translate-x-0","leave-to-class":"translate-x-full"},{default:o(()=>[I.isOpen?(a(),r("div",{key:0,class:"fixed inset-y-0 right-0 z-[200] flex h-[100dvh] w-full max-w-[300px] flex-col bg-background shadow-2xl sm:max-w-sm",onClick:l[7]||(l[7]=pe(()=>{},["stop"]))},[t("div",ft,[l[8]||(l[8]=t("span",{class:"text-xl font-bold tracking-tight text-foreground"},[b(" Smart"),t("span",{class:"text-primary"},"Events")],-1)),e(s($),{variant:"ghost",size:"icon",class:"h-9 w-9 rounded-full hover:bg-muted",onClick:l[1]||(l[1]=i=>d("close"))},{default:o(()=>[e(s(X),{class:"h-5 w-5"})]),_:1})]),t("nav",mt,[t("div",pt,[l[9]||(l[9]=t("p",{class:"px-4 pb-2 text-[11px] font-semibold uppercase tracking-wider text-muted-foreground/70"}," Меню ",-1)),(a(),r(F,null,R(T,i=>e(P,{key:i.id,to:i.to,class:K(["flex items-center gap-3 rounded-xl px-4 py-3 text-sm font-medium transition-all active:scale-[0.98]",j(i.to)?"bg-primary text-primary-foreground shadow-sm":"text-foreground hover:bg-muted"]),onClick:l[2]||(l[2]=g=>d("close"))},{default:o(()=>[(a(),B(W(i.icon),{class:"h-5 w-5"})),b(" "+C(i.label),1)]),_:2},1032,["to","class"])),64))]),t("div",vt,[l[10]||(l[10]=t("p",{class:"px-4 pb-2 text-[11px] font-semibold uppercase tracking-wider text-muted-foreground/70"}," Дополнительно ",-1)),(a(),r(F,null,R(w,i=>e(P,{key:i.id,to:i.to,class:K(["flex items-center gap-3 rounded-xl px-4 py-3 text-sm font-medium transition-colors hover:bg-muted active:scale-[0.98]",D(i.to)?"bg-primary/10 text-primary":"text-foreground"]),onClick:l[3]||(l[3]=g=>d("close"))},{default:o(()=>[(a(),B(W(i.icon),{class:K(["h-5 w-5",D(i.to)?"text-primary":"text-muted-foreground"])},null,8,["class"])),b(" "+C(i.label),1)]),_:2},1032,["to","class"])),64))])]),t("div",ht,[e(s($),{variant:"ghost",class:"mb-4 w-full justify-start gap-3 text-muted-foreground hover:text-foreground",onClick:U},{default:o(()=>[(a(),B(W(h.value?s(je):s(Se)),{class:"h-5 w-5"})),b(" "+C(h.value?"Включить светлую":"Включить тёмную"),1)]),_:1}),z.value?(a(),r("div",gt,[t("div",_t,[t("div",wt,[e(s(ne),{class:"h-5 w-5 text-muted-foreground"})]),l[13]||(l[13]=t("div",null,[t("p",{class:"text-sm font-medium"},"Гость"),t("p",{class:"text-xs text-muted-foreground"},"Прогресс не сохраняется")],-1))]),e(P,{to:_.value,onClick:l[5]||(l[5]=i=>d("close"))},{default:o(()=>[e(s($),{class:"w-full gap-2 font-semibold shadow-lg shadow-primary/20"},{default:o(()=>[e(s(Ve),{class:"h-4 w-4"}),l[14]||(l[14]=b(" Войти ",-1))]),_:1})]),_:1},8,["to"]),e(P,{to:x.value,onClick:l[6]||(l[6]=i=>d("close"))},{default:o(()=>[e(s($),{variant:"outline",class:"w-full font-semibold"},{default:o(()=>[...l[15]||(l[15]=[b(" Создать аккаунт ",-1)])]),_:1})]),_:1},8,["to"])])):(a(),r("div",bt,[e(P,{to:"/profile/me",class:"flex items-center gap-3 rounded-xl border border-border bg-background p-3 transition hover:border-primary/50 active:scale-[0.98]",onClick:l[4]||(l[4]=i=>d("close"))},{default:o(()=>[e(s(ke),{class:"h-10 w-10 border border-border"},{default:o(()=>[e(s($e),{src:u.value},null,8,["src"]),e(s(Ce),null,{default:o(()=>[b(C(L.value),1)]),_:1})]),_:1}),t("div",xt,[t("p",yt,C(n.value),1),l[11]||(l[11]=t("p",{class:"truncate text-xs text-muted-foreground"},"Мой профиль",-1))])]),_:1}),e(s($),{variant:"outline",class:"w-full justify-start gap-3 border-destructive/20 text-destructive hover:bg-destructive/10 hover:text-destructive active:scale-[0.98]",onClick:V},{default:o(()=>[e(s(Le),{class:"h-4 w-4"}),l[12]||(l[12]=b(" Выйти из аккаунта ",-1))]),_:1})]))])])):M("",!0)]),_:1})])}}}),$t=Object.assign(kt,{__name:"LayoutMobileSidebar"}),Ct={class:"flex items-center gap-2"},Mt={class:"relative flex-1"},zt=["placeholder","onKeydown"],Lt={key:0,class:"absolute left-0 right-0 top-[calc(100%+0.45rem)] z-50 overflow-hidden rounded-2xl border border-border bg-card shadow-elevated"},St={key:0,class:"flex items-center gap-2 px-4 py-3 text-sm text-muted-foreground"},jt={key:1,class:"max-h-80 overflow-y-auto py-2"},At=["onClick"],Bt={class:"h-10 w-14 shrink-0 overflow-hidden rounded-lg bg-muted/60"},It=["src","alt"],Ut={key:1,class:"flex h-full w-full items-center justify-center text-[10px] text-muted-foreground"},Tt={class:"line-clamp-2 text-sm font-medium text-foreground"},Pt={key:2,class:"px-4 py-3 text-sm text-muted-foreground"},ce=3,Nt=q({__name:"GlobalSearch",props:{placeholder:{default:"Поиск событий..."},autofocus:{type:Boolean,default:!1},showSubmitButton:{type:Boolean,default:!1},submitLabel:{default:"Search"}},emits:["submitted","selected"],setup(I,{emit:f}){const d=I,v=f,p=Q(),y=S(null),z=S(null),_=S(""),x=S([]),n=S(!1),u=S(!1),L=S(!1),h=m(()=>_.value.trim()),U=m(()=>h.value.length>=ce),T=m(()=>n.value&&U.value&&(u.value||L.value||x.value.length>0));let w=null,j=0;const D=async i=>{const g=++j;u.value=!0,L.value=!1;try{const A=await p.apiFetch("/api/v1/discovery/search",{baseURL:he("/api/v1/discovery/search"),query:{q:i,semantic:!0,limit:8}});if(g!==j)return;x.value=A??[]}catch{if(g!==j)return;x.value=[]}finally{g===j&&(u.value=!1,L.value=!0)}};J(h,i=>{if(w&&(clearTimeout(w),w=null),i.length<ce){x.value=[],L.value=!1,u.value=!1;return}w=setTimeout(()=>{D(i)},260)},{immediate:!1});const V=()=>{_.value="",x.value=[],L.value=!1,z.value?.focus()},N=async()=>{const i=h.value;i&&(n.value=!1,v("submitted",i),await ue(`/discovery/catalog?q=${encodeURIComponent(i)}`))},l=async i=>{n.value=!1,v("selected",i),await ue(`/e/${i.slug}`)},P=i=>{const g=i.target;!g||!y.value||y.value.contains(g)||(n.value=!1)};return ee(()=>{document.addEventListener("mousedown",P),d.autofocus&&Ue(()=>{z.value?.focus()})}),Te(()=>{document.removeEventListener("mousedown",P),w&&clearTimeout(w)}),(i,g)=>(a(),r("div",{ref_key:"rootEl",ref:y,class:"relative w-full"},[t("div",Ct,[t("div",Mt,[e(s(_e),{class:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),Pe(t("input",{ref_key:"inputEl",ref:z,"onUpdate:modelValue":g[0]||(g[0]=A=>_.value=A),type:"search",placeholder:I.placeholder,class:"flex h-10 w-full rounded-md border border-input bg-background pl-9 pr-10 text-sm ring-offset-background transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 [&::-webkit-search-cancel-button]:hidden",onFocus:g[1]||(g[1]=A=>n.value=!0),onKeydown:[ie(pe(N,["prevent"]),["enter"]),g[2]||(g[2]=ie(A=>n.value=!1,["esc"]))]},null,40,zt),[[Ne,_.value]]),_.value?(a(),r("button",{key:0,type:"button",class:"absolute right-1.5 top-1/2 -translate-y-1/2 rounded-full p-1 text-muted-foreground transition-colors hover:text-foreground",onClick:V},[e(s(X),{class:"h-4 w-4"})])):M("",!0)]),I.showSubmitButton?(a(),B(s($),{key:0,type:"button",class:"h-10 shrink-0 rounded-md px-4",disabled:!h.value,onClick:N},{default:o(()=>[b(C(I.submitLabel),1)]),_:1},8,["disabled"])):M("",!0)]),e(E,{"enter-active-class":"transition duration-150 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-120 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:o(()=>[T.value?(a(),r("div",Lt,[u.value?(a(),r("div",St,[e(s(qe),{class:"h-4 w-4 animate-spin"}),g[3]||(g[3]=b(" Ищем события... ",-1))])):x.value.length?(a(),r("ul",jt,[(a(!0),r(F,null,R(x.value,A=>(a(),r("li",{key:A.id},[t("button",{type:"button",class:"flex w-full items-center gap-3 px-3 py-2 text-left transition-colors hover:bg-muted/60",onClick:le=>l(A)},[t("div",Bt,[A.main_image?(a(),r("img",{key:0,src:A.main_image,alt:A.title,class:"h-full w-full object-cover",loading:"lazy"},null,8,It)):(a(),r("div",Ut," event "))]),t("span",Tt,C(A.title),1)],8,At)]))),128))])):(a(),r("div",Pt," Ничего не нашли. Нажми Enter для перехода в каталог. "))])):M("",!0)]),_:1})],512))}}),fe=Object.assign(Nt,{__name:"SharedGlobalSearch"}),Ot={class:"sticky top-0 z-40 w-full border-b border-border bg-card surface-soft shadow-soft"},Dt={class:"mx-auto flex h-16 max-w-7xl items-center justify-between gap-2 px-3 sm:gap-4 sm:px-6 lg:px-8"},Gt={class:"hidden items-center gap-6 text-sm font-medium md:flex"},Et={class:"mx-4 hidden max-w-md flex-1 md:flex"},Ft={class:"hidden items-center gap-2 md:flex"},qt={class:"text-sm font-semibold"},Wt={key:0,class:"absolute right-1.5 top-1.5 flex h-4 w-4 items-center justify-center rounded-full bg-destructive text-[10px] font-bold text-white ring-2 ring-background"},Rt={key:1,class:"h-10 w-10 animate-pulse rounded-full bg-muted/70"},Ht={class:"hidden items-center gap-2 rounded-full border border-border bg-muted/30 px-3 py-1.5 lg:flex"},Vt={class:"flex h-8 w-8 items-center justify-center rounded-full bg-primary/10 text-primary"},Kt={key:3,class:"relative z-40"},Qt={class:"hidden text-sm font-medium lg:inline-block"},Xt={class:"flex shrink-0 items-center gap-2 md:hidden"},Zt={key:0,class:"h-8 w-20 animate-pulse rounded-full bg-muted/70"},Jt={class:"truncate"},Yt={key:0,class:"absolute right-1.5 top-1.5 h-2 w-2 rounded-full bg-destructive ring-2 ring-background"},es={key:0,class:"fixed inset-x-0 bottom-0 z-[95] rounded-t-3xl border-t border-border bg-card p-4 shadow-elevated md:hidden"},ts={class:"mb-3 flex items-center justify-between"},ss="Прогресс не сохраняется",os=q({__name:"TheHeader",setup(I){const f=Q(),d=We(),v=te(),p=Me(),y=m(()=>p.value==="dark"),z=S(!1),_=m(()=>z.value&&f.isAuthInitialized),x=S(!1),n=S(!1),u=S(!1),L=()=>{p.preference=y.value?"light":"dark"},h=[{name:"Интересное",to:"/discovery/trends"},{name:"Сообщество",to:"/community/feed"}],{data:U,refresh:T}=Oe("/api/v1/me/notifications/unread-count",{key:"unread-count",baseURL:he("/api/v1/me/notifications/unread-count"),$fetch:f.apiFetch,server:!1,lazy:!0,immediate:!1,default:()=>({count:0})},"$Tij_uSoUlR");J(()=>_.value&&f.isFullUser,G=>{G?T():U.value={count:0}},{immediate:!0});const w=m(()=>_.value&&f.isFullUser?U.value?.count??0:0),j=m(()=>!_.value||f.isGuest),D=m(()=>f.user?.full_name||f.user?.username||"Гость"),V=m(()=>f.user?.avatar_url||""),N=m(()=>D.value.trim().charAt(0).toUpperCase()),l=m(()=>({path:"/auth/login",query:{redirect:v.fullPath}})),P=m(()=>({path:"/auth/register",query:{redirect:v.fullPath}})),i=[{label:"Мой профиль",to:"/profile/me",icon:ye},{label:"Настройки",to:"/profile/settings",icon:ge},{label:"Помощь",to:"/help",icon:ze}],g=m(()=>d.loaded?`${new Intl.NumberFormat("ru-RU").format(d.balance)} ₽`:"— ₽"),A=m(()=>{if(!d.loaded)return"—";const G=d.balance;return G>=1e3?`${(G/1e3).toFixed(1).replace(".0","")}k`:`${G}`}),le=()=>{u.value=!u.value},se=()=>{u.value=!1},Ae=async()=>{se(),await f.logout()};return ee(()=>{z.value=!0,f.isFullUser&&!d.loaded&&d.fetchWallet()}),J(()=>f.isFullUser,G=>{G?d.fetchWallet():(d.clear(),u.value=!1)}),J(()=>v.fullPath,()=>{u.value=!1}),(G,c)=>{const O=H,re=ae;return a(),r("header",Ot,[t("div",Dt,[e(O,{to:"/",class:"flex min-w-0 max-w-[calc(100vw-9.5rem)] items-center gap-2 font-bold tracking-tighter text-foreground sm:max-w-none"},{default:o(()=>[...c[9]||(c[9]=[t("span",{class:"flex h-8 w-8 shrink-0 items-center justify-center rounded-lg bg-primary/10 text-primary"}," ✨ ",-1),t("span",{class:"truncate text-base leading-none sm:text-xl"},"SmartEvents",-1)])]),_:1}),t("nav",Gt,[(a(),r(F,null,R(h,k=>e(O,{key:k.to,to:k.to,class:"text-muted-foreground transition-colors hover:text-primary","active-class":"font-semibold text-foreground"},{default:o(()=>[b(C(k.name),1)]),_:2},1032,["to"])),64))]),t("div",Et,[e(fe,{class:"hidden md:block"})]),e(re,null,{default:o(()=>[t("div",Ft,[s(f).isAuthInitialized&&!j.value?(a(),B(O,{key:0,to:"/profile/wallet"},{default:o(()=>[e(s($),{variant:"secondary",size:"sm",class:"gap-2 rounded-full px-3"},{default:o(()=>[e(s(Y),{class:"h-4 w-4 text-primary"}),t("span",qt,C(g.value),1)]),_:1})]),_:1})):M("",!0),e(s($),{variant:"ghost",size:"icon",class:"rounded-full hover:bg-muted",onClick:L},{default:o(()=>[(a(),B(W(y.value?s(je):s(Se)),{class:"h-5 w-5"}))]),_:1}),e(O,{to:j.value?l.value:"/notifications"},{default:o(()=>[e(s($),{variant:"ghost",size:"icon",class:"relative rounded-full hover:bg-muted"},{default:o(()=>[e(s(de),{class:"h-5 w-5"}),w.value>0?(a(),r("span",Wt,C(w.value>9?"9+":w.value),1)):M("",!0)]),_:1})]),_:1},8,["to"]),s(f).isAuthInitialized?j.value?(a(),r(F,{key:2},[t("div",Ht,[t("span",Vt,[e(s(ne),{class:"h-4 w-4"})]),t("div",{class:"leading-tight"},[c[10]||(c[10]=t("p",{class:"text-sm font-semibold text-foreground"},"Гость",-1)),t("p",{class:"text-[11px] text-muted-foreground"},C(ss))])]),e(O,{to:l.value},{default:o(()=>[e(s($),{size:"sm",class:"rounded-full"},{default:o(()=>[...c[11]||(c[11]=[b("Войти",-1)])]),_:1})]),_:1},8,["to"]),e(O,{to:P.value},{default:o(()=>[e(s($),{variant:"outline",size:"sm",class:"rounded-full"},{default:o(()=>[...c[12]||(c[12]=[b("Регистрация",-1)])]),_:1})]),_:1},8,["to"])],64)):(a(),r("div",Kt,[e(s($),{variant:"ghost",class:"gap-2 px-2 hover:bg-muted",onClick:le,onMouseenter:c[0]||(c[0]=k=>u.value=!0)},{default:o(()=>[e(s(ke),{class:"h-8 w-8 border-2 border-border"},{default:o(()=>[e(s($e),{src:V.value,alt:D.value},null,8,["src","alt"]),e(s(Ce),{class:"bg-primary/10 text-sm font-semibold text-primary"},{default:o(()=>[b(C(N.value),1)]),_:1})]),_:1}),t("span",Qt,C(D.value),1),e(s(Re),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),e(E,{"enter-active-class":"transition duration-150 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-100 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:o(()=>[u.value?(a(),r("div",{key:0,class:"absolute right-0 mt-2 w-56 rounded-2xl border border-border bg-card/95 p-2 shadow-elevated backdrop-blur",onMouseleave:c[1]||(c[1]=k=>u.value=!1)},[(a(),r(F,null,R(i,k=>e(O,{key:k.to,to:k.to,class:"flex items-center gap-2 rounded-xl px-3 py-2 text-sm font-medium text-foreground transition-colors hover:bg-muted",onClick:se},{default:o(()=>[(a(),B(W(k.icon),{class:"h-4 w-4 text-muted-foreground"})),b(" "+C(k.label),1)]),_:2},1032,["to"])),64)),t("button",{type:"button",class:"mt-1 flex w-full items-center gap-2 rounded-xl px-3 py-2 text-sm font-medium text-destructive transition-colors hover:bg-destructive/10",onClick:Ae},[e(s(Le),{class:"h-4 w-4"}),c[13]||(c[13]=b(" Выйти ",-1))])],32)):M("",!0)]),_:1})])):(a(),r("div",Rt))])]),_:1}),e(re,null,{default:o(()=>[t("div",Xt,[s(f).isAuthInitialized?j.value?M("",!0):(a(),B(O,{key:1,to:"/profile/wallet",class:"flex max-w-[5.5rem] items-center gap-1 rounded-full border border-border bg-card px-2 py-1 text-[11px] font-semibold text-foreground"},{default:o(()=>[e(s(Y),{class:"h-3.5 w-3.5 text-primary"}),t("span",Jt,C(A.value)+" ₽",1)]),_:1})):(a(),r("div",Zt)),e(s($),{variant:"ghost",size:"icon",class:"rounded-full md:hidden",onClick:c[2]||(c[2]=k=>n.value=!0)},{default:o(()=>[e(s(_e),{class:"h-5 w-5"})]),_:1}),e(O,{to:j.value?l.value:"/notifications"},{default:o(()=>[e(s($),{variant:"ghost",size:"icon",class:"relative rounded-full"},{default:o(()=>[e(s(de),{class:"h-5 w-5"}),w.value>0?(a(),r("span",Yt)):M("",!0)]),_:1})]),_:1},8,["to"]),e(s($),{variant:"ghost",size:"icon",class:"rounded-full",onClick:c[3]||(c[3]=k=>x.value=!0)},{default:o(()=>[e(s(Ke),{class:"h-6 w-6"})]),_:1})])]),_:1})]),e($t,{"is-open":x.value,onClose:c[4]||(c[4]=k=>x.value=!1)},null,8,["is-open"]),u.value?(a(),r("div",{key:0,class:"fixed inset-0 z-30 hidden md:block",onClick:se})):M("",!0),(a(),B(ve,{to:"body"},[e(E,{"enter-active-class":"transition-opacity duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:o(()=>[n.value?(a(),r("div",{key:0,class:"fixed inset-0 z-[90] bg-black/60 md:hidden",onClick:c[5]||(c[5]=k=>n.value=!1)})):M("",!0)]),_:1}),e(E,{"enter-active-class":"transition-transform duration-200 ease-out","enter-from-class":"translate-y-full","enter-to-class":"translate-y-0","leave-active-class":"transition-transform duration-200 ease-in","leave-from-class":"translate-y-0","leave-to-class":"translate-y-full"},{default:o(()=>[n.value?(a(),r("div",es,[t("div",ts,[c[14]||(c[14]=t("p",{class:"text-sm font-semibold text-foreground"},"Поиск",-1)),e(s($),{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-full",onClick:c[6]||(c[6]=k=>n.value=!1)},{default:o(()=>[e(s(X),{class:"h-4 w-4"})]),_:1})]),e(fe,{autofocus:!0,"show-submit-button":!0,"submit-label":"Найти",onSubmitted:c[7]||(c[7]=k=>n.value=!1),onSelected:c[8]||(c[8]=k=>n.value=!1)})])):M("",!0)]),_:1})]))])}}}),as=Object.assign(os,{__name:"LayoutTheHeader"}),ns={class:"min-h-screen bg-transparent text-inherit antialiased"},ls={class:"pb-28 pt-4 px-4"},rs={key:0,class:"mx-auto mb-24 w-full max-w-7xl px-4 pb-4 md:mb-6 md:px-6 lg:px-8"},is={class:"rounded-2xl border border-border bg-card/70 p-4 shadow-soft backdrop-blur-sm"},us={class:"mt-4 hidden items-center justify-between gap-4 md:flex"},ds={class:"rounded-xl border border-border bg-background p-2"},cs={class:"mt-4 md:hidden"},oe="/app",As=q({__name:"default",setup(I){const f=me(),d=m(()=>f.public.enableAppPromotions!==!1);return(v,p)=>{const y=H;return a(),r("div",ns,[e(as),e(ct),t("main",ls,[De(v.$slots,"default")]),s(d)?(a(),r("footer",rs,[t("section",is,[p[2]||(p[2]=t("div",{class:"flex items-start justify-between gap-4"},[t("div",{class:"space-y-1"},[t("h2",{class:"text-sm font-semibold uppercase tracking-[0.18em] text-muted-foreground"},"Download App"),t("p",{class:"text-sm text-foreground"},"Use the app for offline tickets and faster check-in.")])],-1)),t("div",us,[t("div",ds,[e(Ge,{value:oe,size:88,level:"M"})]),e(y,{to:oe,class:"inline-flex items-center rounded-xl border border-border px-4 py-2 text-sm font-semibold text-foreground transition hover:bg-muted"},{default:o(()=>[...p[0]||(p[0]=[b(" Open /app ",-1)])]),_:1})]),t("div",cs,[e(y,{to:oe,class:"inline-flex w-full items-center justify-center rounded-xl bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground transition hover:opacity-90"},{default:o(()=>[...p[1]||(p[1]=[b(" Download APK ",-1)])]),_:1})])])])):M("",!0),s(d)?(a(),B(et,{key:1})):M("",!0),e(nt),e(He),e(Fe)])}}});export{As as default};
