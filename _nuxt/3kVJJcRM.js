import{d as U,j as g,z as W,g as J,G as P,o as l,c,F as I,a as e,t as _,q as ee,m as t,b as i,w as h,f as B,B as D,k as O,e as L,l as X,n as te,T as R,r as v,A as se,p as V,_ as ae,Z as ne,J as oe,R as ie,K as re}from"./DIpL79ME.js";import{H as le,p as ce}from"./DS9zloey.js";import{Q as H}from"./DFcLQhsV.js";import{c as Y}from"./Ck3zTzEc.js";import{C as de}from"./DM3jCOsZ.js";import{M as ue}from"./Dh-MwfXC.js";import{T as me}from"./5jP3ovOk.js";import{M as fe}from"./ByXHckbg.js";import{G as pe}from"./CZA99dSy.js";import{X as Z}from"./BvuqPo7h.js";import{_ as ve}from"./DlAUqK2U.js";import{S as ge}from"./B0Whmy7M.js";import"./DSoaomjP.js";import"./BTA2ybKl.js";import"./BwSGWVKi.js";import"./CnmEv5PP.js";import"./NaR5TDkT.js";const he=Y("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);const ye=Y("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),ke={class:"relative overflow-hidden rounded-3xl border border-border bg-card/90 p-5 shadow-soft"},xe={class:"relative space-y-5"},be={class:"flex flex-wrap items-start justify-between gap-3"},we={class:"mt-1 text-xl font-bold text-foreground"},_e={class:"grid gap-3 text-sm sm:grid-cols-2"},Te={class:"flex items-start gap-2"},Ce={class:"text-foreground"},Se={class:"flex items-start gap-2"},Be={class:"text-foreground"},Le={class:"flex items-start gap-2"},ze={class:"text-foreground"},$e={class:"flex items-start gap-2"},Me={class:"text-foreground"},Ee={class:"flex flex-col gap-3 rounded-2xl border border-border bg-background/70 p-3 sm:flex-row sm:items-center sm:justify-between"},De={class:"flex items-center gap-3"},Fe={class:"rounded-xl border border-border bg-white p-2"},Ae={class:"min-w-0"},Ne={class:"mt-1 break-all font-mono text-xs text-foreground"},Ie={class:"flex flex-wrap items-center gap-2"},Oe=U({__name:"TicketCard",props:{ticket:{}},emits:["gift"],setup(u,{emit:T}){const d=u,F=T,m=v(!1),f=v(null),z=v(300),y=v(!1),p=v(null),k=v(null),x=g(()=>{const o=new Date(d.ticket.start_time);return Number.isNaN(o.getTime())?null:o}),C=g(()=>x.value?new Intl.DateTimeFormat("en-US",{weekday:"short",month:"short",day:"numeric"}).format(x.value):"Date TBD"),$=g(()=>x.value?new Intl.DateTimeFormat("en-US",{hour:"2-digit",minute:"2-digit"}).format(x.value):"Time TBD"),M=g(()=>d.ticket.status==="active"?"Active":"Used"),b=g(()=>d.ticket.status==="active"?"bg-emerald-500/15 text-emerald-700 dark:text-emerald-300":"bg-muted text-muted-foreground"),s=()=>{const o=Math.min(window.innerWidth,window.innerHeight),r=Math.floor(o*.82);z.value=Math.max(240,Math.min(r,760))},S=async()=>{const o=navigator;if(o.wakeLock?.request)try{p.value=await o.wakeLock.request("screen")}catch{p.value=null}},w=async()=>{if(p.value)try{await p.value.release()}catch{}finally{p.value=null}},j=async()=>{if(y.value)return;s(),window.addEventListener("resize",s),document.documentElement.classList.add("ticket-qr-max-brightness"),document.body.classList.add("ticket-qr-max-brightness");const o=window.screen;if(typeof o.brightness=="number"){k.value=o.brightness;try{o.brightness=1}catch{k.value=null}}if(await S(),f.value?.requestFullscreen&&document.fullscreenElement!==f.value)try{await f.value.requestFullscreen()}catch{}y.value=!0},A=async()=>{if(!y.value)return;window.removeEventListener("resize",s),await w(),document.documentElement.classList.remove("ticket-qr-max-brightness"),document.body.classList.remove("ticket-qr-max-brightness");const o=window.screen;if(k.value!==null&&typeof o.brightness=="number")try{o.brightness=k.value}catch{}if(k.value=null,document.fullscreenElement===f.value)try{await document.exitFullscreen()}catch{}y.value=!1},N=async()=>{m.value=!0,await se(),await j()},n=async()=>{m.value=!1,await A()},a=()=>{d.ticket.is_giftable&&F("gift",d.ticket)},E=o=>{o.key==="Escape"&&m.value&&n()};return W(m,o=>{o||A()}),J(()=>{window.addEventListener("keydown",E)}),P(()=>{window.removeEventListener("keydown",E),A()}),(o,r)=>(l(),c(I,null,[e("article",ke,[r[8]||(r[8]=e("div",{class:"pointer-events-none absolute -right-16 -top-16 h-40 w-40 rounded-full bg-primary/10 blur-3xl"},null,-1)),e("div",xe,[e("header",be,[e("div",null,[r[0]||(r[0]=e("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground"},"Event",-1)),e("h2",we,_(u.ticket.event_title),1)]),e("span",{class:ee(["rounded-full px-3 py-1 text-xs font-semibold",t(b)])},_(t(M)),3)]),e("dl",_e,[e("div",Te,[i(t(he),{class:"mt-0.5 h-4 w-4 text-primary"}),e("div",null,[r[1]||(r[1]=e("dt",{class:"text-xs uppercase tracking-[0.14em] text-muted-foreground"},"Date",-1)),e("dd",Ce,_(t(C)),1)])]),e("div",Se,[i(t(de),{class:"mt-0.5 h-4 w-4 text-primary"}),e("div",null,[r[2]||(r[2]=e("dt",{class:"text-xs uppercase tracking-[0.14em] text-muted-foreground"},"Time",-1)),e("dd",Be,_(t($)),1)])]),e("div",Le,[i(t(ue),{class:"mt-0.5 h-4 w-4 text-primary"}),e("div",null,[r[3]||(r[3]=e("dt",{class:"text-xs uppercase tracking-[0.14em] text-muted-foreground"},"Venue",-1)),e("dd",ze,_(u.ticket.location_name),1)])]),e("div",$e,[i(t(me),{class:"mt-0.5 h-4 w-4 text-primary"}),e("div",null,[r[4]||(r[4]=e("dt",{class:"text-xs uppercase tracking-[0.14em] text-muted-foreground"},"Ticket Type",-1)),e("dd",Me,_(u.ticket.ticket_type_name),1)])])]),e("section",Ee,[e("div",De,[e("div",Fe,[i(H,{value:u.ticket.uuid,size:88,level:"M"},null,8,["value"])]),e("div",Ae,[r[5]||(r[5]=e("p",{class:"text-xs font-semibold uppercase tracking-[0.14em] text-muted-foreground"},"Ticket UUID",-1)),e("p",Ne,_(u.ticket.uuid),1)])]),e("div",Ie,[i(t(D),{variant:"outline",size:"sm",class:"gap-2",onClick:N},{default:h(()=>[i(t(fe),{class:"h-4 w-4"}),r[6]||(r[6]=B(" Fullscreen QR ",-1))]),_:1}),u.ticket.is_giftable?(l(),O(t(D),{key:0,variant:"outline",size:"sm",class:"gap-2",onClick:a},{default:h(()=>[i(t(pe),{class:"h-4 w-4"}),r[7]||(r[7]=B(" Gift ",-1))]),_:1})):L("",!0)])])])]),(l(),O(X,{to:"body"},[i(R,{"enter-active-class":"transition-opacity duration-250","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:h(()=>[t(m)?(l(),c("div",{key:0,ref_key:"fullscreenSurface",ref:f,class:"fixed inset-0 z-[100] flex h-[100dvh] w-screen items-center justify-center bg-white p-4",onClick:te(n,["self"])},[e("button",{type:"button",class:"absolute right-4 top-[calc(env(safe-area-inset-top)+1rem)] inline-flex h-10 w-10 items-center justify-center rounded-full border border-slate-200 bg-white text-slate-700 shadow-sm","aria-label":"Close fullscreen QR",onClick:n},[i(t(Z),{class:"h-5 w-5"})]),i(H,{value:u.ticket.uuid,size:t(z),level:"H",class:"rounded-[2rem] bg-white p-4 shadow-[0_25px_80px_rgba(0,0,0,0.15)] ring-1 ring-black/10"},null,8,["value","size"])],512)):L("",!0)]),_:1})]))],64))}}),je=ve(Oe,[["__scopeId","data-v-9854f4e8"]]),Re={class:"h-full overflow-y-auto overscroll-contain pr-1"},Ue={class:"mx-auto w-full max-w-5xl space-y-5 pb-8"},qe={key:0,class:"rounded-2xl border border-primary/30 bg-primary/10 px-4 py-3 text-sm text-foreground"},Qe={class:"flex flex-wrap items-start justify-between gap-3"},Ge={class:"flex min-w-0 items-start gap-2"},Ve={key:1,class:"rounded-2xl border border-amber-500/40 bg-amber-500/10 px-4 py-3 text-sm text-amber-800 dark:text-amber-200"},He={class:"flex items-start gap-2"},Ke={key:0},We={key:2,class:"grid gap-4"},Je={key:3,class:"rounded-2xl border border-destructive/30 bg-destructive/10 p-5 text-sm text-destructive"},Pe={key:4,class:"rounded-3xl border border-border bg-card/90 p-8 text-center shadow-soft"},Xe={key:5,class:"grid gap-4"},Ye={key:0,class:"fixed inset-x-4 bottom-4 z-50 rounded-3xl border border-border bg-card p-5 shadow-elevated sm:inset-x-auto sm:right-6 sm:top-6 sm:w-[26rem] sm:bottom-auto"},Ze={key:0,class:"mt-2 text-sm font-medium text-foreground"},et={class:"mt-4 flex flex-wrap gap-2"},tt=U({__name:"MyTicketsList",props:{tickets:{},pending:{type:Boolean,default:!1},error:{type:Boolean,default:!1},usingOfflineCache:{type:Boolean,default:!1},cachedAt:{default:null}},emits:["refresh"],setup(u,{emit:T}){const d=u,F=T,m=v(!1),f=v(null),z=v(!1),y=g(()=>!!d.pending&&d.tickets.length===0),p=g(()=>!!d.error&&d.tickets.length===0),k=g(()=>!y.value&&!p.value&&d.tickets.length===0),x=g(()=>{if(!d.cachedAt)return"";const b=new Date(d.cachedAt);return Number.isNaN(b.getTime())?"":new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(b)}),C=g(()=>f.value?`/community/buddies?gift_ticket=${encodeURIComponent(f.value.uuid)}`:"/community/buddies"),$=b=>{b.is_giftable&&(f.value=b,m.value=!0)},M=()=>{m.value=!1,f.value=null};return(b,s)=>{const S=ae;return l(),c(I,null,[e("div",Re,[e("div",Ue,[s[11]||(s[11]=e("header",{class:"rounded-3xl border border-border bg-card/90 p-5 shadow-soft"},[e("h1",{class:"text-2xl font-bold text-foreground"},"My Tickets"),e("p",{class:"mt-2 text-sm text-muted-foreground"}," Keep your tickets ready at the venue. QR codes stay available from local cache when connection drops. ")],-1)),t(z)?L("",!0):(l(),c("section",qe,[e("div",Qe,[e("p",Ge,[i(t(ge),{class:"mt-0.5 h-4 w-4 shrink-0 text-primary"}),s[2]||(s[2]=e("span",null,"Internet can be unstable at venues. Keep this page open and your QR will still be visible.",-1))]),e("button",{type:"button",class:"inline-flex h-7 w-7 items-center justify-center rounded-md text-muted-foreground transition hover:bg-background hover:text-foreground","aria-label":"Dismiss unstable internet hint",onClick:s[0]||(s[0]=w=>z.value=!0)},[i(t(Z),{class:"h-4 w-4"})])])])),u.usingOfflineCache&&u.tickets.length>0?(l(),c("section",Ve,[e("p",He,[i(t(ye),{class:"mt-0.5 h-4 w-4 shrink-0"}),e("span",null,[s[3]||(s[3]=B(" Showing cached tickets from this device ",-1)),t(x)?(l(),c("span",Ke,"("+_(t(x))+")",1)):L("",!0),s[4]||(s[4]=B(". ",-1))])])])):L("",!0),t(y)?(l(),c("section",We,[(l(),c(I,null,V(3,w=>e("article",{key:w,class:"rounded-3xl border border-border bg-card/90 p-5 shadow-soft"},[...s[5]||(s[5]=[ne('<div class="space-y-3"><div class="h-4 w-24 animate-pulse rounded bg-muted"></div><div class="h-6 w-2/3 animate-pulse rounded bg-muted"></div><div class="grid gap-2 sm:grid-cols-2"><div class="h-4 animate-pulse rounded bg-muted"></div><div class="h-4 animate-pulse rounded bg-muted"></div><div class="h-4 animate-pulse rounded bg-muted"></div><div class="h-4 animate-pulse rounded bg-muted"></div></div><div class="h-24 animate-pulse rounded-2xl bg-muted"></div></div>',1)])])),64))])):t(p)?(l(),c("section",Je,[s[7]||(s[7]=e("p",null,"Unable to load tickets right now. Check your connection and try again.",-1)),i(t(D),{size:"sm",variant:"outline",class:"mt-3",onClick:s[1]||(s[1]=w=>F("refresh"))},{default:h(()=>[...s[6]||(s[6]=[B(" Retry ",-1)])]),_:1})])):t(k)?(l(),c("section",Pe,[s[9]||(s[9]=e("h2",{class:"text-lg font-semibold text-foreground"},"No tickets found",-1)),s[10]||(s[10]=e("p",{class:"mt-2 text-sm text-muted-foreground"}," Explore upcoming events and book your next experience. ",-1)),i(S,{to:"/discovery/catalog",class:"mt-5 inline-flex"},{default:h(()=>[i(t(D),null,{default:h(()=>[...s[8]||(s[8]=[B("Open Catalog",-1)])]),_:1})]),_:1})])):(l(),c("section",Xe,[(l(!0),c(I,null,V(u.tickets,w=>(l(),O(je,{key:w.uuid,ticket:w,onGift:$},null,8,["ticket"]))),128))]))])]),(l(),O(X,{to:"body"},[i(R,{"enter-active-class":"transition-opacity duration-250","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:h(()=>[t(m)?(l(),c("div",{key:0,class:"fixed inset-0 z-50 bg-black/50",onClick:M})):L("",!0)]),_:1}),i(R,{"enter-active-class":"transition-transform duration-250 ease-out","enter-from-class":"translate-y-3 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition-transform duration-200 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-3 opacity-0"},{default:h(()=>[t(m)?(l(),c("section",Ye,[s[14]||(s[14]=e("h3",{class:"text-lg font-semibold text-foreground"},"Gift Ticket",-1)),s[15]||(s[15]=e("p",{class:"mt-2 text-sm text-muted-foreground"}," Continue to gifting flow and choose who should receive this ticket. ",-1)),t(f)?(l(),c("p",Ze,_(t(f).event_title),1)):L("",!0),e("div",et,[i(S,{to:t(C),class:"inline-flex"},{default:h(()=>[i(t(D),{onClick:M},{default:h(()=>[...s[12]||(s[12]=[B(" Continue ",-1)])]),_:1})]),_:1},8,["to"]),i(t(D),{variant:"outline",onClick:M},{default:h(()=>[...s[13]||(s[13]=[B(" Cancel ",-1)])]),_:1})])])):L("",!0)]),_:1})]))],64)}}}),st={class:"relative flex h-[100dvh] w-full flex-col overflow-hidden lg:flex-row"},at={class:"absolute left-0 top-0 z-40 w-full p-2 pt-[calc(env(safe-area-inset-top)+0.5rem)] lg:static lg:w-auto lg:p-6 lg:pt-6"},nt={class:"relative z-0 flex min-h-0 flex-1 overflow-hidden px-2 pb-[calc(env(safe-area-inset-bottom)+1rem)] pt-24 lg:px-6 lg:pb-6 lg:pt-6"},K="profile_my_tickets_cache_v1",wt=U({__name:"index",setup(u){const T=oe(),d=n=>n==="active"||n==="used"||n==="gifted",F=n=>{if(!n||typeof n!="object")return null;const a=n,E=typeof a.uuid=="string"?a.uuid.trim():"",o=a.status,r=typeof a.event_title=="string"?a.event_title.trim():"",q=typeof a.start_time=="string"?a.start_time:"",Q=typeof a.location_name=="string"?a.location_name.trim():"",G=typeof a.ticket_type_name=="string"?a.ticket_type_name.trim():"";return!E||!d(o)||!r||!q||!Q||!G?null:{uuid:E,status:o,event_title:r,start_time:q,location_name:Q,ticket_type_name:G,is_giftable:!!a.is_giftable}},m=n=>Array.isArray(n)?n.map(a=>F(a)).filter(a=>!!a):[],f=()=>{try{const n=localStorage.getItem(K);if(!n)return null;const a=JSON.parse(n);if(!a||typeof a!="object")return null;const E=m(a.tickets),o=typeof a.cached_at=="string"?a.cached_at:"";return o?{tickets:E,cached_at:o}:null}catch{return null}},z=n=>{const a={tickets:n,cached_at:new Date().toISOString()};try{localStorage.setItem(K,JSON.stringify(a))}catch{}},y=f(),p=v(y?.tickets??[]),k=v(y?.cached_at??null),x=v(!1),C=v(!1),$=g(()=>T.isAuthInitialized&&!!T.token),{data:M,pending:b,error:s,refresh:S}=ie("profile-my-tickets",async()=>{if(!T.token)return p.value;try{const n=await T.apiFetch("/api/v1/me/tickets",{baseURL:re("/api/v1/me/tickets")}),a=m(n);return p.value=a,k.value=new Date().toISOString(),x.value=!0,C.value=!1,z(a),a}catch(n){throw p.value.length>0&&(C.value=!0),n}},{server:!1,immediate:!1,default:()=>p.value});W($,n=>{n&&S()},{immediate:!0});const w=g(()=>x.value?m(M.value):p.value),j=g(()=>!!s.value),A=()=>{$.value&&(C.value=!1,S())},N=()=>{$.value&&S()};return J(()=>{window.addEventListener("online",N)}),P(()=>{window.removeEventListener("online",N)}),(n,a)=>(l(),c("div",st,[e("div",at,[i(le,{items:t(ce),class:"lg:!static lg:!top-0"},null,8,["items"])]),e("main",nt,[i(tt,{class:"h-full w-full",tickets:t(w),pending:t(b),error:t(j),"using-offline-cache":t(C),"cached-at":t(k),onRefresh:A},null,8,["tickets","pending","error","using-offline-cache","cached-at"])])]))}});export{wt as default};
