import Y from"./DclQ1Uzj.js";import ee from"./BxaiME2C.js";import te from"./Kdo3OrXQ.js";import{d as R,q as se,v as oe,i as le,o as n,c as d,e as a,w as r,h as o,j as i,u as t,B as ae,t as z,Z as re,D as ne,a0 as ie,b as de,H as T,f as V,S as ue,X as ce,_ as pe,g as _,r as c,s as N,K as me,a1 as fe}from"./BO0_OeXi.js";import ge from"./BP2r0KF4.js";import ve from"./DDegz_5o.js";import _e from"./BAzGcJZe.js";import{u as xe}from"./D92jAQRS.js";import{e as G}from"./Cv8_oF2L.js";import{_ as be}from"./DlAUqK2U.js";const he={class:"flex min-h-[calc(100vh-8rem)] items-center justify-center px-4 py-8"},ye={key:0},we={key:1},ke={class:"space-y-3"},Ce={key:0,class:"mr-2 h-5 w-5 animate-spin rounded-full border-2 border-white border-t-transparent"},Be={key:1,viewBox:"0 0 24 24","aria-hidden":"true",class:"mr-2 h-5 w-5 fill-current"},ze={class:"space-y-3"},Ge={class:"space-y-2"},Me={class:"space-y-2"},Te={key:0,class:"mr-2 h-5 w-5 animate-spin rounded-full border-2 border-white border-t-transparent"},Ve={key:0,class:"mr-2 h-5 w-5 animate-spin rounded-full border-2 border-muted-foreground border-t-transparent"},Ae={class:"flex items-start gap-3 rounded-xl border border-border px-3 py-2 text-sm text-muted-foreground"},Le=["disabled"],Ee={class:"text-center text-sm text-muted-foreground"},Ne={key:0,class:"rounded-lg border border-destructive/20 bg-destructive/10 px-4 py-3 text-sm text-destructive"},Re=R({__name:"LoginMainBlock",setup(S){const p=se(),u=xe(),A=oe(),q=fe(),D=_(()=>!!q.public.googleClientId),f=c(""),g=c(""),x=c(!1),b=c(!1),h=c(!1),y=c(!1),C=c(!1),s=c(""),m=_(()=>b.value||h.value||y.value||C.value),H=_(()=>p.isAuthenticated&&p.user?.role==="guest"),I=l=>["/profile","/wallet","/tickets","/notifications","/organizer"].some(v=>l===v?!0:l.startsWith(`${v}/`)),B=_(()=>{const l=A.query.redirect;if(typeof l!="string")return"/profile/me";try{const e=decodeURIComponent(l);if(e.startsWith("/"))return e}catch{return"/profile/me"}return"/profile/me"}),$=_(()=>{const l=B.value;return I(l)?"/":l}),M=async l=>{await me(),await N(l)};le([f,g],()=>{s.value&&(s.value="")});const j=_(()=>({path:"/auth/register",query:A.query})),P=async()=>{if(!x.value){s.value="Accept offer terms to continue.",u.push({level:"warning",title:"Login",message:s.value,ttlMs:3500});return}if(!f.value.trim()||!g.value){s.value="Введите почту и пароль.",u.push({level:"warning",title:"Вход",message:s.value,ttlMs:3500});return}b.value=!0,s.value="";try{await p.login(f.value.trim(),g.value),await M(B.value)}catch(l){s.value=G(l,"Не удалось войти. Проверь данные и попробуй снова."),u.push({level:"error",title:"Вход",message:s.value})}finally{b.value=!1}},U=async()=>{h.value=!0,s.value="";try{await p.loginAsGuest(),await N($.value)}catch(l){s.value=G(l,"Не удалось войти как гость. Попробуй позже."),u.push({level:"error",title:"Гостевой вход",message:s.value})}finally{h.value=!1}},W=async()=>{y.value=!0,s.value="";try{await p.loginWithTelegram(),await M(B.value)}catch(l){s.value=G(l,"Не удалось войти через Telegram. Попробуй еще раз."),u.push({level:"error",title:"Telegram",message:s.value})}finally{y.value=!1}},F=async l=>{const e=l?.credential;if(!e){s.value="Не удалось получить токен Google.";return}C.value=!0,s.value="";try{await p.loginWithGoogle(e),await M(B.value)}catch(v){s.value=G(v,"Не удалось войти через Google. Попробуй еще раз."),u.push({level:"error",title:"Google",message:s.value})}finally{C.value=!1}},K=()=>{s.value="Google вход не удался. Попробуй еще раз.",u.push({level:"error",title:"Google",message:s.value})};return(l,e)=>{const v=Y,O=ee,X=te,w=ae,Z=re,L=ge,E=pe,J=ve,Q=_e;return n(),d("div",he,[a(Q,{class:"w-full max-w-md rounded-2xl border-border bg-white shadow-xl dark:bg-slate-900"},{default:r(()=>[a(X,{class:"space-y-2 text-center"},{default:r(()=>[e[4]||(e[4]=o("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-primary"}," Сохраните свой прогресс ",-1)),a(v,{class:"text-2xl font-bold text-foreground"},{default:r(()=>[...e[3]||(e[3]=[i(" Вход в SmartEvents ",-1)])]),_:1}),a(O,{class:"text-base text-muted-foreground"},{default:r(()=>[t(H)?(n(),d("span",ye," Превратите гостевой аккаунт в постоянный, чтобы не потерять билеты и историю ")):(n(),d("span",we,"Найди свою компанию"))]),_:1})]),_:1}),a(J,{class:"space-y-4"},{default:r(()=>[o("div",ke,[a(w,{class:"w-full bg-[#24A1DE] text-white hover:bg-[#208bbf]",size:"lg",disabled:t(m),onClick:W},{default:r(()=>[t(y)?(n(),d("span",Ce)):(n(),d("svg",Be,[...e[5]||(e[5]=[o("path",{d:"M20.665 3.717l-17.73 6.837c-1.21.486-1.203 1.161-.222 1.462l4.552 1.42 10.532-6.645c.498-.303.953-.14.577.193l-8.534 7.703-.33 4.946c.483 0 .697-.222.969-.485l2.333-2.27 4.857 3.589c.895.493 1.538.239 1.761-.832l3.185-15.008c.326-1.307-.5-1.902-1.356-1.514z"},null,-1)])])),i(" "+z(t(y)?"Подключаемся...":"Войти через Telegram"),1)]),_:1},8,["disabled"]),a(Z,null,{fallback:r(()=>[a(w,{variant:"outline",size:"lg",class:"w-full",disabled:""},{default:r(()=>[...e[7]||(e[7]=[i(" Загрузка Google... ",-1)])]),_:1})]),default:r(()=>[t(D)?(n(),d("div",{key:0,class:ne(["google-btn-wrapper flex w-full justify-center",{"pointer-events-none opacity-60":t(C)||t(m)}])},[a(t(ie),{theme:"outline",size:"large",shape:"rectangular",text:"signin_with","logo-alignment":"left",width:384,locale:"ru",onSuccess:F,onError:K})],2)):(n(),de(w,{key:1,variant:"outline",size:"lg",class:"w-full border-gray-200 bg-white text-gray-700 hover:bg-gray-50",disabled:""},{default:r(()=>[...e[6]||(e[6]=[o("svg",{class:"mr-2 h-5 w-5",viewBox:"0 0 24 24","aria-hidden":"true"},[o("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),o("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),o("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),o("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})],-1),i(" Google (не настроено) ",-1)])]),_:1}))]),_:1})]),e[14]||(e[14]=o("div",{class:"relative"},[o("div",{class:"absolute inset-0 flex items-center"},[o("span",{class:"w-full border-t border-border"})]),o("div",{class:"relative flex justify-center text-xs uppercase"},[o("span",{class:"rounded-full bg-card px-3 py-0.5 text-muted-foreground ring-1 ring-border/60"}," или ")])],-1)),o("div",ze,[o("div",Ge,[e[8]||(e[8]=o("label",{for:"email",class:"text-sm font-medium text-foreground"}," Почта или логин ",-1)),a(L,{id:"email",modelValue:t(f),"onUpdate:modelValue":e[0]||(e[0]=k=>T(f)?f.value=k:null),type:"text",placeholder:"example@site.ru",disabled:t(m)},null,8,["modelValue","disabled"])]),o("div",Me,[e[9]||(e[9]=o("label",{for:"password",class:"text-sm font-medium text-foreground"}," Пароль ",-1)),a(L,{id:"password",modelValue:t(g),"onUpdate:modelValue":e[1]||(e[1]=k=>T(g)?g.value=k:null),type:"password",placeholder:"••••••••",disabled:t(m)},null,8,["modelValue","disabled"])])]),a(w,{class:"w-full",size:"lg",disabled:t(m)||!t(x),onClick:P},{default:r(()=>[t(b)?(n(),d("span",Te)):V("",!0),i(" "+z(t(b)?"Входим...":"Войти"),1)]),_:1},8,["disabled"]),a(w,{variant:"ghost",size:"lg",class:"w-full",disabled:t(m),onClick:U},{default:r(()=>[t(h)?(n(),d("span",Ve)):V("",!0),i(" "+z(t(h)?"Заходим...":"Я только посмотреть"),1)]),_:1},8,["disabled"]),o("label",Ae,[ue(o("input",{"onUpdate:modelValue":e[2]||(e[2]=k=>T(x)?x.value=k:null),type:"checkbox",required:"",class:"mt-0.5 h-4 w-4 accent-primary",disabled:t(m)},null,8,Le),[[ce,t(x)]]),o("span",null,[e[11]||(e[11]=i(" Я принимаю условия соглашения/оферты. ",-1)),a(E,{to:"/offer",class:"font-semibold text-primary hover:underline"},{default:r(()=>[...e[10]||(e[10]=[i(" Читать оферту ",-1)])]),_:1})])]),o("div",Ee,[e[13]||(e[13]=i(" Ещё не зарегистрированы? ",-1)),a(E,{to:t(j),class:"font-semibold text-primary hover:underline"},{default:r(()=>[...e[12]||(e[12]=[i(" Зарегистрироваться ",-1)])]),_:1},8,["to"])]),t(s)?(n(),d("div",Ne,z(t(s)),1)):V("",!0)]),_:1})]),_:1})])}}}),Se=be(Re,[["__scopeId","data-v-9a8436e1"]]),qe={class:"page-wrapper"},Oe=R({__name:"index",setup(S){return(p,u)=>(n(),d("div",qe,[a(Se)]))}});export{Oe as default};
