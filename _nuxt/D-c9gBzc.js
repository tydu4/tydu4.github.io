import{d as V,n as ne,J as ce,y as ue,z as de,D as pe,s as L,C as ve,p as I,o as p,c as v,u as a,a1 as me,a as o,k as fe,w as x,f as w,B as k,e as he,F as ge,b as d,t as M,j as r,r as be}from"./DUSKV69B.js";import{P as ye,a as xe,b as we,c as ke,d as _e}from"./-afZglMQ.js";import{e as Pe}from"./Cv8_oF2L.js";import{_ as Ce}from"./DlAUqK2U.js";const $e={class:"mx-auto w-full max-w-5xl space-y-6 pb-10"},Ae={key:0,class:"space-y-4"},Ue={key:1,class:"rounded-3xl border border-destructive/20 bg-destructive/10 p-6 text-sm text-destructive shadow-soft"},Se={class:"mt-3 flex flex-wrap items-center gap-3"},Ee={key:2,class:"rounded-3xl border border-white/30 bg-white/60 p-6 text-sm text-slate-700 shadow-soft backdrop-blur-sm"},Ne={class:"profile-highlights-grid grid gap-4 lg:grid-cols-2"},Te={class:"achievements-container"},Le={class:"recent-activity-container"},Fe={class:"grid gap-4 lg:grid-cols-2"},Re={class:"rounded-3xl border border-white/30 bg-white/60 p-5 shadow-soft backdrop-blur-sm"},Be={class:"mt-3 text-sm text-slate-700"},ze=V({__name:"PublicProfileMainBlock",async setup(W){let _,P;const l=ne(),n=ce(),C=ue(),c=r(()=>{const t=C.params.uuid;return Array.isArray(t)?t[0]||"":t||""});l.isAuthInitialized||([_,P]=de(()=>l.initAuth()),await _,P());const $=r(()=>{const t=l.user?.uuid,e=c.value;return!!(t&&e&&t===e)});pe(()=>[l.isAuthInitialized,$.value],([t,e])=>{!t||!e||L("/profile/me",{replace:!0})},{immediate:!0});const{data:D,pending:j,error:q,refresh:F}=ve(()=>`public-profile-${c.value}`,async()=>!c.value||$.value?null:await l.apiFetch(`/api/v1/me/users/${c.value}`,{baseURL:I(`/api/v1/me/users/${c.value}`)}),{server:!1,default:()=>null,watch:[c,()=>l.token,()=>l.isAuthInitialized,$]}),i=r(()=>D.value??null),R=r(()=>i.value?.full_name?.trim()||i.value?.username||"User"),B=r(()=>i.value?.bio?.trim()||""),O=r(()=>i.value?.city?.trim()||""),H=r(()=>i.value?.role==="organizer"?"Organizer":"Participant"),A=r(()=>i.value?.level??1),U=r(()=>i.value?.exp??0),J=r(()=>i.value?.next_level_exp??null),X=r(()=>Math.max(0,Math.round(A.value*100+U.value/10))),m=t=>typeof t=="string"?t.trim():"",S=r(()=>{const t=i.value?.social_links;return!t||typeof t!="object"?{}:t}),f=r(()=>m(S.value.telegram)),h=r(()=>m(S.value.vk)),g=r(()=>m(S.value.instagram)),b=r(()=>m(i.value?.social_contact_type)),u=r(()=>m(i.value?.social_contact_value)),K=t=>t.replace(/^@/,"").trim(),E=(t,e)=>{if(e.startsWith("http://")||e.startsWith("https://"))return e;const s=K(e);return s?t==="telegram"?`https://t.me/${s}`:t==="vk"?`https://vk.com/${s}`:`https://instagram.com/${s}`:""},z=r(()=>u.value?{type:b.value||"contact",value:u.value}:f.value?{type:"telegram",value:f.value}:h.value?{type:"vk",value:h.value}:g.value?{type:"instagram",value:g.value}:null),G=r(()=>{const t=[];if(f.value&&t.push({key:"telegram",label:"Telegram",value:f.value,href:E("telegram",f.value)}),h.value&&t.push({key:"vk",label:"VK",value:h.value,href:E("vk",h.value)}),g.value&&t.push({key:"instagram",label:"Instagram",value:g.value,href:E("instagram",g.value)}),u.value){let e="";b.value==="email"&&(e=`mailto:${u.value}`),b.value==="phone"&&(e=`tel:${u.value}`),!e&&(u.value.startsWith("http://")||u.value.startsWith("https://"))&&(e=u.value),t.push({key:"primary-contact",label:b.value?`Contact (${b.value})`:"Primary Contact",value:u.value,href:e||void 0})}return t}),y=be(!1),Q=()=>{if(l.isFullUser)return!0;const t=encodeURIComponent(C.fullPath||"/");return L(`/login?redirect=${t}`),!1},Y=()=>{const t=encodeURIComponent(C.fullPath||"/");L(`/login?redirect=${t}`)},Z=async()=>{if(!(!c.value||y.value)&&Q()){y.value=!0;try{await l.apiFetch(`/api/v1/me/follow/${c.value}`,{method:"POST",baseURL:I(`/api/v1/me/follow/${c.value}`)}),n.push({level:"success",message:"Friend request sent."})}catch(t){n.push({level:"error",message:Pe(t,"Unable to send friend request.")})}finally{y.value=!1}}},N=t=>{window.open(t,"_blank","noopener")},ee=async()=>{const t=z.value;if(!t){n.push({level:"info",message:"No contact details are available yet."});return}const e=t.value;if(t.type==="telegram"){const s=e.replace("@","");if(s)return N(`https://t.me/${s}`)}if(t.type==="vk"){const s=e.replace("@",""),T=e.startsWith("http")?e:`https://vk.com/${s}`;return N(T)}if(t.type==="instagram"){const s=e.replace("@",""),T=e.startsWith("http")?e:`https://instagram.com/${s}`;return N(T)}if(t.type==="email"){window.location.href=`mailto:${e}`;return}if(t.type==="phone"){window.location.href=`tel:${e}`;return}try{await navigator.clipboard.writeText(e),n.push({level:"success",message:"Contact copied."})}catch{n.push({level:"error",message:"Unable to copy contact."})}},te=()=>typeof navigator.share=="function",ae=()=>{const t=i.value?.uuid?`/u/${i.value.uuid}`:window.location.pathname;try{return new URL(t,window.location.origin).toString()}catch{return`${window.location.origin}${t.startsWith("/")?t:`/${t}`}`}},re=t=>{const e=document.createElement("textarea");e.value=t,e.setAttribute("readonly","true"),e.style.position="fixed",e.style.opacity="0",e.style.pointerEvents="none",e.style.left="-9999px",document.body.appendChild(e),e.focus(),e.select();const s=document.execCommand("copy");return document.body.removeChild(e),s},ie=async t=>window.isSecureContext&&navigator.clipboard?.writeText?(await navigator.clipboard.writeText(t),!0):(console.warn("[public-profile] Clipboard API unavailable in the current context. Falling back to execCommand copy."),re(t)),se=async()=>{const t=ae();if(!t){n.push({level:"error",message:"Unable to share profile link."});return}if(te())try{await navigator.share({title:R.value,url:t});return}catch(e){if(e instanceof Error&&e.name==="AbortError")return;console.warn("[public-profile] Native share failed. Falling back to clipboard copy.",e)}try{if(await ie(t)){n.push({level:"success",message:"Profile link copied."});return}n.push({level:"error",message:"Unable to copy profile link."})}catch(e){console.warn("[public-profile] Clipboard copy failed.",e),n.push({level:"error",message:"Unable to copy profile link."})}},le=[{id:"early-adopter",title:"Early Adopter",description:"Joined before the first major release.",badge:"EA",tone:"gold"},{id:"verified",title:"Verified",description:"Profile identity has been confirmed.",badge:"V",tone:"blue"},{id:"event-master",title:"Event Master",description:"Shows consistent event participation.",badge:"EM",tone:"green"}],oe=r(()=>[{id:"pub-1",title:`Reached profile level ${A.value}`,details:`Current XP is ${U.value}. Progress increases with event activity.`,timeLabel:"Recently"},{id:"pub-2",title:"Attended Event X",details:"Mock activity placeholder until backend timeline arrives.",timeLabel:"This week"},{id:"pub-3",title:"Unlocked achievement progress",details:"Social activity helps unlock profile milestones.",timeLabel:"This month"}]);return(t,e)=>(p(),v("div",$e,[a(j)?(p(),v("section",Ae,[...e[1]||(e[1]=[me('<div class="h-48 animate-pulse rounded-3xl bg-muted/70" data-v-468960e0></div><div class="grid gap-3 sm:grid-cols-2 xl:grid-cols-4" data-v-468960e0><div class="h-32 animate-pulse rounded-3xl bg-muted/70" data-v-468960e0></div><div class="h-32 animate-pulse rounded-3xl bg-muted/70" data-v-468960e0></div><div class="h-32 animate-pulse rounded-3xl bg-muted/70" data-v-468960e0></div><div class="h-32 animate-pulse rounded-3xl bg-muted/70" data-v-468960e0></div></div>',2)])])):a(q)?(p(),v("section",Ue,[e[3]||(e[3]=o("p",null,"Unable to load this profile.",-1)),o("div",Se,[o("button",{type:"button",class:"underline",onClick:e[0]||(e[0]=(...s)=>a(F)&&a(F)(...s))},"Refresh"),a(l).isFullUser?he("",!0):(p(),fe(a(k),{key:0,variant:"outline",size:"sm",onClick:Y},{default:x(()=>[...e[2]||(e[2]=[w(" Log in ",-1)])]),_:1}))])])):a(i)?(p(),v(ge,{key:3},[d(ye,{"avatar-url":a(i).avatar_url,"display-name":a(R),username:a(i).username,city:a(O),bio:a(B)},{actions:x(()=>[d(a(k),{class:"rounded-full",disabled:a(y),onClick:Z},{default:x(()=>[w(M(a(y)?"Sending...":"Add Friend"),1)]),_:1},8,["disabled"]),d(a(k),{variant:"outline",class:"rounded-full border-white/50 bg-white/70",disabled:!a(z),onClick:ee},{default:x(()=>[...e[4]||(e[4]=[w(" Message ",-1)])]),_:1},8,["disabled"]),d(a(k),{variant:"outline",class:"rounded-full border-white/50 bg-white/70",onClick:se},{default:x(()=>[...e[5]||(e[5]=[w(" Share ",-1)])]),_:1})]),_:1},8,["avatar-url","display-name","username","city","bio"]),d(xe,{level:a(A),exp:a(U),"next-level-exp":a(J),status:a(H),"extra-stat-label":"Reputation","extra-stat-value":a(X),"extra-stat-hint":"Calculated from level and experience"},null,8,["level","exp","next-level-exp","status","extra-stat-value"]),o("section",Ne,[o("div",Te,[d(we,{items:le})]),o("div",Le,[d(ke,{items:a(oe)},null,8,["items"])])]),o("section",Fe,[o("section",Re,[e[6]||(e[6]=o("h2",{class:"text-sm font-semibold uppercase tracking-[0.18em] text-slate-700"},"About",-1)),o("p",Be,M(a(B)||"No profile summary added yet."),1)]),d(_e,{items:a(G),"empty-text":"No social links available."},null,8,["items"])])],64)):(p(),v("section",Ee," User not found or profile is not available. "))]))}}),Ie=Ce(ze,[["__scopeId","data-v-468960e0"]]),Me={class:"page-wrapper"},qe=V({__name:"index",setup(W){return(_,P)=>(p(),v("div",Me,[d(Ie)]))}});export{qe as default};
