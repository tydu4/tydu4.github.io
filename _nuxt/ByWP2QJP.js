import{d as j,m as te,I as se,C as re,c as r,a as e,t as v,k as q,u as d,e as V,F as R,E as U,b as p,w as E,j as o,r as C,n as P,o as s,G as H,f as B,B as M,q as oe,aa as G,A as D,_ as ae}from"./BvmsJYLR.js";import ne from"./DDfFWcZW.js";import{e as le}from"./Cv8_oF2L.js";import{c as K}from"./5xDXAavj.js";import{S as ie}from"./Dgjf9vxP.js";import{B as ue,E as ce,S as de}from"./ailpZpTl.js";import"./DlAUqK2U.js";const fe=K("badge-check",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const ve=K("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),me={class:"overflow-hidden rounded-3xl border border-border bg-card shadow-soft"},pe={class:"relative h-56 w-full sm:h-64"},ge=["src","alt"],he={key:1,class:"h-full w-full bg-gradient-to-br from-primary/35 via-primary/20 to-card"},_e={class:"relative px-4 pb-5 sm:px-6"},be={class:"-mt-14 flex flex-col gap-4 sm:-mt-16 sm:flex-row sm:items-end sm:justify-between"},xe={class:"flex items-end gap-4"},ye={class:"h-24 w-24 overflow-hidden rounded-3xl border-4 border-card bg-primary/10 shadow-soft sm:h-28 sm:w-28"},we=["src","alt"],ke={key:1,class:"flex h-full w-full items-center justify-center text-3xl font-bold text-primary"},$e={class:"pb-1"},ze={class:"flex flex-wrap items-center gap-2"},Ce={class:"text-2xl font-bold text-foreground sm:text-3xl"},Le={class:"mt-2 flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-muted-foreground"},Ne={class:"inline-flex items-center gap-1.5"},Se={class:"flex items-center gap-0.5"},Ee={class:"font-semibold text-foreground"},Be={class:"space-y-4"},Me={class:"flex items-start gap-3"},Re={class:"rounded-full bg-primary/10 p-2"},Ue={class:"grid gap-2 sm:grid-cols-2"},Ae=j({__name:"OrganizerHeader",props:{organizer:{}},setup(y){const L=y,c=te(),l=se(),w=G(),a=o(()=>L.organizer),b=o(()=>a.value?.slug?.trim()||""),g=o(()=>encodeURIComponent(b.value)),t=C(!1),i=C(!1),h=C(!1),_=C(!1),x=C(0);re(a,n=>{i.value=!!n?.is_following,x.value=Math.max(0,n?.followers_count??0)},{immediate:!0});const k=o(()=>a.value?.name?.trim()||"Организатор"),$=o(()=>a.value?.logo_url?.trim()||""),A=o(()=>a.value?.cover_image_url?.trim()||""),F=o(()=>k.value.trim().charAt(0).toUpperCase()||"О"),T=o(()=>{const n=Number(a.value?.rating??0);return Number.isFinite(n)?Math.max(0,Math.min(5,n)):0}),I=o(()=>Math.round(T.value)),f=o(()=>T.value.toFixed(1)),u=o(()=>Math.max(0,x.value)),N=o(()=>Math.max(0,a.value?.events_count??0)),S=n=>{const m=n%10,z=n%100;return m===1&&z!==11?"подписчик":m>=2&&m<=4&&(z<12||z>14)?"подписчика":"подписчиков"},O=n=>new Intl.NumberFormat("ru-RU").format(n),X=o(()=>`${O(u.value)} ${S(u.value)}`),Y=o(()=>`${O(N.value)} мероприятий`),Z=o(()=>t.value?"Подписываем...":i.value?"Вы подписаны":"Подписаться"),J=async()=>{const n=encodeURIComponent(w.fullPath||`/organizer/${b.value}`);await oe(`/login?redirect=${n}`)},Q=()=>{if(typeof Notification>"u"){l.push({level:"info",title:"Уведомления",message:"Ваш браузер не поддерживает web-уведомления."});return}if(Notification.permission==="granted"){l.push({level:"success",title:"Уведомления",message:"Уведомления уже включены."});return}if(Notification.permission==="denied"){l.push({level:"warning",title:"Уведомления",message:"Доступ к уведомлениям заблокирован в настройках браузера."});return}h.value=!0},W=async()=>{if(!(typeof Notification>"u")){_.value=!0;try{const n=await Notification.requestPermission();n==="granted"?l.push({level:"success",title:"Уведомления включены",message:"Теперь мы сообщим о новых событиях организатора."}):n==="denied"?l.push({level:"warning",title:"Уведомления отключены",message:"Вы можете включить их позже в настройках браузера."}):l.push({level:"info",title:"Уведомления",message:"Запрос отложен. Вы можете включить уведомления позже."})}catch{l.push({level:"error",title:"Уведомления",message:"Не удалось запросить разрешение на уведомления."})}finally{_.value=!1,h.value=!1}}},ee=async()=>{if(!(t.value||i.value||!b.value)){if(!c.isAuthenticated){await J();return}t.value=!0;try{const n=`/api/v1/public/organizers/${g.value}/follow`;await c.apiFetch(n,{method:"POST",baseURL:P(n)}),i.value=!0,x.value=Math.max(0,x.value)+1,l.push({level:"success",title:"Подписка оформлена",message:"Вы подписались на организатора."}),Q()}catch(n){l.push({level:"error",title:"Ошибка подписки",message:le(n,"Не удалось оформить подписку. Попробуйте еще раз.")})}finally{t.value=!1}}};return(n,m)=>(s(),r("section",me,[e("div",pe,[A.value?(s(),r("img",{key:0,src:A.value,alt:k.value,class:"h-full w-full object-cover"},null,8,ge)):(s(),r("div",he)),m[2]||(m[2]=e("div",{class:"absolute inset-0 bg-gradient-to-t from-black/45 via-black/20 to-transparent"},null,-1))]),e("div",_e,[e("div",be,[e("div",xe,[e("div",ye,[$.value?(s(),r("img",{key:0,src:$.value,alt:k.value,class:"h-full w-full object-cover"},null,8,we)):(s(),r("div",ke,v(F.value),1))]),e("div",$e,[e("div",ze,[e("h1",Ce,v(k.value),1),a.value.is_verified?(s(),q(d(fe),{key:0,class:"h-5 w-5 text-primary"})):V("",!0)]),e("div",Le,[e("div",Ne,[e("div",Se,[(s(),r(R,null,U(5,z=>p(d(ie),{key:`star-${z}`,class:H(["h-4 w-4",z<=I.value?"fill-amber-400 text-amber-400":"text-muted-foreground/40"])},null,8,["class"])),64))]),e("span",Ee,v(f.value),1)]),e("span",null,v(X.value),1),e("span",null,v(Y.value),1)])])]),p(d(M),{class:"w-full rounded-full px-6 sm:w-auto",variant:i.value?"secondary":"default",disabled:t.value||i.value,onClick:ee},{default:E(()=>[B(v(Z.value),1)]),_:1},8,["variant","disabled"])])]),p(d(ne),{modelValue:h.value,"onUpdate:modelValue":m[1]||(m[1]=z=>h.value=z),class:"max-w-md border-border bg-card text-foreground"},{default:E(()=>[e("div",Be,[e("div",Me,[e("div",Re,[p(d(ue),{class:"h-5 w-5 text-primary"})]),m[3]||(m[3]=e("div",null,[e("h3",{class:"text-base font-semibold text-foreground"},"Включить уведомления?"),e("p",{class:"mt-1 text-sm text-muted-foreground"}," Будем присылать анонсы новых событий от этого организатора. ")],-1))]),e("div",Ue,[p(d(M),{variant:"outline",disabled:_.value,onClick:m[0]||(m[0]=z=>h.value=!1)},{default:E(()=>[...m[4]||(m[4]=[B(" Позже ",-1)])]),_:1},8,["disabled"]),p(d(M),{disabled:_.value,onClick:W},{default:E(()=>[B(v(_.value?"Запрашиваем...":"Включить"),1)]),_:1},8,["disabled"])])])]),_:1},8,["modelValue"])]))}}),Te={class:"space-y-4"},je={class:"rounded-2xl border border-border bg-card p-5 shadow-soft"},Fe={class:"mt-2 whitespace-pre-line text-sm text-muted-foreground"},Ie={class:"rounded-2xl border border-border bg-card p-5 shadow-soft"},Oe={key:0,class:"mt-4 grid gap-2 sm:grid-cols-2"},Ve=["href"],Pe={class:"font-medium"},qe={key:1,class:"mt-3 text-sm text-muted-foreground"},De=j({__name:"OrganizerInfo",props:{organizer:{}},setup(y){const L=y,c=o(()=>L.organizer),l=o(()=>c.value?.description?.trim()||"Организатор пока не добавил описание."),w=g=>{const t=g.trim().toLowerCase();return t.includes("telegram")||t==="tg"?"Telegram":t.includes("instagram")||t==="inst"?"Instagram":t.includes("vk")||t.includes("vkontakte")?"VK":t.includes("facebook")?"Facebook":t.includes("youtube")?"YouTube":t.includes("x")||t.includes("twitter")?"X":t.includes("tiktok")?"TikTok":g},a=g=>{const t=g.trim();return t?/^https?:\/\//i.test(t)||/^(mailto|tel):/i.test(t)?t:`https://${t.replace(/^\/+/,"")}`:""},b=o(()=>{const g=[],t=new Set,i=(_,x,k)=>{if(!k?.trim())return;const $=a(k);!$||t.has($)||(t.add($),g.push({key:_,label:x,href:$}))};i("website","Сайт",c.value?.website);const h=c.value?.social_links;return h&&typeof h=="object"&&!Array.isArray(h)&&Object.entries(h).forEach(([_,x])=>{typeof x=="string"&&i(_,w(_),x)}),g});return(g,t)=>(s(),r("section",Te,[e("article",je,[t[0]||(t[0]=e("h2",{class:"text-lg font-semibold text-foreground"},"О нас",-1)),e("p",Fe,v(l.value),1)]),e("article",Ie,[t[1]||(t[1]=e("h3",{class:"text-sm font-semibold uppercase tracking-[0.16em] text-muted-foreground"}," Соцсети и ссылки ",-1)),b.value.length?(s(),r("div",Oe,[(s(!0),r(R,null,U(b.value,i=>(s(),r("a",{key:i.key,href:i.href,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center gap-2 rounded-xl border border-border bg-muted/35 px-3 py-2 text-sm text-foreground transition hover:border-primary/40 hover:bg-primary/5"},[p(d(ve),{class:"h-4 w-4 text-primary"}),e("span",Pe,v(i.label),1)],8,Ve))),128))])):(s(),r("p",qe," Ссылки пока не добавлены. "))])]))}}),He={key:0,class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},Ge={key:1,class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},Ke={key:2,class:"rounded-2xl border border-border bg-card px-4 py-8 text-center text-sm text-muted-foreground shadow-soft"},Xe=j({__name:"OrganizerEventsList",props:{events:{},isLoading:{type:Boolean},variant:{}},setup(y){const L=y,c=o(()=>L.variant==="past"?"Прошедших событий пока нет.":"У этого организатора пока нет запланированных событий.");return(l,w)=>(s(),r("div",null,[y.isLoading&&!y.events.length?(s(),r("div",He,[(s(),r(R,null,U(6,a=>p(de,{key:`organizer-events-skeleton-${a}`})),64))])):y.events.length?(s(),r("div",Ge,[(s(!0),r(R,null,U(y.events,a=>(s(),q(ce,{key:a.id,event:a,"show-tags":!0,class:"h-full"},null,8,["event"]))),128))])):(s(),r("div",Ke,v(c.value),1))]))}}),Ye={class:"page-wrapper pb-24"},Ze={key:0,class:"flex h-[50vh] flex-col items-center justify-center gap-4 p-4 text-center"},Je={class:"text-xl font-bold text-destructive"},Qe={class:"text-muted-foreground"},We={class:"font-mono"},et={class:"rounded bg-muted px-2 py-1 text-left font-mono text-xs"},tt={class:"flex gap-2"},st={key:1,class:"flex h-[50vh] items-center justify-center"},rt={key:2,class:"mx-auto w-full max-w-6xl space-y-6"},ot={class:"space-y-4"},at={class:"inline-flex rounded-full border border-border bg-card p-1 shadow-sm"},nt=["onClick"],lt={key:1,class:"space-y-3"},it={key:0,class:"rounded-xl border border-destructive/30 bg-destructive/10 p-3 text-sm text-destructive"},gt=j({__name:"index",setup(y){const L=G(),c=o(()=>{const f=L.params.slug;return Array.isArray(f)?(f[0]||"").trim():String(f||"").trim()}),l=C("upcoming"),w=C(null),a=C(""),b=C(""),g=f=>{const u=f;return u?.statusCode??u?.response?.status??null},t=(f,u)=>{const N=f;return N?.data?.message||N?.response?._data?.message||N?.message||u},{data:i,pending:h,refresh:_}=D(`safe-org-profile-${c.value}`,async()=>{if(w.value=null,a.value="",!c.value)return w.value=404,a.value="Слаг организатора не указан.",null;try{return await $fetch(`/api/v1/public/organizers/${encodeURIComponent(c.value)}`,{baseURL:P("/api/v1/public/organizers")})}catch(f){return w.value=g(f),a.value=t(f,"Не удалось загрузить данные организатора."),null}},{server:!1,lazy:!1,default:()=>null}),{data:x,pending:k,refresh:$}=D(`safe-org-events-${c.value}`,async()=>{if(b.value="",!i.value||!c.value||l.value==="about")return[];const f=l.value==="past"?"done":"scheduled";try{return await $fetch(`/api/v1/public/organizers/${encodeURIComponent(c.value)}/events`,{baseURL:P("/api/v1/public/organizers"),query:{status:f,limit:12}})}catch(u){return b.value=t(u,"Не удалось загрузить события."),[]}},{server:!1,lazy:!1,default:()=>[],watch:[l,i,c]}),A=o(()=>!!a.value),F=o(()=>x.value||[]),T=async()=>{await _()},I=async()=>{await $()};return(f,u)=>{const N=ae;return s(),r("div",Ye,[A.value?(s(),r("div",Ze,[e("h2",Je,v(w.value===404?"Организатор не найден":"Ошибка загрузки организатора"),1),e("p",Qe,[u[0]||(u[0]=B(" Не удалось загрузить данные по адресу: ",-1)),e("span",We,v(c.value),1)]),e("div",et,v(a.value),1),e("div",tt,[p(d(M),{variant:"outline",onClick:T},{default:E(()=>[...u[1]||(u[1]=[B("Попробовать снова",-1)])]),_:1}),p(N,{to:"/"},{default:E(()=>[p(d(M),null,{default:E(()=>[...u[2]||(u[2]=[B("На главную",-1)])]),_:1})]),_:1})])])):d(h)&&!d(i)?(s(),r("div",st,[...u[3]||(u[3]=[e("div",{class:"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent"},null,-1)])])):d(i)?(s(),r("div",rt,[p(Ae,{organizer:d(i)},null,8,["organizer"]),e("section",ot,[e("div",at,[(s(),r(R,null,U(["upcoming","past","about"],S=>e("button",{key:S,type:"button",class:H(["rounded-full px-5 py-2 text-sm font-semibold transition-all",l.value===S?"bg-primary text-primary-foreground shadow-sm":"text-muted-foreground hover:bg-muted/50 hover:text-foreground"]),onClick:O=>l.value=S},v(S==="upcoming"?"Афиша":S==="past"?"Прошедшие":"О нас"),11,nt)),64))]),l.value==="about"?(s(),q(De,{key:0,organizer:d(i)},null,8,["organizer"])):(s(),r("div",lt,[b.value?(s(),r("div",it,[B(v(b.value)+" ",1),e("button",{type:"button",class:"ml-2 underline",onClick:I},"Обновить")])):V("",!0),p(Xe,{events:F.value,"is-loading":d(k),variant:l.value==="past"?"past":"upcoming"},null,8,["events","is-loading","variant"])]))])])):V("",!0)])}}});export{gt as default};
