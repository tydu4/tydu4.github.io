import{d as Y,q as pe,x as me,z as T,i as fe,o as p,c as m,h as t,e as n,_ as ve,u as s,w as q,j as L,t as c,B as Q,f as K,H as i,S as X,X as W,$ as be,g as v,r as a}from"./BO0_OeXi.js";import f from"./BP2r0KF4.js";import xe from"./BMiDIfG3.js";const ge={class:"mx-auto w-full max-w-3xl space-y-6 pb-10"},ye={class:"rounded-3xl border border-border bg-card p-6 shadow-soft"},_e={key:0,class:"space-y-3"},we={key:1,class:"rounded-2xl border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive"},he={key:2,class:"space-y-4 rounded-3xl border border-border bg-card p-6 shadow-soft"},ke={class:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between"},Ve={class:"flex items-center gap-4"},Ue={class:"h-20 w-20 overflow-hidden rounded-full border-4 border-background bg-primary/10 shadow-soft"},Pe=["src","alt"],Ae={key:1,class:"flex h-full w-full items-center justify-center text-2xl font-bold text-primary"},Ce={class:"min-w-0"},Se={class:"truncate text-lg font-bold text-foreground"},je={class:"truncate text-sm text-muted-foreground"},Be={class:"flex flex-col items-start gap-2"},Ee={key:0,class:"text-xs text-muted-foreground"},Fe={class:"grid gap-4"},Ne={class:"space-y-2"},Me={key:0,class:"text-xs text-destructive"},Re={class:"space-y-2"},Te={class:"flex items-center justify-between text-xs"},Le={key:0,class:"text-destructive"},De={class:"ml-auto text-muted-foreground"},Ie={class:"space-y-4 rounded-3xl border border-border bg-card p-6 shadow-soft"},$e={class:"grid gap-4 sm:grid-cols-2"},ze={class:"space-y-2"},He={class:"space-y-2"},Oe={class:"grid gap-4 sm:grid-cols-3"},qe={class:"space-y-2"},Ke={class:"space-y-2"},Xe={class:"space-y-2"},Ze={class:"space-y-4 rounded-3xl border border-border bg-card p-6 shadow-soft"},Ge={class:"flex items-start gap-3 rounded-2xl border border-border px-4 py-3 text-sm text-muted-foreground"},Je={class:"space-y-4 rounded-3xl border border-border bg-card p-6 shadow-soft"},Qe={class:"grid gap-4 sm:grid-cols-3"},We={class:"space-y-2"},Ye={class:"space-y-2"},et={class:"space-y-2"},tt={class:"space-y-4 rounded-3xl border border-border bg-card p-6 shadow-soft"},st={class:"grid gap-4 sm:grid-cols-2"},lt={class:"space-y-2"},ot={class:"flex items-start gap-3 rounded-2xl border border-border px-4 py-3 text-sm text-muted-foreground"},at={class:"flex items-center justify-between gap-3"},rt={class:"text-xs text-muted-foreground"},nt=Y({__name:"ProfileSettingsBlock",setup(ee){const d=pe(),{data:Z,pending:G,error:te,refresh:D}=me("settings-profile",async()=>!d.isAuthInitialized||!d.token?null:await d.apiFetch("/api/v1/me/profile",{baseURL:T("/api/v1/me/profile")}),{server:!1,default:()=>null,watch:[()=>d.token,()=>d.isAuthInitialized]}),u=v(()=>Z.value??null),I=v(()=>u.value?.full_name?.trim()||u.value?.username||"Profile"),se=v(()=>I.value.trim().charAt(0).toUpperCase()||"U"),le=v(()=>u.value?.uuid?`/u/${u.value.uuid}`:"/profile/me"),b=a(""),x=a(""),g=a(""),_=a(""),w=a(""),h=a(""),k=a(!1),V=a(!0),U=a("public"),C=a(""),S=a(""),j=a(""),B=a(""),E=a(""),F=a(null),N=a(!1),P=a(""),M=a(!1),R=a(""),oe=/^[a-zA-Z0-9_]+$/,$=o=>typeof o!="string"?"":o.trim();fe(u,o=>{if(!o)return;b.value=o.username||"",x.value=o.bio||"",g.value=o.avatar_url||"";const e=o.social_links&&typeof o.social_links=="object"?o.social_links:{};_.value=$(e.telegram),w.value=$(e.vk),h.value=$(e.instagram);const r=o.settings&&typeof o.settings=="object"?o.settings:{},l=r.contact_privacy;k.value=l==="buddies_only"||l==="matches_only";const O=typeof r.privacy_level=="string"?r.privacy_level:"public";U.value=O==="nobody"?"nobody":"public";const y=r.notifications;V.value=typeof y=="boolean"?y:!0,C.value=o.email||"",S.value="",j.value="",B.value="",E.value=""},{immediate:!0});const z=v(()=>{const o=b.value.trim();return o?o.length<3?"Minimum 3 symbols":o.length>50?"Maximum 50 symbols":oe.test(o)?"":'Only latin letters, numbers and "_"':"Username is required"}),H=v(()=>x.value.length>500?"Bio must be <= 500 symbols":""),ae=v(()=>!!(z.value||H.value)),J=v(()=>!M.value&&!G.value&&!ae.value),re=()=>D(),ne=()=>F.value?.click(),ie=o=>{if(!o)return"";if(typeof o=="string")return o;if(typeof o!="object")return"";const e=o,r=e.avatar_url||e.url||e.image_url;if(typeof r=="string")return r;if(e.user&&typeof e.user=="object"){const l=e.user.avatar_url;if(typeof l=="string")return l}if(e.data&&typeof e.data=="object"){const l=e.data.avatar_url||e.data.url;if(typeof l=="string")return l}return""},de=async o=>{const r=o.target.files?.[0];if(r){N.value=!0,P.value="";try{const l=new FormData;l.append("file",r);const O=await d.apiFetch("/api/v1/me/avatar",{method:"POST",baseURL:T("/api/v1/me/avatar"),body:l}),y=ie(O);y&&(g.value=y),await D(),!y&&u.value?.avatar_url&&(g.value=u.value.avatar_url),P.value="Avatar uploaded"}catch{P.value="Avatar upload failed"}finally{N.value=!1,F.value&&(F.value.value="")}}},A=o=>o.trim()||null,ue=o=>{const e=o?.data?.detail;if(typeof e=="string")return e;if(Array.isArray(e)&&e.length>0){const r=e[0];if(r?.msg)return r.msg}return""},ce=async()=>{if(R.value="",!!J.value){M.value=!0;try{const o={username:b.value.trim(),bio:A(x.value),avatar_url:A(g.value),social_links:{telegram:A(_.value),vk:A(w.value),instagram:A(h.value)}};await d.apiFetch("/api/v1/me/profile",{method:"PATCH",baseURL:T("/api/v1/me/profile"),body:o});const r={...u.value?.settings&&typeof u.value.settings=="object"?u.value.settings:{},contact_privacy:k.value?"buddies_only":"all",privacy_level:U.value,notifications:V.value};await d.apiFetch("/api/v1/me/settings",{method:"PATCH",baseURL:T("/api/v1/me/settings"),body:r}),R.value="Profile saved",await D(),await d.fetchUser()}catch(o){const e=ue(o);R.value=e||"Failed to save changes"}finally{M.value=!1}}};return(o,e)=>{const r=ve;return p(),m("div",ge,[t("section",ye,[e[14]||(e[14]=t("p",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-primary/80"},"Profile Settings",-1)),e[15]||(e[15]=t("h1",{class:"mt-2 text-2xl font-bold text-foreground"},"Profile Settings",-1)),e[16]||(e[16]=t("p",{class:"mt-2 text-sm text-muted-foreground"}," Fill social links for Buddy Finder. ",-1)),n(r,{to:s(le),class:"mt-3 inline-flex text-sm font-medium text-primary underline-offset-4 hover:underline"},{default:q(()=>[...e[13]||(e[13]=[L(" Open public profile ",-1)])]),_:1},8,["to"])]),s(G)?(p(),m("section",_e,[...e[17]||(e[17]=[t("div",{class:"h-32 animate-pulse rounded-2xl bg-muted"},null,-1),t("div",{class:"h-64 animate-pulse rounded-2xl bg-muted"},null,-1)])])):s(te)?(p(),m("section",we,[e[18]||(e[18]=L(" Failed to load settings. ",-1)),t("button",{type:"button",class:"ml-2 underline",onClick:re},"Refresh")])):(p(),m("section",he,[t("div",ke,[t("div",Ve,[t("div",Ue,[s(g)?(p(),m("img",{key:0,src:s(g),alt:s(I),class:"h-full w-full object-cover"},null,8,Pe)):(p(),m("div",Ae,c(s(se)),1))]),t("div",Ce,[t("h2",Se,c(s(I)),1),t("p",je,"@"+c(s(b)||"username"),1)])]),t("div",Be,[n(s(Q),{variant:"outline",class:"rounded-full",type:"button",disabled:s(N),onClick:ne},{default:q(()=>[L(c(s(N)?"Uploading...":"Upload avatar"),1)]),_:1},8,["disabled"]),t("input",{ref_key:"avatarInput",ref:F,type:"file",accept:"image/*",class:"hidden",onChange:de},null,544),s(P)?(p(),m("p",Ee,c(s(P)),1)):K("",!0)])]),t("div",Fe,[t("div",Ne,[e[19]||(e[19]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Username ",-1)),n(s(f),{modelValue:s(b),"onUpdate:modelValue":e[0]||(e[0]=l=>i(b)?b.value=l:null),type:"text",placeholder:"my_username",autocomplete:"off"},null,8,["modelValue"]),s(z)?(p(),m("p",Me,c(s(z)),1)):K("",!0)]),t("div",Re,[e[20]||(e[20]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Bio ",-1)),n(s(xe),{modelValue:s(x),"onUpdate:modelValue":e[1]||(e[1]=l=>i(x)?x.value=l:null),rows:5,maxlength:"500",placeholder:"Tell about yourself"},null,8,["modelValue"]),t("div",Te,[s(H)?(p(),m("p",Le,c(s(H)),1)):K("",!0),t("span",De,c(s(x).length)+"/500",1)])])])])),t("section",Ie,[e[26]||(e[26]=t("div",null,[t("h2",{class:"text-lg font-bold text-foreground"},"Account"),t("p",{class:"text-sm text-muted-foreground"}," Email and password updates will be available soon. ")],-1)),t("div",$e,[t("div",ze,[e[21]||(e[21]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Current Email ",-1)),n(s(f),{modelValue:s(C),"onUpdate:modelValue":e[2]||(e[2]=l=>i(C)?C.value=l:null),type:"email",placeholder:"name@example.com",disabled:""},null,8,["modelValue"])]),t("div",He,[e[22]||(e[22]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," New Email ",-1)),n(s(f),{modelValue:s(S),"onUpdate:modelValue":e[3]||(e[3]=l=>i(S)?S.value=l:null),type:"email",placeholder:"name@example.com",disabled:""},null,8,["modelValue"])])]),t("div",Oe,[t("div",qe,[e[23]||(e[23]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Current Password ",-1)),n(s(f),{modelValue:s(j),"onUpdate:modelValue":e[4]||(e[4]=l=>i(j)?j.value=l:null),type:"password",placeholder:"••••••••",disabled:""},null,8,["modelValue"])]),t("div",Ke,[e[24]||(e[24]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," New Password ",-1)),n(s(f),{modelValue:s(B),"onUpdate:modelValue":e[5]||(e[5]=l=>i(B)?B.value=l:null),type:"password",placeholder:"••••••••",disabled:""},null,8,["modelValue"])]),t("div",Xe,[e[25]||(e[25]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Confirm Password ",-1)),n(s(f),{modelValue:s(E),"onUpdate:modelValue":e[6]||(e[6]=l=>i(E)?E.value=l:null),type:"password",placeholder:"••••••••",disabled:""},null,8,["modelValue"])])])]),t("section",Ze,[e[28]||(e[28]=t("div",null,[t("h2",{class:"text-lg font-bold text-foreground"},"Notifications"),t("p",{class:"text-sm text-muted-foreground"}," Choose how we notify you about updates. ")],-1)),t("label",Ge,[X(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>i(V)?V.value=l:null),type:"checkbox",class:"mt-0.5 h-4 w-4 accent-primary"},null,512),[[W,s(V)]]),e[27]||(e[27]=t("span",null,"Enable notifications",-1))])]),t("section",Je,[e[32]||(e[32]=t("div",null,[t("h2",{class:"text-lg font-bold text-foreground"},"Social Links"),t("p",{class:"text-sm text-muted-foreground"}," Required for Buddy Finder. ")],-1)),t("div",Qe,[t("div",We,[e[29]||(e[29]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"},"Telegram",-1)),n(s(f),{modelValue:s(_),"onUpdate:modelValue":e[8]||(e[8]=l=>i(_)?_.value=l:null),type:"text",placeholder:"@username"},null,8,["modelValue"])]),t("div",Ye,[e[30]||(e[30]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"},"VK",-1)),n(s(f),{modelValue:s(w),"onUpdate:modelValue":e[9]||(e[9]=l=>i(w)?w.value=l:null),type:"text",placeholder:"id or username"},null,8,["modelValue"])]),t("div",et,[e[31]||(e[31]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"},"Instagram",-1)),n(s(f),{modelValue:s(h),"onUpdate:modelValue":e[10]||(e[10]=l=>i(h)?h.value=l:null),type:"text",placeholder:"@username"},null,8,["modelValue"])])])]),t("section",tt,[e[36]||(e[36]=t("h2",{class:"text-lg font-bold text-foreground"},"Privacy",-1)),t("div",st,[t("div",lt,[e[34]||(e[34]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Profile visibility ",-1)),X(t("select",{"onUpdate:modelValue":e[11]||(e[11]=l=>i(U)?U.value=l:null),class:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm"},[...e[33]||(e[33]=[t("option",{value:"public"},"Public",-1),t("option",{value:"nobody"},"Hidden",-1)])],512),[[be,s(U)]])])]),t("label",ot,[X(t("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>i(k)?k.value=l:null),type:"checkbox",class:"mt-0.5 h-4 w-4 accent-primary"},null,512),[[W,s(k)]]),e[35]||(e[35]=t("span",null,"Show contacts only to Matches",-1))]),t("div",at,[t("p",rt,c(s(R)),1),n(s(Q),{class:"rounded-full px-5",type:"button",disabled:!s(J),onClick:ce},{default:q(()=>[L(c(s(M)?"Saving...":"Save"),1)]),_:1},8,["disabled"])])])])}}}),it={class:"page-wrapper"},pt=Y({__name:"index",setup(ee){return(d,Z)=>(p(),m("div",it,[n(nt)]))}});export{pt as default};
