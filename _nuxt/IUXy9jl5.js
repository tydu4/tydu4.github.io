import{d as q,c as g,a as r,F as B,D as I,t as $,b,u,w as C,o as d,E as K,f as z,B as A,j as P,n as X,e as D,r as k,k as me,T as ue,A as Oe,O as Ee,aa as Ie,J as Le,K as G,a3 as Ue}from"./DXztqjCQ.js";import{H as ze,d as Ae}from"./DMGK1GPA.js";import{u as Pe}from"./BPhWFNZq.js";import De from"./B_ybT7kY.js";import{E as qe,S as de}from"./CM5Qibd1.js";import{S as ce}from"./Cw-xcs6-.js";import{S as Ve}from"./BCI1LTVQ.js";import{S as je}from"./Bw-WnDok.js";import{X as _e}from"./pIa8rBID.js";import{d as He}from"./Bs8T81Ad.js";import"./DlAUqK2U.js";import"./CQBiaOXw.js";import"./CG4HLnLt.js";import"./DTwSdy3O.js";import"./BVpqY5PZ.js";import"./DJXsfEn5.js";import"./BtdQ4RrR.js";const Je={class:"space-y-5 rounded-2xl border border-border bg-card p-4 shadow-soft"},Qe={class:"space-y-2"},Ye={class:"grid grid-cols-3 gap-1 rounded-xl border border-border bg-background p-1"},Ge=["onClick"],Ke={class:"space-y-2"},Xe={class:"grid grid-cols-2 gap-2"},Ze={class:"space-y-1"},We=["value"],et={class:"space-y-1"},tt=["value"],st={class:"space-y-2"},rt={class:"grid grid-cols-1 gap-2 sm:grid-cols-2"},nt={class:"space-y-1"},at=["value"],ot={class:"space-y-1"},it=["value"],lt={class:"space-y-2"},ut={class:"flex items-center justify-between gap-2"},dt={class:"text-[11px] text-muted-foreground"},ct={key:0,class:"text-xs text-muted-foreground"},gt={key:1,class:"text-xs text-destructive"},mt={key:2,class:"grid grid-cols-2 gap-2"},pt=["onClick"],ge=q({__name:"CatalogFilters",props:{searchType:{},searchTypeOptions:{},priceRange:{},dateRange:{},selectedTags:{},tagOptions:{},tagsLoading:{type:Boolean,default:!1},tagsError:{default:""}},emits:["update:searchType","update:priceRange","update:dateRange","update:selectedTags","reset"],setup(n,{emit:M}){const p=n,c=M,R=P(()=>new Set(p.selectedTags)),f=x=>{const a=x.trim();if(!a)return null;const l=Number(a);return!Number.isFinite(l)||l<0?null:Math.round(l)},y=x=>{const a=f(x),l=p.priceRange.max;if(a!==null&&l!==null&&a>l){c("update:priceRange",{min:a,max:a});return}c("update:priceRange",{min:a,max:l})},w=x=>{const a=f(x),l=p.priceRange.min;if(a!==null&&l!==null&&a<l){c("update:priceRange",{min:a,max:a});return}c("update:priceRange",{min:l,max:a})},i=(x,a)=>{const l={from:p.dateRange.from,to:p.dateRange.to,[x]:a};l.from&&l.to&&l.from>l.to&&(x==="from"&&(l.to=a),x==="to"&&(l.from=a)),c("update:dateRange",l)},s=x=>{if(R.value.has(x)){c("update:selectedTags",p.selectedTags.filter(a=>a!==x));return}c("update:selectedTags",[...p.selectedTags,x])};return(x,a)=>(d(),g("section",Je,[r("div",Qe,[a[5]||(a[5]=r("p",{class:"text-xs font-semibold uppercase tracking-[0.14em] text-muted-foreground"}," Search Type ",-1)),r("div",Ye,[(d(!0),g(B,null,I(n.searchTypeOptions,l=>(d(),g("button",{key:l.value,type:"button",class:K(["rounded-lg px-2 py-2 text-xs font-semibold transition-colors",n.searchType===l.value?"bg-primary text-primary-foreground":"text-muted-foreground hover:bg-muted hover:text-foreground"]),onClick:S=>c("update:searchType",l.value)},$(l.label),11,Ge))),128))])]),r("div",Ke,[a[8]||(a[8]=r("p",{class:"text-xs font-semibold uppercase tracking-[0.14em] text-muted-foreground"}," Price Range ",-1)),r("div",Xe,[r("label",Ze,[a[6]||(a[6]=r("span",{class:"text-[11px] text-muted-foreground"},"Min",-1)),r("input",{type:"number",min:"0",value:n.priceRange.min??"",class:"h-10 w-full rounded-lg border border-input bg-background px-3 text-sm text-foreground outline-none ring-offset-background transition focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:"0",onInput:a[0]||(a[0]=l=>y(l.target.value))},null,40,We)]),r("label",et,[a[7]||(a[7]=r("span",{class:"text-[11px] text-muted-foreground"},"Max",-1)),r("input",{type:"number",min:"0",value:n.priceRange.max??"",class:"h-10 w-full rounded-lg border border-input bg-background px-3 text-sm text-foreground outline-none ring-offset-background transition focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:"Any",onInput:a[1]||(a[1]=l=>w(l.target.value))},null,40,tt)])])]),r("div",st,[a[11]||(a[11]=r("p",{class:"text-xs font-semibold uppercase tracking-[0.14em] text-muted-foreground"}," Date Range ",-1)),r("div",rt,[r("label",nt,[a[9]||(a[9]=r("span",{class:"text-[11px] text-muted-foreground"},"From",-1)),r("input",{type:"date",value:n.dateRange.from,class:"h-10 w-full rounded-lg border border-input bg-background px-3 text-sm text-foreground outline-none ring-offset-background transition focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",onInput:a[2]||(a[2]=l=>i("from",l.target.value))},null,40,at)]),r("label",ot,[a[10]||(a[10]=r("span",{class:"text-[11px] text-muted-foreground"},"To",-1)),r("input",{type:"date",value:n.dateRange.to,class:"h-10 w-full rounded-lg border border-input bg-background px-3 text-sm text-foreground outline-none ring-offset-background transition focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",onInput:a[3]||(a[3]=l=>i("to",l.target.value))},null,40,it)])])]),r("div",lt,[r("div",ut,[a[12]||(a[12]=r("p",{class:"text-xs font-semibold uppercase tracking-[0.14em] text-muted-foreground"}," Categories ",-1)),r("span",dt,$(n.selectedTags.length)+" selected",1)]),n.tagsLoading&&!n.tagOptions.length?(d(),g("p",ct," Loading categories... ")):n.tagsError?(d(),g("p",gt,$(n.tagsError),1)):(d(),g("div",mt,[(d(!0),g(B,null,I(n.tagOptions,l=>(d(),g("button",{key:l.slug,type:"button",class:K(["truncate rounded-full border px-3 py-1.5 text-xs font-medium transition-colors",u(R).has(l.slug)?"border-primary bg-primary text-primary-foreground":"border-border bg-background text-muted-foreground hover:text-foreground"]),onClick:S=>s(l.slug)},$(l.name),11,pt))),128))]))]),b(u(A),{variant:"outline",class:"w-full",onClick:a[4]||(a[4]=l=>c("reset"))},{default:C(()=>[...a[13]||(a[13]=[z(" Reset Filters ",-1)])]),_:1})]))}}),ft={class:"space-y-4"},yt={class:"flex flex-wrap items-center justify-between gap-3 rounded-2xl border border-border bg-card px-4 py-3"},vt={class:"text-sm font-semibold text-foreground"},xt={class:"inline-flex items-center gap-2 text-xs text-muted-foreground"},bt=["value"],ht=["value"],kt={key:0,class:"rounded-2xl border border-destructive/30 bg-destructive/10 px-4 py-3 text-sm text-destructive"},Rt={key:1,class:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3"},wt={key:0,class:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3"},Tt={key:1,class:"rounded-2xl border border-border bg-card px-4 py-10 text-center"},St={key:3,class:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3"},$t={key:4,class:"py-2 text-center text-xs uppercase tracking-[0.14em] text-muted-foreground"},Mt=q({__name:"CatalogGrid",props:{events:{},totalMatched:{},sortBy:{},sortOptions:{},isInitialLoading:{type:Boolean},isFetchingMore:{type:Boolean},hasMore:{type:Boolean},errorMessage:{}},emits:["update:sortBy","update:sentinel","clear:filters"],setup(n,{emit:M}){const p=M,c=k(null);return X(c,R=>{p("update:sentinel",R)},{immediate:!0}),(R,f)=>(d(),g("section",ft,[r("header",yt,[r("div",null,[f[2]||(f[2]=r("p",{class:"text-xs uppercase tracking-[0.14em] text-muted-foreground"},"Catalog",-1)),r("p",vt,$(n.totalMatched)+" loaded ",1)]),r("label",xt,[f[3]||(f[3]=r("span",null,"Sort by",-1)),r("select",{value:n.sortBy,class:"h-9 rounded-lg border border-input bg-background px-2.5 text-sm text-foreground outline-none ring-offset-background transition focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",onChange:f[0]||(f[0]=y=>p("update:sortBy",y.target.value))},[(d(!0),g(B,null,I(n.sortOptions,y=>(d(),g("option",{key:y.value,value:y.value},$(y.label),9,ht))),128))],40,bt)])]),n.errorMessage?(d(),g("div",kt,$(n.errorMessage),1)):D("",!0),n.isInitialLoading?(d(),g("div",Rt,[(d(),g(B,null,I(9,y=>b(de,{key:`catalog-initial-skeleton-${y}`})),64))])):(d(),g(B,{key:2},[n.events.length?(d(),g("div",wt,[(d(!0),g(B,null,I(n.events,y=>(d(),me(qe,{key:y.uuid,event:y,"show-tags":!0,"show-price":!0,"show-organizer-rating":!0},null,8,["event"]))),128))])):(d(),g("div",Tt,[f[5]||(f[5]=r("p",{class:"text-sm font-semibold text-foreground"},"No results found",-1)),f[6]||(f[6]=r("p",{class:"mt-1 text-sm text-muted-foreground"}," Try broadening your query or clearing active filters. ",-1)),b(u(A),{variant:"outline",class:"mt-4",onClick:f[1]||(f[1]=y=>p("clear:filters"))},{default:C(()=>[...f[4]||(f[4]=[z(" Clear filters ",-1)])]),_:1})]))],64)),r("div",{ref_key:"sentinelEl",ref:c,class:"h-1 w-full"},null,512),n.isFetchingMore&&!n.isInitialLoading?(d(),g("div",St,[(d(),g(B,null,I(3,y=>b(de,{key:`catalog-more-skeleton-${y}`})),64))])):!n.hasMore&&n.events.length?(d(),g("p",$t," You have reached the end of the catalog ")):D("",!0)]))}}),Nt={class:"-mx-4 bg-background"},Bt={class:"mx-auto max-w-7xl space-y-5 px-4 pb-12 sm:px-6 lg:px-8"},Ft={class:"space-y-4 rounded-3xl border border-border bg-card p-4 shadow-soft sm:p-5"},Ct={class:"flex flex-wrap items-start justify-between gap-3"},Ot={class:"inline-flex items-center gap-2 rounded-full border border-border bg-background px-3 py-1 text-xs"},Et={class:"font-medium text-foreground"},It={class:"relative"},Lt={class:"inline-flex items-center gap-1"},Ut={class:"lg:hidden"},zt={key:0,class:"ml-1 rounded-full bg-primary px-1.5 py-0.5 text-[10px] text-primary-foreground"},At={class:"grid gap-6 lg:grid-cols-[19rem_minmax(0,1fr)]"},Pt={class:"hidden lg:block"},Dt={class:"sticky top-24"},qt={key:0,class:"fixed inset-x-0 bottom-0 z-[95] max-h-[85dvh] overflow-y-auto rounded-t-3xl border border-border bg-card p-4 shadow-elevated lg:hidden"},Vt={class:"mb-4 flex items-center justify-between"},jt=q({__name:"CatalogMainBlock",props:{events:{},filters:{},searchTypeOptions:{},sortOptions:{},tagOptions:{},totalMatched:{},isSemanticActive:{type:Boolean},tagsLoading:{type:Boolean},tagsError:{},isInitialLoading:{type:Boolean},isFetchingMore:{type:Boolean},hasMore:{type:Boolean},errorMessage:{}},emits:["update:search","update:type","update:priceRange","update:dates","update:tags","update:sortBy","reset:filters","update:sentinel"],setup(n,{emit:M}){const p=n,c=M,R=k(!1),f=P(()=>{let w=0;return p.filters.search.trim()&&(w+=1),p.filters.type!=="events"&&(w+=1),(p.filters.priceRange.min!==null||p.filters.priceRange.max!==null)&&(w+=1),(p.filters.dates.from||p.filters.dates.to)&&(w+=1),p.filters.tags.length&&(w+=1),p.filters.sortBy!=="date_asc"&&(w+=1),w}),y=()=>{c("reset:filters")};return(w,i)=>(d(),g(B,null,[r("div",Nt,[r("div",Bt,[r("header",Ft,[r("div",Ct,[i[15]||(i[15]=r("div",null,[r("h1",{class:"text-2xl font-bold text-foreground"},"Discovery Catalog"),r("p",{class:"mt-1 text-sm text-muted-foreground"}," Explore events with live filters and infinite browsing. ")],-1)),r("div",Ot,[b(u(ce),{class:"h-3.5 w-3.5 text-primary"}),r("span",Et,$(n.totalMatched)+" loaded",1)])]),r("div",It,[b(u(Ve),{class:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),b(u(De),{"model-value":n.filters.search,type:"search",class:"h-11 rounded-xl pl-10 pr-10",placeholder:"Try: sing songs, startup networking, art with live music...","onUpdate:modelValue":i[0]||(i[0]=s=>c("update:search",s))},null,8,["model-value"]),r("div",{class:K(["pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 rounded-full border px-2 py-1 text-[11px]",n.isSemanticActive?"border-primary/40 bg-primary/10 text-primary":"border-border bg-background text-muted-foreground"])},[r("span",Lt,[b(u(ce),{class:"h-3 w-3"}),i[16]||(i[16]=z(" Magic ",-1))])],2)])]),r("div",Ut,[b(u(A),{variant:"outline",class:"h-9 rounded-full px-3 text-xs",onClick:i[1]||(i[1]=s=>R.value=!0)},{default:C(()=>[b(u(je),{class:"mr-1 h-3.5 w-3.5"}),i[17]||(i[17]=z(" Filters ",-1)),u(f)?(d(),g("span",zt,$(u(f)),1)):D("",!0)]),_:1})]),r("div",At,[r("aside",Pt,[r("div",Dt,[b(ge,{"search-type":n.filters.type,"search-type-options":n.searchTypeOptions,"price-range":n.filters.priceRange,"date-range":n.filters.dates,"selected-tags":n.filters.tags,"tag-options":n.tagOptions,"tags-loading":n.tagsLoading,"tags-error":n.tagsError,"onUpdate:searchType":i[2]||(i[2]=s=>c("update:type",s)),"onUpdate:priceRange":i[3]||(i[3]=s=>c("update:priceRange",s)),"onUpdate:dateRange":i[4]||(i[4]=s=>c("update:dates",s)),"onUpdate:selectedTags":i[5]||(i[5]=s=>c("update:tags",s)),onReset:y},null,8,["search-type","search-type-options","price-range","date-range","selected-tags","tag-options","tags-loading","tags-error"])])]),b(Mt,{events:n.events,"total-matched":n.totalMatched,"sort-by":n.filters.sortBy,"sort-options":n.sortOptions,"is-initial-loading":n.isInitialLoading,"is-fetching-more":n.isFetchingMore,"has-more":n.hasMore,"error-message":n.errorMessage,"onUpdate:sortBy":i[6]||(i[6]=s=>c("update:sortBy",s)),"onClear:filters":y,"onUpdate:sentinel":i[7]||(i[7]=s=>c("update:sentinel",s))},null,8,["events","total-matched","sort-by","sort-options","is-initial-loading","is-fetching-more","has-more","error-message"])])])]),(d(),me(Oe,{to:"body"},[b(ue,{"enter-active-class":"transition-opacity duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:C(()=>[u(R)?(d(),g("div",{key:0,class:"fixed inset-0 z-[90] bg-black/55 lg:hidden",onClick:i[8]||(i[8]=s=>R.value=!1)})):D("",!0)]),_:1}),b(ue,{"enter-active-class":"transition-transform duration-250 ease-out","enter-from-class":"translate-y-full","enter-to-class":"translate-y-0","leave-active-class":"transition-transform duration-200 ease-in","leave-from-class":"translate-y-0","leave-to-class":"translate-y-full"},{default:C(()=>[u(R)?(d(),g("section",qt,[r("div",Vt,[i[18]||(i[18]=r("div",null,[r("h2",{class:"text-lg font-semibold text-foreground"},"Filters"),r("p",{class:"text-xs text-muted-foreground"},"Tune the discovery feed for your intent")],-1)),b(u(A),{variant:"ghost",size:"icon",class:"rounded-full",onClick:i[9]||(i[9]=s=>R.value=!1)},{default:C(()=>[b(u(_e),{class:"h-4 w-4"})]),_:1})]),b(ge,{"search-type":n.filters.type,"search-type-options":n.searchTypeOptions,"price-range":n.filters.priceRange,"date-range":n.filters.dates,"selected-tags":n.filters.tags,"tag-options":n.tagOptions,"tags-loading":n.tagsLoading,"tags-error":n.tagsError,"onUpdate:searchType":i[10]||(i[10]=s=>c("update:type",s)),"onUpdate:priceRange":i[11]||(i[11]=s=>c("update:priceRange",s)),"onUpdate:dateRange":i[12]||(i[12]=s=>c("update:dates",s)),"onUpdate:selectedTags":i[13]||(i[13]=s=>c("update:tags",s)),onReset:y},null,8,["search-type","search-type-options","price-range","date-range","selected-tags","tag-options","tags-loading","tags-error"]),b(u(A),{class:"mt-4 w-full",onClick:i[14]||(i[14]=s=>R.value=!1)},{default:C(()=>[...i[19]||(i[19]=[z(" Apply ",-1)])]),_:1})])):D("",!0)]),_:1})]))],64))}}),_t={class:"page-wrapper bg-background"},Ht={class:"flex min-h-[calc(100dvh-9rem)] flex-col gap-4 lg:flex-row lg:items-start lg:gap-6"},Jt={class:"min-w-0 flex-1"},U=12,cs=q({__name:"index",setup(n){const M=[{value:"events",label:"Events"},{value:"venues",label:"Venues"},{value:"organizers",label:"Organizers"}],p=[{value:"date_asc",label:"Date: Soonest"},{value:"date_desc",label:"Date: Latest"},{value:"price_asc",label:"Price: Low to High"},{value:"created_at_desc",label:"Newest"},{value:"popularity",label:"Most Popular"}],c=new Set(M.map(e=>e.value)),R=new Set(p.map(e=>e.value)),f=()=>({search:"",type:"events",priceRange:{min:null,max:null},dates:{from:"",to:""},tags:[],sortBy:"date_asc"}),y=Ee(),w=Ie(),i=Le(),s=Ue(f()),x=k([]),a=k(0),l=k(0),S=k(!0),L=k(!1),O=k(!1),V=k(""),F=k(0),j=k([]),_=k(!1),H=k(""),Z=k(null),J=k(!1),W=P(()=>s.search.trim().split(/\s+/).filter(Boolean).length>=2),E=e=>Array.isArray(e)?String(e[0]??""):typeof e=="string"?e:"",ee=e=>{const t=Number(E(e).trim());return!Number.isFinite(t)||t<0?null:Math.round(t)},te=e=>{const t=E(e).trim();return t&&/^\d{4}-\d{2}-\d{2}$/.test(t)?t:""},pe=e=>{const t=E(e);return c.has(t)?t:"events"},fe=e=>{const t=E(e);return R.has(t)?t:"date_asc"},ye=e=>{const t=Array.isArray(e)?e.map(o=>String(o??"")).join(","):E(e);return Array.from(new Set(t.split(",").map(o=>o.trim()).filter(Boolean)))},Q=e=>{let t=ee(e.min),o=ee(e.max);return t!==null&&o!==null&&t>o&&([t,o]=[o,t]),{search:E(e.q).trim(),type:pe(e.type),priceRange:{min:t,max:o},dates:{from:te(e.from),to:te(e.to)},tags:ye(e.tags),sortBy:fe(e.sort)}},Y=e=>{s.search=e.search,s.type=e.type,s.priceRange={...e.priceRange},s.dates={...e.dates},s.tags=[...e.tags],s.sortBy=e.sortBy};Y(Q(y.query));const se=e=>JSON.stringify({search:e.search.trim(),type:e.type,min:e.priceRange.min,max:e.priceRange.max,from:e.dates.from,to:e.dates.to,tags:[...e.tags].sort(),sortBy:e.sortBy}),re=P(()=>se(s)),ne=e=>{const t={};return e.search.trim()&&(t.q=e.search.trim()),e.type!=="events"&&(t.type=e.type),e.priceRange.min!==null&&(t.min=String(e.priceRange.min)),e.priceRange.max!==null&&(t.max=String(e.priceRange.max)),e.dates.from&&(t.from=e.dates.from),e.dates.to&&(t.to=e.dates.to),e.tags.length&&(t.tags=e.tags.join(",")),e.sortBy!=="date_asc"&&(t.sort=e.sortBy),t},ve=async()=>{const e=ne(s),t=ne(Q(y.query));if(JSON.stringify(t)!==JSON.stringify(e)){J.value=!0;try{await w.replace({query:e})}finally{J.value=!1}}},ae=e=>e.trim().toLowerCase().replace(/\s+/g,"-"),xe=e=>{if(!s.tags.length)return!0;const t=new Set((e.tags??[]).map(o=>ae(o)));return s.tags.every(o=>t.has(ae(o)))},be=e=>{const t=Number(e.price??0);return!(s.priceRange.min!==null&&t<s.priceRange.min||s.priceRange.max!==null&&t>s.priceRange.max)},he=e=>{const t=e.start_time?.slice(0,10)??"";return!(s.dates.from&&(!t||t<s.dates.from)||s.dates.to&&(!t||t>s.dates.to))},oe=(e,t)=>{const o=[...e],m=v=>{if(!v.start_time)return Number.POSITIVE_INFINITY;const h=new Date(v.start_time).getTime();return Number.isFinite(h)?h:Number.POSITIVE_INFINITY},T=v=>{if(!v.start_time)return-1;const h=new Date(v.start_time).getTime();return Number.isFinite(h)?h:-1},N=v=>Number(v.price??0);return t==="date_asc"?o.sort((v,h)=>m(v)-m(h)):t==="date_desc"?o.sort((v,h)=>T(h)-T(v)):t==="price_asc"?o.sort((v,h)=>N(v)-N(h)||m(v)-m(h)):t==="created_at_desc"?o.sort((v,h)=>Number(h.trending_score??0)-Number(v.trending_score??0)):o.sort((v,h)=>Number(h.going_count??0)-Number(v.going_count??0)||Number(h.trending_score??0)-Number(v.trending_score??0))},ie=e=>e.filter(t=>xe(t)&&be(t)&&he(t)),ke=e=>{const t=e.occurrences??[];return t.length?[...t].map(o=>o.start_time).filter(Boolean).sort()[0]??null:null},Re=e=>{const t=(e.tickets??[]).map(o=>Number(o.price)).filter(o=>Number.isFinite(o));return t.length?Math.min(...t):0},we=e=>({id:e.id,uuid:e.uuid,title:e.title,description:e.description??null,slug:e.slug,main_image:e.images?.[0]?.url??null,venue_name:e.default_venue?.name??e.occurrences?.[0]?.location_name??null,city:e.default_venue?.city?.trim()||e.occurrences?.[0]?.venue?.city?.trim()||"City not set",start_time:ke(e),tags:(e.tags??[]).map(t=>t.name),price:Re(e),rating:Number(e.organizer?.rating??0),going_count:0,going_avatars:[],trending_score:Number(e.quality_score??0),friends_summary:e.organizer?.name?`By ${e.organizer.name}`:null}),Te=e=>({...e,city:e.city||"City not set",tags:e.tags??[],price:e.price??null,rating:Number(e.rating??0),going_count:e.going_count??0,going_avatars:e.going_avatars??[],trending_score:Number(e.trending_score??0),friends_summary:e.friends_summary??null}),Se=e=>e==="venues"?"venue":e==="organizers"?"organizer":"event",$e=async e=>{const t=e*U,o=s.search.trim();if(W.value&&o){const v=await i.apiFetch("/api/v1/discovery/search",{baseURL:G("/api/v1/discovery/search"),query:{q:o,semantic:!0,skip:t,limit:U}}),h=v.map(Te);return{items:oe(ie(h),s.sortBy),hasMore:v.length===U}}const m={skip:t,limit:U,search_type:Se(s.type),sort_by:s.sortBy};o&&(m.q=o),s.priceRange.min!==null&&(m.min_price=s.priceRange.min),s.priceRange.max!==null&&(m.max_price=s.priceRange.max),s.dates.from&&(m.start_date=s.dates.from),s.dates.to&&(m.end_date=s.dates.to),s.tags.length&&(m.tag_slug=s.tags[0]);const T=await i.apiFetch("/api/v1/events/",{baseURL:G("/api/v1/events/"),query:m}),N=T.map(we);return{items:oe(ie(N),s.sortBy),hasMore:T.length===U}},le=async({token:e=F.value}={})=>{if(O.value||!S.value)return;O.value=!0;const t=l.value;try{const o=await $e(t);if(e!==F.value)return;const m=new Set(x.value.map(N=>N.uuid)),T=o.items.filter(N=>!m.has(N.uuid));x.value=[...x.value,...T],l.value=t+1,S.value=o.hasMore,a.value=x.value.length}catch{if(e!==F.value)return;V.value="Could not load catalog events. Please try again.",S.value=!1}finally{e===F.value&&(O.value=!1)}},Me=async()=>{F.value+=1;const e=F.value;x.value=[],a.value=0,l.value=0,S.value=!0,V.value="",L.value=!0,await le({token:e}),e===F.value&&(L.value=!1)},Ne=He(()=>{ve(),Me()},320);X(re,()=>{Ne()},{immediate:!0}),X(()=>y.query,e=>{if(J.value)return;const t=Q(e);se(t)!==re.value&&Y(t)});const Be=e=>{const t=[...e.personalized??[],...e.trending??[],...e.all??[]],o=new Map;return t.forEach(m=>{m?.slug&&(o.has(m.slug)||o.set(m.slug,{slug:m.slug,name:m.name,category:m.category??null,weight:Number(m.weight??0)}))}),[...o.values()].sort((m,T)=>Number(T.weight??0)-Number(m.weight??0)||m.name.localeCompare(T.name))};(async()=>{_.value=!0,H.value="";try{const e=await i.apiFetch("/api/v1/events/tags",{baseURL:G("/api/v1/events/tags"),query:{limit:120,personalized_limit:40,trending_limit:40}});j.value=Be(e)}catch{j.value=[],H.value="Failed to load categories."}finally{_.value=!1}})();const Fe=e=>{Z.value=e},Ce=()=>{Y(f())};return Pe(Z,()=>{L.value||O.value||!S.value||le()},{rootMargin:"320px 0px",enabled:P(()=>!L.value&&!O.value&&S.value)}),(e,t)=>(d(),g("div",_t,[r("div",Ht,[b(ze,{items:u(Ae),class:"shrink-0"},null,8,["items"]),r("div",Jt,[b(jt,{events:u(x),filters:u(s),"search-type-options":M,"sort-options":p,"tag-options":u(j),"total-matched":u(a),"is-semantic-active":u(W),"tags-loading":u(_),"tags-error":u(H),"is-initial-loading":u(L),"is-fetching-more":u(O),"has-more":u(S),"error-message":u(V),"onUpdate:search":t[0]||(t[0]=o=>u(s).search=o),"onUpdate:type":t[1]||(t[1]=o=>u(s).type=o),"onUpdate:priceRange":t[2]||(t[2]=o=>u(s).priceRange=o),"onUpdate:dates":t[3]||(t[3]=o=>u(s).dates=o),"onUpdate:tags":t[4]||(t[4]=o=>u(s).tags=o),"onUpdate:sortBy":t[5]||(t[5]=o=>u(s).sortBy=o),"onReset:filters":Ce,"onUpdate:sentinel":Fe},null,8,["events","filters","tag-options","total-matched","is-semantic-active","tags-loading","tags-error","is-initial-loading","is-fetching-more","has-more","error-message"])])])]))}});export{cs as default};
