import{d as I,j as l,c as i,q as _,m as t,a as e,k as v,e as j,t as f,f as T,o,J as S,a2 as E,K as H,z as D,b as u,F as B,p as F,r as z}from"./DIpL79ME.js";import{S as c}from"./BHLqxRoQ.js";import{H as P,c as V}from"./DS9zloey.js";import{c as U}from"./Ck3zTzEc.js";import{T as W}from"./DaLxu3sz.js";import"./DlAUqK2U.js";import"./DSoaomjP.js";import"./BTA2ybKl.js";import"./BwSGWVKi.js";import"./CnmEv5PP.js";import"./Dh-MwfXC.js";import"./NaR5TDkT.js";import"./5jP3ovOk.js";const q=U("award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);const X=U("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);const J=U("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]),O={class:"flex items-center gap-1.5"},K={class:"w-5 text-xs font-semibold tabular-nums text-foreground"},Z={key:2,class:"inline-flex h-3 w-3 items-center justify-center"},G={class:"flex min-w-0 items-center gap-2"},Q={class:"h-8 w-8 overflow-hidden rounded-full border border-border bg-muted"},Y=["src","alt"],ee={key:1,class:"flex h-full w-full items-center justify-center bg-primary/10 text-[11px] font-semibold text-primary"},te={class:"min-w-0"},re={class:"truncate text-sm font-medium leading-tight text-foreground"},ae={class:"text-center text-xs font-semibold tabular-nums text-foreground"},se={class:"text-right font-mono text-xs font-bold tabular-nums text-foreground sm:text-sm"},A=I({__name:"LeaderboardRow",props:{entry:{default:null},user:{default:null},isCurrentUser:{type:Boolean,default:!1},isFooter:{type:Boolean,default:!1}},setup(R){const a=R,x=r=>!r||r==="same"?0:r.startsWith("+")?Number(r.slice(1))||0:r.startsWith("-")?-(Number(r.slice(1))||0):0,s=l(()=>{if(a.entry)return{rank:Number.isFinite(a.entry.rank)?Math.max(0,Math.floor(a.entry.rank)):0,user_id:Number.isFinite(a.entry.user_id)?Math.max(0,Math.floor(a.entry.user_id)):0,username:a.entry.username||"user",full_name:a.entry.full_name??null,avatar_url:a.entry.avatar_url??null,level:Number.isFinite(a.entry.level)?Math.max(0,Math.floor(a.entry.level)):0,exp:Number.isFinite(a.entry.exp)?Math.max(0,Math.floor(a.entry.exp)):0,rank_delta:Number.isFinite(a.entry.rank_delta)?Math.trunc(a.entry.rank_delta):0,league_name:a.entry.league_name||"Bronze",is_highlighted:!!a.entry.is_highlighted};const r=a.user,n=Number(r?.id);return{rank:Math.max(0,Math.floor(r?.rank||0)),user_id:Number.isFinite(n)?Math.max(0,Math.floor(n)):0,username:r?.name?.trim().toLowerCase().replace(/\s+/g,"_")||"user",full_name:r?.name?.trim()||null,avatar_url:r?.avatar||null,level:Math.max(0,Math.floor(r?.level||0)),exp:Math.max(0,Math.floor(r?.xp||0)),rank_delta:x(r?.trend),league_name:"Bronze",is_highlighted:!!a.isCurrentUser}}),g=l(()=>s.value.full_name?.trim()||s.value.username),M=l(()=>g.value.split(/[\s_-]+/).filter(Boolean).slice(0,2).map(r=>r[0]?.toUpperCase()||"").join("")||"U"),m=l(()=>Math.trunc(s.value.rank_delta||0)),y=l(()=>s.value.league_name?.trim()||"Bronze"),L=l(()=>a.isCurrentUser||s.value.is_highlighted),h=r=>new Intl.NumberFormat("en-US").format(Math.max(0,Math.floor(r))),k=l(()=>s.value.rank===1?"bg-gradient-to-r from-amber-500/20 to-transparent dark:from-amber-400/10":s.value.rank===2?"bg-gradient-to-r from-slate-500/20 to-transparent dark:from-slate-300/10":s.value.rank===3?"bg-gradient-to-r from-orange-500/20 to-transparent dark:from-orange-400/10":L.value&&!a.isFooter?"bg-primary/10":""),b=l(()=>["grid min-h-[2.875rem] grid-cols-[4.25rem_minmax(0,1fr)_3.5rem_5.75rem] items-center gap-2 px-2.5 py-2 sm:px-3",a.isFooter?"rounded-lg border border-primary/30 bg-primary/5":"border-b border-border/70 last:border-b-0"]),N=l(()=>s.value.rank===1?"text-amber-700 dark:text-amber-300":s.value.rank===2?"text-slate-600 dark:text-slate-200":s.value.rank===3?"text-orange-700 dark:text-orange-300":"text-muted-foreground"),$=l(()=>m.value>0?"text-emerald-700 dark:text-emerald-300":m.value<0?"text-rose-700 dark:text-rose-300":"text-muted-foreground"),w=l(()=>m.value>0?`+${m.value}`:m.value<0?`${m.value}`:"0"),C=l(()=>{const r=y.value.toLowerCase();return r.includes("diamond")?"text-cyan-700/80 dark:text-cyan-300/80":r.includes("platinum")?"text-violet-700/80 dark:text-violet-300/80":r.includes("gold")?"text-amber-700/80 dark:text-amber-300/80":"text-muted-foreground"});return(r,n)=>(o(),i("article",{class:_([t(b),t(k)])},[e("div",O,[t(s).rank<=3?(o(),v(t(q),{key:0,class:_(["h-3.5 w-3.5 shrink-0",t(N)])},null,8,["class"])):j("",!0),e("span",K,f(t(s).rank),1),t(m)!==0?(o(),i("span",{key:1,class:_(["inline-flex items-center gap-0.5 text-[10px] font-semibold tabular-nums",t($)])},[t(m)>0?(o(),v(t(W),{key:0,class:"h-2.5 w-2.5"})):(o(),v(t(J),{key:1,class:"h-2.5 w-2.5"})),T(" "+f(t(w)),1)],2)):(o(),i("span",Z,[...n[0]||(n[0]=[e("span",{class:"h-1.5 w-1.5 rounded-full bg-muted-foreground/80"},null,-1)])]))]),e("div",G,[e("div",Q,[t(s).avatar_url?(o(),i("img",{key:0,src:t(s).avatar_url,alt:t(g),class:"h-full w-full object-cover",loading:"lazy"},null,8,Y)):(o(),i("div",ee,f(t(M)),1))]),e("div",te,[e("p",re,f(t(g)),1),e("p",{class:_(["truncate text-[10px] leading-tight",t(C)])},f(t(y)),3)])]),e("p",ae,f(t(s).level),1),e("p",se,f(h(t(s).exp)),1)],2))}}),oe={class:"page-wrapper pb-[calc(env(safe-area-inset-bottom)+10.25rem)] md:pb-28"},ne={class:"flex min-h-[calc(100dvh-8.5rem)] flex-col gap-4 lg:flex-row lg:items-start lg:gap-6"},le={class:"min-w-0 flex-1 space-y-3"},de={class:"flex flex-wrap items-end justify-between gap-3"},ie={class:"text-xs text-muted-foreground"},ue={class:"inline-flex rounded-lg border border-border bg-card p-0.5"},me=["onClick"],ce={class:"overflow-hidden rounded-2xl border border-border bg-card/80"},pe={key:0,class:"divide-y divide-border/70"},fe={class:"flex items-center gap-2"},xe={class:"space-y-1"},he={key:1,class:"flex flex-col items-start gap-3 px-3 py-5 text-sm text-muted-foreground"},be={key:2,class:"px-3 py-5 text-sm text-muted-foreground"},ge={key:3,class:"max-h-[calc(100dvh-14.75rem)] overflow-y-auto md:max-h-[calc(100dvh-13.5rem)]"},_e={class:"fixed inset-x-0 bottom-[calc(env(safe-area-inset-bottom)+60px)] z-40 border-t-2 border-primary/35 bg-background/80 backdrop-blur-md md:bottom-0"},ve={class:"mx-auto w-full max-w-6xl px-3 py-2 md:px-4"},ye={class:"rounded-xl border border-border bg-card/80 px-2.5 py-2"},ke={class:"mb-1.5 flex items-center justify-between text-[10px] font-semibold uppercase tracking-[0.12em] text-muted-foreground"},we={key:0,class:"grid min-h-[2.875rem] grid-cols-[4.25rem_minmax(0,1fr)_3.5rem_5.75rem] items-center gap-2 px-0.5 py-2"},Me={class:"flex items-center gap-2"},Le={class:"space-y-1"},Ne={key:2,class:"grid min-h-[2.875rem] grid-cols-[4.25rem_minmax(0,1fr)_3.5rem_5.75rem] items-center rounded-lg border border-border/70 bg-muted/20 px-2.5 py-2 text-sm text-muted-foreground"},$e=80,Pe=I({__name:"index",setup(R){const a=[{label:"Weekly",value:"weekly"},{label:"Monthly",value:"monthly"},{label:"Season",value:"season"}],x=z("weekly"),s=S(),g=l(()=>s.token?{Authorization:`Bearer ${s.token}`}:void 0),M=l(()=>({period:x.value,limit:$e})),{data:m,error:y,execute:L}=E("/api/v1/leaderboard",{server:!1,immediate:!1,lazy:!0,watch:!1,query:M,headers:g,baseURL:H("/api/v1/leaderboard"),default:()=>({items:[],total_users:0,period:"weekly",event_id:null,my_rank:null})},"$ZJ-bN_Upt0"),h=z(!0),k=async()=>{h.value=!0;try{await L()}finally{h.value=!1}};D([x,()=>s.token],()=>{k()},{immediate:!0});const b=l(()=>{const n=m.value?.items;return Array.isArray(n)?n:[]}),N=l(()=>a.find(n=>n.value===x.value)?.label??"Weekly"),$=l(()=>{const n=Number(m.value?.total_users),d=Number.isFinite(n)?Math.max(0,Math.floor(n)):0;return new Intl.NumberFormat("en-US").format(d)}),w=l(()=>m.value?.my_rank?m.value.my_rank:b.value.find(n=>n.is_highlighted)??null),C=Array.from({length:12},(n,d)=>d+1),r=n=>{n!==x.value&&(x.value=n)};return(n,d)=>(o(),i("div",oe,[e("div",ne,[u(P,{items:t(V),class:"shrink-0"},null,8,["items"]),e("section",le,[e("header",de,[e("div",null,[d[0]||(d[0]=e("h1",{class:"text-lg font-semibold text-foreground"},"Leaderboard",-1)),e("p",ie,f(t($))+" competitors ranked by XP. ",1)]),e("div",ue,[(o(),i(B,null,F(a,p=>e("button",{key:p.value,type:"button",class:_(["rounded-md px-2.5 py-1 text-xs font-semibold transition-colors",[t(x)===p.value?"bg-primary text-primary-foreground shadow-sm":"text-muted-foreground hover:bg-muted hover:text-foreground"]]),onClick:Ce=>r(p.value)},f(p.label),11,me)),64))])]),e("section",ce,[d[3]||(d[3]=e("header",{class:"grid grid-cols-[4.25rem_minmax(0,1fr)_3.5rem_5.75rem] h-9 items-center border-b border-border bg-muted/40 px-2.5 text-[10px] font-semibold uppercase tracking-[0.12em] text-muted-foreground sm:px-3"},[e("span",null,"Rank"),e("span",null,"User"),e("span",{class:"text-center"},"Lvl"),e("span",{class:"text-right"},"XP")],-1)),t(h)?(o(),i("div",pe,[(o(!0),i(B,null,F(t(C),p=>(o(),i("div",{key:`leaderboard-row-skeleton-${p}`,class:"grid min-h-[2.875rem] grid-cols-[4.25rem_minmax(0,1fr)_3.5rem_5.75rem] items-center gap-2 px-2.5 py-2 sm:px-3"},[u(c,{class:"h-4 w-14","rounded-class":"rounded-md"}),e("div",fe,[u(c,{class:"h-8 w-8","rounded-class":"rounded-full"}),e("div",xe,[u(c,{class:"h-3 w-24","rounded-class":"rounded-md"}),u(c,{class:"h-2.5 w-16","rounded-class":"rounded-md"})])]),u(c,{class:"mx-auto h-4 w-10","rounded-class":"rounded-md"}),u(c,{class:"ml-auto h-4 w-14","rounded-class":"rounded-md"})]))),128))])):t(y)&&!t(b).length?(o(),i("div",he,[d[2]||(d[2]=e("p",null,"Could not load leaderboard data.",-1)),e("button",{type:"button",class:"inline-flex items-center gap-1 rounded-lg border border-border bg-card px-2.5 py-1.5 text-xs font-semibold text-foreground transition-colors hover:bg-muted",onClick:k},[u(t(X),{class:"h-3.5 w-3.5"}),d[1]||(d[1]=T(" Retry ",-1))])])):t(b).length?(o(),i("div",ge,[(o(!0),i(B,null,F(t(b),p=>(o(),v(A,{key:`${p.user_id}-${p.rank}`,entry:p,"is-current-user":p.is_highlighted},null,8,["entry","is-current-user"]))),128))])):(o(),i("div",be," No leaderboard entries for this period yet. "))])])]),e("footer",_e,[e("div",ve,[e("div",ye,[e("div",ke,[d[4]||(d[4]=e("span",null,"My Rank",-1)),e("span",null,f(t(N)),1)]),t(h)?(o(),i("div",we,[u(c,{class:"h-4 w-14","rounded-class":"rounded-md"}),e("div",Me,[u(c,{class:"h-8 w-8","rounded-class":"rounded-full"}),e("div",Le,[u(c,{class:"h-3 w-24","rounded-class":"rounded-md"}),u(c,{class:"h-2.5 w-16","rounded-class":"rounded-md"})])]),u(c,{class:"mx-auto h-4 w-10","rounded-class":"rounded-md"}),u(c,{class:"ml-auto h-4 w-14","rounded-class":"rounded-md"})])):t(w)?(o(),v(A,{key:1,entry:t(w),"is-current-user":!0,"is-footer":!0},null,8,["entry"])):(o(),i("div",Ne,[...d[5]||(d[5]=[e("span",{class:"tabular-nums"},"#--",-1),e("span",{class:"truncate"},"No personal rank yet",-1),e("span",{class:"text-center tabular-nums"},"--",-1),e("span",{class:"text-right tabular-nums"},"--",-1)])]))])])])]))}});export{Pe as default};
