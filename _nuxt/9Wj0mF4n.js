import{H as Ie,d as Ne}from"./DgUxy0CX.js";import{d as q,c as f,a as e,u as g,o as p,j as D,t as x,b as R,F as T,E as B,w as I,G as H,f as Y,B as W,C as X,e as U,r as w,a1 as ie,k as ce,_ as Ve,a0 as le,Y as ze,T as Ee,g as He,J as qe}from"./BvmsJYLR.js";import Qe from"./C0TRSMCl.js";import{S as je}from"./D6b4k1-A.js";import{S as Ge}from"./CrRG91Pn.js";import{S as We}from"./D5QgTEL4.js";import{X as Je}from"./Bb8wBqGF.js";import"./DlAUqK2U.js";import"./B7XCgDfu.js";import"./5xDXAavj.js";import"./CV6lUnfE.js";import"./99XizrHh.js";import"./BcOzH3FQ.js";import"./Dgjf9vxP.js";const Ye={class:"grid grid-cols-1 gap-2 sm:grid-cols-2"},Xe={class:"space-y-1"},Ze=["value"],Ke={class:"space-y-1"},_e=["value"],et=q({__name:"DateRangePicker",props:{modelValue:{default:()=>({from:"",to:""})}},emits:["update:modelValue"],setup(s,{emit:P}){const v=s,b=P,k=D(()=>v.modelValue?.from??""),$=D(()=>v.modelValue?.to??""),C=(y,l)=>{const u={from:k.value,to:$.value,[y]:l};u.from&&u.to&&u.from>u.to&&(y==="from"?u.to=l:u.from=l),b("update:modelValue",u)};return(y,l)=>(p(),f("div",Ye,[e("label",Xe,[l[2]||(l[2]=e("span",{class:"text-xs font-medium text-muted-foreground"},"С",-1)),e("input",{type:"date",value:g(k),class:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm text-foreground ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",onInput:l[0]||(l[0]=u=>C("from",u.target.value))},null,40,Ze)]),e("label",Ke,[l[3]||(l[3]=e("span",{class:"text-xs font-medium text-muted-foreground"},"По",-1)),e("input",{type:"date",value:g($),class:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm text-foreground ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",onInput:l[1]||(l[1]=u=>C("to",u.target.value))},null,40,_e)])]))}}),tt=Object.assign(et,{__name:"SharedDateRangePicker"}),ot={class:"space-y-6 rounded-3xl border border-border/80 bg-card/90 p-5 shadow-soft backdrop-blur-sm"},rt={class:"space-y-3"},st={class:"flex items-center justify-between"},at={class:"text-xs text-muted-foreground"},nt={class:"grid grid-cols-2 gap-2 text-xs"},it={class:"rounded-xl border border-border bg-background px-3 py-2"},lt={class:"mt-0.5 font-semibold text-foreground"},dt={class:"rounded-xl border border-border bg-background px-3 py-2 text-right"},ut={class:"mt-0.5 font-semibold text-foreground"},ct={class:"space-y-2"},gt=["min","max","value"],pt=["min","max","value"],mt={class:"space-y-3"},vt={class:"space-y-2"},bt=["value"],ft=["value"],yt={class:"space-y-2"},xt={class:"font-medium text-foreground"},ht=["checked","onChange"],wt={class:"space-y-2"},kt={class:"flex flex-wrap gap-2"},$t=["onClick"],de=q({__name:"CatalogFilters",props:{priceRange:{},priceMin:{},priceMax:{},dateRange:{},sortBy:{},sortOptions:{},categoryOptions:{},selectedCategories:{},vibeOptions:{},selectedVibe:{}},emits:["update:priceRange","update:dateRange","update:sortBy","toggle:category","update:vibe","reset:filters"],setup(s,{emit:P}){const v=s,b=P,k=u=>{const r=Math.max(v.priceMin,Math.min(u,v.priceRange[1]));b("update:priceRange",[r,v.priceRange[1]])},$=u=>{const r=Math.min(v.priceMax,Math.max(u,v.priceRange[0]));b("update:priceRange",[v.priceRange[0],r])},C=u=>u>=v.priceMax?"5000+ ₽":`${u.toLocaleString("ru-RU")} ₽`,y=u=>v.selectedCategories.includes(u),l=u=>{if(v.selectedVibe===u){b("update:vibe","");return}b("update:vibe",u)};return(u,r)=>(p(),f("section",ot,[e("div",rt,[e("div",st,[r[5]||(r[5]=e("h3",{class:"text-sm font-semibold text-foreground"},"Цена",-1)),e("span",at,x(C(s.priceRange[0]))+" - "+x(C(s.priceRange[1])),1)]),e("div",nt,[e("div",it,[r[6]||(r[6]=e("p",{class:"text-muted-foreground"},"От",-1)),e("p",lt,x(C(s.priceRange[0])),1)]),e("div",dt,[r[7]||(r[7]=e("p",{class:"text-muted-foreground"},"До",-1)),e("p",ut,x(C(s.priceRange[1])),1)])]),e("div",ct,[e("input",{type:"range",min:s.priceMin,max:s.priceMax,value:s.priceRange[0],class:"h-2 w-full cursor-pointer accent-primary",onInput:r[0]||(r[0]=c=>k(Number(c.target.value)))},null,40,gt),e("input",{type:"range",min:s.priceMin,max:s.priceMax,value:s.priceRange[1],class:"h-2 w-full cursor-pointer accent-primary",onInput:r[1]||(r[1]=c=>$(Number(c.target.value)))},null,40,pt)])]),e("div",mt,[r[8]||(r[8]=e("h3",{class:"text-sm font-semibold text-foreground"},"Дата",-1)),R(tt,{"model-value":s.dateRange,"onUpdate:modelValue":r[2]||(r[2]=c=>b("update:dateRange",c))},null,8,["model-value"])]),e("div",vt,[r[9]||(r[9]=e("h3",{class:"text-sm font-semibold text-foreground"},"Сортировка",-1)),e("select",{value:s.sortBy,class:"h-10 w-full rounded-lg border border-input bg-background px-3 text-sm text-foreground ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",onChange:r[3]||(r[3]=c=>b("update:sortBy",c.target.value))},[(p(!0),f(T,null,B(s.sortOptions,c=>(p(),f("option",{key:c.value,value:c.value},x(c.label),9,ft))),128))],40,bt)]),e("div",yt,[r[10]||(r[10]=e("h3",{class:"text-sm font-semibold text-foreground"},"Категории",-1)),(p(!0),f(T,null,B(s.categoryOptions,c=>(p(),f("label",{key:c.value,class:"flex cursor-pointer items-center justify-between rounded-lg border border-border bg-background px-3 py-2 text-sm transition-colors hover:bg-muted/60"},[e("span",xt,x(c.label),1),e("input",{type:"checkbox",checked:y(c.value),class:"h-4 w-4 rounded border-input accent-primary",onChange:S=>b("toggle:category",c.value)},null,40,ht)]))),128))]),e("div",wt,[r[11]||(r[11]=e("h3",{class:"text-sm font-semibold text-foreground"},"Vibe",-1)),e("div",kt,[(p(!0),f(T,null,B(s.vibeOptions,c=>(p(),f("button",{key:c.value,type:"button",class:H(["rounded-full border px-3 py-1.5 text-xs font-medium transition-colors",s.selectedVibe===c.value?"border-primary bg-primary text-primary-foreground":"border-border bg-background text-muted-foreground hover:text-foreground"]),onClick:S=>l(c.value)},x(c.label),11,$t))),128))])]),R(g(W),{variant:"outline",class:"w-full",onClick:r[4]||(r[4]=c=>b("reset:filters"))},{default:I(()=>[...r[12]||(r[12]=[Y(" Сбросить фильтры ",-1)])]),_:1})]))}}),Ct={class:"space-y-4"},Rt={class:"flex items-center justify-between rounded-2xl border border-border/70 bg-card/80 px-4 py-3 text-sm"},Mt={class:"font-semibold text-foreground"},Dt={key:0,class:"rounded-2xl border border-destructive/30 bg-destructive/10 px-4 py-3 text-sm text-destructive"},St={key:1,class:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3"},Tt={key:0,class:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3"},At={class:"absolute left-3 top-3 rounded-full bg-card/90 px-2.5 py-1 text-[11px] font-semibold text-foreground"},Pt={key:0,class:"absolute right-3 top-3 rounded-full bg-primary px-2.5 py-1 text-[10px] font-semibold uppercase tracking-[0.08em] text-primary-foreground"},Bt={class:"flex flex-1 flex-col gap-3 p-4"},Ft={class:"line-clamp-2 text-base font-semibold leading-tight text-foreground"},Lt={class:"mt-1 text-xs text-muted-foreground"},Ut={class:"mt-auto grid grid-cols-2 gap-3 text-xs"},Ot={class:"mt-1 font-semibold text-foreground"},It={class:"text-right"},Nt={class:"mt-1 font-semibold text-primary"},Vt={class:"flex items-center justify-between text-xs text-muted-foreground"},zt={class:"truncate"},Et={key:0,class:"shrink-0 font-semibold text-foreground"},Ht={key:1,class:"rounded-2xl border border-border bg-card px-4 py-10 text-center text-sm text-muted-foreground"},qt={key:3,class:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3"},Qt={key:4,class:"py-2 text-center text-xs uppercase tracking-[0.14em] text-muted-foreground"},jt=q({__name:"CatalogGrid",props:{events:{},totalMatched:{},isInitialLoading:{type:Boolean},isFetchingMore:{type:Boolean},hasMore:{type:Boolean},errorMessage:{}},emits:["update:sentinel"],setup(s,{emit:P}){const v=P,b=w(null),k=y=>{const l=new Date(y);if(Number.isNaN(l.getTime()))return"Дата уточняется";const u=new Date,r=new Date(u);r.setHours(0,0,0,0);const c=new Date(r);c.setDate(r.getDate()+1);const S=new Date(c);S.setDate(c.getDate()+1);const F=new Intl.DateTimeFormat("ru-RU",{hour:"2-digit",minute:"2-digit"}).format(l);return l>=r&&l<c?`Сегодня, ${F}`:l>=c&&l<S?`Завтра, ${F}`:new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"}).format(l)},$=y=>y<=0?"Бесплатно":`${y.toLocaleString("ru-RU")} ₽`,C=y=>y==="Music"?"from-cyan-500/30 via-cyan-500/10 to-transparent":y==="Tech"?"from-emerald-500/30 via-emerald-500/10 to-transparent":y==="Art"?"from-amber-500/30 via-amber-500/10 to-transparent":"from-rose-500/30 via-rose-500/10 to-transparent";return X(b,y=>{v("update:sentinel",y)},{immediate:!0}),(y,l)=>{const u=Ve;return p(),f("section",Ct,[e("div",Rt,[l[0]||(l[0]=e("p",{class:"text-muted-foreground"},"Найдено событий",-1)),e("p",Mt,x(s.totalMatched),1)]),s.errorMessage?(p(),f("div",Dt,x(s.errorMessage),1)):U("",!0),s.isInitialLoading?(p(),f("div",St,[(p(),f(T,null,B(9,r=>e("article",{key:`initial-skeleton-${r}`,class:"overflow-hidden rounded-2xl border border-border bg-card/80"},[...l[1]||(l[1]=[ie('<div class="h-36 animate-pulse bg-muted"></div><div class="space-y-3 p-4"><div class="h-4 w-2/3 animate-pulse rounded-full bg-muted"></div><div class="h-3 w-1/2 animate-pulse rounded-full bg-muted"></div><div class="h-3 w-1/3 animate-pulse rounded-full bg-muted"></div></div>',2)])])),64))])):(p(),f(T,{key:2},[s.events.length?(p(),f("div",Tt,[(p(!0),f(T,null,B(s.events,r=>(p(),ce(u,{key:r.id,to:`/e/${r.slug}`,class:"group flex h-full flex-col overflow-hidden rounded-2xl border border-border bg-card shadow-soft transition-all duration-200 hover:-translate-y-0.5 hover:shadow-elevated"},{default:I(()=>[e("div",{class:H(["relative h-36 overflow-hidden bg-gradient-to-br",C(r.category)])},[e("div",At,x(r.category)+" • "+x(r.vibe),1),r.recommended?(p(),f("div",Pt," Рекомендовано ")):U("",!0)],2),e("div",Bt,[e("div",null,[e("h3",Ft,x(r.title),1),e("p",Lt,x(r.venue)+" • "+x(r.city),1)]),e("div",Ut,[e("div",null,[l[2]||(l[2]=e("p",{class:"text-muted-foreground"},"Дата",-1)),e("p",Ot,x(k(r.startAt)),1)]),e("div",It,[l[3]||(l[3]=e("p",{class:"text-muted-foreground"},"Цена",-1)),e("p",Nt,x($(r.price)),1)])]),e("div",Vt,[e("span",zt,x(r.organizer),1),r.rating!==null?(p(),f("span",Et," ★ "+x(r.rating.toFixed(1)),1)):U("",!0)])])]),_:2},1032,["to"]))),128))])):(p(),f("div",Ht," Ничего не найдено. Попробуйте изменить фильтры или тип поиска. "))],64)),e("div",{ref_key:"sentinelEl",ref:b,class:"h-1 w-full"},null,512),s.isFetchingMore&&!s.isInitialLoading?(p(),f("div",qt,[(p(),f(T,null,B(3,r=>e("article",{key:`next-skeleton-${r}`,class:"overflow-hidden rounded-2xl border border-border bg-card/80"},[...l[4]||(l[4]=[ie('<div class="h-36 animate-pulse bg-muted"></div><div class="space-y-3 p-4"><div class="h-4 w-2/3 animate-pulse rounded-full bg-muted"></div><div class="h-3 w-1/2 animate-pulse rounded-full bg-muted"></div><div class="h-3 w-1/3 animate-pulse rounded-full bg-muted"></div></div>',2)])])),64))])):!s.hasMore&&s.events.length?(p(),f("p",Qt," Показаны все доступные события ")):U("",!0)])}}}),Gt={class:"-mx-4"},Wt={class:"mx-auto max-w-7xl space-y-5 px-4 pb-12 sm:px-6 lg:px-8"},Jt={class:"space-y-4 rounded-3xl border border-border/70 bg-card/80 p-4 shadow-soft backdrop-blur-sm sm:p-5"},Yt={class:"flex flex-wrap items-start justify-between gap-3"},Xt={class:"inline-flex items-center gap-2 rounded-full border border-border bg-background px-3 py-1 text-xs"},Zt={class:"font-medium text-foreground"},Kt={class:"grid gap-3 md:grid-cols-[minmax(0,1fr)_auto] md:items-start"},_t={class:"relative"},eo={key:0,class:"absolute z-30 mt-2 w-full overflow-hidden rounded-2xl border border-border bg-card shadow-elevated"},to={class:"px-3 py-2 text-[11px] font-semibold uppercase tracking-[0.14em] text-muted-foreground"},oo=["onClick"],ro={class:"text-sm font-medium text-foreground"},so={class:"text-xs text-muted-foreground"},ao={key:1,class:"px-3 py-4 text-sm text-muted-foreground"},no={class:"rounded-xl border border-border bg-background p-1"},io={class:"flex flex-wrap gap-1"},lo=["onClick"],uo={class:"lg:hidden"},co={class:"flex gap-2 overflow-x-auto pb-1"},go={key:0,class:"ml-1 rounded-full bg-primary px-1.5 py-0.5 text-[10px] text-primary-foreground"},po={class:"grid gap-6 lg:grid-cols-[19rem_minmax(0,1fr)]"},mo={class:"hidden lg:block"},vo={class:"sticky top-24"},bo={key:0,class:"fixed inset-x-0 bottom-0 z-[95] max-h-[85dvh] overflow-y-auto rounded-t-3xl border border-border bg-card p-4 shadow-elevated lg:hidden"},fo={class:"mb-4 flex items-center justify-between"},yo=q({__name:"CatalogMainBlock",props:{events:{},totalMatched:{},searchQuery:{},searchScope:{},searchModes:{},suggestionGroups:{},priceRange:{},priceMin:{},priceMax:{},dateRange:{},sortBy:{},sortOptions:{},categoryOptions:{},selectedCategories:{},vibeOptions:{},selectedVibe:{},activeFiltersCount:{},isInitialLoading:{type:Boolean},isFetchingMore:{type:Boolean},hasMore:{type:Boolean},errorMessage:{}},emits:["update:searchQuery","update:searchScope","apply:suggestion","update:priceRange","update:dateRange","update:sortBy","toggle:category","update:vibe","reset:filters","quick:friday","quick:budget","update:sentinel"],setup(s,{emit:P}){const v=s,b=P,k=w(!1),$=w(!1),C=D(()=>v.suggestionGroups.some(h=>h.items.length>0)),y=D(()=>$.value&&v.searchQuery.trim().length>0),l=h=>{const o=h.getFullYear(),n=`${h.getMonth()+1}`.padStart(2,"0"),M=`${h.getDate()}`.padStart(2,"0");return`${o}-${n}-${M}`},u=h=>{const o=new Date,n=new Date(o),M=(h-o.getDay()+7)%7;return n.setDate(o.getDate()+M),l(n)},r=D(()=>u(5)),c=D(()=>v.priceRange[0]<=v.priceMin&&v.priceRange[1]<=1e3),S=D(()=>v.dateRange.from===r.value&&v.dateRange.to===r.value),F=D(()=>v.sortOptions.find(h=>h.value===v.sortBy)?.label??""),z=D(()=>v.selectedCategories.length?v.selectedCategories.length===1?v.categoryOptions.find(h=>h.value===v.selectedCategories[0])?.label??"Категории":`Категории: ${v.selectedCategories.length}`:"Категории"),N=D(()=>v.selectedVibe?v.vibeOptions.find(h=>h.value===v.selectedVibe)?.label??"Vibe":"Vibe"),O=h=>{b("apply:suggestion",h),$.value=!1},L=()=>{window.setTimeout(()=>{$.value=!1},120)};return(h,o)=>(p(),f(T,null,[e("div",Gt,[e("div",Wt,[e("header",Jt,[e("div",Yt,[o[25]||(o[25]=e("div",null,[e("h1",{class:"text-2xl font-bold text-foreground"},"Каталог событий"),e("p",{class:"mt-1 text-sm text-muted-foreground"}," Найдите событие в несколько шагов: от техно-вечеринки до бизнес-нетворкинга. ")],-1)),e("div",Xt,[R(g(je),{class:"h-3.5 w-3.5 text-primary"}),e("span",Zt,x(s.totalMatched)+" результатов",1)])]),e("div",Kt,[e("div",{class:"relative",onFocusin:o[2]||(o[2]=n=>$.value=!0),onFocusout:L},[e("div",_t,[R(g(Ge),{class:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),R(g(Qe),{"model-value":s.searchQuery,type:"search",class:"h-11 rounded-xl pl-10",placeholder:"Например: техно, roof, pulse...","onUpdate:modelValue":o[0]||(o[0]=n=>b("update:searchQuery",n))},null,8,["model-value"])]),g(y)?(p(),f("div",eo,[g(C)?(p(!0),f(T,{key:0},B(s.suggestionGroups,n=>(p(),f("div",{key:n.type,class:"border-b border-border/70 last:border-b-0"},[e("p",to,x(n.title),1),(p(!0),f(T,null,B(n.items,M=>(p(),f("button",{key:M.id,type:"button",class:"flex w-full items-center justify-between px-3 py-2 text-left transition-colors hover:bg-muted/60",onMousedown:o[1]||(o[1]=Ee(()=>{},["prevent"])),onClick:Z=>O(M)},[e("span",ro,x(M.label),1),e("span",so,x(M.caption),1)],40,oo))),128))]))),128)):(p(),f("p",ao," Ничего не найдено. Попробуйте другой запрос. "))])):U("",!0)],32),e("div",no,[o[26]||(o[26]=e("p",{class:"px-2 pb-1 text-[11px] uppercase tracking-[0.12em] text-muted-foreground"}," Искать по ",-1)),e("div",io,[(p(!0),f(T,null,B(s.searchModes,n=>(p(),f("button",{key:n.value,type:"button",class:H(["rounded-lg px-3 py-2 text-xs font-semibold transition-colors",s.searchScope===n.value?"bg-primary text-primary-foreground":"text-muted-foreground hover:bg-muted hover:text-foreground"]),onClick:M=>b("update:searchScope",n.value)},x(n.label),11,lo))),128))])])])]),e("div",uo,[e("div",co,[e("button",{type:"button",class:H(["whitespace-nowrap rounded-full border px-3 py-1.5 text-xs font-medium transition-colors",g(c)?"border-primary bg-primary text-primary-foreground":"border-border bg-background text-muted-foreground"]),onClick:o[3]||(o[3]=n=>b("quick:budget"))}," до 1000 ₽ ",2),e("button",{type:"button",class:H(["whitespace-nowrap rounded-full border px-3 py-1.5 text-xs font-medium transition-colors",g(S)?"border-primary bg-primary text-primary-foreground":"border-border bg-background text-muted-foreground"]),onClick:o[4]||(o[4]=n=>b("quick:friday"))}," Пятница ",2),e("button",{type:"button",class:"whitespace-nowrap rounded-full border border-border bg-background px-3 py-1.5 text-xs font-medium text-muted-foreground",onClick:o[5]||(o[5]=n=>k.value=!0)},x(g(F)||"Сортировка"),1),e("button",{type:"button",class:"whitespace-nowrap rounded-full border border-border bg-background px-3 py-1.5 text-xs font-medium text-muted-foreground",onClick:o[6]||(o[6]=n=>k.value=!0)},x(g(z)),1),e("button",{type:"button",class:"whitespace-nowrap rounded-full border border-border bg-background px-3 py-1.5 text-xs font-medium text-muted-foreground",onClick:o[7]||(o[7]=n=>k.value=!0)},x(g(N)),1),R(g(W),{variant:"outline",class:"h-8 shrink-0 rounded-full px-3 text-xs",onClick:o[8]||(o[8]=n=>k.value=!0)},{default:I(()=>[R(g(We),{class:"mr-1 h-3.5 w-3.5"}),o[27]||(o[27]=Y(" Все фильтры ",-1)),s.activeFiltersCount?(p(),f("span",go,x(s.activeFiltersCount),1)):U("",!0)]),_:1})])]),e("div",po,[e("aside",mo,[e("div",vo,[R(de,{"price-range":s.priceRange,"price-min":s.priceMin,"price-max":s.priceMax,"date-range":s.dateRange,"sort-by":s.sortBy,"sort-options":s.sortOptions,"category-options":s.categoryOptions,"selected-categories":s.selectedCategories,"vibe-options":s.vibeOptions,"selected-vibe":s.selectedVibe,"onUpdate:priceRange":o[9]||(o[9]=n=>b("update:priceRange",n)),"onUpdate:dateRange":o[10]||(o[10]=n=>b("update:dateRange",n)),"onUpdate:sortBy":o[11]||(o[11]=n=>b("update:sortBy",n)),"onToggle:category":o[12]||(o[12]=n=>b("toggle:category",n)),"onUpdate:vibe":o[13]||(o[13]=n=>b("update:vibe",n)),"onReset:filters":o[14]||(o[14]=n=>b("reset:filters"))},null,8,["price-range","price-min","price-max","date-range","sort-by","sort-options","category-options","selected-categories","vibe-options","selected-vibe"])])]),R(jt,{events:s.events,"total-matched":s.totalMatched,"is-initial-loading":s.isInitialLoading,"is-fetching-more":s.isFetchingMore,"has-more":s.hasMore,"error-message":s.errorMessage,"onUpdate:sentinel":o[15]||(o[15]=n=>b("update:sentinel",n))},null,8,["events","total-matched","is-initial-loading","is-fetching-more","has-more","error-message"])])])]),(p(),ce(ze,{to:"body"},[R(le,{"enter-active-class":"transition-opacity duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:I(()=>[g(k)?(p(),f("div",{key:0,class:"fixed inset-0 z-[90] bg-black/55 lg:hidden",onClick:o[16]||(o[16]=n=>k.value=!1)})):U("",!0)]),_:1}),R(le,{"enter-active-class":"transition-transform duration-250 ease-out","enter-from-class":"translate-y-full","enter-to-class":"translate-y-0","leave-active-class":"transition-transform duration-200 ease-in","leave-from-class":"translate-y-0","leave-to-class":"translate-y-full"},{default:I(()=>[g(k)?(p(),f("section",bo,[e("div",fo,[o[28]||(o[28]=e("div",null,[e("h2",{class:"text-lg font-semibold text-foreground"},"Все фильтры"),e("p",{class:"text-xs text-muted-foreground"},"Настройте выдачу под текущий запрос")],-1)),R(g(W),{variant:"ghost",size:"icon",class:"rounded-full",onClick:o[17]||(o[17]=n=>k.value=!1)},{default:I(()=>[R(g(Je),{class:"h-4 w-4"})]),_:1})]),R(de,{"price-range":s.priceRange,"price-min":s.priceMin,"price-max":s.priceMax,"date-range":s.dateRange,"sort-by":s.sortBy,"sort-options":s.sortOptions,"category-options":s.categoryOptions,"selected-categories":s.selectedCategories,"vibe-options":s.vibeOptions,"selected-vibe":s.selectedVibe,"onUpdate:priceRange":o[18]||(o[18]=n=>b("update:priceRange",n)),"onUpdate:dateRange":o[19]||(o[19]=n=>b("update:dateRange",n)),"onUpdate:sortBy":o[20]||(o[20]=n=>b("update:sortBy",n)),"onToggle:category":o[21]||(o[21]=n=>b("toggle:category",n)),"onUpdate:vibe":o[22]||(o[22]=n=>b("update:vibe",n)),"onReset:filters":o[23]||(o[23]=n=>b("reset:filters"))},null,8,["price-range","price-min","price-max","date-range","sort-by","sort-options","category-options","selected-categories","vibe-options","selected-vibe"]),R(g(W),{class:"mt-4 w-full",onClick:o[24]||(o[24]=n=>k.value=!1)},{default:I(()=>[...o[29]||(o[29]=[Y(" Применить ",-1)])]),_:1})])):U("",!0)]),_:1})]))],64))}}),xo={class:"page-wrapper"},ho={class:"flex min-h-[calc(100dvh-9rem)] flex-col gap-4 lg:flex-row lg:items-start lg:gap-6"},wo={class:"min-w-0 flex-1"},ue=12,E=0,G=5500,Io=q({__name:"index",setup(s){const P=[{value:"events",label:"Событиям"},{value:"venues",label:"Площадкам"},{value:"organizers",label:"Организаторам"}],v=[{value:"date_asc",label:"Дата: сначала ранние"},{value:"date_desc",label:"Дата: сначала поздние"},{value:"price_asc",label:"Сначала дешевые"},{value:"newest",label:"Сначала новые"},{value:"popular",label:"По популярности"}],b=[{value:"Music",label:"Music"},{value:"Tech",label:"Tech"},{value:"Art",label:"Art"},{value:"Party",label:"Party"}],k=[{value:"Chill",label:"Chill"},{value:"Rave",label:"Rave"},{value:"Networking",label:"Networking"}],$=w(""),C=w("events"),y=w([E,G]),l=w({from:"",to:""}),u=w("popular"),r=w([]),c=w(""),S=w([]),F=w(0),z=w(0),N=w(!1),O=w(!1),L=w(!0),h=w(""),o=w(0),n=w(null);let M=null;const Z=a=>new Promise(t=>{setTimeout(t,a)}),ge=a=>{const t=a.getFullYear(),i=`${a.getMonth()+1}`.padStart(2,"0"),m=`${a.getDate()}`.padStart(2,"0");return`${t}-${i}-${m}`},pe=a=>{const t=new Date,i=new Date(t),m=(a-t.getDay()+7)%7;return i.setDate(t.getDate()+m),ge(i)},V=(a,t,i=0)=>{const m=new Date;return m.setDate(m.getDate()+a),m.setHours(t,i,0,0),m.toISOString()},J=D(()=>pe(5)),me=[{id:1,slug:"techno-friday-rave",title:"Техно вечеринка: Friday Rave",description:"Ночной рейв с индустриальным звуком и световым шоу.",venue:"Factory Hall",organizer:"Pulse Family",city:"Москва",category:"Party",vibe:"Rave",price:900,startAt:((a,t=0)=>{const i=new Date(`${J.value}T00:00:00`);return i.setHours(a,t,0,0),i.toISOString()})(22,0),rating:4.8,recommended:!0,popularity:980},{id:2,slug:"sunset-house-session",title:"Sunset House Session",description:"Легкий хаус на крыше с видом на город.",venue:"Skyline Roof",organizer:"City Beats",city:"Санкт-Петербург",category:"Music",vibe:"Chill",price:1200,startAt:V(2,19,30),rating:4.6,recommended:!1,popularity:760},{id:3,slug:"startup-night-mixer",title:"Startup Night Mixer",description:"Нетворкинг для фаундеров, продактов и разработчиков.",venue:"Tech Loft",organizer:"Founders Hub",city:"Казань",category:"Tech",vibe:"Networking",price:0,startAt:V(4,18,0),rating:4.4,recommended:!0,popularity:690},{id:4,slug:"new-media-art-lab",title:"New Media Art Lab",description:"Иммерсивная выставка digital art и перформансов.",venue:"Art Reactor",organizer:"Shape Studio",city:"Екатеринбург",category:"Art",vibe:"Chill",price:700,startAt:V(1,17,30),rating:4.7,recommended:!1,popularity:640},{id:5,slug:"deep-tech-conference",title:"Deep Tech Conference",description:"Тренды AI, hardware и продуктовой инженерии.",venue:"Volga Expo",organizer:"Next Era Team",city:"Нижний Новгород",category:"Tech",vibe:"Networking",price:2800,startAt:V(7,11,0),rating:4.9,recommended:!0,popularity:910},{id:6,slug:"city-breakbeat-party",title:"City Breakbeat Party",description:"Танцевальная ночь с лайв-сетами и visual art.",venue:"Dock Stage",organizer:"Night Pulse",city:"Москва",category:"Party",vibe:"Rave",price:1100,startAt:V(3,23,0),rating:4.3,recommended:!1,popularity:720}],K={Music:["Jazz Courtyard","Indie Weekend","Lo-fi Session","Acoustic Pulse"],Tech:["Product Meetup","Frontend Club","AI Hands-On","Cloud Practicum"],Art:["Gallery Night","Street Photo Talk","Creative Lab","Art Breakfast"],Party:["Bassline Night","Neon Party","Electro Friday","Afterhours Set"]},_=["Москва","Санкт-Петербург","Казань","Екатеринбург","Новосибирск"],ee=["Warehouse 21","Tech Loft","Orbit Hall","Signal Space","Blue Room"],te=["Pulse Crew","Open Culture","Community Lab","Flow Agency","Event Syndicate"],oe=[0,500,800,950,1200,1500,1900,2300,2800,3400,4100,5200],re=["Music","Tech","Art","Party"],se=["Chill","Rave","Networking"],ve=Array.from({length:64},(a,t)=>{const i=t+1,m=re[t%re.length],d=se[(t+1)%se.length],A=K[m][t%K[m].length],j=100+i,Ue=3.9+t*3%11/10,Oe=t%6===0?null:Number(Ue.toFixed(1));return{id:j,slug:`catalog-event-${j}`,title:`${A} #${i}`,description:`Подборка ${m.toLowerCase()} событий для настроения ${d.toLowerCase()}.`,venue:ee[t%ee.length],organizer:te[t%te.length],city:_[t%_.length],category:m,vibe:d,price:oe[t%oe.length],startAt:V(t%24+1,11+t%9,t%2===0?0:30),rating:Oe,recommended:t%5===0,popularity:280+t*47%720}}),Q=[...me,...ve],be=a=>{const t=new Date(a);return Number.isNaN(t.getTime())?"дата уточняется":new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"short"}).format(t)},fe=D(()=>{const a=$.value.trim().toLocaleLowerCase("ru-RU");if(!a)return[];const t=Q.filter(d=>d.title.toLocaleLowerCase("ru-RU").includes(a)).slice(0,4).map(d=>({id:`event-${d.id}`,type:"events",label:d.title,caption:`${d.venue} • ${be(d.startAt)}`})),i=Array.from(new Set(Q.map(d=>`${d.venue}|${d.city}`).filter(d=>d.toLocaleLowerCase("ru-RU").includes(a)))).slice(0,3).map(d=>{const[A,j]=d.split("|");return{id:`venue-${A}`,type:"venues",label:A,caption:j}}),m=Array.from(new Set(Q.map(d=>d.organizer).filter(d=>d.toLocaleLowerCase("ru-RU").includes(a)))).slice(0,3).map(d=>({id:`organizer-${d}`,type:"organizers",label:d,caption:"Организатор"}));return[{type:"events",title:"События",items:t},{type:"venues",title:"Площадки",items:i},{type:"organizers",title:"Организаторы",items:m}].filter(d=>d.items.length>0)}),ye=()=>({query:$.value.trim(),scope:C.value,minPrice:y.value[0],maxPrice:y.value[1],fromDate:l.value.from,toDate:l.value.to,sort:u.value,categories:[...r.value],vibe:c.value}),xe=(a,t)=>{if(!t.query)return!0;const i=t.query.toLocaleLowerCase("ru-RU");return t.scope==="venues"?`${a.venue} ${a.city}`.toLocaleLowerCase("ru-RU").includes(i):t.scope==="organizers"?a.organizer.toLocaleLowerCase("ru-RU").includes(i):`${a.title} ${a.description} ${a.category} ${a.vibe}`.toLocaleLowerCase("ru-RU").includes(i)},he=(a,t)=>a.price>=t.minPrice&&a.price<=t.maxPrice,we=(a,t)=>{const i=a.startAt.slice(0,10);return!(t.fromDate&&i<t.fromDate||t.toDate&&i>t.toDate)},ke=(a,t)=>t.categories.length===0||t.categories.includes(a.category),$e=(a,t)=>!t.vibe||a.vibe===t.vibe,Ce=(a,t)=>{const i=[...a];return t==="date_asc"?i.sort((m,d)=>new Date(m.startAt).getTime()-new Date(d.startAt).getTime()):t==="date_desc"?i.sort((m,d)=>new Date(d.startAt).getTime()-new Date(m.startAt).getTime()):t==="price_asc"?i.sort((m,d)=>m.price-d.price||d.popularity-m.popularity):t==="newest"?i.sort((m,d)=>new Date(d.startAt).getTime()-new Date(m.startAt).getTime()):i.sort((m,d)=>d.popularity-m.popularity||m.price-d.price)},Re=async({page:a,filters:t})=>{console.log("Filter applied:",t),await Z(650);const i=Ce(Q.filter(A=>xe(A,t)&&he(A,t)&&we(A,t)&&ke(A,t)&&$e(A,t)),t.sort),m=a*ue,d=m+ue;return{items:i.slice(m,d),total:i.length,hasMore:d<i.length}},ae=async({token:a=o.value}={})=>{if(O.value||!L.value)return;O.value=!0;const t=ye(),i=z.value;try{const m=await Re({page:i,filters:t});if(a!==o.value)return;S.value=[...S.value,...m.items],z.value=i+1,L.value=m.hasMore,F.value=m.total}catch{if(a!==o.value)return;h.value="Не удалось загрузить события. Попробуйте еще раз.",L.value=!1}finally{a===o.value&&(O.value=!1)}},Me=async()=>{o.value+=1;const a=o.value;S.value=[],z.value=0,F.value=0,L.value=!0,h.value="",N.value=!0,window.scrollTo({top:0,behavior:"smooth"}),await ae({token:a}),a===o.value&&(N.value=!1)},De=D(()=>JSON.stringify({query:$.value.trim(),scope:C.value,minPrice:y.value[0],maxPrice:y.value[1],fromDate:l.value.from,toDate:l.value.to,sort:u.value,categories:[...r.value].sort(),vibe:c.value})),Se=D(()=>{let a=0;return(y.value[0]!==E||y.value[1]!==G)&&(a+=1),(l.value.from||l.value.to)&&(a+=1),u.value!=="popular"&&(a+=1),r.value.length&&(a+=1),c.value&&(a+=1),a}),Te=a=>{C.value=a.type,$.value=a.label},Ae=a=>{if(r.value.includes(a)){r.value=r.value.filter(t=>t!==a);return}r.value=[...r.value,a]},Pe=()=>{y.value=[E,G],l.value={from:"",to:""},u.value="popular",r.value=[],c.value=""},Be=()=>{l.value={from:J.value,to:J.value}},Fe=()=>{y.value=[E,1e3]},Le=a=>{n.value=a},ne=()=>{M?.disconnect(),M=new IntersectionObserver(a=>{a.some(i=>i.isIntersecting)&&(N.value||O.value||L.value&&ae())},{rootMargin:"280px 0px 280px 0px"}),n.value&&M.observe(n.value)};return X(De,()=>{Me()},{immediate:!0}),X(n,()=>{ne()}),He(()=>{ne()}),qe(()=>{M?.disconnect()}),(a,t)=>(p(),f("div",xo,[e("div",ho,[R(Ie,{items:g(Ne),class:"shrink-0"},null,8,["items"]),e("div",wo,[R(yo,{events:g(S),"total-matched":g(F),"search-query":g($),"search-scope":g(C),"search-modes":P,"suggestion-groups":g(fe),"price-range":g(y),"price-min":E,"price-max":G,"date-range":g(l),"sort-by":g(u),"sort-options":v,"category-options":b,"selected-categories":g(r),"vibe-options":k,"selected-vibe":g(c),"active-filters-count":g(Se),"is-initial-loading":g(N),"is-fetching-more":g(O),"has-more":g(L),"error-message":g(h),"onUpdate:searchQuery":t[0]||(t[0]=i=>$.value=i),"onUpdate:searchScope":t[1]||(t[1]=i=>C.value=i),"onApply:suggestion":Te,"onUpdate:priceRange":t[2]||(t[2]=i=>y.value=i),"onUpdate:dateRange":t[3]||(t[3]=i=>l.value=i),"onUpdate:sortBy":t[4]||(t[4]=i=>u.value=i),"onToggle:category":Ae,"onUpdate:vibe":t[5]||(t[5]=i=>c.value=i),"onReset:filters":Pe,"onQuick:friday":Be,"onQuick:budget":Fe,"onUpdate:sentinel":Le},null,8,["events","total-matched","search-query","search-scope","suggestion-groups","price-range","date-range","sort-by","selected-categories","selected-vibe","active-filters-count","is-initial-loading","is-fetching-more","has-more","error-message"])])])]))}});export{Io as default};
