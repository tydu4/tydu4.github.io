import{H as ne,d as le}from"./D1uJsfV4.js";import{d as H,I as de,J as ue,o as u,c,a as e,G as E,u as t,s as ce,U as F,e as _,T as J,b as d,a0 as X,w as m,t as v,r as C,j as R,a4 as me,m as pe,z as fe,A as ve,n as q,f as x,B as y,a2 as ge,L as be,_ as xe,F as ke,E as he}from"./D4tOOpea.js";import{a as we}from"./DHr-Wc25.js";import ye from"./CtJ5tJ5V.js";import _e from"./C94ZD2ww.js";import{u as Ce,S as Se}from"./Dxk9Oq8Z.js";import"./DlAUqK2U.js";import"./CUtcqh3c.js";import"./BrE5OWI-.js";import"./DSD0DqAy.js";import"./CDoVUn-y.js";import"./BDIprTuF.js";import"./D6B2Eigc.js";import"./DQ6Ue2G3.js";import"./D_jAd2MS.js";import"./B8ijCWxw.js";import"./CepWY41C.js";import"./DuJc6R8_.js";const Me={class:"relative h-full w-full min-h-0"},ze={key:0,class:"relative z-10 flex h-full items-center justify-center rounded-3xl border border-border/60 bg-card/70 backdrop-blur-sm"},$e={key:1,class:"relative z-10 flex h-full items-center justify-center rounded-3xl border border-border/60 bg-card/60"},De={key:2,class:"relative z-10 flex h-full min-h-0 flex-col items-center"},Pe={class:"relative flex min-h-0 flex-1 w-full items-center justify-center"},Ie={class:"relative w-full max-w-[90vw] sm:max-w-[26rem] max-h-[85vh] [aspect-ratio:2/3]"},Le={class:"absolute right-6 top-6"},je={class:"absolute left-6 top-6"},Be={key:0,class:"absolute left-1/2 top-10 -translate-x-1/2 rounded-xl border border-emerald-400/30 bg-emerald-500/20 px-5 py-2.5 backdrop-blur-md"},Te={class:"absolute bottom-0 left-0 right-0 space-y-4 p-6 text-white select-none"},Ue={class:"flex items-center gap-2 text-xs"},Ve={class:"flex items-center gap-1.5 rounded-lg bg-white/15 px-2.5 py-1 backdrop-blur-sm"},Fe={class:"font-medium text-white/90"},Re={class:"text-3xl font-bold leading-tight tracking-tight"},Ae={class:"flex items-center gap-2 text-sm text-white/80"},Oe={class:"font-medium"},Ne={class:"w-full max-w-[90vw] sm:max-w-[26rem] px-2 pt-3",style:{"padding-bottom":"calc(env(safe-area-inset-bottom) + 0.35rem)"}},Ee=H({__name:"SwipeDeck",props:{items:{},loading:{type:Boolean,default:!1}},emits:["swipe","info","rewind"],setup(j,{emit:f}){const z=j,$=f,D=de(),P=C(!1),k=C(null),g=C("");let r=null;const S=i=>{g.value=i==="like"?"bg-green-500/10":i==="dislike"?"bg-red-500/10":"bg-blue-500/10",r&&clearTimeout(r),r=setTimeout(()=>{g.value="",r=null},300)},B=()=>{_e({particleCount:100,spread:70,origin:{y:.6},colors:["#22c55e","#3b82f6","#eab308"]})};ue(()=>{r&&clearTimeout(r)});const A=()=>{P.value=!0,setTimeout(()=>{P.value=!1},600)},{activeItem:n,nextItem:I,cardStyle:O,nextCardStyle:T,indicators:U,handlers:p,actions:h,isAnimating:M,isDragging:N,didDrag:a,offsetX:o,offsetY:b,cardMotionClass:V}=Ce(me(z,"items"),{enableSwipeUp:!1,onSwipe:({direction:i,item:s,meta:l})=>{const L=l?.type||(i==="left"?"dislike":"like"),ae=l?.feedback||(L==="bookmark"?"super":i==="left"?"dislike":"like"),G=i==="left"?"left":"right";S(ae),G==="right"&&A(),$("swipe",{direction:G,type:L,item:s})}}),w=()=>{h.swipeLeft({type:"dislike",feedback:"dislike"})},Y=()=>{h.swipeRight({type:"bookmark",feedback:"super"}),B()},K=()=>{h.swipeRight({type:"like",feedback:"like"})},Q=()=>{const i=h.rewind();i&&$("rewind",i.item)},W=()=>{const i=navigator.maxTouchPoints>0,s=window.matchMedia?.("(pointer: coarse)").matches??!1,l=/Android|iPhone|iPad|iPod|Mobile|Opera Mini|IEMobile/i.test(navigator.userAgent);return i&&(s||l)},Z=()=>typeof navigator.share=="function"&&W(),ee=async()=>{if(!n.value||M.value)return;const i=`/e/${n.value.slug}`,s=new URL(i,window.location.origin).toString(),l={title:n.value.title,text:n.value.description||void 0,url:s};try{if(Z()){await navigator.share(l);return}if(navigator.clipboard?.writeText){await navigator.clipboard.writeText(s),D.push({level:"success",title:"Поделиться",message:"Ссылка скопирована"});return}D.push({level:"error",title:"Поделиться",message:"Не удалось скопировать ссылку"})}catch(L){if(L instanceof Error&&L.name==="AbortError")return;D.push({level:"error",title:"Поделиться",message:"Не удалось поделиться событием"})}},te=R(()=>M.value||!n.value),oe=()=>{if(!(!n.value||M.value)){if(a.value){a.value=!1;return}N.value||Math.abs(o.value)>10||Math.abs(b.value)>10||$("info",n.value)}},se=R(()=>O.value),re=i=>i?.main_image?{backgroundImage:`url(${i.main_image})`}:{backgroundImage:"linear-gradient(160deg, rgba(139,92,246,0.6), rgba(30,27,75,0.9))"},ie=i=>i?new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"long",hour:"2-digit",minute:"2-digit"}).format(new Date(i)):"Дата уточняется";return(i,s)=>(u(),c("div",Me,[e("div",{class:E(["pointer-events-none fixed inset-0 z-0 transition-colors duration-300",t(g)])},null,2),j.loading?(u(),c("div",ze,[...s[6]||(s[6]=[e("div",{class:"space-y-4 text-center"},[e("div",{class:"mx-auto h-10 w-10 animate-spin rounded-full border-2 border-primary/20 border-t-primary"}),e("p",{class:"text-sm font-medium text-muted-foreground"},"Загружаем события...")],-1)])])):t(n)?(u(),c("div",De,[e("div",Pe,[e("div",Ie,[t(I)?(u(),c("div",{key:0,class:"absolute inset-0 translate-y-4 scale-[0.96] rounded-[2.5rem] border border-border/50 bg-card/70 backdrop-blur-sm",style:F(t(T))},null,4)):_("",!0),e("div",{ref_key:"cardRef",ref:k,class:E(["absolute inset-0 touch-none select-none overflow-hidden rounded-[2.5rem] border border-border/40 bg-cover bg-center shadow-2xl",[t(V),t(M)?"pointer-events-none":""]]),style:F([re(t(n)),t(se)]),onPointerdown:s[0]||(s[0]=(...l)=>t(p).onPointerDown&&t(p).onPointerDown(...l)),onPointermove:s[1]||(s[1]=(...l)=>t(p).onPointerMove&&t(p).onPointerMove(...l)),onPointerup:s[2]||(s[2]=(...l)=>t(p).onPointerUp&&t(p).onPointerUp(...l)),onPointercancel:s[3]||(s[3]=(...l)=>t(p).onPointerUp&&t(p).onPointerUp(...l)),onPointerleave:s[4]||(s[4]=(...l)=>t(p).onPointerLeave&&t(p).onPointerLeave(...l)),onDragstart:s[5]||(s[5]=J(()=>{},["prevent"])),onClick:oe},[s[12]||(s[12]=e("div",{class:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"},null,-1)),e("div",Le,[e("div",{class:"flex items-center gap-2 rounded-xl border-2 border-emerald-400 bg-emerald-500/20 px-4 py-2 backdrop-blur-sm",style:F({opacity:t(U).likeOpacity})},[...s[7]||(s[7]=[e("svg",{class:"h-5 w-5 text-emerald-300",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z","clip-rule":"evenodd"})],-1),e("span",{class:"text-sm font-bold uppercase tracking-wider text-emerald-200"},"Нравится",-1)])],4)]),e("div",je,[e("div",{class:"flex items-center gap-2 rounded-xl border-2 border-rose-400 bg-rose-500/20 px-4 py-2 backdrop-blur-sm",style:F({opacity:t(U).nopeOpacity})},[...s[8]||(s[8]=[e("svg",{class:"h-5 w-5 text-rose-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),e("span",{class:"text-sm font-bold uppercase tracking-wider text-rose-200"},"Пропуск",-1)])],4)]),d(X,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":"-translate-y-2 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-200 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"-translate-y-2 opacity-0"},{default:m(()=>[t(P)?(u(),c("div",Be,[...s[9]||(s[9]=[e("div",{class:"flex items-center gap-2"},[e("svg",{class:"h-5 w-5 text-emerald-300",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})]),e("span",{class:"text-sm font-semibold text-emerald-200"},"Добавлено в избранное")],-1)])])):_("",!0)]),_:1}),e("div",Te,[e("div",Ue,[e("div",Ve,[s[10]||(s[10]=e("svg",{class:"h-3.5 w-3.5 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),e("span",Fe,v(ie(t(n).start_time)),1)])]),e("h2",Re,v(t(n).title),1),e("div",Ae,[s[11]||(s[11]=e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),e("span",Oe,v(t(n).venue_name||t(n).city),1)])])],38)])]),e("div",Ne,[d(Se,{type:"event",disabled:t(te),onRewind:Q,onDislike:w,onSuper:Y,onLike:K,onAction:ee},null,8,["disabled"])])])):(u(),c("div",$e,[ce(i.$slots,"empty")]))]))}}),He=Object.assign(Ee,{__name:"DiscoverySwipeDeck"}),Ge={class:"relative h-full overflow-hidden bg-background text-foreground"},qe={class:"relative mx-auto flex h-full w-full max-w-[27rem] flex-col pt-4"},Je={class:"rounded-2xl border border-border/60 bg-card p-8 shadow-soft backdrop-blur-sm"},Xe={class:"space-y-5 text-center"},Ye={class:"flex flex-col gap-3 pt-2"},Ke={class:"w-full rounded-3xl border border-border bg-card p-6 text-foreground shadow-2xl"},Qe={class:"flex items-start justify-between gap-4"},We={key:0,class:"space-y-6"},Ze={class:"flex items-start justify-between gap-4 pb-4 border-b border-border/60"},et={class:"flex-1 space-y-2"},tt={class:"text-2xl font-bold leading-tight"},ot={class:"flex items-center gap-2 text-sm text-muted-foreground"},st={class:"space-y-4"},rt={class:"space-y-3"},it={class:"text-base leading-relaxed text-muted-foreground"},at={key:0,class:"flex items-center gap-2 text-sm text-muted-foreground"},nt={key:0,class:"flex flex-wrap gap-2"},lt={class:"flex items-center gap-3 pt-2"},dt={key:0,class:"fixed bottom-8 left-1/2 z-50 -translate-x-1/2 rounded-xl border border-border/60 bg-card px-5 py-3 text-sm font-medium text-foreground shadow-2xl backdrop-blur-md"},ut=H({__name:"VibesMainBlock",setup(j){const f=pe(),z=fe(),{data:$,pending:D,refresh:P}=ve("discovery-feed",()=>f.isAuthInitialized?f.apiFetch("/api/v1/discovery/feed",{baseURL:q("/api/v1/discovery/feed"),query:{limit:30}}):[],{server:!1,default:()=>[],watch:[()=>f.token,()=>f.isAuthInitialized]}),k=C([]),g=C(!1),r=C(null),S=C(""),B=we("discovery_onboarding_seen",!1),A=R(()=>!B.value),n=()=>{B.value=!0},I=R(()=>r.value?k.value.includes(r.value.id):!1),O=a=>{S.value=a,setTimeout(()=>{S.value=""},2200)},T=async(a,o)=>{if(f.isGuest){z.trackInteraction({type:o,eventId:a.id,eventSlug:a.slug||null});return}const b={event_id:a.id,type:o,weight:1,device_type:"mobile"};try{await f.apiFetch("/api/v1/me/interactions",{method:"POST",baseURL:q("/api/v1/me/interactions"),body:b})}catch{}},U=async({direction:a,type:o,item:b})=>{o==="like"&&a==="right"&&!k.value.includes(b.id)&&(k.value=[...k.value,b.id]),await T(b,o)},p=a=>{f.isGuest&&z.trackView({eventId:a.id,eventSlug:a.slug||null,title:a.title||null}),r.value=a,g.value=!0},h=()=>{g.value=!1},M=async()=>{!r.value||I.value||(k.value=[...k.value,r.value.id],await T(r.value,"like"))},N=a=>a?new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"long",hour:"2-digit",minute:"2-digit"}).format(new Date(a)):"Дата уточняется";return(a,o)=>{const b=ge,V=xe;return u(),c("div",Ge,[o[15]||(o[15]=e("div",{class:"pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(99,102,241,0.16),transparent_55%)] dark:bg-[radial-gradient(circle_at_top,_rgba(99,102,241,0.28),transparent_55%)]"},null,-1)),e("div",qe,[d(He,{class:"flex-1 min-h-0 h-full",items:t($)||[],loading:t(D),onSwipe:U,onInfo:p},{empty:m(()=>[e("div",Je,[e("div",Xe,[o[4]||(o[4]=e("div",{class:"mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-primary/10"},[e("svg",{class:"h-8 w-8 text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)),o[5]||(o[5]=e("div",{class:"space-y-2"},[e("h3",{class:"text-xl font-semibold"},"Все события просмотрены"),e("p",{class:"text-sm leading-relaxed text-muted-foreground"},[x(" Вы посмотрели все доступные рекомендации."),e("br"),x(" Попробуйте изменить фильтры или вернитесь позже. ")])],-1)),e("div",Ye,[d(t(y),{variant:"default",size:"lg",class:"w-full bg-gradient-to-r from-primary to-primary/80 text-primary-foreground hover:from-primary/90 hover:to-primary font-medium",onClick:t(P)},{default:m(()=>[...o[2]||(o[2]=[x(" Изменить фильтры ",-1)])]),_:1},8,["onClick"]),d(t(y),{variant:"outline",size:"lg",class:"w-full border-border/70 bg-card/60 font-medium hover:bg-card",onClick:o[0]||(o[0]=w=>O("Карта скоро будет доступна"))},{default:m(()=>[...o[3]||(o[3]=[x(" Открыть карту ",-1)])]),_:1})])])])]),_:1},8,["items","loading"])]),d(b,null,{default:m(()=>[t(A)?(u(),c("div",{key:0,class:"fixed inset-0 z-40 flex items-end bg-black/60 px-4 pb-6",onClick:J(n,["self"])},[e("div",Ke,[e("div",Qe,[o[7]||(o[7]=e("div",{class:"space-y-1"},[e("h3",{class:"text-lg font-semibold"},"Как работают рекомендации"),e("p",{class:"text-sm text-muted-foreground"}," Алгоритм учится по вашим свайпам: вправо — “нравится”, влево — “пропустить”. Чем больше действий, тем точнее лента. ")],-1)),d(t(y),{variant:"ghost",size:"sm",class:"-mr-2 -mt-2",onClick:n},{default:m(()=>[...o[6]||(o[6]=[x("Закрыть",-1)])]),_:1})]),d(t(y),{class:"mt-4 w-full",size:"lg",onClick:n},{default:m(()=>[...o[8]||(o[8]=[x("Понятно",-1)])]),_:1})])])):_("",!0)]),_:1}),d(t(ye),{modelValue:t(g),"onUpdate:modelValue":o[1]||(o[1]=w=>be(g)?g.value=w:null),class:"max-h-[90vh] overflow-y-auto border-border bg-card text-foreground backdrop-blur-xl shadow-2xl"},{default:m(()=>[t(r)?(u(),c("div",We,[e("div",Ze,[e("div",et,[o[10]||(o[10]=e("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-primary/80"}," Детали события ",-1)),e("h3",tt,v(t(r).title),1),e("div",ot,[o[9]||(o[9]=e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),e("span",null,v(N(t(r).start_time)),1)])]),d(t(y),{variant:"ghost",size:"sm",class:"text-muted-foreground hover:text-foreground -mr-2",onClick:h},{default:m(()=>[...o[11]||(o[11]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),_:1})]),e("div",st,[e("div",rt,[e("p",it,v(t(r).description||"Описание события скоро появится."),1),t(r).venue_name||t(r).city?(u(),c("div",at,[o[12]||(o[12]=e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),e("span",null,v(t(r).venue_name||t(r).city),1)])):_("",!0),d(V,{to:`/e/${t(r).slug}`,class:"inline-flex items-center gap-2 text-sm font-medium text-primary transition-colors hover:text-primary/80"},{default:m(()=>[...o[13]||(o[13]=[x(" Подробнее ",-1),e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 3h7m0 0v7m0-7L10 14"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 5v14h14"})],-1)])]),_:1},8,["to"])]),t(r).tags?.length?(u(),c("div",nt,[(u(!0),c(ke,null,he(t(r).tags,w=>(u(),c("span",{key:w,class:"rounded-lg bg-muted/60 px-3 py-1.5 text-xs font-medium text-muted-foreground backdrop-blur-sm"},v(w),1))),128))])):_("",!0)]),e("div",lt,[d(t(y),{class:E(["flex-1 font-medium",t(I)?"bg-muted text-foreground hover:bg-muted/80":"bg-gradient-to-r from-primary to-primary/80 text-primary-foreground hover:from-primary/90 hover:to-primary"]),size:"lg",onClick:M},{default:m(()=>[x(v(t(I)?"Вы идёте":"Я иду"),1)]),_:1},8,["class"]),d(t(y),{variant:"outline",size:"lg",class:"flex-1 border-border/70 bg-card/60 font-medium hover:bg-card",onClick:h},{default:m(()=>[...o[14]||(o[14]=[x(" Назад ",-1)])]),_:1})])])):_("",!0)]),_:1},8,["modelValue"]),d(X,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":"translate-y-2 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-200 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-2 opacity-0"},{default:m(()=>[t(S)?(u(),c("div",dt,v(t(S)),1)):_("",!0)]),_:1})])}}}),ct={class:"relative flex h-full w-full flex-col lg:flex-row"},mt={class:"absolute left-0 top-0 z-50 w-full p-2 pt-[calc(env(safe-area-inset-top)+0.5rem)] lg:static lg:w-auto lg:p-6 lg:pt-6"},pt={class:"relative z-0 flex min-h-0 flex-1 items-center justify-center overflow-hidden px-2 pb-2 pt-24 lg:px-6 lg:pb-6 lg:pt-6"},Lt=H({__name:"index",setup(j){return(f,z)=>(u(),c("div",ct,[e("div",mt,[d(ne,{items:t(le),class:"lg:!static lg:!top-0"},null,8,["items"])]),e("main",pt,[d(ut,{class:"h-full w-full"})])]))}});export{Lt as default};
