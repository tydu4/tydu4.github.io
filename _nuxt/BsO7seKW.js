import{H as pe,p as me}from"./By8OhNrP.js";import{d as Y,n as fe,C as ve,p as T,D as be,o as p,c as m,a as t,b as n,_ as ge,u as s,w as q,f as L,t as c,B as Q,e as K,M as i,W,$ as X,a0 as xe,j as v,r as a}from"./DUSKV69B.js";import f from"./CXwJNjwb.js";import ye from"./RV7DZdDJ.js";import"./DlAUqK2U.js";import"./D_fppIDC.js";import"./DvKiIxB7.js";import"./C6br2r2Y.js";import"./BkVHlTuu.js";import"./vt-yVw7v.js";import"./DyhqVQhY.js";import"./CMKBuKYn.js";import"./BCRJ9o_f.js";const _e={class:"mx-auto w-full max-w-3xl space-y-6 pb-10"},we={class:"rounded-3xl border border-border bg-card p-6 shadow-soft"},he={key:0,class:"space-y-3"},ke={key:1,class:"rounded-2xl border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive"},Ve={key:2,class:"space-y-4 rounded-3xl border border-border bg-card p-6 shadow-soft"},Ue={class:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between"},Pe={class:"flex items-center gap-4"},Ae={class:"h-20 w-20 overflow-hidden rounded-full border-4 border-background bg-primary/10 shadow-soft"},Ce=["src","alt"],Se={key:1,class:"flex h-full w-full items-center justify-center text-2xl font-bold text-primary"},je={class:"min-w-0"},Be={class:"truncate text-lg font-bold text-foreground"},Ee={class:"truncate text-sm text-muted-foreground"},Fe={class:"flex flex-col items-start gap-2"},Ne={key:0,class:"text-xs text-muted-foreground"},Me={class:"grid gap-4"},Re={class:"space-y-2"},Te={key:0,class:"text-xs text-destructive"},Le={class:"space-y-2"},De={class:"flex items-center justify-between text-xs"},Ie={key:0,class:"text-destructive"},$e={class:"ml-auto text-muted-foreground"},He={class:"space-y-4 rounded-3xl border border-border bg-card p-6 shadow-soft"},Oe={class:"grid gap-4 sm:grid-cols-2"},ze={class:"space-y-2"},qe={class:"space-y-2"},Ke={class:"grid gap-4 sm:grid-cols-3"},We={class:"space-y-2"},Ze={class:"space-y-2"},Ge={class:"space-y-2"},Je={class:"space-y-4 rounded-3xl border border-border bg-card p-6 shadow-soft"},Qe={class:"flex items-start gap-3 rounded-2xl border border-border px-4 py-3 text-sm text-muted-foreground"},Xe={class:"space-y-4 rounded-3xl border border-border bg-card p-6 shadow-soft"},Ye={class:"grid gap-4 sm:grid-cols-3"},et={class:"space-y-2"},tt={class:"space-y-2"},st={class:"space-y-2"},ot={class:"space-y-4 rounded-3xl border border-border bg-card p-6 shadow-soft"},lt={class:"grid gap-4 sm:grid-cols-2"},at={class:"space-y-2"},rt={class:"flex items-start gap-3 rounded-2xl border border-border px-4 py-3 text-sm text-muted-foreground"},nt={class:"flex items-center justify-between gap-3"},it={class:"text-xs text-muted-foreground"},dt=Y({__name:"ProfileSettingsBlock",setup(ee){const d=fe(),{data:Z,pending:G,error:te,refresh:D}=ve("settings-profile",async()=>!d.isAuthInitialized||!d.token?null:await d.apiFetch("/api/v1/me/profile",{baseURL:T("/api/v1/me/profile")}),{server:!1,default:()=>null,watch:[()=>d.token,()=>d.isAuthInitialized]}),u=v(()=>Z.value??null),I=v(()=>u.value?.full_name?.trim()||u.value?.username||"Profile"),se=v(()=>I.value.trim().charAt(0).toUpperCase()||"U"),oe=v(()=>u.value?.uuid?`/u/${u.value.uuid}`:"/profile/me"),b=a(""),g=a(""),x=a(""),_=a(""),w=a(""),h=a(""),k=a(!1),V=a(!0),U=a("public"),C=a(""),S=a(""),j=a(""),B=a(""),E=a(""),F=a(null),N=a(!1),P=a(""),M=a(!1),R=a(""),le=/^[a-zA-Z0-9_]+$/,$=l=>typeof l!="string"?"":l.trim();be(u,l=>{if(!l)return;b.value=l.username||"",g.value=l.bio||"",x.value=l.avatar_url||"";const e=l.social_links&&typeof l.social_links=="object"?l.social_links:{};_.value=$(e.telegram),w.value=$(e.vk),h.value=$(e.instagram);const r=l.settings&&typeof l.settings=="object"?l.settings:{},o=r.contact_privacy;k.value=o==="buddies_only"||o==="matches_only";const z=typeof r.privacy_level=="string"?r.privacy_level:"public";U.value=z==="nobody"?"nobody":"public";const y=r.notifications;V.value=typeof y=="boolean"?y:!0,C.value=l.email||"",S.value="",j.value="",B.value="",E.value=""},{immediate:!0});const H=v(()=>{const l=b.value.trim();return l?l.length<3?"Minimum 3 symbols":l.length>50?"Maximum 50 symbols":le.test(l)?"":'Only latin letters, numbers and "_"':"Username is required"}),O=v(()=>g.value.length>500?"Bio must be <= 500 symbols":""),ae=v(()=>!!(H.value||O.value)),J=v(()=>!M.value&&!G.value&&!ae.value),re=()=>D(),ne=()=>F.value?.click(),ie=l=>{if(!l)return"";if(typeof l=="string")return l;if(typeof l!="object")return"";const e=l,r=e.avatar_url||e.url||e.image_url;if(typeof r=="string")return r;if(e.user&&typeof e.user=="object"){const o=e.user.avatar_url;if(typeof o=="string")return o}if(e.data&&typeof e.data=="object"){const o=e.data.avatar_url||e.data.url;if(typeof o=="string")return o}return""},de=async l=>{const r=l.target.files?.[0];if(r){N.value=!0,P.value="";try{const o=new FormData;o.append("file",r);const z=await d.apiFetch("/api/v1/me/avatar",{method:"POST",baseURL:T("/api/v1/me/avatar"),body:o}),y=ie(z);y&&(x.value=y),await D(),!y&&u.value?.avatar_url&&(x.value=u.value.avatar_url),P.value="Avatar uploaded"}catch{P.value="Avatar upload failed"}finally{N.value=!1,F.value&&(F.value.value="")}}},A=l=>l.trim()||null,ue=l=>{const e=l?.data?.detail;if(typeof e=="string")return e;if(Array.isArray(e)&&e.length>0){const r=e[0];if(r?.msg)return r.msg}return""},ce=async()=>{if(R.value="",!!J.value){M.value=!0;try{const l={username:b.value.trim(),bio:A(g.value),avatar_url:A(x.value),social_links:{telegram:A(_.value),vk:A(w.value),instagram:A(h.value)}};await d.apiFetch("/api/v1/me/profile",{method:"PATCH",baseURL:T("/api/v1/me/profile"),body:l});const r={...u.value?.settings&&typeof u.value.settings=="object"?u.value.settings:{},contact_privacy:k.value?"buddies_only":"all",privacy_level:U.value,notifications:V.value};await d.apiFetch("/api/v1/me/settings",{method:"PATCH",baseURL:T("/api/v1/me/settings"),body:r}),R.value="Profile saved",await D(),await d.fetchUser()}catch(l){const e=ue(l);R.value=e||"Failed to save changes"}finally{M.value=!1}}};return(l,e)=>{const r=ge;return p(),m("div",_e,[t("section",we,[e[14]||(e[14]=t("p",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-primary/80"},"Profile Settings",-1)),e[15]||(e[15]=t("h1",{class:"mt-2 text-2xl font-bold text-foreground"},"Profile Settings",-1)),e[16]||(e[16]=t("p",{class:"mt-2 text-sm text-muted-foreground"}," Fill social links for Buddy Finder. ",-1)),n(r,{to:s(oe),class:"mt-3 inline-flex text-sm font-medium text-primary underline-offset-4 hover:underline"},{default:q(()=>[...e[13]||(e[13]=[L(" Open public profile ",-1)])]),_:1},8,["to"])]),s(G)?(p(),m("section",he,[...e[17]||(e[17]=[t("div",{class:"h-32 animate-pulse rounded-2xl bg-muted"},null,-1),t("div",{class:"h-64 animate-pulse rounded-2xl bg-muted"},null,-1)])])):s(te)?(p(),m("section",ke,[e[18]||(e[18]=L(" Failed to load settings. ",-1)),t("button",{type:"button",class:"ml-2 underline",onClick:re},"Refresh")])):(p(),m("section",Ve,[t("div",Ue,[t("div",Pe,[t("div",Ae,[s(x)?(p(),m("img",{key:0,src:s(x),alt:s(I),class:"h-full w-full object-cover"},null,8,Ce)):(p(),m("div",Se,c(s(se)),1))]),t("div",je,[t("h2",Be,c(s(I)),1),t("p",Ee,"@"+c(s(b)||"username"),1)])]),t("div",Fe,[n(s(Q),{variant:"outline",class:"rounded-full",type:"button",disabled:s(N),onClick:ne},{default:q(()=>[L(c(s(N)?"Uploading...":"Upload avatar"),1)]),_:1},8,["disabled"]),t("input",{ref_key:"avatarInput",ref:F,type:"file",accept:"image/*",class:"hidden",onChange:de},null,544),s(P)?(p(),m("p",Ne,c(s(P)),1)):K("",!0)])]),t("div",Me,[t("div",Re,[e[19]||(e[19]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Username ",-1)),n(s(f),{modelValue:s(b),"onUpdate:modelValue":e[0]||(e[0]=o=>i(b)?b.value=o:null),type:"text",placeholder:"my_username",autocomplete:"off"},null,8,["modelValue"]),s(H)?(p(),m("p",Te,c(s(H)),1)):K("",!0)]),t("div",Le,[e[20]||(e[20]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Bio ",-1)),n(s(ye),{modelValue:s(g),"onUpdate:modelValue":e[1]||(e[1]=o=>i(g)?g.value=o:null),rows:5,maxlength:"500",placeholder:"Tell about yourself"},null,8,["modelValue"]),t("div",De,[s(O)?(p(),m("p",Ie,c(s(O)),1)):K("",!0),t("span",$e,c(s(g).length)+"/500",1)])])])])),t("section",He,[e[26]||(e[26]=t("div",null,[t("h2",{class:"text-lg font-bold text-foreground"},"Account"),t("p",{class:"text-sm text-muted-foreground"}," Email and password updates will be available soon. ")],-1)),t("div",Oe,[t("div",ze,[e[21]||(e[21]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Current Email ",-1)),n(s(f),{modelValue:s(C),"onUpdate:modelValue":e[2]||(e[2]=o=>i(C)?C.value=o:null),type:"email",placeholder:"name@example.com",disabled:""},null,8,["modelValue"])]),t("div",qe,[e[22]||(e[22]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," New Email ",-1)),n(s(f),{modelValue:s(S),"onUpdate:modelValue":e[3]||(e[3]=o=>i(S)?S.value=o:null),type:"email",placeholder:"name@example.com",disabled:""},null,8,["modelValue"])])]),t("div",Ke,[t("div",We,[e[23]||(e[23]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Current Password ",-1)),n(s(f),{modelValue:s(j),"onUpdate:modelValue":e[4]||(e[4]=o=>i(j)?j.value=o:null),type:"password",placeholder:"••••••••",disabled:""},null,8,["modelValue"])]),t("div",Ze,[e[24]||(e[24]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," New Password ",-1)),n(s(f),{modelValue:s(B),"onUpdate:modelValue":e[5]||(e[5]=o=>i(B)?B.value=o:null),type:"password",placeholder:"••••••••",disabled:""},null,8,["modelValue"])]),t("div",Ge,[e[25]||(e[25]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Confirm Password ",-1)),n(s(f),{modelValue:s(E),"onUpdate:modelValue":e[6]||(e[6]=o=>i(E)?E.value=o:null),type:"password",placeholder:"••••••••",disabled:""},null,8,["modelValue"])])])]),t("section",Je,[e[28]||(e[28]=t("div",null,[t("h2",{class:"text-lg font-bold text-foreground"},"Notifications"),t("p",{class:"text-sm text-muted-foreground"}," Choose how we notify you about updates. ")],-1)),t("label",Qe,[W(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>i(V)?V.value=o:null),type:"checkbox",class:"mt-0.5 h-4 w-4 accent-primary"},null,512),[[X,s(V)]]),e[27]||(e[27]=t("span",null,"Enable notifications",-1))])]),t("section",Xe,[e[32]||(e[32]=t("div",null,[t("h2",{class:"text-lg font-bold text-foreground"},"Social Links"),t("p",{class:"text-sm text-muted-foreground"}," Required for Buddy Finder. ")],-1)),t("div",Ye,[t("div",et,[e[29]||(e[29]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"},"Telegram",-1)),n(s(f),{modelValue:s(_),"onUpdate:modelValue":e[8]||(e[8]=o=>i(_)?_.value=o:null),type:"text",placeholder:"@username"},null,8,["modelValue"])]),t("div",tt,[e[30]||(e[30]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"},"VK",-1)),n(s(f),{modelValue:s(w),"onUpdate:modelValue":e[9]||(e[9]=o=>i(w)?w.value=o:null),type:"text",placeholder:"id or username"},null,8,["modelValue"])]),t("div",st,[e[31]||(e[31]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"},"Instagram",-1)),n(s(f),{modelValue:s(h),"onUpdate:modelValue":e[10]||(e[10]=o=>i(h)?h.value=o:null),type:"text",placeholder:"@username"},null,8,["modelValue"])])])]),t("section",ot,[e[36]||(e[36]=t("h2",{class:"text-lg font-bold text-foreground"},"Privacy",-1)),t("div",lt,[t("div",at,[e[34]||(e[34]=t("label",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Profile visibility ",-1)),W(t("select",{"onUpdate:modelValue":e[11]||(e[11]=o=>i(U)?U.value=o:null),class:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm"},[...e[33]||(e[33]=[t("option",{value:"public"},"Public",-1),t("option",{value:"nobody"},"Hidden",-1)])],512),[[xe,s(U)]])])]),t("label",rt,[W(t("input",{"onUpdate:modelValue":e[12]||(e[12]=o=>i(k)?k.value=o:null),type:"checkbox",class:"mt-0.5 h-4 w-4 accent-primary"},null,512),[[X,s(k)]]),e[35]||(e[35]=t("span",null,"Show contacts only to Matches",-1))]),t("div",nt,[t("p",it,c(s(R)),1),n(s(Q),{class:"rounded-full px-5",type:"button",disabled:!s(J),onClick:ce},{default:q(()=>[L(c(s(M)?"Saving...":"Save"),1)]),_:1},8,["disabled"])])])])}}}),ut={class:"page-wrapper"},ct={class:"flex min-h-[calc(100dvh-9rem)] flex-col gap-4 lg:flex-row lg:items-start lg:gap-6"},pt={class:"min-w-0 flex-1"},Pt=Y({__name:"index",setup(ee){return(d,Z)=>(p(),m("div",ut,[t("div",ct,[n(pe,{items:s(me),class:"shrink-0"},null,8,["items"]),t("div",pt,[n(dt)])])]))}});export{Pt as default};
