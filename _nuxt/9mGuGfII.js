import{d as M,c as a,a as u,b,u as e,w as z,F as B,E as P,f as V,o as r,B as j,k as T,t as $,e as L,C as O,r as I,G as ae,j as v,g as ue,J as ie,R as H,a6 as de,x as J,m as ce,I as me,A as Z,n as F,q as ve}from"./BvmsJYLR.js";import{E as fe,S as pe,B as ge}from"./ailpZpTl.js";import{M as be}from"./B7XCgDfu.js";import{C as ye}from"./C8vofjsm.js";import{N as he}from"./C6rC-zF7.js";import{L as Y}from"./C8imrU26.js";import{C as we}from"./Ckb9_sJ4.js";import{C as xe}from"./BRdF3y4B.js";/* empty css        */import{_ as _e}from"./DlAUqK2U.js";import{e as ke}from"./Cv8_oF2L.js";import"./5xDXAavj.js";const $e={class:"space-y-4 rounded-3xl border border-border bg-card p-5 shadow-soft sm:p-6"},Ce={class:"flex items-center justify-between gap-2"},Le={key:0,class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},Ie={key:1,class:"rounded-2xl border border-destructive/30 bg-destructive/10 p-4 text-sm text-destructive"},Re={key:2,class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},Se={key:3,class:"rounded-2xl border border-border bg-muted/20 p-4 text-sm text-muted-foreground"},Ee=M({__name:"VenueEventsList",props:{pending:{type:Boolean},hasError:{type:Boolean},events:{}},emits:["retry"],setup(o,{emit:l}){const t=l;return(f,n)=>(r(),a("section",$e,[u("div",Ce,[n[3]||(n[3]=u("h2",{class:"text-xl font-semibold text-foreground"},"Афиша площадки",-1)),b(e(j),{variant:"outline",size:"sm",onClick:n[0]||(n[0]=i=>t("retry"))},{default:z(()=>[...n[2]||(n[2]=[V("Обновить",-1)])]),_:1})]),o.pending?(r(),a("div",Le,[(r(),a(B,null,P(3,i=>b(pe,{key:`venue-events-skeleton-${i}`})),64))])):o.hasError?(r(),a("div",Ie,[n[4]||(n[4]=V(" Не удалось загрузить афишу площадки. ",-1)),u("button",{type:"button",class:"ml-2 underline",onClick:n[1]||(n[1]=i=>t("retry"))},"Обновить")])):o.events.length?(r(),a("div",Re,[(r(!0),a(B,null,P(o.events,i=>(r(),T(fe,{key:i.uuid,event:i,"show-tags":!0,"show-going-badge":!1},null,8,["event"]))),128))])):(r(),a("div",Se," На этой площадке пока нет запланированных событий. "))]))}}),Be={class:"space-y-4 rounded-3xl border border-border bg-card p-5 shadow-soft sm:p-6"},Ve={class:"flex flex-wrap items-start justify-between gap-4"},Me={class:"space-y-3"},Ne={class:"text-2xl font-bold text-foreground sm:text-3xl"},Ae={class:"flex items-center gap-2 text-sm text-muted-foreground"},ze={key:0,class:"flex items-center gap-2 text-sm text-muted-foreground"},Pe={class:"flex flex-wrap items-center gap-2 text-xs font-medium text-muted-foreground"},je={class:"rounded-full bg-muted px-3 py-1"},Oe={class:"rounded-full bg-muted px-3 py-1"},Ue={class:"flex flex-wrap gap-2"},De={key:0,class:"text-sm leading-relaxed text-muted-foreground"},Fe=M({__name:"VenueHeader",props:{venueName:{},venueAddress:{},workingHours:{},followersLabel:{},eventsLabel:{},followPending:{type:Boolean},followState:{type:Boolean},followButtonLabel:{},venueDescription:{}},emits:["show-map","follow"],setup(o,{emit:l}){const t=l;return(f,n)=>(r(),a("section",Be,[u("div",Ve,[u("div",Me,[u("h1",Ne,$(o.venueName),1),u("p",Ae,[b(e(be),{class:"h-4 w-4 text-primary"}),u("span",null,$(o.venueAddress),1)]),o.workingHours?(r(),a("p",ze,[b(e(ye),{class:"h-4 w-4 text-primary"}),u("span",null,$(o.workingHours),1)])):L("",!0),u("div",Pe,[u("span",je,$(o.followersLabel),1),u("span",Oe,$(o.eventsLabel),1)])]),u("div",Ue,[b(e(j),{variant:"outline",class:"gap-2",onClick:n[0]||(n[0]=i=>t("show-map"))},{default:z(()=>[b(e(he),{class:"h-4 w-4"}),n[2]||(n[2]=V(" Показать на карте ",-1))]),_:1}),b(e(j),{class:"gap-2",disabled:o.followPending||o.followState,onClick:n[1]||(n[1]=i=>t("follow"))},{default:z(()=>[o.followPending?(r(),T(e(Y),{key:0,class:"h-4 w-4 animate-spin"})):(r(),T(e(ge),{key:1,class:"h-4 w-4"})),V(" "+$(o.followButtonLabel),1)]),_:1},8,["disabled"])])]),o.venueDescription?(r(),a("p",De,$(o.venueDescription),1)):L("",!0)]))}}),Te={class:"space-y-4 rounded-3xl border border-border bg-card p-5 shadow-soft sm:p-6"},Ge={class:"flex items-center justify-between gap-2"},qe={key:0,class:"rounded-full bg-muted px-2.5 py-1 text-xs font-semibold text-muted-foreground"},He={class:"relative overflow-hidden rounded-2xl border border-border bg-muted/20"},Ze=["src","alt"],Je={key:0,class:"flex gap-2 overflow-x-auto pb-1"},Ye=["aria-label","onClick"],Ke=["src","alt"],Qe={key:1,class:"rounded-2xl border border-border bg-muted/20 p-4 text-sm text-muted-foreground"},We=M({__name:"VenueInfo",props:{galleryImages:{},venueName:{}},setup(o){const l=o,t=I(0),f=v(()=>l.galleryImages.length>0),n=v(()=>l.galleryImages.length>1),i=v(()=>l.galleryImages[t.value]||""),p=()=>{n.value&&(t.value=t.value>0?t.value-1:l.galleryImages.length-1)},h=()=>{n.value&&(t.value=t.value<l.galleryImages.length-1?t.value+1:0)},C=x=>{x<0||x>=l.galleryImages.length||(t.value=x)};return O(()=>l.galleryImages,()=>{t.value=0},{immediate:!0}),(x,y)=>(r(),a("section",Te,[u("div",Ge,[y[0]||(y[0]=u("h2",{class:"text-xl font-semibold text-foreground"},"Галерея",-1)),e(f)?(r(),a("span",qe,$(e(t)+1)+" / "+$(l.galleryImages.length),1)):L("",!0)]),e(f)?(r(),a(B,{key:0},[u("div",He,[u("img",{src:e(i),alt:`${l.venueName} - фото ${e(t)+1}`,class:"h-[240px] w-full object-cover sm:h-[340px]",loading:"lazy"},null,8,Ze),e(n)?(r(),a("button",{key:0,type:"button",class:"absolute left-3 top-1/2 inline-flex h-10 w-10 -translate-y-1/2 items-center justify-center rounded-full border border-white/30 bg-black/35 text-white transition hover:bg-black/55","aria-label":"Предыдущее фото",onClick:p},[b(e(we),{class:"h-5 w-5"})])):L("",!0),e(n)?(r(),a("button",{key:1,type:"button",class:"absolute right-3 top-1/2 inline-flex h-10 w-10 -translate-y-1/2 items-center justify-center rounded-full border border-white/30 bg-black/35 text-white transition hover:bg-black/55","aria-label":"Следующее фото",onClick:h},[b(e(xe),{class:"h-5 w-5"})])):L("",!0)]),e(n)?(r(),a("div",Je,[(r(!0),a(B,null,P(l.galleryImages,(_,k)=>(r(),a("button",{key:`${_}-${k}`,type:"button",class:ae(["h-16 w-24 flex-shrink-0 overflow-hidden rounded-xl border transition",k===e(t)?"border-primary ring-1 ring-primary/60":"border-border hover:border-primary/40"]),"aria-label":`Открыть фото ${k+1}`,onClick:N=>C(k)},[u("img",{src:_,alt:`${l.venueName} - миниатюра ${k+1}`,class:"h-full w-full object-cover",loading:"lazy"},null,8,Ke)],10,Ye))),128))])):L("",!0)],64)):(r(),a("div",Qe," Фотографии площадки скоро появятся. "))]))}}),Xe={class:"flex items-center justify-between gap-2"},et={key:0,class:"relative overflow-hidden rounded-2xl border border-border bg-muted/20"},tt={key:0,class:"pointer-events-none absolute inset-0 flex items-center justify-center bg-card/50"},ot={key:1,class:"rounded-2xl border border-border bg-muted/20 p-4 text-sm text-muted-foreground"},nt={key:2,class:"text-sm text-destructive"},st=M({__name:"VenueLocationSection",props:{lat:{default:null},lon:{default:null},address:{default:""},city:{default:""}},setup(o,{expose:l}){const t=o,f={version:8,sources:{osm:{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"&copy; OpenStreetMap contributors"}},layers:[{id:"osm",type:"raster",source:"osm"}]},n=I(null),i=I(null),p=H(null),h=H(null),C=I(!1),x=I(""),y=v(()=>{const c=Number(t.lat),m=Number(t.lon);return!Number.isFinite(c)||!Number.isFinite(m)?null:{lat:c,lon:m}}),_=v(()=>{const c=y.value;if(c){const d=`${c.lat},${c.lon}`;return`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(d)}`}const m=[t.address,t.city].filter(d=>!!d?.trim()).join(", ");return m?`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(m)}`:""}),k=()=>{_.value&&window.open(_.value,"_blank","noopener,noreferrer")},N=()=>{h.value?.remove(),h.value=null,p.value?.remove(),p.value=null},A=()=>{const c=y.value;!c||!p.value||(h.value?.setLngLat([c.lon,c.lat]),p.value.setCenter([c.lon,c.lat]))},E=async()=>{if(!(!i.value||!y.value)){if(x.value="",p.value){A(),p.value.resize();return}C.value=!0;try{const c=(await de(async()=>{const{default:U}=await import("./kZj0XkdK.js").then(D=>D.m);return{default:U}},[],import.meta.url)).default,m=y.value,d=i.value;if(!m||!d)return;const g=new c.Map({container:d,style:f,center:[m.lon,m.lat],zoom:14,attributionControl:!1});g.scrollZoom.disable(),g.boxZoom.disable(),g.doubleClickZoom.disable(),g.dragRotate.disable(),g.dragPan.disable(),g.touchZoomRotate.disable(),g.touchZoomRotate.disableRotation(),g.keyboard.disable(),g.on("click",()=>{k()}),g.on("load",()=>{g.resize()}),h.value=new c.Marker({color:"#ef4444"}).setLngLat([m.lon,m.lat]).addTo(g),p.value=g}catch{x.value="Не удалось загрузить карту."}finally{C.value=!1}}};return l({showOnMap:()=>{if(!y.value){k();return}n.value?.scrollIntoView({behavior:"smooth",block:"start"}),E()}}),O(y,c=>{if(!c){N();return}if(p.value){A();return}i.value&&E()}),O(i,c=>{!c||!y.value||E()}),ue(()=>{y.value&&E()}),ie(()=>{N()}),(c,m)=>(r(),a("section",{ref_key:"mapSectionRef",ref:n,class:"space-y-4 rounded-3xl border border-border bg-card p-5 shadow-soft sm:p-6"},[u("div",Xe,[m[1]||(m[1]=u("h2",{class:"text-xl font-semibold text-foreground"},"Карта",-1)),b(e(j),{variant:"outline",size:"sm",disabled:!e(_),onClick:k},{default:z(()=>[...m[0]||(m[0]=[V(" Открыть навигатор ",-1)])]),_:1},8,["disabled"])]),e(y)?(r(),a("div",et,[u("div",{ref_key:"mapContainerRef",ref:i,class:"venue-map h-[320px] w-full"},null,512),m[2]||(m[2]=u("div",{class:"pointer-events-none absolute left-3 top-3 rounded-full bg-card/90 px-3 py-1 text-xs font-medium text-foreground"}," Нажмите на карту, чтобы открыть маршрут ",-1)),e(C)?(r(),a("div",tt,[b(e(Y),{class:"h-6 w-6 animate-spin text-primary"})])):L("",!0)])):(r(),a("div",ot," Координаты площадки пока не указаны. ")),e(x)?(r(),a("p",nt,$(e(x)),1)):L("",!0)],512))}}),rt=_e(st,[["__scopeId","data-v-3f1e9d26"]]),lt=o=>{const l=o.occurrences?.[0],t=l?.venue??null,f=o.default_venue??t,n=o.images?.[0]?.url??null;return{id:o.id,uuid:o.uuid,title:o.title,description:o.description??"",slug:o.slug,main_image:n,venue_name:f?.name??l?.location_name??null,city:f?.city?.trim()||"Не указан",start_time:l?.start_time??null,tags:o.tags?.map(i=>i.name).filter(i=>!!i?.trim())??[],going_count:0,going_avatars:[]}},at=(o,l)=>{if(!l)return!0;const t=o.default_venue_id;if(typeof t=="number")return t===l;const f=o.default_venue?.id;if(typeof f=="number")return f===l;const n=o.occurrences?.[0]?.venue?.id;return typeof n=="number"?n===l:!0},ut={class:"mx-auto w-full max-w-6xl space-y-5 pb-10"},it={key:0,class:"space-y-4"},dt={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},ct={key:1,class:"rounded-2xl border border-destructive/30 bg-destructive/10 p-4 text-sm text-destructive"},mt=M({__name:"VenueMainBlock",setup(o){const l=J(),t=ce(),f=me(),n=I(null),i=I(!1),p=I(!1),h=v(()=>{const s=l.params.slug;return Array.isArray(s)?s[0]||"":String(s||"")}),C=v(()=>encodeURIComponent(h.value)),x=v(()=>`/api/v1/public/venues/${C.value}`),y=v(()=>`/api/v1/public/venues/${C.value}/events`),{data:_,pending:k,error:N,refresh:A}=Z("public-venue-profile",async()=>h.value?await t.apiFetch(x.value,{baseURL:F(x.value)}):null,{server:!1,default:()=>null,watch:[h,()=>t.token,()=>t.isAuthInitialized]}),{data:E,pending:G,error:c,refresh:m}=Z("public-venue-events",async()=>h.value?await t.apiFetch(y.value,{baseURL:F(y.value),query:{limit:24}}):[],{server:!1,default:()=>[],watch:[h,()=>t.token,()=>t.isAuthInitialized]}),d=v(()=>_.value??null);O(d,s=>{p.value=!!s?.is_following},{immediate:!0});const g=v(()=>d.value?.name?.trim()||"Площадка"),U=v(()=>{const s=d.value?.address?.trim(),w=d.value?.city?.trim();return s&&w&&!s.toLocaleLowerCase("ru-RU").includes(w.toLocaleLowerCase("ru-RU"))?`${s}, ${w}`:s||w||"Адрес уточняется"}),D=v(()=>d.value?.description?.trim()||""),K=v(()=>{const s=d.value;if(!s)return"";const w=[s.working_hours,s.opening_hours,s.schedule,s.work_time];for(const S of w)if(typeof S=="string"&&S.trim())return S.trim();const R=s.social_links;if(R&&typeof R=="object"&&!Array.isArray(R)){const S=R.working_hours??R.hours;if(typeof S=="string"&&S.trim())return S.trim()}return""}),Q=v(()=>(d.value?.images??[]).filter(s=>typeof s=="string"&&s.trim().length>0).map(s=>s.trim())),q=s=>new Intl.NumberFormat("ru-RU").format(Math.max(0,s)),W=v(()=>`${q(d.value?.followers_count??0)} подписчиков`),X=v(()=>`${q(d.value?.events_count??0)} событий`),ee=v(()=>i.value?"Подписываем...":p.value?"Вы подписаны":"Подписаться"),te=async()=>{const s=encodeURIComponent(l.fullPath||`/venue/${h.value}`);await ve(`/login?redirect=${s}`)},oe=()=>{n.value?.showOnMap()},ne=v(()=>(E.value??[]).filter(s=>at(s,d.value?.id??null)).map(lt)),se=async()=>{if(!(i.value||p.value||!h.value)){if(!t.isAuthenticated){await te();return}i.value=!0;try{const s=`/api/v1/public/venues/${C.value}/follow`;await t.apiFetch(s,{method:"POST",baseURL:F(s)}),p.value=!0,_.value&&(_.value={..._.value,is_following:!0,followers_count:Math.max(_.value.followers_count??0,0)+1}),f.push({level:"success",title:"Подписка оформлена",message:"Вы подписались на обновления площадки."})}catch(s){f.push({level:"error",title:"Ошибка подписки",message:ke(s,"Не удалось оформить подписку. Попробуйте еще раз.")})}finally{i.value=!1}}},re=()=>{A()},le=()=>{m()};return(s,w)=>(r(),a("div",ut,[e(k)&&!e(d)?(r(),a("section",it,[w[0]||(w[0]=u("div",{class:"h-40 animate-pulse rounded-3xl bg-muted"},null,-1)),w[1]||(w[1]=u("div",{class:"h-72 animate-pulse rounded-3xl bg-muted"},null,-1)),u("div",dt,[(r(),a(B,null,P(6,R=>u("div",{key:`venue-page-skeleton-${R}`,class:"h-72 animate-pulse rounded-2xl bg-muted"})),64))])])):e(N)||!e(d)?(r(),a("section",ct,[w[2]||(w[2]=V(" Не удалось загрузить страницу площадки. ",-1)),u("button",{type:"button",class:"ml-2 underline",onClick:re},"Обновить")])):(r(),a(B,{key:2},[b(Fe,{"venue-name":e(g),"venue-address":e(U),"working-hours":e(K),"followers-label":e(W),"events-label":e(X),"follow-pending":e(i),"follow-state":e(p),"follow-button-label":e(ee),"venue-description":e(D),onShowMap:oe,onFollow:se},null,8,["venue-name","venue-address","working-hours","followers-label","events-label","follow-pending","follow-state","follow-button-label","venue-description"]),b(We,{"gallery-images":e(Q),"venue-name":e(g)},null,8,["gallery-images","venue-name"]),b(Ee,{pending:e(G),"has-error":!!e(c),events:e(ne),onRetry:le},null,8,["pending","has-error","events"]),b(rt,{ref_key:"venueLocationSectionRef",ref:n,lat:e(d)?.lat??null,lon:e(d)?.lon??null,address:e(d)?.address??"",city:e(d)?.city??""},null,8,["lat","lon","address","city"])],64))]))}}),vt={class:"page-wrapper"},Lt=M({__name:"index",setup(o){const l=J(),t=v(()=>l.params.slug);return(f,n)=>(r(),a("div",vt,[b(mt,{slug:e(t)},null,8,["slug"])]))}});export{Lt as default};
