import Z from"./Df5nKSVD.js";import ee from"./DNyXnZr7.js";import te from"./BleJcCpV.js";import{d as L,J as se,u as ae,O as oe,j as _,z as le,o as i,c as u,b as l,w as r,a as o,f as d,m as s,B as re,t as C,a7 as ne,q as ie,a8 as ue,k as de,C as M,e as T,_ as ce,r as m,s as E,A as pe,N as me}from"./DIpL79ME.js";import fe from"./CgaNsBb1.js";import ge from"./CSRhEDK3.js";import ve from"./BnfmgMFc.js";import{e as B}from"./Cv8_oF2L.js";import{_ as _e}from"./DlAUqK2U.js";const he={class:"flex min-h-[calc(100vh-8rem)] items-center justify-center px-4 py-8"},xe={key:0},be={key:1},ye={class:"space-y-3"},we={key:0,class:"mr-2 h-5 w-5 animate-spin rounded-full border-2 border-white border-t-transparent"},ke={key:1,viewBox:"0 0 24 24","aria-hidden":"true",class:"mr-2 h-5 w-5 fill-current"},Ce={class:"space-y-3"},Be={class:"space-y-2"},ze={class:"space-y-2"},Ge={key:0,class:"mr-2 h-5 w-5 animate-spin rounded-full border-2 border-white border-t-transparent"},Te={key:0,class:"mr-2 h-5 w-5 animate-spin rounded-full border-2 border-muted-foreground border-t-transparent"},Ae={class:"text-center text-sm text-muted-foreground"},Ve={key:0,class:"rounded-lg border border-destructive/20 bg-destructive/10 px-4 py-3 text-sm text-destructive"},Me=L({__name:"LoginMainBlock",setup(N){const c=se(),p=ae(),A=oe(),R=me(),S=_(()=>!!R.public.googleClientId),f=m(""),g=m(""),h=m(!1),x=m(!1),b=m(!1),w=m(!1),t=m(""),v=_(()=>h.value||x.value||b.value||w.value),W=_(()=>c.isAuthenticated&&c.user?.role==="guest"),I=a=>["/profile","/wallet","/tickets","/notifications","/organizer"].some(n=>a===n?!0:a.startsWith(`${n}/`)),$=a=>{const e=Array.isArray(a)?a[0]:a;if(typeof e!="string"||!e)return"/";try{const n=decodeURIComponent(e);return!n.startsWith("/")||n.startsWith("/auth/login")||n.startsWith("/login")?"/":n}catch{return"/"}},k=_(()=>$(A.query.redirect)),j=_(()=>{const a=k.value;return I(a)?"/":a}),z=async a=>{await pe(),await E(a,{replace:!0})};le([f,g],()=>{t.value&&(t.value="")});const q=_(()=>({path:"/auth/register",query:A.query})),H=async()=>{if(!f.value.trim()||!g.value){t.value="Введите почту и пароль.",p.push({level:"warning",title:"Вход",message:t.value,ttlMs:3500});return}h.value=!0,t.value="";try{await c.login(f.value.trim(),g.value),await z(k.value)}catch(a){t.value=B(a,"Не удалось войти. Проверь данные и попробуй снова."),p.push({level:"error",title:"Вход",message:t.value})}finally{h.value=!1}},P=async()=>{x.value=!0,t.value="";try{await c.loginAsGuest(),await E(j.value)}catch(a){t.value=B(a,"Не удалось войти как гость. Попробуй позже."),p.push({level:"error",title:"Гостевой вход",message:t.value})}finally{x.value=!1}},D=async()=>{b.value=!0,t.value="";try{await c.loginWithTelegram(),await z(k.value)}catch(a){t.value=B(a,"Не удалось войти через Telegram. Попробуй еще раз."),p.push({level:"error",title:"Telegram",message:t.value})}finally{b.value=!1}},U=async a=>{const e=a?.credential;if(!e){t.value="Не удалось получить токен Google.";return}w.value=!0,t.value="";try{await c.loginWithGoogle(e),await z(k.value)}catch(n){t.value=B(n,"Не удалось войти через Google. Попробуй еще раз."),p.push({level:"error",title:"Google",message:t.value})}finally{w.value=!1}},F=()=>{t.value="Google вход не удался. Попробуй еще раз.",p.push({level:"error",title:"Google",message:t.value})};return(a,e)=>{const n=Z,O=ee,J=te,y=re,K=ne,V=fe,Q=ce,X=ge,Y=ve;return i(),u("div",he,[l(Y,{class:"w-full max-w-md rounded-2xl border-border bg-white shadow-xl dark:bg-slate-900"},{default:r(()=>[l(J,{class:"space-y-2 text-center"},{default:r(()=>[e[3]||(e[3]=o("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-primary"}," Сохраните свой прогресс ",-1)),l(n,{class:"text-2xl font-bold text-foreground"},{default:r(()=>[...e[2]||(e[2]=[d(" Вход в SmartEvents ",-1)])]),_:1}),l(O,{class:"text-base text-muted-foreground"},{default:r(()=>[s(W)?(i(),u("span",xe," Превратите гостевой аккаунт в постоянный, чтобы не потерять билеты и историю ")):(i(),u("span",be,"Найди свою компанию"))]),_:1})]),_:1}),l(X,{class:"space-y-4"},{default:r(()=>[o("div",ye,[l(y,{class:"w-full bg-[#24A1DE] text-white hover:bg-[#208bbf]",size:"lg",disabled:s(v),onClick:D},{default:r(()=>[s(b)?(i(),u("span",we)):(i(),u("svg",ke,[...e[4]||(e[4]=[o("path",{d:"M20.665 3.717l-17.73 6.837c-1.21.486-1.203 1.161-.222 1.462l4.552 1.42 10.532-6.645c.498-.303.953-.14.577.193l-8.534 7.703-.33 4.946c.483 0 .697-.222.969-.485l2.333-2.27 4.857 3.589c.895.493 1.538.239 1.761-.832l3.185-15.008c.326-1.307-.5-1.902-1.356-1.514z"},null,-1)])])),d(" "+C(s(b)?"Подключаемся...":"Войти через Telegram"),1)]),_:1},8,["disabled"]),l(K,null,{fallback:r(()=>[l(y,{variant:"outline",size:"lg",class:"w-full",disabled:""},{default:r(()=>[...e[6]||(e[6]=[d(" Загрузка Google... ",-1)])]),_:1})]),default:r(()=>[s(S)?(i(),u("div",{key:0,class:ie(["google-btn-wrapper flex w-full justify-center",{"pointer-events-none opacity-60":s(w)||s(v)}])},[l(s(ue),{theme:"outline",size:"large",shape:"rectangular",text:"signin_with","logo-alignment":"left",width:384,locale:"ru",onSuccess:U,onError:F})],2)):(i(),de(y,{key:1,variant:"outline",size:"lg",class:"w-full border-gray-200 bg-white text-gray-700 hover:bg-gray-50",disabled:""},{default:r(()=>[...e[5]||(e[5]=[o("svg",{class:"mr-2 h-5 w-5",viewBox:"0 0 24 24","aria-hidden":"true"},[o("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),o("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),o("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),o("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})],-1),d(" Google (не настроено) ",-1)])]),_:1}))]),_:1})]),e[11]||(e[11]=o("div",{class:"relative"},[o("div",{class:"absolute inset-0 flex items-center"},[o("span",{class:"w-full border-t border-border"})]),o("div",{class:"relative flex justify-center text-xs uppercase"},[o("span",{class:"rounded-full bg-card px-3 py-0.5 text-muted-foreground ring-1 ring-border/60"}," или ")])],-1)),o("div",Ce,[o("div",Be,[e[7]||(e[7]=o("label",{for:"email",class:"text-sm font-medium text-foreground"}," Почта или логин ",-1)),l(V,{id:"email",modelValue:s(f),"onUpdate:modelValue":e[0]||(e[0]=G=>M(f)?f.value=G:null),type:"text",placeholder:"example@site.ru",disabled:s(v)},null,8,["modelValue","disabled"])]),o("div",ze,[e[8]||(e[8]=o("label",{for:"password",class:"text-sm font-medium text-foreground"}," Пароль ",-1)),l(V,{id:"password",modelValue:s(g),"onUpdate:modelValue":e[1]||(e[1]=G=>M(g)?g.value=G:null),type:"password",placeholder:"••••••••",disabled:s(v)},null,8,["modelValue","disabled"])])]),l(y,{class:"w-full",size:"lg",disabled:s(v),onClick:H},{default:r(()=>[s(h)?(i(),u("span",Ge)):T("",!0),d(" "+C(s(h)?"Входим...":"Войти"),1)]),_:1},8,["disabled"]),l(y,{variant:"ghost",size:"lg",class:"w-full",disabled:s(v),onClick:P},{default:r(()=>[s(x)?(i(),u("span",Te)):T("",!0),d(" "+C(s(x)?"Заходим...":"Я только посмотреть"),1)]),_:1},8,["disabled"]),o("div",Ae,[e[10]||(e[10]=d(" Ещё не зарегистрированы? ",-1)),l(Q,{to:s(q),class:"font-semibold text-primary hover:underline"},{default:r(()=>[...e[9]||(e[9]=[d(" Зарегистрироваться ",-1)])]),_:1},8,["to"])]),s(t)?(i(),u("div",Ve,C(s(t)),1)):T("",!0)]),_:1})]),_:1})])}}}),Ee=_e(Me,[["__scopeId","data-v-ae28abd0"]]),Le={class:"page-wrapper"},Pe=L({__name:"index",setup(N){return(c,p)=>(i(),u("div",Le,[l(Ee)]))}});export{Pe as default};
