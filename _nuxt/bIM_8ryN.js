import{d as D,i as te,o as l,b as O,e as i,Y as H,w as g,c as d,f as U,h as e,u as t,B as _,t as u,j as $,D as B,F as P,A as X,H as se,V as oe,r as p,g as h,l as ae,y as re}from"./BO0_OeXi.js";import{u as Y,W as ne}from"./BlQ4NI5O.js";import le from"./BP2r0KF4.js";import{X as ie}from"./kDTr-kfK.js";import{c as z}from"./ChLhOB94.js";import{E as de}from"./BI_wR26L.js";import{T as ue}from"./C_j7hyYr.js";const ce=z("arrow-down-left",[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]]);const pe=z("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);const me=z("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const fe=z("utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]]),ve={key:0,class:"fixed bottom-0 left-0 right-0 z-50 max-h-[85vh] overflow-y-auto rounded-t-3xl border border-border bg-card p-5 shadow-elevated"},be={class:"flex items-center justify-between"},ge={key:0,class:"mt-6 space-y-4 text-center"},xe={class:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-primary/10 text-primary"},ye={class:"text-sm text-muted-foreground"},he={key:1,class:"mt-6 space-y-5"},_e={class:"space-y-3"},ke={class:"grid grid-cols-2 gap-2"},we={class:"space-y-3"},Ce={class:"grid grid-cols-2 gap-2"},$e=["onClick"],Se={class:"space-y-2"},Me={class:"rounded-2xl border border-border bg-muted/40 p-4"},Ue={class:"flex items-center justify-between text-sm"},Be={class:"font-semibold text-foreground"},Te={class:"mt-2 text-xs text-muted-foreground"},Ve={key:0,class:"mt-3 rounded-xl border border-border bg-card p-3 text-xs text-muted-foreground"},ze={key:0,class:"mt-1"},Ne={class:"mt-2 flex gap-2"},Le={key:1,class:"mt-2 text-xs text-destructive"},je=D({__name:"TopUpSheet",props:{open:{type:Boolean}},emits:["close"],setup(S,{emit:m}){const k=S,T=m,x=Y(),N=[100,300,500,1e3],y=p(500),f=p(""),r=p("sbp"),s=p(!1),a=p(""),v=p(""),M=p(""),w=p(null),V=p(null),C=p(!1),b=p("idle"),Z=new Intl.NumberFormat("ru-RU"),L=h(()=>{const n=Number(f.value.replace(/\s+/g,""));return Number.isFinite(n)?Math.round(n):0}),j=h(()=>L.value>0?L.value:y.value??0),W=h(()=>`${Z.format(j.value)} ₽`),A=h(()=>j.value>0&&!x.topUpPending&&!C.value),G=h(()=>b.value==="pending"),I=h(()=>r.value==="cryptobot"?"CryptoBot":"СБП"),J=n=>{y.value=n,f.value=""},F=()=>{T("close")},K=()=>{y.value=500,f.value="",r.value="sbp",s.value=!1,a.value="",v.value="",M.value="",w.value=null,V.value=null,b.value="idle",C.value=!1},E=()=>{M.value&&window.open(M.value,"_blank","noopener,noreferrer")},Q=async()=>{if(!V.value&&!w.value)return null;const n=await x.getTopUpStatus(V.value,w.value);return n?n.toLowerCase():null},R=async()=>{C.value=!0,v.value="Проверяем статус платежа...";try{for(let o=0;o<30;o+=1){const c=await Q();if(c==="completed"||c==="paid"){b.value="completed",s.value=!0,v.value="Платеж подтвержден.",await x.fetchWallet();return}if(c==="failed"){b.value="failed",a.value="Платеж отклонен. Попробуйте еще раз.",v.value="";return}await new Promise(q=>setTimeout(q,3e3))}b.value="pending",v.value='Платеж еще в обработке. Нажмите "Проверить статус" позже.'}catch{b.value="pending",v.value="Не удалось проверить статус. Можно повторить позже."}finally{C.value=!1}},ee=async()=>{if(A.value){a.value="",v.value="";try{const n=await x.topUp(j.value,{provider:r.value});if(!n)return;if(M.value=n.pay_url||"",w.value=n.invoice_id||null,V.value=n.transaction?.id?String(n.transaction.id):null,(n.transaction?.status?.toLowerCase?.()||"pending")==="completed"){b.value="completed",s.value=!0,v.value="Платеж подтвержден.",await x.fetchWallet();return}b.value="pending",v.value=`Инвойс создан (${I.value}).`,E(),await R()}catch{b.value="failed",a.value="Платеж не прошел. Попробуй еще раз."}}};return te(()=>k.open,n=>{n||K()}),(n,o)=>(l(),O(oe,{to:"body"},[i(H,{"enter-active-class":"transition-opacity duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:g(()=>[S.open?(l(),d("div",{key:0,class:"fixed inset-0 z-50 bg-black/50",onClick:F})):U("",!0)]),_:1}),i(H,{"enter-active-class":"transition-transform duration-300 ease-out","enter-from-class":"translate-y-full","enter-to-class":"translate-y-0","leave-active-class":"transition-transform duration-200 ease-in","leave-from-class":"translate-y-0","leave-to-class":"translate-y-full"},{default:g(()=>[S.open?(l(),d("div",ve,[e("div",be,[o[3]||(o[3]=e("div",null,[e("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground"},"Кошелек"),e("h3",{class:"text-base font-bold text-foreground"},"Пополнение баланса")],-1)),i(t(_),{variant:"ghost",size:"icon",class:"rounded-full",onClick:F},{default:g(()=>[i(t(ie),{class:"h-4 w-4"})]),_:1})]),t(s)?(l(),d("div",ge,[e("div",xe,[i(t(me),{class:"h-6 w-6"})]),o[5]||(o[5]=e("h4",{class:"text-lg font-bold text-foreground"},"Баланс пополнен",-1)),e("p",ye,u(t(W))+" уже доступны в кошельке. ",1),i(t(_),{class:"w-full",onClick:F},{default:g(()=>[...o[4]||(o[4]=[$("Готово",-1)])]),_:1})])):(l(),d("div",he,[e("div",_e,[o[6]||(o[6]=e("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground"},"Способ оплаты",-1)),e("div",ke,[e("button",{type:"button",class:B(["rounded-2xl border border-border px-4 py-3 text-sm font-semibold transition hover:border-primary/40",t(r)==="sbp"?"border-primary/50 bg-primary/10 text-foreground":"bg-card text-muted-foreground"]),onClick:o[0]||(o[0]=c=>r.value="sbp")}," СБП ",2),e("button",{type:"button",class:B(["rounded-2xl border border-border px-4 py-3 text-sm font-semibold transition hover:border-primary/40",t(r)==="cryptobot"?"border-primary/50 bg-primary/10 text-foreground":"bg-card text-muted-foreground"]),onClick:o[1]||(o[1]=c=>r.value="cryptobot")}," CryptoBot ",2)])]),e("div",we,[o[7]||(o[7]=e("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground"}," Выберите сумму ",-1)),e("div",Ce,[(l(),d(P,null,X(N,c=>e("button",{key:c,type:"button",class:B(["rounded-2xl border border-border px-4 py-3 text-sm font-semibold text-foreground transition hover:border-primary/40",t(y)===c&&t(L)===0?"border-primary/50 bg-primary/10":"bg-card"]),onClick:q=>J(c)},u(c)+" ₽ ",11,$e)),64))])]),e("div",Se,[o[8]||(o[8]=e("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground"},"Своя сумма",-1)),i(t(le),{modelValue:t(f),"onUpdate:modelValue":o[2]||(o[2]=c=>se(f)?f.value=c:null),inputmode:"numeric",placeholder:"Например, 750",class:"text-base"},null,8,["modelValue"])]),e("div",Me,[e("div",Ue,[o[9]||(o[9]=e("span",{class:"text-muted-foreground"},"К оплате",-1)),e("span",Be,u(t(W)),1)]),e("p",Te," Провайдер: "+u(t(I)),1),t(b)==="pending"?(l(),d("div",Ve,[e("p",null,u(t(v)),1),t(w)?(l(),d("p",ze,"Invoice: "+u(t(w)),1)):U("",!0),e("div",Ne,[i(t(_),{variant:"outline",size:"sm",class:"gap-1",disabled:!t(M),onClick:E},{default:g(()=>[i(t(de),{class:"h-3.5 w-3.5"}),o[10]||(o[10]=$(" Открыть инвойс ",-1))]),_:1},8,["disabled"]),i(t(_),{variant:"outline",size:"sm",disabled:t(C),onClick:R},{default:g(()=>[$(u(t(C)?"Проверяем...":"Проверить статус"),1)]),_:1},8,["disabled"])])])):U("",!0),t(a)?(l(),d("p",Le,u(t(a)),1)):U("",!0),i(t(_),{class:"mt-4 w-full gap-2",disabled:!t(A)||t(G),onClick:ee},{default:g(()=>[i(t(pe),{class:"h-4 w-4"}),$(" "+u(t(x).topUpPending?"Создаем инвойс...":`Оплатить через ${t(I)}`),1)]),_:1},8,["disabled"])])]))])):U("",!0)]),_:1})]))}}),Ie={class:"space-y-8 pb-12"},Fe={class:"relative overflow-hidden rounded-3xl border border-primary/25 bg-gradient-to-br from-primary/30 via-card to-primary/5 p-6 shadow-elevated"},Pe={class:"relative flex flex-col gap-6"},De={class:"mt-3 text-3xl font-bold text-foreground"},We={class:"flex flex-wrap items-center gap-3"},Ae={class:"space-y-4"},Ee={class:"flex items-center justify-between"},Re={key:0,class:"grid gap-3"},qe={key:1,class:"rounded-2xl border border-border bg-card p-6 text-center text-sm text-muted-foreground shadow-soft"},He={key:2,class:"space-y-3"},Oe={class:"flex items-center gap-3"},Xe={class:"text-sm font-semibold text-foreground"},Ye={class:"text-xs text-muted-foreground"},Ze={class:"text-right"},Ge={class:"text-xs text-muted-foreground"},Je=D({__name:"WalletMainBlock",setup(S){const m=Y(),k=p(!1),T=new Intl.NumberFormat("ru-RU"),x=h(()=>`${T.format(m.balance)} ₽`),N=r=>{const s=r>=0?"+":"-",a=Math.abs(r);return`${s}${T.format(a)} ₽`},y=r=>{if(!r)return"Сегодня";const s=new Date(r);return Number.isNaN(s.getTime())?"Сегодня":new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"}).format(s).replace(".","")},f=r=>{const s=(r.type||"").toLowerCase();return s.includes("topup")||s.includes("deposit")||r.amount>0?{label:"Пополнение",icon:ce,iconClass:"bg-emerald-100 text-emerald-700"}:s.includes("ticket")||s.includes("event")?{label:"Покупка билета",icon:ue,iconClass:"bg-primary/15 text-primary"}:s.includes("bar")||s.includes("queue")||s.includes("food")?{label:"Бар / Очередь",icon:fe,iconClass:"bg-orange-100 text-orange-600"}:{label:r.title||"Операция",icon:ne,iconClass:"bg-muted text-foreground"}};return ae(()=>{m.loaded||m.fetchWallet()}),(r,s)=>(l(),d(P,null,[e("div",Ie,[e("section",Fe,[s[6]||(s[6]=e("div",{class:"absolute -right-20 -top-20 h-48 w-48 rounded-full bg-primary/20 blur-3xl"},null,-1)),e("div",Pe,[e("div",null,[s[2]||(s[2]=e("p",{class:"text-xs font-semibold uppercase tracking-[0.25em] text-primary/80"},"Кошелек",-1)),e("h1",De,u(t(x)),1),s[3]||(s[3]=e("p",{class:"text-sm text-muted-foreground"},"Баланс SmartEvents",-1))]),e("div",We,[i(t(_),{class:"rounded-full bg-primary px-5 text-primary-foreground shadow-glow hover:bg-primary/90",onClick:s[0]||(s[0]=a=>k.value=!0)},{default:g(()=>[...s[4]||(s[4]=[$(" Пополнить ",-1)])]),_:1}),s[5]||(s[5]=e("span",{class:"text-xs text-muted-foreground"}," Быстрое пополнение через СБП и CryptoBot ",-1))])])]),e("section",Ae,[e("div",Ee,[s[8]||(s[8]=e("h2",{class:"text-lg font-bold text-foreground"},"История транзакций",-1)),i(t(_),{variant:"outline",size:"sm",class:"rounded-full",onClick:t(m).fetchWallet},{default:g(()=>[...s[7]||(s[7]=[$(" Обновить ",-1)])]),_:1},8,["onClick"])]),t(m).loading?(l(),d("div",Re,[...s[9]||(s[9]=[e("div",{class:"h-16 animate-pulse rounded-2xl bg-muted"},null,-1),e("div",{class:"h-16 animate-pulse rounded-2xl bg-muted"},null,-1),e("div",{class:"h-16 animate-pulse rounded-2xl bg-muted"},null,-1)])])):t(m).transactions.length?(l(),d("div",He,[(l(!0),d(P,null,X(t(m).transactions,a=>(l(),d("div",{key:a.id||`${a.type}-${a.created_at}`,class:"flex items-center justify-between gap-4 rounded-2xl border border-border bg-card p-4 shadow-soft"},[e("div",Oe,[e("div",{class:B(["flex h-11 w-11 items-center justify-center rounded-2xl",f(a).iconClass])},[(l(),O(re(f(a).icon),{class:"h-5 w-5"}))],2),e("div",null,[e("p",Xe,u(f(a).label),1),e("p",Ye,u(a.description||y(a.created_at)),1)])]),e("div",Ze,[e("p",{class:B(["text-sm font-semibold",a.amount>=0?"text-emerald-600":"text-foreground"])},u(N(a.amount)),3),e("p",Ge,u(y(a.created_at)),1)])]))),128))])):(l(),d("div",qe," Транзакций пока нет. Самое время пополнить кошелек! "))])]),i(je,{open:t(k),onClose:s[1]||(s[1]=a=>k.value=!1)},null,8,["open"])],64))}}),Ke={class:"page-wrapper"},nt=D({__name:"index",setup(S){return(m,k)=>(l(),d("div",Ke,[i(Je)]))}});export{nt as default};
