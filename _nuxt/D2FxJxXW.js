import{H as K,p as J}from"./D1uJsfV4.js";import{d as C,m as X,I as q,A as G,n as Q,o as d,c as u,u as a,a1 as Y,f as m,a as r,F as Z,b as s,w as c,_ as ee,B as A,t as te,j as o}from"./D4tOOpea.js";import{P as ae,a as ie,b as oe,c as se,d as re}from"./b2XxXEtf.js";import{_ as le}from"./DlAUqK2U.js";import"./CUtcqh3c.js";import"./BrE5OWI-.js";import"./DSD0DqAy.js";import"./CDoVUn-y.js";import"./BDIprTuF.js";import"./D6B2Eigc.js";import"./DQ6Ue2G3.js";import"./D_jAd2MS.js";const ne={class:"mx-auto w-full max-w-5xl space-y-6 pb-10"},ce={key:0,class:"space-y-4"},de={key:1,class:"rounded-3xl border border-destructive/20 bg-destructive/10 p-6 text-sm text-destructive shadow-soft"},ue={key:2,class:"rounded-3xl border border-white/30 bg-white/60 p-6 text-sm text-slate-700 shadow-soft backdrop-blur-sm"},pe={class:"profile-highlights-grid grid gap-4 lg:grid-cols-2"},me={class:"achievements-container"},ve={class:"recent-activity-container"},fe={class:"grid gap-4 lg:grid-cols-2"},he={class:"rounded-3xl border border-white/30 bg-white/60 p-5 shadow-soft backdrop-blur-sm"},be={class:"mt-3 text-sm text-slate-700"},ge=C({__name:"ProfileOverviewBlock",setup(S){const n=X(),p=q(),{data:$,pending:E,error:N,refresh:w}=G("profile-overview",async()=>!n.isAuthInitialized||!n.token?null:await n.apiFetch("/api/v1/me/profile",{baseURL:Q("/api/v1/me/profile")}),{server:!1,default:()=>null,watch:[()=>n.token,()=>n.isAuthInitialized]}),i=o(()=>$.value??null),k=o(()=>i.value?.full_name?.trim()||i.value?.username||"Profile"),U=o(()=>i.value?.city?.trim()||""),P=o(()=>i.value?.bio?.trim()||""),L=o(()=>i.value?.uuid?`/u/${i.value.uuid}`:"/profile/me"),T=o(()=>i.value?.role==="organizer"?"Organizer":"Participant"),v=t=>typeof t=="string"?t.trim():"",f=o(()=>{const t=i.value?.social_links;return!t||typeof t!="object"?{}:t}),h=o(()=>v(f.value.telegram)),b=o(()=>v(f.value.vk)),g=o(()=>v(f.value.instagram)),x=o(()=>i.value?.level??1),y=o(()=>i.value?.exp??0),B=o(()=>i.value?.next_level_exp??null),I=o(()=>Math.max(0,Math.round(x.value*100+y.value/10))),V=t=>t.replace(/^@/,"").trim(),_=(t,e)=>{if(e.startsWith("http://")||e.startsWith("https://"))return e;const l=V(e);return l?t==="telegram"?`https://t.me/${l}`:t==="vk"?`https://vk.com/${l}`:`https://instagram.com/${l}`:""},z=o(()=>{const t=[];return h.value&&t.push({key:"telegram",label:"Telegram",value:h.value,href:_("telegram",h.value)}),b.value&&t.push({key:"vk",label:"VK",value:b.value,href:_("vk",b.value)}),g.value&&t.push({key:"instagram",label:"Instagram",value:g.value,href:_("instagram",g.value)}),t}),R=()=>typeof navigator.share=="function",F=()=>{const t=i.value?.uuid?`/u/${i.value.uuid}`:window.location.pathname;try{return new URL(t,window.location.origin).toString()}catch{return`${window.location.origin}${t.startsWith("/")?t:`/${t}`}`}},H=t=>{const e=document.createElement("textarea");e.value=t,e.setAttribute("readonly","true"),e.style.position="fixed",e.style.opacity="0",e.style.pointerEvents="none",e.style.left="-9999px",document.body.appendChild(e),e.focus(),e.select();const l=document.execCommand("copy");return document.body.removeChild(e),l},M=async t=>window.isSecureContext&&navigator.clipboard?.writeText?(await navigator.clipboard.writeText(t),!0):(console.warn("[profile] Clipboard API unavailable in the current context. Falling back to execCommand copy."),H(t)),O=async()=>{const t=F();if(!t){p.push({level:"error",message:"Unable to share profile link."});return}if(R())try{await navigator.share({title:k.value,url:t});return}catch(e){if(e instanceof Error&&e.name==="AbortError")return;console.warn("[profile] Native share failed. Falling back to clipboard copy.",e)}try{if(await M(t)){p.push({level:"success",message:"Profile link copied."});return}p.push({level:"error",message:"Unable to copy profile link."})}catch(e){console.warn("[profile] Clipboard copy failed.",e),p.push({level:"error",message:"Unable to copy profile link."})}},W=[{id:"early-adopter",title:"Early Adopter",description:"Joined before the first major release.",badge:"EA",tone:"gold"},{id:"verified",title:"Verified",description:"Profile identity has been confirmed.",badge:"V",tone:"blue"},{id:"event-master",title:"Event Master",description:"Shows consistent event participation.",badge:"EM",tone:"green"}],j=o(()=>[{id:"me-1",title:`Reached profile level ${x.value}`,details:`Current XP is ${y.value}. Keep going to unlock new milestones.`,timeLabel:"Today"},{id:"me-2",title:"Updated profile visibility",details:"Public profile is ready to share with new contacts.",timeLabel:"This week"},{id:"me-3",title:"Maintaining participation streak",details:"Active engagement boosts reputation and unlocks rewards.",timeLabel:"This month"}]);return(t,e)=>{const l=ee;return d(),u("div",ne,[a(E)?(d(),u("section",ce,[...e[1]||(e[1]=[Y('<div class="h-48 animate-pulse rounded-3xl bg-muted/70" data-v-1a5ab463></div><div class="grid gap-3 sm:grid-cols-2 xl:grid-cols-4" data-v-1a5ab463><div class="h-32 animate-pulse rounded-3xl bg-muted/70" data-v-1a5ab463></div><div class="h-32 animate-pulse rounded-3xl bg-muted/70" data-v-1a5ab463></div><div class="h-32 animate-pulse rounded-3xl bg-muted/70" data-v-1a5ab463></div><div class="h-32 animate-pulse rounded-3xl bg-muted/70" data-v-1a5ab463></div></div>',2)])])):a(N)?(d(),u("section",de,[e[2]||(e[2]=m(" Unable to load profile data. ",-1)),r("button",{type:"button",class:"ml-2 underline",onClick:e[0]||(e[0]=(...D)=>a(w)&&a(w)(...D))},"Refresh")])):a(i)?(d(),u(Z,{key:3},[s(ae,{"avatar-url":a(i).avatar_url,"display-name":a(k),username:a(i).username,city:a(U),bio:a(P)},{actions:c(()=>[s(l,{to:"/profile/settings"},{default:c(()=>[s(a(A),{class:"rounded-full"},{default:c(()=>[...e[3]||(e[3]=[m("Edit Profile",-1)])]),_:1})]),_:1}),s(a(A),{variant:"outline",class:"rounded-full border-white/50 bg-white/70",onClick:O},{default:c(()=>[...e[4]||(e[4]=[m(" Share ",-1)])]),_:1})]),footer:c(()=>[s(l,{to:a(L),class:"inline-flex text-xs font-semibold uppercase tracking-[0.18em] text-primary underline-offset-4 hover:underline"},{default:c(()=>[...e[5]||(e[5]=[m(" Open public profile ",-1)])]),_:1},8,["to"])]),_:1},8,["avatar-url","display-name","username","city","bio"]),s(ie,{level:a(x),exp:a(y),"next-level-exp":a(B),status:a(T),"extra-stat-label":"Reputation","extra-stat-value":a(I),"extra-stat-hint":"Calculated from level and experience"},null,8,["level","exp","next-level-exp","status","extra-stat-value"]),r("section",pe,[r("div",me,[s(oe,{items:W})]),r("div",ve,[s(se,{items:a(j)},null,8,["items"])])]),r("section",fe,[r("section",he,[e[6]||(e[6]=r("h2",{class:"text-sm font-semibold uppercase tracking-[0.18em] text-slate-700"},"About",-1)),r("p",be,te(a(P)||"No profile summary added yet."),1)]),s(re,{items:a(z)},null,8,["items"])])],64)):(d(),u("section",ue," Profile is not available right now. Try refreshing this page. "))])}}}),xe=le(ge,[["__scopeId","data-v-1a5ab463"]]),ye={class:"page-wrapper"},_e={class:"flex min-h-[calc(100dvh-9rem)] flex-col gap-4 lg:flex-row lg:items-start lg:gap-6"},we={class:"min-w-0 flex-1"},Ie=C({__name:"index",setup(S){return(n,p)=>(d(),u("div",ye,[r("div",_e,[s(K,{items:a(J),class:"shrink-0"},null,8,["items"]),r("div",we,[s(xe)])])]))}});export{Ie as default};
