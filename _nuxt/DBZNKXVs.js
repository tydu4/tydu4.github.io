import{d as J,J as te,O as ae,z as re,y as se,c as T,E as X,b as l,u as e,w as k,o as p,a as s,B as U,k as K,f as $,t as y,e as D,r as I,j as c,K as oe,n as Y,g as ie,F as le,_ as ce,q as ue,N as de,aa as me}from"./DXztqjCQ.js";import ne from"./C-Eyoouw.js";import{L as ve}from"./CuhuTuqL.js";import{C as fe}from"./2_J2ATjA.js";import{M as pe}from"./DJXsfEn5.js";import{Q as Z}from"./DOelJJwf.js";import ge from"./BBdJDuwr.js";import he from"./B6yq4ezY.js";import{S as _e}from"./DfgMGbzZ.js";import{M as xe}from"./s8bY5U6r.js";import{X as be}from"./pIa8rBID.js";import{c as ye}from"./CG4HLnLt.js";import{_ as ke}from"./DlAUqK2U.js";import{_ as we}from"./QOMubj7K.js";import{_ as Ce}from"./CvcII9pi.js";import{C as Se}from"./foL5lnpC.js";const Te=ye("sun-medium",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 3v1",key:"1asbbs"}],["path",{d:"M12 20v1",key:"1wcdkc"}],["path",{d:"M3 12h1",key:"lp3yf2"}],["path",{d:"M20 12h1",key:"1vloll"}],["path",{d:"m18.364 5.636-.707.707",key:"1hakh0"}],["path",{d:"m6.343 17.657-.707.707",key:"18m9nf"}],["path",{d:"m5.636 5.636.707.707",key:"1xv1c5"}],["path",{d:"m17.657 17.657.707.707",key:"vl76zb"}]]),Ie={class:"space-y-3"},Le={key:0,class:"rounded-xl border border-emerald-500/30 bg-emerald-500/10 px-3 py-2 text-sm text-emerald-700"},Me={key:2,class:"text-xs text-muted-foreground"},Ee=J({__name:"CheckInAction",props:{slug:{default:""},fixed:{type:Boolean,default:!0}},emits:["checked-in"],setup(u,{emit:w}){const B=u,g=w,L=te(),h=ae(),m=re(),o=I("idle"),v=I(""),d=I("");let f=null;const _=c(()=>B.slug.trim()||String(h.params.slug??"").trim()),A=c(()=>o.value==="locating"||o.value==="submitting"),x=()=>{f&&(clearTimeout(f),f=null)},N=a=>!a||typeof a!="object"?null:a,V=a=>{if(!Array.isArray(a))return"";const n=N(a[0]);if(!n)return"";const i=typeof n.msg=="string"?n.msg.trim():"";return i||""},H=a=>{const n="Check-in failed. Verify internet and try again near venue entrance.",i=N(a);if(!i)return n;const F=typeof i.message=="string"?i.message.trim():"";if(F)return F;const M=N(i.data);if(!M)return n;const E=typeof M.message=="string"?M.message.trim():"";if(E)return E;const P=M.detail;if(typeof P=="string"&&P.trim())return P.trim();const G=V(P);return G||n},C=a=>{const n=a;switch(n?.code){case 1:return`Location permission is blocked. Allow location access in browser settings, then tap "I'm here" again.`;case 2:return"Location is unavailable. Move closer to venue entrance and enable GPS/Wi-Fi for better accuracy.";case 3:return"Location request timed out. Stay in open sky area near venue and retry.";default:return n?.message?.trim()||"Unable to read location. Check GPS and internet, then retry."}},z=async()=>{if(!navigator.geolocation)throw new Error("Geolocation is not available on this device.");const a=await new Promise((n,i)=>{navigator.geolocation.getCurrentPosition(n,i,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})});return{lat:a.coords.latitude,lon:a.coords.longitude}},O=a=>{o.value="success";const n=Number(a.xp_awarded??0);d.value=n>0?`Check-in confirmed. +${n} XP`:a.message?.trim()||"Check-in confirmed.",x(),f=setTimeout(()=>{o.value="idle",d.value="",v.value="",f=null},2800)},j=async()=>{if(A.value||o.value==="success")return;if(!_.value){o.value="error",v.value="Event slug is missing. Reload the page and try again.";return}v.value="",d.value="",o.value="locating";let a;try{a=await z()}catch(n){o.value="error";const i=C(n);v.value=i,m.push({level:"warning",title:"Location access",message:i});return}o.value="submitting";try{const n=await L.apiFetch(`/api/v1/events/slug/${encodeURIComponent(_.value)}/check-in`,{method:"POST",baseURL:oe("/api/v1/events"),body:a});if(!n.success)throw new Error(n.message||"Check-in was not confirmed.");O(n);const i=Number(n.xp_awarded??0);m.push({level:"success",title:"You are checked in",message:i>0?`Welcome inside. +${i} XP`:n.message?.trim()||"Welcome inside."}),g("checked-in",n)}catch(n){o.value="error";const i=H(n);v.value=i,m.push({level:"error",title:"Check-in error",message:i})}},R=c(()=>o.value==="locating"?"Detecting location...":o.value==="submitting"?"Validating location...":o.value==="success"?"Checked in":"I'm here (Я на месте)"),W=c(()=>o.value==="error"?"border-destructive/30 bg-destructive/10 text-destructive":"border-amber-500/30 bg-amber-500/10 text-amber-700");return se(()=>{x()}),(a,n)=>(p(),T("div",{class:X(u.fixed?"fixed inset-x-0 bottom-0 z-[60]":"")},[l(e(ne),{class:"rounded-t-3xl border border-border bg-background/95 p-4 shadow-elevated backdrop-blur"},{default:k(()=>[s("div",Ie,[l(e(U),{class:"h-14 w-full gap-2 text-lg font-semibold",disabled:e(A)||e(o)==="success",onClick:j},{default:k(()=>[e(A)?(p(),K(e(ve),{key:0,class:"h-5 w-5 animate-spin"})):e(o)==="success"?(p(),K(e(fe),{key:1,class:"h-5 w-5"})):(p(),K(e(pe),{key:2,class:"h-5 w-5"})),$(" "+y(e(R)),1)]),_:1},8,["disabled"]),e(d)?(p(),T("p",Le,y(e(d)),1)):D("",!0),e(v)?(p(),T("p",{key:1,class:X(["rounded-xl border px-3 py-2 text-sm",e(W)])},y(e(v)),3)):(p(),T("p",Me," Allow location access and stand near the venue entrance before pressing the button. "))])]),_:1})],2))}}),Pe=Object.assign(Ee,{__name:"Event[slug]BlocksState21CheckInAction"}),$e={class:"space-y-3"},Be={key:0,class:"flex flex-wrap items-center justify-between gap-2 rounded-2xl border border-primary/25 bg-primary/10 px-3 py-2 text-xs text-foreground"},Ae={class:"flex items-center gap-2"},Ne={class:"flex items-center gap-2"},Ve={class:"flex items-start justify-between gap-3"},ze={class:"mt-2 text-lg font-semibold"},Oe={class:"mt-2 flex items-center gap-2"},je={key:0,class:"text-[11px] font-medium text-amber-200/95"},Re={class:"mt-5 flex justify-center"},We={class:"rounded-2xl bg-white p-4 shadow-lg"},Fe={class:"mt-5 flex flex-wrap items-center justify-between gap-2 text-xs text-white/80"},Ge={class:"rounded-full border border-white/30 px-2.5 py-1 font-medium"},Ue={class:"relative flex h-full flex-col items-center justify-center gap-6 overflow-hidden bg-white px-6"},De={class:"absolute right-4 top-4"},He={class:"text-center"},qe={class:"mt-2 text-lg font-semibold text-foreground"},Ke={class:"rounded-3xl bg-white p-5 shadow-lg ring-1 ring-black/10"},Xe={class:"flex items-center gap-2 text-sm text-muted-foreground"},Je="event_state2_1_wallet_v1",ee="se-wallet-brightness-max",Qe=J({__name:"TicketWallet",props:{event:{default:null},slug:{default:""}},setup(u){const w=u,B=de(),g=I(!1),L=I(!0),h=I(null),m=c(()=>w.slug.trim()||w.event?.slug?.trim()||""),o=c(()=>w.event?.title?.trim()||"Event Pass"),v=c(()=>B.public.enableAppPromotions!==!1),d=c(()=>m.value?`${Je}:${m.value}`:""),f=r=>{if(!r||typeof r!="object")return null;const t=r,b=typeof t.uuid=="string"?t.uuid.trim():"";if(!b)return null;const S=typeof t.ticket_type=="string"?t.ticket_type.trim():"Standard",q=typeof t.holder_name=="string"?t.holder_name.trim():"Guest";return{uuid:b,ticket_type:S||"Standard",holder_name:q||"Guest"}},_=()=>{const r=w.event?.state_payload;return f(r?.ticket_preview??null)},A=()=>{if(!d.value)return null;try{const r=localStorage.getItem(d.value);if(!r)return null;const t=JSON.parse(r);if(!t||typeof t!="object")return null;const b=typeof t.slug=="string"?t.slug.trim():"",S=typeof t.ticket_uuid=="string"?t.ticket_uuid.trim():"";return!b||!S||b!==m.value?null:{slug:b,event_title:typeof t.event_title=="string"?t.event_title:"",ticket_uuid:S,ticket_type:typeof t.ticket_type=="string"?t.ticket_type:"Standard",holder_name:typeof t.holder_name=="string"?t.holder_name:"Guest",cached_at:typeof t.cached_at=="string"?t.cached_at:new Date().toISOString()}}catch{return null}},x=I(null),N=r=>{if(d.value)try{localStorage.setItem(d.value,JSON.stringify(r))}catch{}},V=c(()=>{const r=_();return r||(x.value?{uuid:x.value.ticket_uuid,ticket_type:x.value.ticket_type,holder_name:x.value.holder_name}:null)}),H=c(()=>!_()&&!!x.value),C=c(()=>V.value?.uuid?.trim()||""),z=c(()=>V.value?.ticket_type?.trim()||"Standard"),O=c(()=>V.value?.holder_name?.trim()||"Guest"),j=c(()=>C.value||`${m.value||"event"}:offline-pass`),R=c(()=>/vip|premium|gold|platinum/i.test(z.value)),W=c(()=>R.value?"VIP Pass":"Standard Pass"),a=c(()=>R.value?"border-amber-200/40 bg-gradient-to-br from-zinc-950 via-amber-950/40 to-zinc-900 text-amber-50":"border-cyan-200/30 bg-gradient-to-br from-slate-950 via-cyan-950/35 to-slate-900 text-cyan-50"),n=()=>{L.value=!1},i=async()=>{const r=navigator.wakeLock;if(r?.request)try{h.value=await r.request("screen")}catch{h.value=null}},F=async()=>{if(h.value)try{await h.value.release()}catch{}finally{h.value=null}},M=async()=>{document.documentElement.classList.add(ee),await i()},E=async()=>{document.documentElement.classList.remove(ee),await F()},P=()=>{C.value&&(g.value=!0,M())},G=()=>{g.value=!1,E()};return Y(()=>[m.value,C.value,z.value,O.value,o.value],([r,t,b,S,q])=>{if(!r||!t)return;const Q={slug:r,event_title:q,ticket_uuid:t,ticket_type:b,holder_name:S,cached_at:new Date().toISOString()};x.value=Q,N(Q)},{immediate:!0}),Y(g,r=>{r||E()}),ie(()=>{x.value=A()}),se(()=>{E()}),(r,t)=>{const b=ce;return p(),T(le,null,[s("div",$e,[e(v)&&e(L)?(p(),T("div",Be,[s("p",Ae,[l(e(_e),{class:"h-4 w-4 text-primary"}),t[1]||(t[1]=s("span",null,"Internet can be unstable at venue entrance. Keep this pass available offline.",-1))]),s("div",Ne,[l(b,{to:"/app",class:"inline-flex items-center rounded-md bg-primary px-2.5 py-1 text-xs font-semibold text-primary-foreground transition hover:opacity-90"},{default:k(()=>[...t[2]||(t[2]=[$(" Open App ",-1)])]),_:1}),s("button",{type:"button",class:"rounded-md px-2 py-1 text-xs text-muted-foreground transition hover:bg-background hover:text-foreground",onClick:n}," Dismiss ")])])):D("",!0),l(e(ne),{class:X(["relative overflow-hidden rounded-3xl border p-5 shadow-2xl",e(a)])},{default:k(()=>[s("div",Ve,[s("div",null,[t[3]||(t[3]=s("p",{class:"text-xs uppercase tracking-[0.3em] text-white/70"},"Digital Pass",-1)),s("h2",ze,y(e(o)),1),s("div",Oe,[l(e(ge),{variant:"secondary",class:"border-white/20 bg-white/15 text-white"},{default:k(()=>[$(y(e(W)),1)]),_:1}),e(H)?(p(),T("span",je," Offline copy ")):D("",!0)])]),l(e(U),{variant:"outline",size:"sm",class:"gap-2 border-white/30 bg-white/10 text-white hover:bg-white/20",disabled:!e(C),onClick:P},{default:k(()=>[l(e(xe),{class:"h-4 w-4"}),t[4]||(t[4]=$(" Fullscreen ",-1))]),_:1},8,["disabled"])]),s("div",Re,[s("div",We,[l(Z,{value:e(j),size:220,level:"H"},null,8,["value"])])]),s("div",Fe,[s("span",null,y(e(O)),1),s("span",Ge,y(e(C)?e(C).slice(0,8).toUpperCase():"NO-TICKET"),1)])]),_:1},8,["class"])]),l(e(he),{modelValue:e(g),"onUpdate:modelValue":t[0]||(t[0]=S=>ue(g)?g.value=S:null),class:"h-[100dvh] w-full max-w-none rounded-none border-0 bg-white p-0"},{default:k(()=>[s("div",Ue,[s("div",De,[l(e(U),{variant:"ghost",size:"icon",class:"rounded-full",onClick:G},{default:k(()=>[l(e(be),{class:"h-4 w-4"})]),_:1})]),s("div",He,[t[5]||(t[5]=s("p",{class:"text-xs uppercase tracking-[0.24em] text-muted-foreground"},"Show this at entrance",-1)),s("p",qe,y(e(W)),1)]),s("div",Ke,[l(Z,{value:e(j),size:320,level:"H"},null,8,["value"])]),s("p",Xe,[l(e(Te),{class:"h-4 w-4"}),t[6]||(t[6]=$(" Max brightness mode enabled ",-1))])])]),_:1},8,["modelValue"])],64)}}}),Ye=Object.assign(ke(Qe,[["__scopeId","data-v-e6be0001"]]),{__name:"Event[slug]BlocksState21TicketWallet"}),Ze={key:0,class:"fixed inset-0 z-40 overflow-hidden bg-background text-foreground"},et={class:"mx-auto flex h-[100dvh] w-full max-w-3xl flex-col overflow-hidden px-4 pb-[calc(env(safe-area-inset-bottom)+0.5rem)] pt-[calc(env(safe-area-inset-top)+0.75rem)] md:px-0"},tt={class:"flex items-center justify-between gap-2"},st={class:"text-xl font-semibold text-foreground"},nt={class:"mt-4 min-h-0 flex-1 space-y-4 overflow-y-auto pb-4"},at={class:"text-sm text-muted-foreground"},rt={class:"shrink-0"},kt=J({__name:"CheckInWayView",props:{event:{}},emits:["checked-in"],setup(u,{emit:w}){const B=u,g=w,L=me(),h=te(),m=()=>{L.back()},o=()=>{g("checked-in")},v=c(()=>{const f=B.event;return f?.default_venue??f?.occurrences?.[0]?.venue??null}),d=c(()=>h.user?.full_name?.trim()||h.user?.username?.trim()||"friend");return(f,_)=>u.event?(p(),T("div",Ze,[s("div",et,[s("header",tt,[s("div",null,[_[0]||(_[0]=s("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground"},"On the way",-1)),s("h1",st,y(u.event.title||"Event"),1)]),l(e(U),{variant:"ghost",size:"sm",class:"gap-2",onClick:m},{default:k(()=>[l(e(Se),{class:"h-4 w-4"}),_[1]||(_[1]=$(" Back ",-1))]),_:1})]),s("div",nt,[s("p",at,"We are waiting for you, "+y(e(d))+".",1),l(Ye,{event:u.event},null,8,["event"]),l(Ce,{event:u.event,venue:e(v)},null,8,["event","venue"]),l(we,{event:u.event,mode:"venue"},null,8,["event"])]),s("div",rt,[l(Pe,{slug:u.event.slug,fixed:!1,onCheckedIn:o},null,8,["slug"])])])])):D("",!0)}});export{kt as _};
