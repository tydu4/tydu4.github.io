import{H as Oe,d as Ne}from"./D1uJsfV4.js";import{d as H,c as b,a as e,u as g,o as p,j as D,t as x,b as C,F as T,E as F,w as O,G as q,f as Y,B as W,C as X,e as U,r as w,a1 as ie,k as ce,_ as Ve,a0 as le,Y as ze,T as Ee,g as qe,J as He}from"./D4tOOpea.js";import je from"./DitAOtD7.js";import{S as Qe}from"./CDoVUn-y.js";import{S as Ge}from"./CUtcqh3c.js";import{c as We}from"./BrE5OWI-.js";import{X as Je}from"./B8ijCWxw.js";import"./DlAUqK2U.js";import"./DSD0DqAy.js";import"./BDIprTuF.js";import"./D6B2Eigc.js";import"./DQ6Ue2G3.js";import"./D_jAd2MS.js";const Ye=We("sliders-horizontal",[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]]),Xe={class:"grid grid-cols-1 gap-2 sm:grid-cols-2"},Ze={class:"space-y-1"},Ke=["value"],_e={class:"space-y-1"},et=["value"],tt=H({__name:"DateRangePicker",props:{modelValue:{default:()=>({from:"",to:""})}},emits:["update:modelValue"],setup(s,{emit:B}){const m=s,v=B,k=D(()=>m.modelValue?.from??""),$=D(()=>m.modelValue?.to??""),M=(y,i)=>{const d={from:k.value,to:$.value,[y]:i};d.from&&d.to&&d.from>d.to&&(y==="from"?d.to=i:d.from=i),v("update:modelValue",d)};return(y,i)=>(p(),b("div",Xe,[e("label",Ze,[i[2]||(i[2]=e("span",{class:"text-xs font-medium text-muted-foreground"},"С",-1)),e("input",{type:"date",value:g(k),class:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm text-foreground ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",onInput:i[0]||(i[0]=d=>M("from",d.target.value))},null,40,Ke)]),e("label",_e,[i[3]||(i[3]=e("span",{class:"text-xs font-medium text-muted-foreground"},"По",-1)),e("input",{type:"date",value:g($),class:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm text-foreground ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",onInput:i[1]||(i[1]=d=>M("to",d.target.value))},null,40,et)])]))}}),ot=Object.assign(tt,{__name:"SharedDateRangePicker"}),rt={class:"space-y-6 rounded-3xl border border-border/80 bg-card/90 p-5 shadow-soft backdrop-blur-sm"},st={class:"space-y-3"},at={class:"flex items-center justify-between"},nt={class:"text-xs text-muted-foreground"},it={class:"grid grid-cols-2 gap-2 text-xs"},lt={class:"rounded-xl border border-border bg-background px-3 py-2"},dt={class:"mt-0.5 font-semibold text-foreground"},ut={class:"rounded-xl border border-border bg-background px-3 py-2 text-right"},ct={class:"mt-0.5 font-semibold text-foreground"},gt={class:"space-y-2"},pt=["min","max","value"],mt=["min","max","value"],vt={class:"space-y-3"},bt={class:"space-y-2"},ft=["value"],yt=["value"],xt={class:"space-y-2"},ht={class:"font-medium text-foreground"},wt=["checked","onChange"],kt={class:"space-y-2"},$t={class:"flex flex-wrap gap-2"},Mt=["onClick"],de=H({__name:"CatalogFilters",props:{priceRange:{},priceMin:{},priceMax:{},dateRange:{},sortBy:{},sortOptions:{},categoryOptions:{},selectedCategories:{},vibeOptions:{},selectedVibe:{}},emits:["update:priceRange","update:dateRange","update:sortBy","toggle:category","update:vibe","reset:filters"],setup(s,{emit:B}){const m=s,v=B,k=d=>{const r=Math.max(m.priceMin,Math.min(d,m.priceRange[1]));v("update:priceRange",[r,m.priceRange[1]])},$=d=>{const r=Math.min(m.priceMax,Math.max(d,m.priceRange[0]));v("update:priceRange",[m.priceRange[0],r])},M=d=>d>=m.priceMax?"5000+ ₽":`${d.toLocaleString("ru-RU")} ₽`,y=d=>m.selectedCategories.includes(d),i=d=>{if(m.selectedVibe===d){v("update:vibe","");return}v("update:vibe",d)};return(d,r)=>(p(),b("section",rt,[e("div",st,[e("div",at,[r[5]||(r[5]=e("h3",{class:"text-sm font-semibold text-foreground"},"Цена",-1)),e("span",nt,x(M(s.priceRange[0]))+" - "+x(M(s.priceRange[1])),1)]),e("div",it,[e("div",lt,[r[6]||(r[6]=e("p",{class:"text-muted-foreground"},"От",-1)),e("p",dt,x(M(s.priceRange[0])),1)]),e("div",ut,[r[7]||(r[7]=e("p",{class:"text-muted-foreground"},"До",-1)),e("p",ct,x(M(s.priceRange[1])),1)])]),e("div",gt,[e("input",{type:"range",min:s.priceMin,max:s.priceMax,value:s.priceRange[0],class:"h-2 w-full cursor-pointer accent-primary",onInput:r[0]||(r[0]=u=>k(Number(u.target.value)))},null,40,pt),e("input",{type:"range",min:s.priceMin,max:s.priceMax,value:s.priceRange[1],class:"h-2 w-full cursor-pointer accent-primary",onInput:r[1]||(r[1]=u=>$(Number(u.target.value)))},null,40,mt)])]),e("div",vt,[r[8]||(r[8]=e("h3",{class:"text-sm font-semibold text-foreground"},"Дата",-1)),C(ot,{"model-value":s.dateRange,"onUpdate:modelValue":r[2]||(r[2]=u=>v("update:dateRange",u))},null,8,["model-value"])]),e("div",bt,[r[9]||(r[9]=e("h3",{class:"text-sm font-semibold text-foreground"},"Сортировка",-1)),e("select",{value:s.sortBy,class:"h-10 w-full rounded-lg border border-input bg-background px-3 text-sm text-foreground ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",onChange:r[3]||(r[3]=u=>v("update:sortBy",u.target.value))},[(p(!0),b(T,null,F(s.sortOptions,u=>(p(),b("option",{key:u.value,value:u.value},x(u.label),9,yt))),128))],40,ft)]),e("div",xt,[r[10]||(r[10]=e("h3",{class:"text-sm font-semibold text-foreground"},"Категории",-1)),(p(!0),b(T,null,F(s.categoryOptions,u=>(p(),b("label",{key:u.value,class:"flex cursor-pointer items-center justify-between rounded-lg border border-border bg-background px-3 py-2 text-sm transition-colors hover:bg-muted/60"},[e("span",ht,x(u.label),1),e("input",{type:"checkbox",checked:y(u.value),class:"h-4 w-4 rounded border-input accent-primary",onChange:S=>v("toggle:category",u.value)},null,40,wt)]))),128))]),e("div",kt,[r[11]||(r[11]=e("h3",{class:"text-sm font-semibold text-foreground"},"Vibe",-1)),e("div",$t,[(p(!0),b(T,null,F(s.vibeOptions,u=>(p(),b("button",{key:u.value,type:"button",class:q(["rounded-full border px-3 py-1.5 text-xs font-medium transition-colors",s.selectedVibe===u.value?"border-primary bg-primary text-primary-foreground":"border-border bg-background text-muted-foreground hover:text-foreground"]),onClick:S=>i(u.value)},x(u.label),11,Mt))),128))])]),C(g(W),{variant:"outline",class:"w-full",onClick:r[4]||(r[4]=u=>v("reset:filters"))},{default:O(()=>[...r[12]||(r[12]=[Y(" Сбросить фильтры ",-1)])]),_:1})]))}}),Ct={class:"space-y-4"},Rt={class:"flex items-center justify-between rounded-2xl border border-border/70 bg-card/80 px-4 py-3 text-sm"},Dt={class:"font-semibold text-foreground"},St={key:0,class:"rounded-2xl border border-destructive/30 bg-destructive/10 px-4 py-3 text-sm text-destructive"},Tt={key:1,class:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3"},Pt={key:0,class:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3"},Bt={class:"absolute left-3 top-3 rounded-full bg-card/90 px-2.5 py-1 text-[11px] font-semibold text-foreground"},Ft={key:0,class:"absolute right-3 top-3 rounded-full bg-primary px-2.5 py-1 text-[10px] font-semibold uppercase tracking-[0.08em] text-primary-foreground"},Lt={class:"flex flex-1 flex-col gap-3 p-4"},At={class:"line-clamp-2 text-base font-semibold leading-tight text-foreground"},Ut={class:"mt-1 text-xs text-muted-foreground"},It={class:"mt-auto grid grid-cols-2 gap-3 text-xs"},Ot={class:"mt-1 font-semibold text-foreground"},Nt={class:"text-right"},Vt={class:"mt-1 font-semibold text-primary"},zt={class:"flex items-center justify-between text-xs text-muted-foreground"},Et={class:"truncate"},qt={key:0,class:"shrink-0 font-semibold text-foreground"},Ht={key:1,class:"rounded-2xl border border-border bg-card px-4 py-10 text-center text-sm text-muted-foreground"},jt={key:3,class:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3"},Qt={key:4,class:"py-2 text-center text-xs uppercase tracking-[0.14em] text-muted-foreground"},Gt=H({__name:"CatalogGrid",props:{events:{},totalMatched:{},isInitialLoading:{type:Boolean},isFetchingMore:{type:Boolean},hasMore:{type:Boolean},errorMessage:{}},emits:["update:sentinel"],setup(s,{emit:B}){const m=B,v=w(null),k=y=>{const i=new Date(y);if(Number.isNaN(i.getTime()))return"Дата уточняется";const d=new Date,r=new Date(d);r.setHours(0,0,0,0);const u=new Date(r);u.setDate(r.getDate()+1);const S=new Date(u);S.setDate(u.getDate()+1);const L=new Intl.DateTimeFormat("ru-RU",{hour:"2-digit",minute:"2-digit"}).format(i);return i>=r&&i<u?`Сегодня, ${L}`:i>=u&&i<S?`Завтра, ${L}`:new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"}).format(i)},$=y=>y<=0?"Бесплатно":`${y.toLocaleString("ru-RU")} ₽`,M=y=>y==="Music"?"from-cyan-500/30 via-cyan-500/10 to-transparent":y==="Tech"?"from-emerald-500/30 via-emerald-500/10 to-transparent":y==="Art"?"from-amber-500/30 via-amber-500/10 to-transparent":"from-rose-500/30 via-rose-500/10 to-transparent";return X(v,y=>{m("update:sentinel",y)},{immediate:!0}),(y,i)=>{const d=Ve;return p(),b("section",Ct,[e("div",Rt,[i[0]||(i[0]=e("p",{class:"text-muted-foreground"},"Найдено событий",-1)),e("p",Dt,x(s.totalMatched),1)]),s.errorMessage?(p(),b("div",St,x(s.errorMessage),1)):U("",!0),s.isInitialLoading?(p(),b("div",Tt,[(p(),b(T,null,F(9,r=>e("article",{key:`initial-skeleton-${r}`,class:"overflow-hidden rounded-2xl border border-border bg-card/80"},[...i[1]||(i[1]=[ie('<div class="h-36 animate-pulse bg-muted"></div><div class="space-y-3 p-4"><div class="h-4 w-2/3 animate-pulse rounded-full bg-muted"></div><div class="h-3 w-1/2 animate-pulse rounded-full bg-muted"></div><div class="h-3 w-1/3 animate-pulse rounded-full bg-muted"></div></div>',2)])])),64))])):(p(),b(T,{key:2},[s.events.length?(p(),b("div",Pt,[(p(!0),b(T,null,F(s.events,r=>(p(),ce(d,{key:r.id,to:`/e/${r.slug}`,class:"group flex h-full flex-col overflow-hidden rounded-2xl border border-border bg-card shadow-soft transition-all duration-200 hover:-translate-y-0.5 hover:shadow-elevated"},{default:O(()=>[e("div",{class:q(["relative h-36 overflow-hidden bg-gradient-to-br",M(r.category)])},[e("div",Bt,x(r.category)+" • "+x(r.vibe),1),r.recommended?(p(),b("div",Ft," Рекомендовано ")):U("",!0)],2),e("div",Lt,[e("div",null,[e("h3",At,x(r.title),1),e("p",Ut,x(r.venue)+" • "+x(r.city),1)]),e("div",It,[e("div",null,[i[2]||(i[2]=e("p",{class:"text-muted-foreground"},"Дата",-1)),e("p",Ot,x(k(r.startAt)),1)]),e("div",Nt,[i[3]||(i[3]=e("p",{class:"text-muted-foreground"},"Цена",-1)),e("p",Vt,x($(r.price)),1)])]),e("div",zt,[e("span",Et,x(r.organizer),1),r.rating!==null?(p(),b("span",qt," ★ "+x(r.rating.toFixed(1)),1)):U("",!0)])])]),_:2},1032,["to"]))),128))])):(p(),b("div",Ht," Ничего не найдено. Попробуйте изменить фильтры или тип поиска. "))],64)),e("div",{ref_key:"sentinelEl",ref:v,class:"h-1 w-full"},null,512),s.isFetchingMore&&!s.isInitialLoading?(p(),b("div",jt,[(p(),b(T,null,F(3,r=>e("article",{key:`next-skeleton-${r}`,class:"overflow-hidden rounded-2xl border border-border bg-card/80"},[...i[4]||(i[4]=[ie('<div class="h-36 animate-pulse bg-muted"></div><div class="space-y-3 p-4"><div class="h-4 w-2/3 animate-pulse rounded-full bg-muted"></div><div class="h-3 w-1/2 animate-pulse rounded-full bg-muted"></div><div class="h-3 w-1/3 animate-pulse rounded-full bg-muted"></div></div>',2)])])),64))])):!s.hasMore&&s.events.length?(p(),b("p",Qt," Показаны все доступные события ")):U("",!0)])}}}),Wt={class:"-mx-4"},Jt={class:"mx-auto max-w-7xl space-y-5 px-4 pb-12 sm:px-6 lg:px-8"},Yt={class:"space-y-4 rounded-3xl border border-border/70 bg-card/80 p-4 shadow-soft backdrop-blur-sm sm:p-5"},Xt={class:"flex flex-wrap items-start justify-between gap-3"},Zt={class:"inline-flex items-center gap-2 rounded-full border border-border bg-background px-3 py-1 text-xs"},Kt={class:"font-medium text-foreground"},_t={class:"grid gap-3 md:grid-cols-[minmax(0,1fr)_auto] md:items-start"},eo={class:"relative"},to={key:0,class:"absolute z-30 mt-2 w-full overflow-hidden rounded-2xl border border-border bg-card shadow-elevated"},oo={class:"px-3 py-2 text-[11px] font-semibold uppercase tracking-[0.14em] text-muted-foreground"},ro=["onClick"],so={class:"text-sm font-medium text-foreground"},ao={class:"text-xs text-muted-foreground"},no={key:1,class:"px-3 py-4 text-sm text-muted-foreground"},io={class:"rounded-xl border border-border bg-background p-1"},lo={class:"flex flex-wrap gap-1"},uo=["onClick"],co={class:"lg:hidden"},go={class:"flex gap-2 overflow-x-auto pb-1"},po={key:0,class:"ml-1 rounded-full bg-primary px-1.5 py-0.5 text-[10px] text-primary-foreground"},mo={class:"grid gap-6 lg:grid-cols-[19rem_minmax(0,1fr)]"},vo={class:"hidden lg:block"},bo={class:"sticky top-24"},fo={key:0,class:"fixed inset-x-0 bottom-0 z-[95] max-h-[85dvh] overflow-y-auto rounded-t-3xl border border-border bg-card p-4 shadow-elevated lg:hidden"},yo={class:"mb-4 flex items-center justify-between"},xo=H({__name:"CatalogMainBlock",props:{events:{},totalMatched:{},searchQuery:{},searchScope:{},searchModes:{},suggestionGroups:{},priceRange:{},priceMin:{},priceMax:{},dateRange:{},sortBy:{},sortOptions:{},categoryOptions:{},selectedCategories:{},vibeOptions:{},selectedVibe:{},activeFiltersCount:{},isInitialLoading:{type:Boolean},isFetchingMore:{type:Boolean},hasMore:{type:Boolean},errorMessage:{}},emits:["update:searchQuery","update:searchScope","apply:suggestion","update:priceRange","update:dateRange","update:sortBy","toggle:category","update:vibe","reset:filters","quick:friday","quick:budget","update:sentinel"],setup(s,{emit:B}){const m=s,v=B,k=w(!1),$=w(!1),M=D(()=>m.suggestionGroups.some(h=>h.items.length>0)),y=D(()=>$.value&&m.searchQuery.trim().length>0),i=h=>{const o=h.getFullYear(),n=`${h.getMonth()+1}`.padStart(2,"0"),R=`${h.getDate()}`.padStart(2,"0");return`${o}-${n}-${R}`},d=h=>{const o=new Date,n=new Date(o),R=(h-o.getDay()+7)%7;return n.setDate(o.getDate()+R),i(n)},r=D(()=>d(5)),u=D(()=>m.priceRange[0]<=m.priceMin&&m.priceRange[1]<=1e3),S=D(()=>m.dateRange.from===r.value&&m.dateRange.to===r.value),L=D(()=>m.sortOptions.find(h=>h.value===m.sortBy)?.label??""),z=D(()=>m.selectedCategories.length?m.selectedCategories.length===1?m.categoryOptions.find(h=>h.value===m.selectedCategories[0])?.label??"Категории":`Категории: ${m.selectedCategories.length}`:"Категории"),N=D(()=>m.selectedVibe?m.vibeOptions.find(h=>h.value===m.selectedVibe)?.label??"Vibe":"Vibe"),I=h=>{v("apply:suggestion",h),$.value=!1},A=()=>{window.setTimeout(()=>{$.value=!1},120)};return(h,o)=>(p(),b(T,null,[e("div",Wt,[e("div",Jt,[e("header",Yt,[e("div",Xt,[o[25]||(o[25]=e("div",null,[e("h1",{class:"text-2xl font-bold text-foreground"},"Каталог событий"),e("p",{class:"mt-1 text-sm text-muted-foreground"}," Найдите событие в несколько шагов: от техно-вечеринки до бизнес-нетворкинга. ")],-1)),e("div",Zt,[C(g(Qe),{class:"h-3.5 w-3.5 text-primary"}),e("span",Kt,x(s.totalMatched)+" результатов",1)])]),e("div",_t,[e("div",{class:"relative",onFocusin:o[2]||(o[2]=n=>$.value=!0),onFocusout:A},[e("div",eo,[C(g(Ge),{class:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),C(g(je),{"model-value":s.searchQuery,type:"search",class:"h-11 rounded-xl pl-10",placeholder:"Например: техно, roof, pulse...","onUpdate:modelValue":o[0]||(o[0]=n=>v("update:searchQuery",n))},null,8,["model-value"])]),g(y)?(p(),b("div",to,[g(M)?(p(!0),b(T,{key:0},F(s.suggestionGroups,n=>(p(),b("div",{key:n.type,class:"border-b border-border/70 last:border-b-0"},[e("p",oo,x(n.title),1),(p(!0),b(T,null,F(n.items,R=>(p(),b("button",{key:R.id,type:"button",class:"flex w-full items-center justify-between px-3 py-2 text-left transition-colors hover:bg-muted/60",onMousedown:o[1]||(o[1]=Ee(()=>{},["prevent"])),onClick:Z=>I(R)},[e("span",so,x(R.label),1),e("span",ao,x(R.caption),1)],40,ro))),128))]))),128)):(p(),b("p",no," Ничего не найдено. Попробуйте другой запрос. "))])):U("",!0)],32),e("div",io,[o[26]||(o[26]=e("p",{class:"px-2 pb-1 text-[11px] uppercase tracking-[0.12em] text-muted-foreground"}," Искать по ",-1)),e("div",lo,[(p(!0),b(T,null,F(s.searchModes,n=>(p(),b("button",{key:n.value,type:"button",class:q(["rounded-lg px-3 py-2 text-xs font-semibold transition-colors",s.searchScope===n.value?"bg-primary text-primary-foreground":"text-muted-foreground hover:bg-muted hover:text-foreground"]),onClick:R=>v("update:searchScope",n.value)},x(n.label),11,uo))),128))])])])]),e("div",co,[e("div",go,[e("button",{type:"button",class:q(["whitespace-nowrap rounded-full border px-3 py-1.5 text-xs font-medium transition-colors",g(u)?"border-primary bg-primary text-primary-foreground":"border-border bg-background text-muted-foreground"]),onClick:o[3]||(o[3]=n=>v("quick:budget"))}," до 1000 ₽ ",2),e("button",{type:"button",class:q(["whitespace-nowrap rounded-full border px-3 py-1.5 text-xs font-medium transition-colors",g(S)?"border-primary bg-primary text-primary-foreground":"border-border bg-background text-muted-foreground"]),onClick:o[4]||(o[4]=n=>v("quick:friday"))}," Пятница ",2),e("button",{type:"button",class:"whitespace-nowrap rounded-full border border-border bg-background px-3 py-1.5 text-xs font-medium text-muted-foreground",onClick:o[5]||(o[5]=n=>k.value=!0)},x(g(L)||"Сортировка"),1),e("button",{type:"button",class:"whitespace-nowrap rounded-full border border-border bg-background px-3 py-1.5 text-xs font-medium text-muted-foreground",onClick:o[6]||(o[6]=n=>k.value=!0)},x(g(z)),1),e("button",{type:"button",class:"whitespace-nowrap rounded-full border border-border bg-background px-3 py-1.5 text-xs font-medium text-muted-foreground",onClick:o[7]||(o[7]=n=>k.value=!0)},x(g(N)),1),C(g(W),{variant:"outline",class:"h-8 shrink-0 rounded-full px-3 text-xs",onClick:o[8]||(o[8]=n=>k.value=!0)},{default:O(()=>[C(g(Ye),{class:"mr-1 h-3.5 w-3.5"}),o[27]||(o[27]=Y(" Все фильтры ",-1)),s.activeFiltersCount?(p(),b("span",po,x(s.activeFiltersCount),1)):U("",!0)]),_:1})])]),e("div",mo,[e("aside",vo,[e("div",bo,[C(de,{"price-range":s.priceRange,"price-min":s.priceMin,"price-max":s.priceMax,"date-range":s.dateRange,"sort-by":s.sortBy,"sort-options":s.sortOptions,"category-options":s.categoryOptions,"selected-categories":s.selectedCategories,"vibe-options":s.vibeOptions,"selected-vibe":s.selectedVibe,"onUpdate:priceRange":o[9]||(o[9]=n=>v("update:priceRange",n)),"onUpdate:dateRange":o[10]||(o[10]=n=>v("update:dateRange",n)),"onUpdate:sortBy":o[11]||(o[11]=n=>v("update:sortBy",n)),"onToggle:category":o[12]||(o[12]=n=>v("toggle:category",n)),"onUpdate:vibe":o[13]||(o[13]=n=>v("update:vibe",n)),"onReset:filters":o[14]||(o[14]=n=>v("reset:filters"))},null,8,["price-range","price-min","price-max","date-range","sort-by","sort-options","category-options","selected-categories","vibe-options","selected-vibe"])])]),C(Gt,{events:s.events,"total-matched":s.totalMatched,"is-initial-loading":s.isInitialLoading,"is-fetching-more":s.isFetchingMore,"has-more":s.hasMore,"error-message":s.errorMessage,"onUpdate:sentinel":o[15]||(o[15]=n=>v("update:sentinel",n))},null,8,["events","total-matched","is-initial-loading","is-fetching-more","has-more","error-message"])])])]),(p(),ce(ze,{to:"body"},[C(le,{"enter-active-class":"transition-opacity duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:O(()=>[g(k)?(p(),b("div",{key:0,class:"fixed inset-0 z-[90] bg-black/55 lg:hidden",onClick:o[16]||(o[16]=n=>k.value=!1)})):U("",!0)]),_:1}),C(le,{"enter-active-class":"transition-transform duration-250 ease-out","enter-from-class":"translate-y-full","enter-to-class":"translate-y-0","leave-active-class":"transition-transform duration-200 ease-in","leave-from-class":"translate-y-0","leave-to-class":"translate-y-full"},{default:O(()=>[g(k)?(p(),b("section",fo,[e("div",yo,[o[28]||(o[28]=e("div",null,[e("h2",{class:"text-lg font-semibold text-foreground"},"Все фильтры"),e("p",{class:"text-xs text-muted-foreground"},"Настройте выдачу под текущий запрос")],-1)),C(g(W),{variant:"ghost",size:"icon",class:"rounded-full",onClick:o[17]||(o[17]=n=>k.value=!1)},{default:O(()=>[C(g(Je),{class:"h-4 w-4"})]),_:1})]),C(de,{"price-range":s.priceRange,"price-min":s.priceMin,"price-max":s.priceMax,"date-range":s.dateRange,"sort-by":s.sortBy,"sort-options":s.sortOptions,"category-options":s.categoryOptions,"selected-categories":s.selectedCategories,"vibe-options":s.vibeOptions,"selected-vibe":s.selectedVibe,"onUpdate:priceRange":o[18]||(o[18]=n=>v("update:priceRange",n)),"onUpdate:dateRange":o[19]||(o[19]=n=>v("update:dateRange",n)),"onUpdate:sortBy":o[20]||(o[20]=n=>v("update:sortBy",n)),"onToggle:category":o[21]||(o[21]=n=>v("toggle:category",n)),"onUpdate:vibe":o[22]||(o[22]=n=>v("update:vibe",n)),"onReset:filters":o[23]||(o[23]=n=>v("reset:filters"))},null,8,["price-range","price-min","price-max","date-range","sort-by","sort-options","category-options","selected-categories","vibe-options","selected-vibe"]),C(g(W),{class:"mt-4 w-full",onClick:o[24]||(o[24]=n=>k.value=!1)},{default:O(()=>[...o[29]||(o[29]=[Y(" Применить ",-1)])]),_:1})])):U("",!0)]),_:1})]))],64))}}),ho={class:"page-wrapper"},wo={class:"flex min-h-[calc(100dvh-9rem)] flex-col gap-4 lg:flex-row lg:items-start lg:gap-6"},ko={class:"min-w-0 flex-1"},ue=12,E=0,G=5500,Oo=H({__name:"index",setup(s){const B=[{value:"events",label:"Событиям"},{value:"venues",label:"Площадкам"},{value:"organizers",label:"Организаторам"}],m=[{value:"price_asc",label:"Сначала дешевые"},{value:"newest",label:"Сначала новые"},{value:"popular",label:"По популярности"}],v=[{value:"Music",label:"Music"},{value:"Tech",label:"Tech"},{value:"Art",label:"Art"},{value:"Party",label:"Party"}],k=[{value:"Chill",label:"Chill"},{value:"Rave",label:"Rave"},{value:"Networking",label:"Networking"}],$=w(""),M=w("events"),y=w([E,G]),i=w({from:"",to:""}),d=w("popular"),r=w([]),u=w(""),S=w([]),L=w(0),z=w(0),N=w(!1),I=w(!1),A=w(!0),h=w(""),o=w(0),n=w(null);let R=null;const Z=a=>new Promise(t=>{setTimeout(t,a)}),ge=a=>{const t=a.getFullYear(),l=`${a.getMonth()+1}`.padStart(2,"0"),f=`${a.getDate()}`.padStart(2,"0");return`${t}-${l}-${f}`},pe=a=>{const t=new Date,l=new Date(t),f=(a-t.getDay()+7)%7;return l.setDate(t.getDate()+f),ge(l)},V=(a,t,l=0)=>{const f=new Date;return f.setDate(f.getDate()+a),f.setHours(t,l,0,0),f.toISOString()},J=D(()=>pe(5)),me=[{id:1,slug:"techno-friday-rave",title:"Техно вечеринка: Friday Rave",description:"Ночной рейв с индустриальным звуком и световым шоу.",venue:"Factory Hall",organizer:"Pulse Family",city:"Москва",category:"Party",vibe:"Rave",price:900,startAt:((a,t=0)=>{const l=new Date(`${J.value}T00:00:00`);return l.setHours(a,t,0,0),l.toISOString()})(22,0),rating:4.8,recommended:!0,popularity:980},{id:2,slug:"sunset-house-session",title:"Sunset House Session",description:"Легкий хаус на крыше с видом на город.",venue:"Skyline Roof",organizer:"City Beats",city:"Санкт-Петербург",category:"Music",vibe:"Chill",price:1200,startAt:V(2,19,30),rating:4.6,recommended:!1,popularity:760},{id:3,slug:"startup-night-mixer",title:"Startup Night Mixer",description:"Нетворкинг для фаундеров, продактов и разработчиков.",venue:"Tech Loft",organizer:"Founders Hub",city:"Казань",category:"Tech",vibe:"Networking",price:0,startAt:V(4,18,0),rating:4.4,recommended:!0,popularity:690},{id:4,slug:"new-media-art-lab",title:"New Media Art Lab",description:"Иммерсивная выставка digital art и перформансов.",venue:"Art Reactor",organizer:"Shape Studio",city:"Екатеринбург",category:"Art",vibe:"Chill",price:700,startAt:V(1,17,30),rating:4.7,recommended:!1,popularity:640},{id:5,slug:"deep-tech-conference",title:"Deep Tech Conference",description:"Тренды AI, hardware и продуктовой инженерии.",venue:"Volga Expo",organizer:"Next Era Team",city:"Нижний Новгород",category:"Tech",vibe:"Networking",price:2800,startAt:V(7,11,0),rating:4.9,recommended:!0,popularity:910},{id:6,slug:"city-breakbeat-party",title:"City Breakbeat Party",description:"Танцевальная ночь с лайв-сетами и visual art.",venue:"Dock Stage",organizer:"Night Pulse",city:"Москва",category:"Party",vibe:"Rave",price:1100,startAt:V(3,23,0),rating:4.3,recommended:!1,popularity:720}],K={Music:["Jazz Courtyard","Indie Weekend","Lo-fi Session","Acoustic Pulse"],Tech:["Product Meetup","Frontend Club","AI Hands-On","Cloud Practicum"],Art:["Gallery Night","Street Photo Talk","Creative Lab","Art Breakfast"],Party:["Bassline Night","Neon Party","Electro Friday","Afterhours Set"]},_=["Москва","Санкт-Петербург","Казань","Екатеринбург","Новосибирск"],ee=["Warehouse 21","Tech Loft","Orbit Hall","Signal Space","Blue Room"],te=["Pulse Crew","Open Culture","Community Lab","Flow Agency","Event Syndicate"],oe=[0,500,800,950,1200,1500,1900,2300,2800,3400,4100,5200],re=["Music","Tech","Art","Party"],se=["Chill","Rave","Networking"],ve=Array.from({length:64},(a,t)=>{const l=t+1,f=re[t%re.length],c=se[(t+1)%se.length],P=K[f][t%K[f].length],Q=100+l,Ue=3.9+t*3%11/10,Ie=t%6===0?null:Number(Ue.toFixed(1));return{id:Q,slug:`catalog-event-${Q}`,title:`${P} #${l}`,description:`Подборка ${f.toLowerCase()} событий для настроения ${c.toLowerCase()}.`,venue:ee[t%ee.length],organizer:te[t%te.length],city:_[t%_.length],category:f,vibe:c,price:oe[t%oe.length],startAt:V(t%24+1,11+t%9,t%2===0?0:30),rating:Ie,recommended:t%5===0,popularity:280+t*47%720}}),j=[...me,...ve],be=a=>{const t=new Date(a);return Number.isNaN(t.getTime())?"дата уточняется":new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"short"}).format(t)},fe=D(()=>{const a=$.value.trim().toLocaleLowerCase("ru-RU");if(!a)return[];const t=j.filter(c=>c.title.toLocaleLowerCase("ru-RU").includes(a)).slice(0,4).map(c=>({id:`event-${c.id}`,type:"events",label:c.title,caption:`${c.venue} • ${be(c.startAt)}`})),l=Array.from(new Set(j.map(c=>`${c.venue}|${c.city}`).filter(c=>c.toLocaleLowerCase("ru-RU").includes(a)))).slice(0,3).map(c=>{const[P,Q]=c.split("|");return{id:`venue-${P}`,type:"venues",label:P,caption:Q}}),f=Array.from(new Set(j.map(c=>c.organizer).filter(c=>c.toLocaleLowerCase("ru-RU").includes(a)))).slice(0,3).map(c=>({id:`organizer-${c}`,type:"organizers",label:c,caption:"Организатор"}));return[{type:"events",title:"События",items:t},{type:"venues",title:"Площадки",items:l},{type:"organizers",title:"Организаторы",items:f}].filter(c=>c.items.length>0)}),ye=()=>({query:$.value.trim(),scope:M.value,minPrice:y.value[0],maxPrice:y.value[1],fromDate:i.value.from,toDate:i.value.to,sort:d.value,categories:[...r.value],vibe:u.value}),xe=(a,t)=>{if(!t.query)return!0;const l=t.query.toLocaleLowerCase("ru-RU");return t.scope==="venues"?`${a.venue} ${a.city}`.toLocaleLowerCase("ru-RU").includes(l):t.scope==="organizers"?a.organizer.toLocaleLowerCase("ru-RU").includes(l):`${a.title} ${a.description} ${a.category} ${a.vibe}`.toLocaleLowerCase("ru-RU").includes(l)},he=(a,t)=>a.price>=t.minPrice&&a.price<=t.maxPrice,we=(a,t)=>{const l=a.startAt.slice(0,10);return!(t.fromDate&&l<t.fromDate||t.toDate&&l>t.toDate)},ke=(a,t)=>t.categories.length===0||t.categories.includes(a.category),$e=(a,t)=>!t.vibe||a.vibe===t.vibe,Me=(a,t)=>{const l=[...a];return t==="price_asc"?l.sort((f,c)=>f.price-c.price||c.popularity-f.popularity):t==="newest"?l.sort((f,c)=>new Date(c.startAt).getTime()-new Date(f.startAt).getTime()):l.sort((f,c)=>c.popularity-f.popularity||f.price-c.price)},Ce=async({page:a,filters:t})=>{console.log("Filter applied:",t),await Z(650);const l=Me(j.filter(P=>xe(P,t)&&he(P,t)&&we(P,t)&&ke(P,t)&&$e(P,t)),t.sort),f=a*ue,c=f+ue;return{items:l.slice(f,c),total:l.length,hasMore:c<l.length}},ae=async({token:a=o.value}={})=>{if(I.value||!A.value)return;I.value=!0;const t=ye(),l=z.value;try{const f=await Ce({page:l,filters:t});if(a!==o.value)return;S.value=[...S.value,...f.items],z.value=l+1,A.value=f.hasMore,L.value=f.total}catch{if(a!==o.value)return;h.value="Не удалось загрузить события. Попробуйте еще раз.",A.value=!1}finally{a===o.value&&(I.value=!1)}},Re=async()=>{o.value+=1;const a=o.value;S.value=[],z.value=0,L.value=0,A.value=!0,h.value="",N.value=!0,window.scrollTo({top:0,behavior:"smooth"}),await ae({token:a}),a===o.value&&(N.value=!1)},De=D(()=>JSON.stringify({query:$.value.trim(),scope:M.value,minPrice:y.value[0],maxPrice:y.value[1],fromDate:i.value.from,toDate:i.value.to,sort:d.value,categories:[...r.value].sort(),vibe:u.value})),Se=D(()=>{let a=0;return(y.value[0]!==E||y.value[1]!==G)&&(a+=1),(i.value.from||i.value.to)&&(a+=1),d.value!=="popular"&&(a+=1),r.value.length&&(a+=1),u.value&&(a+=1),a}),Te=a=>{M.value=a.type,$.value=a.label},Pe=a=>{if(r.value.includes(a)){r.value=r.value.filter(t=>t!==a);return}r.value=[...r.value,a]},Be=()=>{y.value=[E,G],i.value={from:"",to:""},d.value="popular",r.value=[],u.value=""},Fe=()=>{i.value={from:J.value,to:J.value}},Le=()=>{y.value=[E,1e3]},Ae=a=>{n.value=a},ne=()=>{R?.disconnect(),R=new IntersectionObserver(a=>{a.some(l=>l.isIntersecting)&&(N.value||I.value||A.value&&ae())},{rootMargin:"280px 0px 280px 0px"}),n.value&&R.observe(n.value)};return X(De,()=>{Re()},{immediate:!0}),X(n,()=>{ne()}),qe(()=>{ne()}),He(()=>{R?.disconnect()}),(a,t)=>(p(),b("div",ho,[e("div",wo,[C(Oe,{items:g(Ne),class:"shrink-0"},null,8,["items"]),e("div",ko,[C(xo,{events:g(S),"total-matched":g(L),"search-query":g($),"search-scope":g(M),"search-modes":B,"suggestion-groups":g(fe),"price-range":g(y),"price-min":E,"price-max":G,"date-range":g(i),"sort-by":g(d),"sort-options":m,"category-options":v,"selected-categories":g(r),"vibe-options":k,"selected-vibe":g(u),"active-filters-count":g(Se),"is-initial-loading":g(N),"is-fetching-more":g(I),"has-more":g(A),"error-message":g(h),"onUpdate:searchQuery":t[0]||(t[0]=l=>$.value=l),"onUpdate:searchScope":t[1]||(t[1]=l=>M.value=l),"onApply:suggestion":Te,"onUpdate:priceRange":t[2]||(t[2]=l=>y.value=l),"onUpdate:dateRange":t[3]||(t[3]=l=>i.value=l),"onUpdate:sortBy":t[4]||(t[4]=l=>d.value=l),"onToggle:category":Pe,"onUpdate:vibe":t[5]||(t[5]=l=>u.value=l),"onReset:filters":Be,"onQuick:friday":Fe,"onQuick:budget":Le,"onUpdate:sentinel":Ae},null,8,["events","total-matched","search-query","search-scope","suggestion-groups","price-range","date-range","sort-by","selected-categories","selected-vibe","active-filters-count","is-initial-loading","is-fetching-more","has-more","error-message"])])])]))}});export{Oo as default};
