import{H as oe,p as ae}from"./DS9zloey.js";import{d as $,J as le,u as re,j as m,a2 as ie,K as P,z as I,o as d,c as u,a as t,b as i,_ as ne,m as s,w as x,B as F,f as y,F as de,t as n,e as N,W as M,a3 as ue,a5 as ce,a4 as me,r as _}from"./DIpL79ME.js";import f from"./CgaNsBb1.js";import pe from"./QaezlMZ8.js";import fe from"./ktI8lQth.js";import"./DlAUqK2U.js";import"./DSoaomjP.js";import"./Ck3zTzEc.js";import"./BTA2ybKl.js";import"./BwSGWVKi.js";import"./CnmEv5PP.js";import"./Dh-MwfXC.js";import"./NaR5TDkT.js";import"./5jP3ovOk.js";const ge={class:"mx-auto w-full max-w-3xl space-y-6 pb-10 overscroll-none"},ve={class:"rounded-3xl border border-border bg-card p-6 shadow-soft"},be={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},xe={key:0,class:"space-y-3"},ye={key:1,class:"rounded-2xl border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive"},_e={class:"space-y-4 rounded-3xl border border-border bg-card p-6 shadow-soft"},he={class:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between"},ke={class:"flex items-center gap-4"},we=["disabled"],Ve=["src","alt"],Pe={key:1,class:"flex h-full w-full items-center justify-center text-2xl font-bold text-primary"},Ue={class:"min-w-0 select-none"},Ae={class:"truncate text-lg font-bold text-foreground"},Ce={class:"truncate text-sm text-muted-foreground"},Se={class:"flex flex-col items-start gap-2"},je={key:0,class:"text-xs text-muted-foreground"},Be={class:"grid gap-4"},Fe={class:"space-y-2"},Ne={key:0,class:"text-xs text-destructive"},Ee={class:"space-y-2"},Le={class:"flex items-center justify-between text-xs"},Re={key:0,class:"text-destructive"},Te={class:"ml-auto text-muted-foreground"},Ie={class:"space-y-4 rounded-3xl border border-border bg-card p-6 shadow-soft"},Me={class:"flex items-center justify-between gap-3 select-none"},$e={class:"grid gap-4 sm:grid-cols-2"},He={class:"space-y-2"},De={class:"space-y-2"},ze={class:"space-y-4 rounded-3xl border border-border bg-card p-6 shadow-soft"},Oe={class:"grid gap-4 sm:grid-cols-3"},Ke={class:"space-y-2"},Je={class:"space-y-2"},qe={class:"space-y-2"},We={class:"space-y-4 rounded-3xl border border-border bg-card p-6 shadow-soft"},Ze={class:"flex items-start gap-3 rounded-2xl border border-border px-4 py-3 text-sm text-muted-foreground"},Ge={class:"space-y-2"},Qe={class:"flex items-center justify-between gap-3"},Xe={class:"text-xs text-muted-foreground"},Ye=$({__name:"ProfileSettingsBlock",setup(H){const p=le(),U=re(),A=m(()=>p.isAuthInitialized&&!!p.token),{data:D,pending:E,error:z,refresh:h}=ie("/api/v1/me/profile",{key:"profile-settings",baseURL:P("/api/v1/me/profile"),$fetch:p.apiFetch,server:!1,immediate:!1,default:()=>null},"$I_JUyNAw6j");I(A,o=>{o&&h()},{immediate:!0});const c=m(()=>D.value??null),a=me({username:"",bio:"",avatar_url:"",email:"",social_links:{telegram:"",vk:"",instagram:""},settings:{notifications:!0,privacy_level:"public"}}),C=o=>typeof o=="string"?o.trim():"",g=o=>o.trim()||null,O=["public","hidden","matches_only"],K=o=>typeof o!="string"?"public":O.includes(o)?o:"public",J=o=>{if(!o)return;a.username=o.username||"",a.bio=o.bio||"",a.avatar_url=o.avatar_url||"",a.email=o.email||"";const e=o.social_links&&typeof o.social_links=="object"?o.social_links:{};a.social_links.telegram=C(e.telegram),a.social_links.vk=C(e.vk),a.social_links.instagram=C(e.instagram);const r=o.settings&&typeof o.settings=="object"?o.settings:{};a.settings.notifications=typeof r.notifications=="boolean"?r.notifications:!0,a.settings.privacy_level=K(r.privacy_level)};I(c,o=>{J(o)},{immediate:!0});const S=m(()=>c.value?.full_name?.trim()||a.username.trim()||c.value?.username||"Profile"),q=m(()=>S.value.trim().charAt(0).toUpperCase()||"U"),W=m(()=>{const o=a.username.trim()||c.value?.username||"";return o?`/u/${encodeURIComponent(o)}`:"/profile/me"}),Z=/^[a-zA-Z0-9_]+$/,j=m(()=>{const o=a.username.trim();return o?o.length<3?"Minimum 3 symbols":o.length>50?"Maximum 50 symbols":Z.test(o)?"":'Only latin letters, numbers and "_"':"Username is required"}),B=m(()=>a.bio.length>500?"Bio must be <= 500 symbols":""),G=m(()=>!!(j.value||B.value)),k=_(null),v=_(!1),b=_(""),w=_(!1),V=_(""),L=m(()=>A.value&&!w.value&&!E.value&&!G.value&&!!a.username.trim()),Q=()=>{A.value&&h()},R=()=>k.value?.click(),X=o=>{if(!o)return"";if(typeof o=="string")return o;if(typeof o!="object")return"";const e=o,r=e.avatar_url||e.url||e.image_url;if(typeof r=="string")return r;if(e.user&&typeof e.user=="object"){const l=e.user.avatar_url;if(typeof l=="string")return l}if(e.data&&typeof e.data=="object"){const l=e.data.avatar_url||e.data.url;if(typeof l=="string")return l}return""},Y=async o=>{const r=o.target.files?.[0];if(r){v.value=!0,b.value="";try{const l=new FormData;l.append("file",r);const se=await p.apiFetch("/api/v1/me/avatar",{method:"POST",baseURL:P("/api/v1/me/avatar"),body:l}),T=X(se);T?a.avatar_url=T:(await h(),c.value?.avatar_url&&(a.avatar_url=c.value.avatar_url)),b.value="Avatar uploaded"}catch{b.value="Avatar upload failed"}finally{v.value=!1,k.value&&(k.value.value="")}}},ee=o=>{const e=o?.data?.detail;if(typeof e=="string")return e;if(Array.isArray(e)&&e.length>0){const r=e[0];if(r?.msg)return r.msg}return""},te=async()=>{if(V.value="",!!L.value){w.value=!0;try{const o={username:a.username.trim(),bio:g(a.bio),avatar_url:g(a.avatar_url),social_links:{telegram:g(a.social_links.telegram),vk:g(a.social_links.vk),instagram:g(a.social_links.instagram)}},r={...c.value?.settings&&typeof c.value.settings=="object"?c.value.settings:{},notifications:a.settings.notifications,privacy_level:a.settings.privacy_level};await Promise.all([p.apiFetch("/api/v1/me/profile",{method:"PATCH",baseURL:P("/api/v1/me/profile"),body:o}),p.apiFetch("/api/v1/me/settings",{method:"PATCH",baseURL:P("/api/v1/me/settings"),body:r})]),V.value="Profile settings saved",U.push({level:"success",title:"Success",message:"Profile settings saved."}),await Promise.all([h(),p.fetchUser()])}catch(o){const e=ee(o)||"Failed to save changes";V.value=e,U.push({level:"error",title:"Error",message:e})}finally{w.value=!1}}};return(o,e)=>{const r=ne;return d(),u("div",ge,[t("section",ve,[t("div",be,[e[9]||(e[9]=t("div",{class:"space-y-2 select-none"},[t("p",{class:"text-xs font-semibold uppercase tracking-[0.18em] text-primary/80"},"Profile Settings"),t("h1",{class:"text-2xl font-bold text-foreground"},"Profile Settings")],-1)),i(r,{to:s(W)},{default:x(()=>[i(s(F),{variant:"outline",class:"rounded-full",type:"button"},{default:x(()=>[...e[8]||(e[8]=[y(" Open public profile ",-1)])]),_:1})]),_:1},8,["to"])])]),s(E)?(d(),u("section",xe,[...e[10]||(e[10]=[t("div",{class:"h-32 animate-pulse rounded-2xl bg-muted"},null,-1),t("div",{class:"h-64 animate-pulse rounded-2xl bg-muted"},null,-1)])])):s(z)?(d(),u("section",ye,[e[11]||(e[11]=y(" Failed to load settings. ",-1)),t("button",{type:"button",class:"ml-2 underline",onClick:Q},"Refresh")])):(d(),u(de,{key:2},[t("section",_e,[t("div",he,[t("div",ke,[t("button",{type:"button",class:"h-20 w-20 overflow-hidden rounded-full border-4 border-background bg-primary/10 shadow-soft transition hover:scale-[1.02] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",disabled:s(v),onClick:R},[s(a).avatar_url?(d(),u("img",{key:0,src:s(a).avatar_url,alt:s(S),class:"h-full w-full object-cover"},null,8,Ve)):(d(),u("span",Pe,n(s(q)),1))],8,we),t("div",Ue,[t("h2",Ae,n(s(S)),1),t("p",Ce,"@"+n(s(a).username||"username"),1),e[12]||(e[12]=t("p",{class:"text-xs text-muted-foreground"},"Click avatar to upload",-1))])]),t("div",Se,[i(s(F),{variant:"outline",class:"rounded-full",type:"button",disabled:s(v),onClick:R},{default:x(()=>[y(n(s(v)?"Uploading...":"Upload avatar"),1)]),_:1},8,["disabled"]),t("input",{ref_key:"avatarInput",ref:k,type:"file",accept:"image/*",class:"hidden",onChange:Y},null,544),s(b)?(d(),u("p",je,n(s(b)),1)):N("",!0)])]),t("div",Be,[t("div",Fe,[e[13]||(e[13]=t("label",{class:"select-none text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Username ",-1)),i(s(f),{modelValue:s(a).username,"onUpdate:modelValue":e[0]||(e[0]=l=>s(a).username=l),type:"text",placeholder:"my_username",autocomplete:"off"},null,8,["modelValue"]),s(j)?(d(),u("p",Ne,n(s(j)),1)):N("",!0)]),t("div",Ee,[e[14]||(e[14]=t("label",{class:"select-none text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Bio ",-1)),i(s(pe),{modelValue:s(a).bio,"onUpdate:modelValue":e[1]||(e[1]=l=>s(a).bio=l),rows:5,maxlength:"500",placeholder:"Tell about yourself"},null,8,["modelValue"]),t("div",Le,[s(B)?(d(),u("p",Re,n(s(B)),1)):N("",!0),t("span",Te,n(s(a).bio.length)+"/500",1)])])])]),t("section",Ie,[t("div",Me,[e[16]||(e[16]=t("div",null,[t("h2",{class:"text-lg font-bold text-foreground"},"Account Security"),t("p",{class:"text-sm text-muted-foreground"}," Email and password updates will be available soon. ")],-1)),i(s(fe),{variant:"outline"},{default:x(()=>[...e[15]||(e[15]=[y("Coming soon",-1)])]),_:1})]),t("div",$e,[t("div",He,[e[17]||(e[17]=t("label",{class:"select-none text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Email ",-1)),i(s(f),{modelValue:s(a).email,"onUpdate:modelValue":e[2]||(e[2]=l=>s(a).email=l),type:"email",placeholder:"name@example.com",disabled:""},null,8,["modelValue"])]),t("div",De,[e[18]||(e[18]=t("label",{class:"select-none text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Password ",-1)),i(s(f),{type:"password",placeholder:"********",disabled:""})])])]),t("section",ze,[e[22]||(e[22]=t("div",{class:"select-none"},[t("h2",{class:"text-lg font-bold text-foreground"},"Social Links"),t("p",{class:"text-sm text-muted-foreground"}," Keep these links up to date for profile discovery. ")],-1)),t("div",Oe,[t("div",Ke,[e[19]||(e[19]=t("label",{class:"select-none text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Telegram ",-1)),i(s(f),{modelValue:s(a).social_links.telegram,"onUpdate:modelValue":e[3]||(e[3]=l=>s(a).social_links.telegram=l),type:"text",placeholder:"@username"},null,8,["modelValue"])]),t("div",Je,[e[20]||(e[20]=t("label",{class:"select-none text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," VK ",-1)),i(s(f),{modelValue:s(a).social_links.vk,"onUpdate:modelValue":e[4]||(e[4]=l=>s(a).social_links.vk=l),type:"text",placeholder:"id or username"},null,8,["modelValue"])]),t("div",qe,[e[21]||(e[21]=t("label",{class:"select-none text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Instagram ",-1)),i(s(f),{modelValue:s(a).social_links.instagram,"onUpdate:modelValue":e[5]||(e[5]=l=>s(a).social_links.instagram=l),type:"text",placeholder:"@username"},null,8,["modelValue"])])])]),t("section",We,[e[26]||(e[26]=t("div",{class:"select-none"},[t("h2",{class:"text-lg font-bold text-foreground"},"Notifications & Privacy"),t("p",{class:"text-sm text-muted-foreground"}," Control how your profile appears and how we notify you. ")],-1)),t("label",Ze,[M(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>s(a).settings.notifications=l),type:"checkbox",class:"mt-0.5 h-4 w-4 accent-primary"},null,512),[[ue,s(a).settings.notifications]]),e[23]||(e[23]=t("span",null,"Enable notifications",-1))]),t("div",Ge,[e[25]||(e[25]=t("label",{class:"select-none text-xs font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," Privacy level ",-1)),M(t("select",{"onUpdate:modelValue":e[7]||(e[7]=l=>s(a).settings.privacy_level=l),class:"h-10 w-full rounded-md border border-input bg-background px-3 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...e[24]||(e[24]=[t("option",{value:"public"},"Public",-1),t("option",{value:"hidden"},"Hidden",-1),t("option",{value:"matches_only"},"Matches Only",-1)])],512),[[ce,s(a).settings.privacy_level]])]),t("div",Qe,[t("p",Xe,n(s(V)),1),i(s(F),{class:"rounded-full px-5",type:"button",disabled:!s(L),onClick:te},{default:x(()=>[y(n(s(w)?"Saving...":"Save"),1)]),_:1},8,["disabled"])])])],64))])}}}),et={class:"page-wrapper"},tt={class:"flex min-h-[calc(100dvh-9rem)] flex-col gap-4 lg:flex-row lg:items-start lg:gap-6"},st={class:"min-w-0 flex-1"},bt=$({__name:"index",setup(H){return(p,U)=>(d(),u("div",et,[t("div",tt,[i(oe,{items:s(ae),class:"shrink-0"},null,8,["items"]),t("div",st,[i(Ye)])])]))}});export{bt as default};
