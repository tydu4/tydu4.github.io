import{d as h,q as N,x as F,z as p,o as r,c as a,h as e,e as g,u as i,B as T,w as j,j as z,t as c,F as x,A as _,D as l,b as L,y as I,g as y,r as P}from"./BO0_OeXi.js";import{G as R}from"./D2UZSJW0.js";import{c as U}from"./ChLhOB94.js";import{B as q}from"./DR4eY2n-.js";const V=U("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),$={class:"space-y-6 pb-8"},E={class:"flex items-center justify-between"},G={key:0,class:"space-y-3"},H={key:1,class:"rounded-2xl border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive"},S={key:2,class:"rounded-2xl border border-border bg-card p-6 text-center"},M={key:3,class:"space-y-3"},J={class:"flex gap-3"},K={class:"flex-1"},O={class:"flex items-start justify-between gap-3"},Q={class:"text-[11px] font-semibold uppercase tracking-[0.18em] text-muted-foreground"},W=h({__name:"NotificationsList",setup(b){const o=N(),{data:f,pending:v,error:k,refresh:w}=F("me-notifications",()=>!o.isAuthInitialized||!o.token?{items:[],total:0,has_more:!1}:o.apiFetch("/api/v1/me/notifications",{baseURL:p("/api/v1/me/notifications"),query:{limit:50,offset:0}}),{server:!1,default:()=>({items:[],total:0,has_more:!1}),watch:[()=>o.token,()=>o.isAuthInitialized]}),u=y(()=>f.value?.items??[]),m=y(()=>u.value.filter(t=>!t.is_read).length),d=P(!1),A=async()=>{if(m.value){d.value=!0;try{await o.apiFetch("/api/v1/me/notifications/read-all",{method:"PATCH",baseURL:p("/api/v1/me/notifications/read-all")}),await w()}catch{}finally{d.value=!1}}},B=t=>t==="gift"?R:t==="buddy_invite"?V:q,C=t=>t==="gift"?"bg-primary/10 text-primary":t==="buddy_invite"?"bg-primary/15 text-primary":"bg-muted text-muted-foreground",D=t=>{const n=new Date(t);return Number.isNaN(n.getTime())?"":new Intl.DateTimeFormat("ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}).format(n)};return(t,n)=>(r(),a("div",$,[e("div",E,[n[0]||(n[0]=e("h1",{class:"text-xl font-bold text-foreground"},"Уведомления",-1)),g(i(T),{variant:"outline",size:"sm",disabled:i(d)||i(m)===0,onClick:A},{default:j(()=>[z(c(i(d)?"Секунду...":"Прочитать все"),1)]),_:1},8,["disabled"])]),i(v)?(r(),a("div",G,[(r(),a(x,null,_(4,s=>e("div",{key:`notif-skeleton-${s}`,class:"h-20 animate-pulse rounded-2xl bg-muted"})),64))])):i(k)?(r(),a("div",H," Не удалось загрузить уведомления. Попробуй обновить страницу. ")):i(u).length?(r(),a("div",M,[(r(!0),a(x,null,_(i(u),s=>(r(),a("article",{key:s.id,class:l(["rounded-2xl border border-border bg-card p-4 shadow-sm transition",s.is_read?"":"border-primary/20 bg-primary/10"])},[e("div",J,[e("div",{class:l(["flex h-10 w-10 items-center justify-center rounded-xl",C(s.type)])},[(r(),L(I(B(s.type)),{class:"h-5 w-5"}))],2),e("div",K,[e("div",O,[e("div",null,[e("p",{class:l(["text-sm font-semibold text-foreground",s.is_read?"":"font-bold"])},c(s.title),3),e("p",{class:l(["mt-1 text-sm",s.is_read?"text-muted-foreground":"text-foreground font-medium"])},c(s.message),3)]),e("span",Q,c(D(s.created_at)),1)])])])],2))),128))])):(r(),a("div",S,[...n[1]||(n[1]=[e("p",{class:"text-sm font-semibold text-foreground"},"Тишина... Пока новостей нет",-1),e("p",{class:"mt-2 text-xs text-muted-foreground"},"Как только что-то появится — мы сразу дадим знать.",-1)])]))]))}}),X={class:"page-wrapper"},se=h({__name:"index",setup(b){return(o,f)=>(r(),a("div",X,[g(W)]))}});export{se as default};
