import{I as A,r as u,J as v,K as d}from"./DXztqjCQ.js";const m=s=>({...s,amount:Number(s.amount||0)}),R=A("billing",()=>{const s=u(0),o=u([]),p=u(!1),f=u(!1),c=u(!1),l=u(""),h=e=>{e&&(typeof e.balance=="number"&&(s.value=e.balance),Array.isArray(e.transactions)&&(o.value=e.transactions.map(m)))},b=e=>{if(!e)return;const t=m(e),n=[...o.value],a=n.findIndex(i=>String(i.id)===String(t.id));a>=0?n[a]={...n[a],...t}:n.unshift(t),o.value=n},w=async()=>{const e=v();if(!p.value){p.value=!0,l.value="";try{const t=await e.apiFetch("/api/v1/me/wallet",{baseURL:d("/api/v1/me/wallet")});h(t),c.value=!0}catch{l.value="Failed to load wallet."}finally{p.value=!1}}},y=async(e=50,t=0)=>{const a=await v().apiFetch("/api/v1/me/wallet/history",{method:"POST",baseURL:d("/api/v1/me/wallet/history"),body:{limit:e,offset:t}}),i=Array.isArray(a?.items)?a.items.map(m):[];return o.value=i,c.value=!0,a};return{balance:s,transactions:o,loading:p,topUpPending:f,loaded:c,error:l,fetchWallet:w,fetchHistory:y,topUp:async(e,t={})=>{if(!e||e<=0)return null;const n=v();f.value=!0,l.value="";try{const a=t.provider||"sbp",i={amount:e,provider_data:{provider:a}},r=await n.apiFetch("/api/v1/me/wallet/topup",{method:"POST",baseURL:d("/api/v1/me/wallet/topup"),body:i});return typeof r?.balance=="number"&&(s.value=r.balance),b(r?.transaction||null),c.value=!0,r}catch(a){throw l.value="Failed to top up wallet.",a}finally{f.value=!1}},getTopUpStatus:async(e,t)=>{const n=await y(50,0);return(Array.isArray(n?.items)?n.items:[]).find(r=>{const S=e&&String(r.id)===String(e),g=t&&r.reference_id&&String(r.reference_id)===String(t);return!!(S||g)})?.status?.toLowerCase?.()||null},clear:()=>{s.value=0,o.value=[],c.value=!1,l.value=""}}});export{R as u};
