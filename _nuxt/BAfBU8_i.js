import{d as A,G as se,a3 as re,o as i,c as l,h as e,D as O,u as t,O as ae,W as T,f as _,e as c,Y as E,w as p,t as f,r as C,g as R,q as ne,x as ie,z as q,j as y,B as h,Z as le,R as de,H as ue,F as ce,A as me}from"./BO0_OeXi.js";import{u as pe}from"./Bsr6Qi3e.js";import fe from"./DPasnuvX.js";import ve from"./C94ZD2ww.js";import{u as ge,S as be}from"./B4EFBzzi.js";import"./ChLhOB94.js";import"./kDTr-kfK.js";import"./COC0__mb.js";import"./BaFub9o4.js";import"./DLAxxCvb.js";const xe={class:"relative h-full w-full min-h-0"},ke={key:0,class:"relative z-10 flex h-full items-center justify-center rounded-3xl border border-border/60 bg-card/70 backdrop-blur-sm"},ye={key:1,class:"relative z-10 flex h-full items-center justify-center rounded-3xl border border-border/60 bg-card/60"},we={key:2,class:"relative z-10 flex h-full min-h-0 flex-col items-center"},he={class:"relative flex min-h-0 flex-1 w-full items-center justify-center"},_e={class:"relative w-full max-w-[90vw] sm:max-w-[26rem] max-h-[85vh] [aspect-ratio:2/3]"},Ce={class:"absolute left-6 top-6"},ze={class:"absolute right-6 top-6"},Se={key:0,class:"absolute left-1/2 top-10 -translate-x-1/2 rounded-xl border border-emerald-400/30 bg-emerald-500/20 px-5 py-2.5 backdrop-blur-md"},Me={class:"absolute bottom-0 left-0 right-0 space-y-4 p-6 text-white"},$e={class:"flex items-center gap-2 text-xs"},De={class:"flex items-center gap-1.5 rounded-lg bg-white/15 px-2.5 py-1 backdrop-blur-sm"},Be={class:"font-medium text-white/90"},Le={class:"text-3xl font-bold leading-tight tracking-tight"},Pe={class:"flex items-center gap-2 text-sm text-white/80"},je={class:"font-medium"},Ie={class:"w-full max-w-[90vw] sm:max-w-[26rem] px-2 pt-3",style:{"padding-bottom":"calc(env(safe-area-inset-bottom) + 0.35rem)"}},Te=A({__name:"SwipeDeck",props:{items:{},loading:{type:Boolean,default:!1}},emits:["swipe","info","rewind"],setup(B,{emit:b}){const L=B,M=b,$=C(!1),x=C(null),v=C("");let r=null;const z=a=>{v.value=a==="like"?"bg-green-500/10":a==="dislike"?"bg-red-500/10":"bg-blue-500/10",r&&clearTimeout(r),r=setTimeout(()=>{v.value="",r=null},300)},P=()=>{ve({particleCount:100,spread:70,origin:{y:.6},colors:["#22c55e","#3b82f6","#eab308"]})};se(()=>{r&&clearTimeout(r)});const U=()=>{$.value=!0,setTimeout(()=>{$.value=!1},600)},{activeItem:n,nextItem:D,cardStyle:V,nextCardStyle:j,indicators:I,handlers:m,actions:w,isAnimating:S,isDragging:F,didDrag:d,offsetX:o,offsetY:g,cardMotionClass:k}=ge(re(L,"items"),{enableSwipeUp:!1,onSwipe:({direction:a,item:s,meta:u})=>{const N=u?.type||(a==="left"?"dislike":"like"),oe=u?.feedback||(N==="bookmark"?"super":a==="left"?"dislike":"like"),H=a==="left"?"left":"right";z(oe),H==="right"&&U(),M("swipe",{direction:H,type:N,item:s})}}),Y=()=>{w.swipeLeft({type:"dislike",feedback:"dislike"})},G=()=>{w.swipeRight({type:"bookmark",feedback:"super"}),P()},W=()=>{w.swipeRight({type:"like",feedback:"like"})},X=()=>{const a=w.rewind();a&&M("rewind",a.item)},Z=async()=>{if(!n.value||S.value)return;const a=`/e/${n.value.slug}`,s=new URL(a,window.location.origin).toString(),u={title:n.value.title,text:n.value.description||void 0,url:s};try{if(typeof navigator.share=="function"){await navigator.share(u);return}navigator.clipboard&&await navigator.clipboard.writeText(s)}catch{}},J=R(()=>S.value||!n.value),K=()=>{if(!(!n.value||S.value)){if(d.value){d.value=!1;return}F.value||Math.abs(o.value)>10||Math.abs(g.value)>10||M("info",n.value)}},Q=R(()=>V.value),ee=a=>a?.main_image?{backgroundImage:`url(${a.main_image})`}:{backgroundImage:"linear-gradient(160deg, rgba(139,92,246,0.6), rgba(30,27,75,0.9))"},te=a=>a?new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"long",hour:"2-digit",minute:"2-digit"}).format(new Date(a)):"Дата уточняется";return(a,s)=>(i(),l("div",xe,[e("div",{class:O(["pointer-events-none fixed inset-0 z-0 transition-colors duration-300",t(v)])},null,2),B.loading?(i(),l("div",ke,[...s[5]||(s[5]=[e("div",{class:"space-y-4 text-center"},[e("div",{class:"mx-auto h-10 w-10 animate-spin rounded-full border-2 border-primary/20 border-t-primary"}),e("p",{class:"text-sm font-medium text-muted-foreground"},"Загружаем события...")],-1)])])):t(n)?(i(),l("div",we,[e("div",he,[e("div",_e,[t(D)?(i(),l("div",{key:0,class:"absolute inset-0 translate-y-4 scale-[0.96] rounded-[2.5rem] border border-border/50 bg-card/70 backdrop-blur-sm",style:T(t(j))},null,4)):_("",!0),e("div",{ref_key:"cardRef",ref:x,class:O(["absolute inset-0 touch-none overflow-hidden rounded-[2.5rem] border border-border/40 bg-cover bg-center shadow-2xl",[t(k),t(S)?"pointer-events-none":""]]),style:T([ee(t(n)),t(Q)]),onPointerdown:s[0]||(s[0]=(...u)=>t(m).onPointerDown&&t(m).onPointerDown(...u)),onPointermove:s[1]||(s[1]=(...u)=>t(m).onPointerMove&&t(m).onPointerMove(...u)),onPointerup:s[2]||(s[2]=(...u)=>t(m).onPointerUp&&t(m).onPointerUp(...u)),onPointercancel:s[3]||(s[3]=(...u)=>t(m).onPointerUp&&t(m).onPointerUp(...u)),onPointerleave:s[4]||(s[4]=(...u)=>t(m).onPointerLeave&&t(m).onPointerLeave(...u)),onClick:K},[s[11]||(s[11]=e("div",{class:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"},null,-1)),e("div",Ce,[e("div",{class:"flex items-center gap-2 rounded-xl border-2 border-emerald-400 bg-emerald-500/20 px-4 py-2 backdrop-blur-sm",style:T({opacity:t(I).likeOpacity})},[...s[6]||(s[6]=[e("svg",{class:"h-5 w-5 text-emerald-300",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z","clip-rule":"evenodd"})],-1),e("span",{class:"text-sm font-bold uppercase tracking-wider text-emerald-200"},"Нравится",-1)])],4)]),e("div",ze,[e("div",{class:"flex items-center gap-2 rounded-xl border-2 border-rose-400 bg-rose-500/20 px-4 py-2 backdrop-blur-sm",style:T({opacity:t(I).nopeOpacity})},[...s[7]||(s[7]=[e("svg",{class:"h-5 w-5 text-rose-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),e("span",{class:"text-sm font-bold uppercase tracking-wider text-rose-200"},"Пропуск",-1)])],4)]),c(E,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":"-translate-y-2 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-200 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"-translate-y-2 opacity-0"},{default:p(()=>[t($)?(i(),l("div",Se,[...s[8]||(s[8]=[e("div",{class:"flex items-center gap-2"},[e("svg",{class:"h-5 w-5 text-emerald-300",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})]),e("span",{class:"text-sm font-semibold text-emerald-200"},"Добавлено в избранное")],-1)])])):_("",!0)]),_:1}),e("div",Me,[e("div",$e,[e("div",De,[s[9]||(s[9]=e("svg",{class:"h-3.5 w-3.5 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),e("span",Be,f(te(t(n).start_time)),1)])]),e("h2",Le,f(t(n).title),1),e("div",Pe,[s[10]||(s[10]=e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),e("span",je,f(t(n).venue_name||t(n).city),1)])])],38)])]),e("div",Ie,[c(be,{type:"event",disabled:t(J),onRewind:X,onDislike:Y,onSuper:G,onLike:W,onAction:Z},null,8,["disabled"])])])):(i(),l("div",ye,[ae(a.$slots,"empty")]))]))}}),Re=Object.assign(Te,{__name:"DiscoverySwipeDeck"}),Ue={class:"relative h-full overflow-hidden bg-background text-foreground"},Ve={class:"relative mx-auto flex h-full w-full max-w-[27rem] flex-col pt-4"},Fe={class:"rounded-2xl border border-border/60 bg-card p-8 shadow-soft backdrop-blur-sm"},Oe={class:"space-y-5 text-center"},Ae={class:"flex flex-col gap-3 pt-2"},Ne={class:"w-full rounded-3xl border border-border bg-card p-6 text-foreground shadow-2xl"},He={class:"flex items-start justify-between gap-4"},qe={key:0,class:"space-y-6"},Ee={class:"flex items-start justify-between gap-4 pb-4 border-b border-border/60"},Ye={class:"flex-1 space-y-2"},Ge={class:"text-2xl font-bold leading-tight"},We={class:"flex items-center gap-2 text-sm text-muted-foreground"},Xe={class:"space-y-4"},Ze={class:"space-y-3"},Je={class:"text-base leading-relaxed text-muted-foreground"},Ke={key:0,class:"flex items-center gap-2 text-sm text-muted-foreground"},Qe={key:0,class:"flex flex-wrap gap-2"},et={class:"flex items-center gap-3 pt-2"},tt={key:0,class:"fixed bottom-8 left-1/2 z-50 -translate-x-1/2 rounded-xl border border-border/60 bg-card px-5 py-3 text-sm font-medium text-foreground shadow-2xl backdrop-blur-md"},ot=A({__name:"TrendsMainBlock",setup(B){const b=ne(),{data:L,pending:M,refresh:$}=ie("discovery-feed",()=>b.isAuthInitialized?b.apiFetch("/api/v1/discovery/feed",{baseURL:q("/api/v1/discovery/feed"),query:{limit:30}}):[],{server:!1,default:()=>[],watch:[()=>b.token,()=>b.isAuthInitialized]}),x=C([]),v=C(!1),r=C(null),z=C(""),P=pe("discovery_onboarding_seen",!1),U=R(()=>!P.value),n=()=>{P.value=!0},D=R(()=>r.value?x.value.includes(r.value.id):!1),V=d=>{z.value=d,setTimeout(()=>{z.value=""},2200)},j=async(d,o)=>{const g={event_id:d.id,type:o,weight:1,device_type:"mobile"};try{await b.apiFetch("/api/v1/me/interactions",{method:"POST",baseURL:q("/api/v1/me/interactions"),body:g})}catch{}},I=async({direction:d,type:o,item:g})=>{o==="like"&&d==="right"&&!x.value.includes(g.id)&&(x.value=[...x.value,g.id]),await j(g,o)},m=d=>{r.value=d,v.value=!0},w=()=>{v.value=!1},S=async()=>{!r.value||D.value||(x.value=[...x.value,r.value.id],await j(r.value,"like"))},F=d=>d?new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"long",hour:"2-digit",minute:"2-digit"}).format(new Date(d)):"Дата уточняется";return(d,o)=>{const g=le;return i(),l("div",Ue,[o[14]||(o[14]=e("div",{class:"pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(99,102,241,0.16),transparent_55%)] dark:bg-[radial-gradient(circle_at_top,_rgba(99,102,241,0.28),transparent_55%)]"},null,-1)),e("div",Ve,[c(Re,{class:"flex-1 min-h-0 h-full",items:t(L)||[],loading:t(M),onSwipe:I,onInfo:m},{empty:p(()=>[e("div",Fe,[e("div",Oe,[o[4]||(o[4]=e("div",{class:"mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-primary/10"},[e("svg",{class:"h-8 w-8 text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)),o[5]||(o[5]=e("div",{class:"space-y-2"},[e("h3",{class:"text-xl font-semibold"},"Все события просмотрены"),e("p",{class:"text-sm leading-relaxed text-muted-foreground"},[y(" Вы посмотрели все доступные рекомендации."),e("br"),y(" Попробуйте изменить фильтры или вернитесь позже. ")])],-1)),e("div",Ae,[c(t(h),{variant:"default",size:"lg",class:"w-full bg-gradient-to-r from-primary to-primary/80 text-primary-foreground hover:from-primary/90 hover:to-primary font-medium",onClick:t($)},{default:p(()=>[...o[2]||(o[2]=[y(" Изменить фильтры ",-1)])]),_:1},8,["onClick"]),c(t(h),{variant:"outline",size:"lg",class:"w-full border-border/70 bg-card/60 font-medium hover:bg-card",onClick:o[0]||(o[0]=k=>V("Карта скоро будет доступна"))},{default:p(()=>[...o[3]||(o[3]=[y(" Открыть карту ",-1)])]),_:1})])])])]),_:1},8,["items","loading"])]),c(g,null,{default:p(()=>[t(U)?(i(),l("div",{key:0,class:"fixed inset-0 z-40 flex items-end bg-black/60 px-4 pb-6",onClick:de(n,["self"])},[e("div",Ne,[e("div",He,[o[7]||(o[7]=e("div",{class:"space-y-1"},[e("h3",{class:"text-lg font-semibold"},"Как работают рекомендации"),e("p",{class:"text-sm text-muted-foreground"}," Алгоритм учится по вашим свайпам: вправо — “нравится”, влево — “пропустить”. Чем больше действий, тем точнее лента. ")],-1)),c(t(h),{variant:"ghost",size:"sm",class:"-mr-2 -mt-2",onClick:n},{default:p(()=>[...o[6]||(o[6]=[y("Закрыть",-1)])]),_:1})]),c(t(h),{class:"mt-4 w-full",size:"lg",onClick:n},{default:p(()=>[...o[8]||(o[8]=[y("Понятно",-1)])]),_:1})])])):_("",!0)]),_:1}),c(t(fe),{modelValue:t(v),"onUpdate:modelValue":o[1]||(o[1]=k=>ue(v)?v.value=k:null),class:"max-h-[90vh] overflow-y-auto border-border bg-card text-foreground backdrop-blur-xl shadow-2xl"},{default:p(()=>[t(r)?(i(),l("div",qe,[e("div",Ee,[e("div",Ye,[o[10]||(o[10]=e("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-primary/80"}," Детали события ",-1)),e("h3",Ge,f(t(r).title),1),e("div",We,[o[9]||(o[9]=e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),e("span",null,f(F(t(r).start_time)),1)])]),c(t(h),{variant:"ghost",size:"sm",class:"text-muted-foreground hover:text-foreground -mr-2",onClick:w},{default:p(()=>[...o[11]||(o[11]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),_:1})]),e("div",Xe,[e("div",Ze,[e("p",Je,f(t(r).description||"Описание события скоро появится."),1),t(r).venue_name||t(r).city?(i(),l("div",Ke,[o[12]||(o[12]=e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),e("span",null,f(t(r).venue_name||t(r).city),1)])):_("",!0)]),t(r).tags?.length?(i(),l("div",Qe,[(i(!0),l(ce,null,me(t(r).tags,k=>(i(),l("span",{key:k,class:"rounded-lg bg-muted/60 px-3 py-1.5 text-xs font-medium text-muted-foreground backdrop-blur-sm"},f(k),1))),128))])):_("",!0)]),e("div",et,[c(t(h),{class:O(["flex-1 font-medium",t(D)?"bg-muted text-foreground hover:bg-muted/80":"bg-gradient-to-r from-primary to-primary/80 text-primary-foreground hover:from-primary/90 hover:to-primary"]),size:"lg",onClick:S},{default:p(()=>[y(f(t(D)?"Вы идёте":"Я иду"),1)]),_:1},8,["class"]),c(t(h),{variant:"outline",size:"lg",class:"flex-1 border-border/70 bg-card/60 font-medium hover:bg-card",onClick:w},{default:p(()=>[...o[13]||(o[13]=[y(" Назад ",-1)])]),_:1})])])):_("",!0)]),_:1},8,["modelValue"]),c(E,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":"translate-y-2 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-200 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-2 opacity-0"},{default:p(()=>[t(z)?(i(),l("div",tt,f(t(z)),1)):_("",!0)]),_:1})])}}}),st={class:"page-wrapper h-full w-full overflow-hidden"},ft=A({__name:"index",setup(B){return(b,L)=>(i(),l("div",st,[c(ot,{class:"h-full"})]))}});export{ft as default};
