import{d as q,J as G,n as W,o as c,c as v,a,b as f,w as g,u as n,t as s,f as h,k,Q as R,e as X,E as Z,j as p,a3 as ee,K as te,_ as ne}from"./vvrMSRdc.js";import{F as M}from"./Ba2NRgtU.js";import{c as oe}from"./Idgo-c1n.js";import{M as ae}from"./8R6Hccz8.js";import{U as re}from"./CMEcg2KB.js";import{T as ie}from"./nq_z6SHw.js";import{C as se}from"./Brevm6N2.js";import{S as L}from"./D2JooQc7.js";const T=oe("building-2",[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]]),le={class:"rounded-2xl border border-border bg-card p-4 shadow-sm"},ce={class:"flex items-start gap-3"},de={class:"flex h-11 w-11 items-center justify-center overflow-hidden rounded-full border border-border bg-muted text-sm font-semibold text-foreground"},ue=["src","alt"],ve={key:1},me={class:"min-w-0 flex-1"},_e={class:"text-sm leading-6 text-foreground"},fe={class:"ml-1 text-muted-foreground"},pe={class:"mt-1 flex items-center gap-2 text-xs text-muted-foreground"},ge={class:"mt-4"},be={key:0,class:"rounded-xl border border-border bg-background p-3"},ye={class:"flex items-center justify-between gap-3"},he={class:"flex items-center"},xe={class:"flex h-10 w-10 items-center justify-center overflow-hidden rounded-full border border-border bg-muted text-xs font-semibold text-foreground"},we=["src","alt"],ke={key:1},Ce={class:"-ml-2 flex h-10 w-10 items-center justify-center overflow-hidden rounded-full border border-border bg-muted text-xs font-semibold text-foreground"},Ne=["src","alt"],je={key:1},Ae={class:"inline-flex items-center gap-1 rounded-full border border-orange-500/30 bg-orange-500/10 px-2.5 py-1 text-[11px] font-semibold text-orange-600 dark:text-orange-300"},Re={class:"mt-2 text-sm text-foreground"},Me={class:"font-semibold"},Le={key:0,class:"mt-1 text-xs text-muted-foreground"},Te={key:1,class:"flex items-center justify-between gap-3 rounded-xl border border-border bg-background p-3"},Pe={class:"flex h-11 w-11 items-center justify-center overflow-hidden rounded-xl border border-border bg-card"},$e=["src","alt"],Fe={class:"min-w-0"},Ie={class:"line-clamp-1 text-sm font-semibold text-foreground"},Ve={class:"mt-0.5 text-xs text-muted-foreground"},Be={key:2,class:"relative overflow-hidden rounded-xl border border-primary/30 bg-primary/10 p-4"},De={class:"relative flex items-center gap-3"},Se={class:"flex h-14 w-14 items-center justify-center rounded-2xl border border-primary/30 bg-background text-sm font-black tracking-wide text-primary"},ze={class:"min-w-0"},Ue={class:"line-clamp-1 text-sm font-semibold text-foreground"},He={class:"mt-1 text-xs text-muted-foreground"},Ee={key:3,class:"overflow-hidden rounded-xl border border-border bg-background"},Je=["src","alt"],Oe={key:1,class:"h-24 w-full bg-[linear-gradient(130deg,rgba(14,165,233,0.3),rgba(99,102,241,0.24),rgba(236,72,153,0.28))]"},Ke={class:"flex items-center justify-between gap-3 p-3"},Qe={class:"min-w-0"},Ye={class:"mt-1 text-xs text-muted-foreground"},qe={key:4,class:"rounded-xl border border-border bg-background p-3"},Ge={class:"mt-1 text-xs text-muted-foreground"},We={class:"mt-4 flex flex-wrap items-center gap-2 border-t border-border pt-3"},Xe=["disabled"],Ze=q({__name:"FeedActivityCard",props:{activity:{}},emits:["open-comments"],setup(P,{emit:$}){const x=P,F=$,I=G(),b=r=>!r||typeof r!="object"?{}:r,l=(r,e="")=>typeof r!="string"?e:r.trim()||e,C=r=>typeof r=="number"&&Number.isFinite(r)?String(Math.round(r)):l(r),y=(r,e=0)=>{const i=Number(r);return Number.isFinite(i)?i:e},V=r=>{const e=new Date(r);return Number.isNaN(e.getTime())?"Date TBA":new Intl.DateTimeFormat("en-US",{weekday:"short",month:"short",day:"numeric"}).format(e)},B=r=>{const e=new Date(r);if(Number.isNaN(e.getTime()))return"Recently";const i=Date.now()-e.getTime(),m=Math.floor(i/6e4);if(m<=0)return"Just now";if(m<60)return`${m} min ago`;const _=Math.floor(m/60);if(_<24)return`${_} hour${_===1?"":"s"} ago`;const u=Math.floor(_/24);return u===1?"Yesterday":`${u} days ago`},D=r=>typeof r.activity_type=="string",S=r=>{const e=r.toLowerCase();return e==="new_connection"||e==="friend_connect"||e==="friend_connection"||e.includes("connection")?"new_connection":e==="venue_follow"||e==="follow_venue"||e.includes("venue")&&e.includes("follow")?"venue_follow":e==="level_up"||e.includes("level")?"level_up":e==="event_join"||e.includes("event")?"event_join":"unknown"},t=p(()=>{if(!D(x.activity)){const o=x.activity,Y=o.type==="friend_connect"?"new_connection":o.type==="follow_venue"?"venue_follow":o.type==="level_up"?"level_up":o.type==="event_join"?"event_join":"unknown";return{id:o.id,variant:Y,activityTypeRaw:o.type,actorName:o.actor.name,actorAvatar:o.actor.avatar||null,actorPath:`/u/${o.actor.uuid}`,createdAt:o.createdAt,timeAgo:o.timeAgo,reactionCount:Math.max(0,Math.round(y(o.fireCount,0))),commentCount:Math.max(0,Math.round(y(o.commentCount,0))),isReacted:!1,supportsRemoteReaction:!1,connectionName:o.type==="friend_connect"?o.friend.name:"",connectionAvatar:o.type==="friend_connect"?o.friend.avatar:null,connectionPath:o.type==="friend_connect"?`/u/${o.friend.uuid}`:"/community/buddies",connectionHeadline:o.type==="friend_connect"?o.friend.headline:"",venueName:o.type==="follow_venue"?o.venue.name:"",venueCity:o.type==="follow_venue"?o.venue.city:"",venuePath:o.type==="follow_venue"?`/venue/${o.venue.slug}`:"/discovery/catalog",venueLogo:o.type==="follow_venue"?o.venue.logo:null,levelValue:o.type==="level_up"?o.badge.level:1,levelBadge:o.type==="level_up"?o.badge.icon:"LVL",levelTitle:o.type==="level_up"?o.badge.title:"Level unlocked",eventTitle:o.type==="event_join"?o.event.title:"",eventCity:o.type==="event_join"?o.event.city:"",eventDateLabel:o.type==="event_join"?o.event.dateLabel:"",eventPath:o.type==="event_join"?`/e/${o.event.slug}`:"/discovery/catalog",eventImage:o.type==="event_join"?o.event.coverImage:null}}const r=x.activity,e=b(r.metadata),i=b(e.target_user??e.friend??e.connection??e.target),m=b(e.venue),_=b(e.badge),u=b(e.event),A=l(r.activity_type,"unknown"),Q=S(A),w=Math.max(1,Math.round(y(e.new_level??e.level??_.level,1)));return{id:r.id,variant:Q,activityTypeRaw:A,actorName:l(r.actor.username,"Community member"),actorAvatar:l(r.actor.avatar_url)||null,actorPath:`/u/${r.actor.id}`,createdAt:r.created_at,timeAgo:B(r.created_at),reactionCount:Math.max(0,Math.round(y(r.reactions_count,0))),commentCount:Math.max(0,Math.round(y(r.comments_count,0))),isReacted:!!r.is_reacted,supportsRemoteReaction:!0,connectionName:l(i.username??i.full_name??i.name??e.target_username??e.friend_name??e.connection_name,"a new buddy"),connectionAvatar:l(i.avatar_url??i.avatar??e.target_avatar_url??e.friend_avatar_url)||null,connectionPath:C(i.id)?`/u/${C(i.id)}`:"/community/buddies",connectionHeadline:l(i.headline??e.target_headline??e.connection_headline),venueName:l(m.name??e.venue_name??e.target_name,"a venue"),venueCity:l(m.city??e.venue_city),venuePath:l(m.slug??e.venue_slug)?`/venue/${l(m.slug??e.venue_slug)}`:"/discovery/catalog",venueLogo:l(m.logo_url??m.logo??e.venue_logo_url)||null,levelValue:w,levelBadge:l(_.icon??e.badge_icon??e.badge_code,`L${w}`),levelTitle:l(_.title??e.badge_title,`Level ${w} unlocked`),eventTitle:l(u.title??e.event_title,"Upcoming event"),eventCity:l(u.city??e.event_city),eventDateLabel:V(l(u.starts_at??e.event_starts_at)),eventPath:l(u.slug??e.event_slug)?`/e/${l(u.slug??e.event_slug)}`:"/discovery/catalog",eventImage:l(u.cover_image??u.main_image??e.event_image)||null}}),d=ee({isReacted:!1,count:0,pending:!1});W(()=>[t.value.id,t.value.isReacted,t.value.reactionCount],([,r,e])=>{d.pending||(d.isReacted=r,d.count=e)},{immediate:!0});const N=p(()=>t.value.variant==="new_connection"?{label:"New connection",icon:re}:t.value.variant==="venue_follow"?{label:"Venue follow",icon:T}:t.value.variant==="level_up"?{label:"Level up",icon:ie}:t.value.variant==="event_join"?{label:"Event join",icon:se}:{label:"Activity",icon:L}),z=p(()=>t.value.variant==="new_connection"?"made a new connection.":t.value.variant==="venue_follow"?"started following a venue.":t.value.variant==="event_join"?"is heading to an event.":t.value.variant==="level_up"?`reached Level ${t.value.levelValue}!`:"posted an update."),U=p(()=>t.value.variant==="level_up"?"Congratulate":"Fire"),H=p(()=>t.value.variant==="level_up"?"congratulate":"fire"),E=p(()=>t.value.variant==="level_up"?L:M),j=p(()=>t.value.actorName.trim()[0]?.toUpperCase()||"?"),J=p(()=>t.value.connectionName.trim()[0]?.toUpperCase()||"?"),O=async()=>{if(d.pending)return;const r=d.isReacted,e=d.count,i=!r;if(d.isReacted=i,d.count=Math.max(0,e+(i?1:-1)),!(!t.value.supportsRemoteReaction||typeof t.value.id!="number")){d.pending=!0;try{const m=t.value.id,_={reaction_type:H.value},u=await I.apiFetch(`/api/v1/community/feed/${m}/react`,{method:"POST",baseURL:te(`/api/v1/community/feed/${m}/react`),body:_});typeof u.is_reacted=="boolean"&&(d.isReacted=u.is_reacted),typeof u.reactions_count=="number"&&Number.isFinite(u.reactions_count)&&(d.count=Math.max(0,Math.round(u.reactions_count)))}catch{d.isReacted=r,d.count=e}finally{d.pending=!1}}},K=()=>{F("open-comments",x.activity)};return(r,e)=>{const i=ne;return c(),v("article",le,[a("header",ce,[f(i,{to:n(t).actorPath,class:"shrink-0"},{default:g(()=>[a("div",de,[n(t).actorAvatar?(c(),v("img",{key:0,src:n(t).actorAvatar,alt:n(t).actorName,class:"h-full w-full object-cover",loading:"lazy"},null,8,ue)):(c(),v("span",ve,s(n(j)),1))])]),_:1},8,["to"]),a("div",me,[a("p",_e,[f(i,{to:n(t).actorPath,class:"font-semibold hover:underline"},{default:g(()=>[h(s(n(t).actorName),1)]),_:1},8,["to"]),a("span",fe,s(n(z)),1)]),a("div",pe,[(c(),k(R(n(N).icon),{class:"h-3.5 w-3.5"})),a("span",null,s(n(N).label),1),e[0]||(e[0]=a("span",{class:"text-border"},"-",-1)),a("span",null,s(n(t).timeAgo),1)])])]),a("div",ge,[n(t).variant==="new_connection"?(c(),v("div",be,[a("div",ye,[a("div",he,[a("div",xe,[n(t).actorAvatar?(c(),v("img",{key:0,src:n(t).actorAvatar,alt:n(t).actorName,class:"h-full w-full object-cover",loading:"lazy"},null,8,we)):(c(),v("span",ke,s(n(j)),1))]),a("div",Ce,[n(t).connectionAvatar?(c(),v("img",{key:0,src:n(t).connectionAvatar,alt:n(t).connectionName,class:"h-full w-full object-cover",loading:"lazy"},null,8,Ne)):(c(),v("span",je,s(n(J)),1))])]),a("p",Ae,[f(n(M),{class:"h-3 w-3"}),e[1]||(e[1]=h(" Fire ",-1))])]),a("p",Re,[a("span",Me,s(n(t).actorName),1),e[2]||(e[2]=a("span",{class:"mx-1 text-muted-foreground"},"connected with",-1)),f(i,{to:n(t).connectionPath,class:"font-semibold transition hover:text-primary"},{default:g(()=>[h(s(n(t).connectionName),1)]),_:1},8,["to"])]),n(t).connectionHeadline?(c(),v("p",Le,s(n(t).connectionHeadline),1)):X("",!0)])):n(t).variant==="venue_follow"?(c(),v("div",Te,[f(i,{to:n(t).venuePath,class:"flex min-w-0 items-center gap-3"},{default:g(()=>[a("div",Pe,[n(t).venueLogo?(c(),v("img",{key:0,src:n(t).venueLogo,alt:n(t).venueName,class:"h-full w-full object-cover",loading:"lazy"},null,8,$e)):(c(),k(n(T),{key:1,class:"h-4 w-4 text-muted-foreground"}))]),a("div",Fe,[a("p",Ie,s(n(t).venueName),1),a("p",Ve,s(n(t).venueCity||"New venue unlocked"),1)])]),_:1},8,["to"]),e[3]||(e[3]=a("button",{type:"button",class:"rounded-full border border-border bg-card px-3 py-1.5 text-xs font-semibold text-foreground transition hover:bg-muted"}," Follow ",-1))])):n(t).variant==="level_up"?(c(),v("div",Be,[a("div",De,[a("div",Se,s(n(t).levelBadge),1),a("div",ze,[a("p",Ue,s(n(t).levelTitle),1),a("p",He," Level "+s(n(t).levelValue)+" unlocked ",1)])])])):n(t).variant==="event_join"?(c(),v("div",Ee,[f(i,{to:n(t).eventPath,class:"block"},{default:g(()=>[n(t).eventImage?(c(),v("img",{key:0,src:n(t).eventImage,alt:n(t).eventTitle,class:"h-36 w-full object-cover",loading:"lazy"},null,8,Je)):(c(),v("div",Oe))]),_:1},8,["to"]),a("div",Ke,[a("div",Qe,[f(i,{to:n(t).eventPath,class:"line-clamp-1 text-sm font-semibold text-foreground transition hover:text-primary"},{default:g(()=>[h(s(n(t).eventTitle),1)]),_:1},8,["to"]),a("p",Ye,s(n(t).eventDateLabel)+" - "+s(n(t).eventCity||"City TBA"),1)]),f(i,{to:n(t).eventPath,class:"shrink-0 rounded-full border border-border bg-card px-3 py-1.5 text-xs font-semibold text-foreground transition hover:bg-muted"},{default:g(()=>[...e[4]||(e[4]=[h(" Join ",-1)])]),_:1},8,["to"])])])):(c(),v("div",qe,[e[5]||(e[5]=a("p",{class:"text-sm font-semibold text-foreground"},"Community update",-1)),a("p",Ge," Activity type: "+s(n(t).activityTypeRaw),1)]))]),a("footer",We,[a("button",{type:"button",class:Z(["inline-flex min-w-0 items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition",n(d).isReacted?"border-primary/30 bg-primary/10 text-primary":"border-border bg-card text-foreground hover:bg-muted"]),disabled:n(d).pending,onClick:O},[(c(),k(R(n(E)),{class:"h-3.5 w-3.5"})),a("span",null,s(n(U)),1),a("span",null,s(n(d).count),1)],10,Xe),a("button",{type:"button",class:"inline-flex min-w-0 items-center gap-2 rounded-full border border-border bg-card px-3 py-1.5 text-xs font-semibold text-foreground transition hover:bg-muted",onClick:K},[f(n(ae),{class:"h-3.5 w-3.5"}),e[6]||(e[6]=a("span",null,"Comment",-1)),a("span",null,s(n(t).commentCount),1)])])])}}}),lt=Object.assign(Ze,{__name:"CommunityFeedActivityCard"});export{lt as F};
