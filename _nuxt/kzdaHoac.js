import{H as te,p as se}from"./D1uJsfV4.js";import{d as P,C as oe,o as i,k as O,b as l,a0 as q,w as g,c as d,e as B,a as e,u as t,B as h,t as u,f as $,G as M,F,E as G,L as ae,Y as re,r as p,j as _,g as ne,D as le}from"./D4tOOpea.js";import{u as X}from"./CAGkR0gb.js";import ie from"./DitAOtD7.js";import{X as de}from"./B8ijCWxw.js";import{S as ue}from"./DZrQYTjy.js";import{E as ce}from"./CFAsUDjd.js";import{c as D}from"./BrE5OWI-.js";import{T as pe}from"./BDIprTuF.js";import{W as me}from"./CUtcqh3c.js";import"./DlAUqK2U.js";import"./DSD0DqAy.js";import"./CDoVUn-y.js";import"./D6B2Eigc.js";import"./DQ6Ue2G3.js";import"./D_jAd2MS.js";const fe=D("arrow-down-left",[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]]);const ve=D("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);const be=D("utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]]),ge={key:0,class:"fixed bottom-0 left-0 right-0 z-50 max-h-[85vh] overflow-y-auto rounded-t-3xl border border-border bg-card p-5 shadow-elevated"},xe={class:"flex items-center justify-between"},ye={key:0,class:"mt-6 space-y-4 text-center"},_e={class:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-primary/10 text-primary"},he={class:"text-sm text-muted-foreground"},ke={key:1,class:"mt-6 space-y-5"},we={class:"space-y-3"},Ce={class:"grid grid-cols-2 gap-2"},$e={class:"space-y-3"},Se={class:"grid grid-cols-2 gap-2"},Ue=["onClick"],Be={class:"space-y-2"},Me={class:"rounded-2xl border border-border bg-muted/40 p-4"},Ne={class:"flex items-center justify-between text-sm"},Te={class:"font-semibold text-foreground"},Le={class:"mt-2 text-xs text-muted-foreground"},Ie={key:0,class:"mt-3 rounded-xl border border-border bg-card p-3 text-xs text-muted-foreground"},Ve={key:0,class:"mt-1"},je={class:"mt-2 flex gap-2"},ze={key:1,class:"mt-2 text-xs text-destructive"},Fe=P({__name:"TopUpSheet",props:{open:{type:Boolean}},emits:["close"],setup(S,{emit:m}){const k=S,N=m,x=X(),L=[100,300,500,1e3],y=p(500),f=p(""),r=p("sbp"),s=p(!1),a=p(""),v=p(""),U=p(""),w=p(null),T=p(null),C=p(!1),b=p("idle"),Y=new Intl.NumberFormat("ru-RU"),I=_(()=>{const n=Number(f.value.replace(/\s+/g,""));return Number.isFinite(n)?Math.round(n):0}),V=_(()=>I.value>0?I.value:y.value??0),W=_(()=>`${Y.format(V.value)} ₽`),A=_(()=>V.value>0&&!x.topUpPending&&!C.value),Z=_(()=>b.value==="pending"),j=_(()=>r.value==="cryptobot"?"CryptoBot":"СБП"),J=n=>{y.value=n,f.value=""},z=()=>{N("close")},K=()=>{y.value=500,f.value="",r.value="sbp",s.value=!1,a.value="",v.value="",U.value="",w.value=null,T.value=null,b.value="idle",C.value=!1},E=()=>{U.value&&window.open(U.value,"_blank","noopener,noreferrer")},Q=async()=>{if(!T.value&&!w.value)return null;const n=await x.getTopUpStatus(T.value,w.value);return n?n.toLowerCase():null},H=async()=>{C.value=!0,v.value="Проверяем статус платежа...";try{for(let o=0;o<30;o+=1){const c=await Q();if(c==="completed"||c==="paid"){b.value="completed",s.value=!0,v.value="Платеж подтвержден.",await x.fetchWallet();return}if(c==="failed"){b.value="failed",a.value="Платеж отклонен. Попробуйте еще раз.",v.value="";return}await new Promise(R=>setTimeout(R,3e3))}b.value="pending",v.value='Платеж еще в обработке. Нажмите "Проверить статус" позже.'}catch{b.value="pending",v.value="Не удалось проверить статус. Можно повторить позже."}finally{C.value=!1}},ee=async()=>{if(A.value){a.value="",v.value="";try{const n=await x.topUp(V.value,{provider:r.value});if(!n)return;if(U.value=n.pay_url||"",w.value=n.invoice_id||null,T.value=n.transaction?.id?String(n.transaction.id):null,(n.transaction?.status?.toLowerCase?.()||"pending")==="completed"){b.value="completed",s.value=!0,v.value="Платеж подтвержден.",await x.fetchWallet();return}b.value="pending",v.value=`Инвойс создан (${j.value}).`,E(),await H()}catch{b.value="failed",a.value="Платеж не прошел. Попробуй еще раз."}}};return oe(()=>k.open,n=>{n||K()}),(n,o)=>(i(),O(re,{to:"body"},[l(q,{"enter-active-class":"transition-opacity duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:g(()=>[S.open?(i(),d("div",{key:0,class:"fixed inset-0 z-50 bg-black/50",onClick:z})):B("",!0)]),_:1}),l(q,{"enter-active-class":"transition-transform duration-300 ease-out","enter-from-class":"translate-y-full","enter-to-class":"translate-y-0","leave-active-class":"transition-transform duration-200 ease-in","leave-from-class":"translate-y-0","leave-to-class":"translate-y-full"},{default:g(()=>[S.open?(i(),d("div",ge,[e("div",xe,[o[3]||(o[3]=e("div",null,[e("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground"},"Кошелек"),e("h3",{class:"text-base font-bold text-foreground"},"Пополнение баланса")],-1)),l(t(h),{variant:"ghost",size:"icon",class:"rounded-full",onClick:z},{default:g(()=>[l(t(de),{class:"h-4 w-4"})]),_:1})]),t(s)?(i(),d("div",ye,[e("div",_e,[l(t(ue),{class:"h-6 w-6"})]),o[5]||(o[5]=e("h4",{class:"text-lg font-bold text-foreground"},"Баланс пополнен",-1)),e("p",he,u(t(W))+" уже доступны в кошельке. ",1),l(t(h),{class:"w-full",onClick:z},{default:g(()=>[...o[4]||(o[4]=[$("Готово",-1)])]),_:1})])):(i(),d("div",ke,[e("div",we,[o[6]||(o[6]=e("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground"},"Способ оплаты",-1)),e("div",Ce,[e("button",{type:"button",class:M(["rounded-2xl border border-border px-4 py-3 text-sm font-semibold transition hover:border-primary/40",t(r)==="sbp"?"border-primary/50 bg-primary/10 text-foreground":"bg-card text-muted-foreground"]),onClick:o[0]||(o[0]=c=>r.value="sbp")}," СБП ",2),e("button",{type:"button",class:M(["rounded-2xl border border-border px-4 py-3 text-sm font-semibold transition hover:border-primary/40",t(r)==="cryptobot"?"border-primary/50 bg-primary/10 text-foreground":"bg-card text-muted-foreground"]),onClick:o[1]||(o[1]=c=>r.value="cryptobot")}," CryptoBot ",2)])]),e("div",$e,[o[7]||(o[7]=e("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground"}," Выберите сумму ",-1)),e("div",Se,[(i(),d(F,null,G(L,c=>e("button",{key:c,type:"button",class:M(["rounded-2xl border border-border px-4 py-3 text-sm font-semibold text-foreground transition hover:border-primary/40",t(y)===c&&t(I)===0?"border-primary/50 bg-primary/10":"bg-card"]),onClick:R=>J(c)},u(c)+" ₽ ",11,Ue)),64))])]),e("div",Be,[o[8]||(o[8]=e("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground"},"Своя сумма",-1)),l(t(ie),{modelValue:t(f),"onUpdate:modelValue":o[2]||(o[2]=c=>ae(f)?f.value=c:null),inputmode:"numeric",placeholder:"Например, 750",class:"text-base"},null,8,["modelValue"])]),e("div",Me,[e("div",Ne,[o[9]||(o[9]=e("span",{class:"text-muted-foreground"},"К оплате",-1)),e("span",Te,u(t(W)),1)]),e("p",Le," Провайдер: "+u(t(j)),1),t(b)==="pending"?(i(),d("div",Ie,[e("p",null,u(t(v)),1),t(w)?(i(),d("p",Ve,"Invoice: "+u(t(w)),1)):B("",!0),e("div",je,[l(t(h),{variant:"outline",size:"sm",class:"gap-1",disabled:!t(U),onClick:E},{default:g(()=>[l(t(ce),{class:"h-3.5 w-3.5"}),o[10]||(o[10]=$(" Открыть инвойс ",-1))]),_:1},8,["disabled"]),l(t(h),{variant:"outline",size:"sm",disabled:t(C),onClick:H},{default:g(()=>[$(u(t(C)?"Проверяем...":"Проверить статус"),1)]),_:1},8,["disabled"])])])):B("",!0),t(a)?(i(),d("p",ze,u(t(a)),1)):B("",!0),l(t(h),{class:"mt-4 w-full gap-2",disabled:!t(A)||t(Z),onClick:ee},{default:g(()=>[l(t(ve),{class:"h-4 w-4"}),$(" "+u(t(x).topUpPending?"Создаем инвойс...":`Оплатить через ${t(j)}`),1)]),_:1},8,["disabled"])])]))])):B("",!0)]),_:1})]))}}),Pe={class:"space-y-8 pb-12"},De={class:"relative overflow-hidden rounded-3xl border border-primary/25 bg-gradient-to-br from-primary/30 via-card to-primary/5 p-6 shadow-elevated"},We={class:"relative flex flex-col gap-6"},Ae={class:"mt-3 text-3xl font-bold text-foreground"},Ee={class:"flex flex-wrap items-center gap-3"},He={class:"space-y-4"},Re={class:"flex items-center justify-between"},qe={key:0,class:"grid gap-3"},Oe={key:1,class:"rounded-2xl border border-border bg-card p-6 text-center text-sm text-muted-foreground shadow-soft"},Ge={key:2,class:"space-y-3"},Xe={class:"flex items-center gap-3"},Ye={class:"text-sm font-semibold text-foreground"},Ze={class:"text-xs text-muted-foreground"},Je={class:"text-right"},Ke={class:"text-xs text-muted-foreground"},Qe=P({__name:"WalletMainBlock",setup(S){const m=X(),k=p(!1),N=new Intl.NumberFormat("ru-RU"),x=_(()=>`${N.format(m.balance)} ₽`),L=r=>{const s=r>=0?"+":"-",a=Math.abs(r);return`${s}${N.format(a)} ₽`},y=r=>{if(!r)return"Сегодня";const s=new Date(r);return Number.isNaN(s.getTime())?"Сегодня":new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"}).format(s).replace(".","")},f=r=>{const s=(r.type||"").toLowerCase();return s.includes("topup")||s.includes("deposit")||r.amount>0?{label:"Пополнение",icon:fe,iconClass:"bg-emerald-100 text-emerald-700"}:s.includes("ticket")||s.includes("event")?{label:"Покупка билета",icon:pe,iconClass:"bg-primary/15 text-primary"}:s.includes("bar")||s.includes("queue")||s.includes("food")?{label:"Бар / Очередь",icon:be,iconClass:"bg-orange-100 text-orange-600"}:{label:r.title||"Операция",icon:me,iconClass:"bg-muted text-foreground"}};return ne(()=>{m.loaded||m.fetchWallet()}),(r,s)=>(i(),d(F,null,[e("div",Pe,[e("section",De,[s[6]||(s[6]=e("div",{class:"absolute -right-20 -top-20 h-48 w-48 rounded-full bg-primary/20 blur-3xl"},null,-1)),e("div",We,[e("div",null,[s[2]||(s[2]=e("p",{class:"text-xs font-semibold uppercase tracking-[0.25em] text-primary/80"},"Кошелек",-1)),e("h1",Ae,u(t(x)),1),s[3]||(s[3]=e("p",{class:"text-sm text-muted-foreground"},"Баланс SmartEvents",-1))]),e("div",Ee,[l(t(h),{class:"rounded-full bg-primary px-5 text-primary-foreground shadow-glow hover:bg-primary/90",onClick:s[0]||(s[0]=a=>k.value=!0)},{default:g(()=>[...s[4]||(s[4]=[$(" Пополнить ",-1)])]),_:1}),s[5]||(s[5]=e("span",{class:"text-xs text-muted-foreground"}," Быстрое пополнение через СБП и CryptoBot ",-1))])])]),e("section",He,[e("div",Re,[s[8]||(s[8]=e("h2",{class:"text-lg font-bold text-foreground"},"История транзакций",-1)),l(t(h),{variant:"outline",size:"sm",class:"rounded-full",onClick:t(m).fetchWallet},{default:g(()=>[...s[7]||(s[7]=[$(" Обновить ",-1)])]),_:1},8,["onClick"])]),t(m).loading?(i(),d("div",qe,[...s[9]||(s[9]=[e("div",{class:"h-16 animate-pulse rounded-2xl bg-muted"},null,-1),e("div",{class:"h-16 animate-pulse rounded-2xl bg-muted"},null,-1),e("div",{class:"h-16 animate-pulse rounded-2xl bg-muted"},null,-1)])])):t(m).transactions.length?(i(),d("div",Ge,[(i(!0),d(F,null,G(t(m).transactions,a=>(i(),d("div",{key:a.id||`${a.type}-${a.created_at}`,class:"flex items-center justify-between gap-4 rounded-2xl border border-border bg-card p-4 shadow-soft"},[e("div",Xe,[e("div",{class:M(["flex h-11 w-11 items-center justify-center rounded-2xl",f(a).iconClass])},[(i(),O(le(f(a).icon),{class:"h-5 w-5"}))],2),e("div",null,[e("p",Ye,u(f(a).label),1),e("p",Ze,u(a.description||y(a.created_at)),1)])]),e("div",Je,[e("p",{class:M(["text-sm font-semibold",a.amount>=0?"text-emerald-600":"text-foreground"])},u(L(a.amount)),3),e("p",Ke,u(y(a.created_at)),1)])]))),128))])):(i(),d("div",Oe," Транзакций пока нет. Самое время пополнить кошелек! "))])]),l(Fe,{open:t(k),onClose:s[1]||(s[1]=a=>k.value=!1)},null,8,["open"])],64))}}),et={class:"page-wrapper"},tt={class:"flex min-h-[calc(100dvh-9rem)] flex-col gap-4 lg:flex-row lg:items-start lg:gap-6"},st={class:"min-w-0 flex-1"},yt=P({__name:"index",setup(S){return(m,k)=>(i(),d("div",et,[e("div",tt,[l(te,{items:t(se),class:"shrink-0"},null,8,["items"]),e("div",st,[l(Qe)])])]))}});export{yt as default};
