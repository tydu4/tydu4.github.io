const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BCnLW41T.js","./CqkleIqs.js"])))=>i.map(i=>d[i]);
import{d as V,c as s,h as a,e as m,u as n,w as P,F as L,A as j,j as R,o as r,B as D,b as Z,t as y,f as _,D as Be,v as ne,q as Ee,x as ee,i as G,l as Ne,G as Ve,r as C,N as te,z as H,g as u,a2 as Me,s as Ae}from"./BO0_OeXi.js";import{E as ze}from"./ChWJ63gv.js";import{S as Ge}from"./BIVUFcDL.js";import{M as Pe}from"./oEsFR4E0.js";import{c as je}from"./ChLhOB94.js";import{N as De}from"./B3Mz9nlm.js";import{L as oe}from"./BWQX0J8z.js";import{B as Ue}from"./DF3yHlRt.js";import{C as Fe}from"./C80jQyI2.js";import{C as Te}from"./CB3rgRP1.js";import{u as Oe}from"./D92jAQRS.js";import{e as qe}from"./Cv8_oF2L.js";import{_ as He}from"./DlAUqK2U.js";const Ze=je("clock-3",[["path",{d:"M12 6v6h4",key:"135r8i"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Ye={class:"space-y-4 rounded-3xl border border-border bg-card p-5 shadow-soft sm:p-6"},Je={class:"flex items-center justify-between gap-2"},Ke={key:0,class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},Qe={key:1,class:"rounded-2xl border border-destructive/30 bg-destructive/10 p-4 text-sm text-destructive"},We={key:2,class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},Xe={key:3,class:"rounded-2xl border border-border bg-muted/20 p-4 text-sm text-muted-foreground"},et=V({__name:"VenueEventsList",props:{pending:{type:Boolean},hasError:{type:Boolean},events:{}},emits:["retry"],setup(o,{emit:h}){const f=h;return(g,l)=>(r(),s("section",Ye,[a("div",Je,[l[3]||(l[3]=a("h2",{class:"text-xl font-semibold text-foreground"},"Афиша площадки",-1)),m(n(D),{variant:"outline",size:"sm",onClick:l[0]||(l[0]=c=>f("retry"))},{default:P(()=>[...l[2]||(l[2]=[R("Обновить",-1)])]),_:1})]),o.pending?(r(),s("div",Ke,[(r(),s(L,null,j(3,c=>m(Ge,{key:`venue-events-skeleton-${c}`})),64))])):o.hasError?(r(),s("div",Qe,[l[4]||(l[4]=R(" Не удалось загрузить афишу площадки. ",-1)),a("button",{type:"button",class:"ml-2 underline",onClick:l[1]||(l[1]=c=>f("retry"))},"Обновить")])):o.events.length?(r(),s("div",We,[(r(!0),s(L,null,j(o.events,c=>(r(),Z(ze,{key:c.uuid,event:c,"show-tags":!0,"show-going-badge":!1},null,8,["event"]))),128))])):(r(),s("div",Xe," На этой площадке пока нет запланированных событий. "))]))}}),tt={class:"space-y-4 rounded-3xl border border-border bg-card p-5 shadow-soft sm:p-6"},nt={class:"flex flex-wrap items-start justify-between gap-4"},ot={class:"space-y-3"},rt={class:"text-2xl font-bold text-foreground sm:text-3xl"},st={class:"flex items-center gap-2 text-sm text-muted-foreground"},lt={key:0,class:"flex items-center gap-2 text-sm text-muted-foreground"},at={class:"flex flex-wrap items-center gap-2 text-xs font-medium text-muted-foreground"},it={class:"rounded-full bg-muted px-3 py-1"},ut={class:"rounded-full bg-muted px-3 py-1"},dt={class:"flex flex-wrap gap-2"},ct={key:0,class:"text-sm leading-relaxed text-muted-foreground"},vt=V({__name:"VenueHeader",props:{venueName:{},venueAddress:{},workingHours:{},followersLabel:{},eventsLabel:{},followPending:{type:Boolean},followState:{type:Boolean},followButtonLabel:{},venueDescription:{}},emits:["show-map","follow"],setup(o,{emit:h}){const f=h;return(g,l)=>(r(),s("section",tt,[a("div",nt,[a("div",ot,[a("h1",rt,y(o.venueName),1),a("p",st,[m(n(Pe),{class:"h-4 w-4 text-primary"}),a("span",null,y(o.venueAddress),1)]),o.workingHours?(r(),s("p",lt,[m(n(Ze),{class:"h-4 w-4 text-primary"}),a("span",null,y(o.workingHours),1)])):_("",!0),a("div",at,[a("span",it,y(o.followersLabel),1),a("span",ut,y(o.eventsLabel),1)])]),a("div",dt,[m(n(D),{variant:"outline",class:"gap-2",onClick:l[0]||(l[0]=c=>f("show-map"))},{default:P(()=>[m(n(De),{class:"h-4 w-4"}),l[2]||(l[2]=R(" Показать на карте ",-1))]),_:1}),m(n(D),{class:"gap-2",disabled:o.followPending||o.followState,onClick:l[1]||(l[1]=c=>f("follow"))},{default:P(()=>[o.followPending?(r(),Z(n(oe),{key:0,class:"h-4 w-4 animate-spin"})):(r(),Z(n(Ue),{key:1,class:"h-4 w-4"})),R(" "+y(o.followButtonLabel),1)]),_:1},8,["disabled"])])]),o.venueDescription?(r(),s("p",ct,y(o.venueDescription),1)):_("",!0)]))}}),mt={class:"space-y-4 rounded-3xl border border-border bg-card p-5 shadow-soft sm:p-6"},ft={class:"flex items-center justify-between gap-2"},gt={key:0,class:"rounded-full bg-muted px-2.5 py-1 text-xs font-semibold text-muted-foreground"},pt={class:"relative overflow-hidden rounded-2xl border border-border bg-muted/20"},bt=["src","alt"],yt={key:0,class:"flex gap-2 overflow-x-auto pb-1"},ht=["aria-label","onClick"],xt=["src","alt"],wt={key:1,class:"rounded-2xl border border-border bg-muted/20 p-4 text-sm text-muted-foreground"},kt=V({__name:"VenueInfo",props:{hasGallery:{type:Boolean},galleryIndex:{},galleryImages:{},canSlideGallery:{type:Boolean},currentGalleryImage:{},venueName:{}},emits:["prev-image","next-image","select-image"],setup(o,{emit:h}){const f=h;return(g,l)=>(r(),s("section",mt,[a("div",ft,[l[2]||(l[2]=a("h2",{class:"text-xl font-semibold text-foreground"},"Галерея",-1)),o.hasGallery?(r(),s("span",gt,y(o.galleryIndex+1)+" / "+y(o.galleryImages.length),1)):_("",!0)]),o.hasGallery?(r(),s(L,{key:0},[a("div",pt,[a("img",{src:o.currentGalleryImage,alt:`${o.venueName} - фото ${o.galleryIndex+1}`,class:"h-[240px] w-full object-cover sm:h-[340px]",loading:"lazy"},null,8,bt),o.canSlideGallery?(r(),s("button",{key:0,type:"button",class:"absolute left-3 top-1/2 inline-flex h-10 w-10 -translate-y-1/2 items-center justify-center rounded-full border border-white/30 bg-black/35 text-white transition hover:bg-black/55","aria-label":"Предыдущее фото",onClick:l[0]||(l[0]=c=>f("prev-image"))},[m(n(Fe),{class:"h-5 w-5"})])):_("",!0),o.canSlideGallery?(r(),s("button",{key:1,type:"button",class:"absolute right-3 top-1/2 inline-flex h-10 w-10 -translate-y-1/2 items-center justify-center rounded-full border border-white/30 bg-black/35 text-white transition hover:bg-black/55","aria-label":"Следующее фото",onClick:l[1]||(l[1]=c=>f("next-image"))},[m(n(Te),{class:"h-5 w-5"})])):_("",!0)]),o.canSlideGallery?(r(),s("div",yt,[(r(!0),s(L,null,j(o.galleryImages,(c,p)=>(r(),s("button",{key:`${c}-${p}`,type:"button",class:Be(["h-16 w-24 flex-shrink-0 overflow-hidden rounded-xl border transition",p===o.galleryIndex?"border-primary ring-1 ring-primary/60":"border-border hover:border-primary/40"]),"aria-label":`Открыть фото ${p+1}`,onClick:x=>f("select-image",p)},[a("img",{src:c,alt:`${o.venueName} - миниатюра ${p+1}`,class:"h-full w-full object-cover",loading:"lazy"},null,8,xt)],10,ht))),128))])):_("",!0)],64)):(r(),s("div",wt," Фотографии площадки скоро появятся. "))]))}}),_t={class:"mx-auto w-full max-w-6xl space-y-5 pb-10"},$t={key:0,class:"space-y-4"},Ct={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},It={key:1,class:"rounded-2xl border border-destructive/30 bg-destructive/10 p-4 text-sm text-destructive"},Lt={class:"flex items-center justify-between gap-2"},Rt={key:0,class:"relative overflow-hidden rounded-2xl border border-border bg-muted/20"},St={key:0,class:"pointer-events-none absolute inset-0 flex items-center justify-center bg-card/50"},Bt={key:1,class:"rounded-2xl border border-border bg-muted/20 p-4 text-sm text-muted-foreground"},Et={key:2,class:"text-sm text-destructive"},Nt=V({__name:"VenueMainBlock",setup(o){const h={version:8,sources:{osm:{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"&copy; OpenStreetMap contributors"}},layers:[{id:"osm",type:"raster",source:"osm"}]},f=ne(),g=Ee(),l=Oe(),c=C(null),p=C(null),x=te(null),M=te(null),U=C(!1),A=C(""),S=C(!1),B=C(!1),b=C(0),$=u(()=>{const e=f.params.slug;return Array.isArray(e)?e[0]||"":String(e||"")}),F=u(()=>encodeURIComponent($.value)),Y=u(()=>`/api/v1/public/venues/${F.value}`),J=u(()=>`/api/v1/public/venues/${F.value}/events`),{data:E,pending:re,error:se,refresh:le}=ee("public-venue-profile",async()=>$.value?await g.apiFetch(Y.value,{baseURL:H(Y.value)}):null,{server:!1,default:()=>null,watch:[$,()=>g.token,()=>g.isAuthInitialized]}),{data:ae,pending:ie,error:ue,refresh:de}=ee("public-venue-events",async()=>$.value?await g.apiFetch(J.value,{baseURL:H(J.value),query:{limit:24}}):[],{server:!1,default:()=>[],watch:[$,()=>g.token,()=>g.isAuthInitialized]}),v=u(()=>E.value??null);G(v,e=>{B.value=!!e?.is_following},{immediate:!0});const K=u(()=>v.value?.name?.trim()||"Площадка"),ce=u(()=>{const e=v.value?.address?.trim(),t=v.value?.city?.trim();return e&&t&&!e.toLocaleLowerCase("ru-RU").includes(t.toLocaleLowerCase("ru-RU"))?`${e}, ${t}`:e||t||"Адрес уточняется"}),ve=u(()=>v.value?.description?.trim()||""),me=u(()=>{const e=v.value;if(!e)return"";const t=[e.working_hours,e.opening_hours,e.schedule,e.work_time];for(const i of t)if(typeof i=="string"&&i.trim())return i.trim();const d=e.social_links;if(d&&typeof d=="object"&&!Array.isArray(d)){const i=d.working_hours??d.hours;if(typeof i=="string"&&i.trim())return i.trim()}return""}),k=u(()=>(v.value?.images??[]).filter(e=>typeof e=="string"&&e.trim().length>0).map(e=>e.trim())),fe=u(()=>k.value.length>0),T=u(()=>k.value.length>1),ge=u(()=>k.value[b.value]||"");G(k,()=>{b.value=0},{immediate:!0});const pe=()=>{T.value&&(b.value=b.value>0?b.value-1:k.value.length-1)},be=()=>{T.value&&(b.value=b.value<k.value.length-1?b.value+1:0)},ye=e=>{e<0||e>=k.value.length||(b.value=e)},w=u(()=>{const e=Number(v.value?.lat),t=Number(v.value?.lon);return!Number.isFinite(e)||!Number.isFinite(t)?null:{lat:e,lon:t}}),O=u(()=>{const e=w.value;if(e){const d=`${e.lat},${e.lon}`;return`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(d)}`}const t=[v.value?.address,v.value?.city].filter(d=>!!d?.trim()).join(", ");return t?`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(t)}`:""}),Q=e=>new Intl.NumberFormat("ru-RU").format(Math.max(0,e)),he=u(()=>`${Q(v.value?.followers_count??0)} подписчиков`),xe=u(()=>`${Q(v.value?.events_count??0)} событий`),we=u(()=>S.value?"Подписываем...":B.value?"Вы подписаны":"Подписаться"),ke=async()=>{const e=encodeURIComponent(f.fullPath||`/venue/${$.value}`);await Ae(`/login?redirect=${e}`)},q=()=>{O.value&&window.open(O.value,"_blank","noopener,noreferrer")},_e=()=>{if(!w.value){q();return}c.value?.scrollIntoView({behavior:"smooth",block:"start"}),z()},W=()=>{M.value?.remove(),M.value=null,x.value?.remove(),x.value=null},X=()=>{const e=w.value;!e||!x.value||(M.value?.setLngLat([e.lon,e.lat]),x.value.setCenter([e.lon,e.lat]))},z=async()=>{if(!(!p.value||!w.value)){if(A.value="",x.value){X(),x.value.resize();return}U.value=!0;try{const e=(await Me(async()=>{const{default:I}=await import("./BCnLW41T.js").then(N=>N.m);return{default:I}},__vite__mapDeps([0,1]),import.meta.url)).default,t=w.value,d=p.value;if(!t||!d)return;const i=new e.Map({container:d,style:h,center:[t.lon,t.lat],zoom:14,attributionControl:!1});i.scrollZoom.disable(),i.boxZoom.disable(),i.doubleClickZoom.disable(),i.dragRotate.disable(),i.dragPan.disable(),i.touchZoomRotate.disable(),i.touchZoomRotate.disableRotation(),i.keyboard.disable(),i.on("click",()=>{q()}),i.on("load",()=>{i.resize()}),M.value=new e.Marker({color:"#ef4444"}).setLngLat([t.lon,t.lat]).addTo(i),x.value=i}catch{A.value="Не удалось загрузить карту."}finally{U.value=!1}}},$e=e=>{const t=e.occurrences?.[0],d=t?.venue??null,i=e.default_venue??d,I=e.images?.[0]?.url??null;return{id:e.id,uuid:e.uuid,title:e.title,description:e.description??"",slug:e.slug,main_image:I,venue_name:i?.name??t?.location_name??null,city:i?.city?.trim()||"Не указан",start_time:t?.start_time??null,tags:e.tags?.map(N=>N.name).filter(N=>!!N?.trim())??[],going_count:0,going_avatars:[]}},Ce=e=>{const t=v.value?.id;if(!t)return!0;const d=e.default_venue_id;if(typeof d=="number")return d===t;const i=e.default_venue?.id;if(typeof i=="number")return i===t;const I=e.occurrences?.[0]?.venue?.id;return typeof I=="number"?I===t:!0},Ie=u(()=>(ae.value??[]).filter(e=>Ce(e)).map($e)),Le=async()=>{if(!(S.value||B.value||!$.value)){if(!g.isAuthenticated){await ke();return}S.value=!0;try{const e=`/api/v1/public/venues/${F.value}/follow`;await g.apiFetch(e,{method:"POST",baseURL:H(e)}),B.value=!0,E.value&&(E.value={...E.value,is_following:!0,followers_count:Math.max(E.value.followers_count??0,0)+1}),l.push({level:"success",title:"Подписка оформлена",message:"Вы подписались на обновления площадки."})}catch(e){l.push({level:"error",title:"Ошибка подписки",message:qe(e,"Не удалось оформить подписку. Попробуйте еще раз.")})}finally{S.value=!1}}},Re=()=>{le()},Se=()=>{de()};return G(w,e=>{if(!e){W();return}if(x.value){X();return}p.value&&z()}),G(p,e=>{!e||!w.value||z()}),Ne(()=>{w.value&&z()}),Ve(()=>{W()}),(e,t)=>(r(),s("div",_t,[n(re)&&!n(v)?(r(),s("section",$t,[t[0]||(t[0]=a("div",{class:"h-40 animate-pulse rounded-3xl bg-muted"},null,-1)),t[1]||(t[1]=a("div",{class:"h-72 animate-pulse rounded-3xl bg-muted"},null,-1)),a("div",Ct,[(r(),s(L,null,j(6,d=>a("div",{key:`venue-page-skeleton-${d}`,class:"h-72 animate-pulse rounded-2xl bg-muted"})),64))])])):n(se)||!n(v)?(r(),s("section",It,[t[2]||(t[2]=R(" Не удалось загрузить страницу площадки. ",-1)),a("button",{type:"button",class:"ml-2 underline",onClick:Re},"Обновить")])):(r(),s(L,{key:2},[m(vt,{"venue-name":n(K),"venue-address":n(ce),"working-hours":n(me),"followers-label":n(he),"events-label":n(xe),"follow-pending":n(S),"follow-state":n(B),"follow-button-label":n(we),"venue-description":n(ve),onShowMap:_e,onFollow:Le},null,8,["venue-name","venue-address","working-hours","followers-label","events-label","follow-pending","follow-state","follow-button-label","venue-description"]),m(kt,{"has-gallery":n(fe),"gallery-index":n(b),"gallery-images":n(k),"can-slide-gallery":n(T),"current-gallery-image":n(ge),"venue-name":n(K),onPrevImage:pe,onNextImage:be,onSelectImage:ye},null,8,["has-gallery","gallery-index","gallery-images","can-slide-gallery","current-gallery-image","venue-name"]),m(et,{pending:n(ie),"has-error":!!n(ue),events:n(Ie),onRetry:Se},null,8,["pending","has-error","events"]),a("section",{ref_key:"mapSectionRef",ref:c,class:"space-y-4 rounded-3xl border border-border bg-card p-5 shadow-soft sm:p-6"},[a("div",Lt,[t[4]||(t[4]=a("h2",{class:"text-xl font-semibold text-foreground"},"Карта",-1)),m(n(D),{variant:"outline",size:"sm",disabled:!n(O),onClick:q},{default:P(()=>[...t[3]||(t[3]=[R(" Открыть навигатор ",-1)])]),_:1},8,["disabled"])]),n(w)?(r(),s("div",Rt,[a("div",{ref_key:"mapContainerRef",ref:p,class:"venue-map h-[320px] w-full"},null,512),t[5]||(t[5]=a("div",{class:"pointer-events-none absolute left-3 top-3 rounded-full bg-card/90 px-3 py-1 text-xs font-medium text-foreground"}," Нажмите на карту, чтобы открыть маршрут ",-1)),n(U)?(r(),s("div",St,[m(n(oe),{class:"h-6 w-6 animate-spin text-primary"})])):_("",!0)])):(r(),s("div",Bt," Координаты площадки пока не указаны. ")),n(A)?(r(),s("p",Et,y(n(A)),1)):_("",!0)],512)],64))]))}}),Vt=He(Nt,[["__scopeId","data-v-dab4e6cd"]]),Mt={class:"page-wrapper"},Yt=V({__name:"index",setup(o){const h=ne(),f=u(()=>h.params.slug);return(g,l)=>(r(),s("div",Mt,[m(Vt,{slug:n(f)},null,8,["slug"])]))}});export{Yt as default};
