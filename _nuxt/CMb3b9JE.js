import{d as N,c as o,a as e,F as x,D as k,u as d,o as r,b as h,k as M,w as O,t as u,E as G,j as g,_ as H,f as L,J as ee,P as te,n as re,g as oe,y as se,r as q,a2 as ne,K as R}from"./DXztqjCQ.js";import{H as ae,d as ie}from"./DMGK1GPA.js";import{S as A}from"./C1W7Eyd7.js";import"./DlAUqK2U.js";import"./CQBiaOXw.js";import"./CG4HLnLt.js";import"./DTwSdy3O.js";import"./BVpqY5PZ.js";import"./BCI1LTVQ.js";import"./DJXsfEn5.js";import"./Cw-xcs6-.js";import"./BtdQ4RrR.js";const de={key:0,class:"flex flex-wrap gap-2"},le={key:1,class:"rounded-2xl border border-border/70 bg-card/60 p-4 text-sm text-muted-foreground"},ue={key:2,class:"rounded-2xl border border-border/70 bg-card/60 p-4 text-sm text-muted-foreground"},ce={key:3,class:"flex flex-wrap gap-2"},ge={class:"text-[11px] opacity-85"},pe=N({__name:"SearchBar",props:{searches:{},loading:{type:Boolean,default:!1},error:{type:Boolean,default:!1}},setup(w){const p=w,t=l=>new Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(l),f=g(()=>p.searches.reduce((l,i)=>Math.max(l,i.count),1)),b=l=>{const i=l/f.value;return i>=.75?"text-base bg-orange-500/12 border-orange-500/30 text-orange-700 dark:text-orange-300":i>=.45?"text-sm bg-amber-500/12 border-amber-500/30 text-amber-700 dark:text-amber-300":"text-sm bg-muted/70 border-border text-foreground"},v=l=>l.trim().toLowerCase().replace(/^#/,"").replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"trend",m=l=>{const i=l.trim().replace(/^#/,"").replace(/\s+/g,"");return i?`#${i}`:"#trend"},F=g(()=>[...p.searches].sort((l,i)=>i.count-l.count)),$=l=>({path:"/discovery/catalog",query:{type:"events",tags:v(l)}});return(l,i)=>{const T=H;return r(),o("section",null,[i[0]||(i[0]=e("div",{class:"mb-3 flex items-center justify-between gap-2"},[e("h2",{class:"text-lg font-semibold"},"Trending Searches"),e("span",{class:"text-xs text-muted-foreground"},"Tap a tag to jump to Catalog")],-1)),p.loading&&!p.searches.length?(r(),o("div",de,[(r(),o(x,null,k(8,c=>h(A,{key:`search-skeleton-${c}`,class:"h-9 w-24","rounded-class":"rounded-full"})),64))])):p.error&&!p.searches.length?(r(),o("div",le," Could not load trending searches. ")):p.searches.length?(r(),o("div",ce,[(r(!0),o(x,null,k(d(F),c=>(r(),M(T,{key:c.query,to:$(c.query),class:G(["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 font-semibold tracking-tight transition-colors hover:border-primary/40",b(c.count)])},{default:O(()=>[e("span",null,u(m(c.query)),1),e("span",ge,u(t(c.count)),1)]),_:2},1032,["to","class"]))),128))])):(r(),o("div",ue," No trending searches yet. "))])}}}),me={class:"space-y-8"},fe={class:"mb-3 flex flex-wrap items-center justify-between gap-2"},xe={class:"flex items-center gap-2"},he={class:"text-xs text-muted-foreground"},be=["disabled"],ve={key:0,class:"grid gap-3 sm:grid-cols-2 xl:grid-cols-3"},ye={key:1,class:"rounded-2xl border border-border/70 bg-card/60 p-4 text-sm text-muted-foreground"},_e={key:2,class:"rounded-2xl border border-border/70 bg-card/60 p-4 text-sm text-muted-foreground"},ke={key:3,class:"grid gap-3 sm:grid-cols-2 xl:grid-cols-3"},Fe={class:"mb-3 flex items-center justify-between gap-2"},we={class:"rounded-full bg-orange-500/10 px-2.5 py-1 text-xs font-semibold text-orange-700 dark:text-orange-300"},Te={class:"mt-1 text-xs text-muted-foreground"},Le={class:"mt-4 flex items-end justify-between gap-2"},$e={class:"text-sm font-semibold text-foreground"},Be={class:"text-xs font-semibold text-orange-700 dark:text-orange-300"},Se={key:0,class:"space-y-2"},Ee={key:1,class:"rounded-2xl border border-border/70 bg-card/60 p-4 text-sm text-muted-foreground"},Ce={key:2,class:"rounded-2xl border border-border/70 bg-card/60 p-4 text-sm text-muted-foreground"},Ue={key:3,class:"space-y-2"},Re={class:"min-w-0 flex-1"},Oe={class:"mt-0.5 text-xs text-muted-foreground"},Ae={class:"text-right"},Ne={class:"text-sm font-semibold text-foreground"},De={key:0,class:"grid gap-3 sm:grid-cols-2 xl:grid-cols-3"},Ve={key:1,class:"rounded-2xl border border-border/70 bg-card/60 p-4 text-sm text-muted-foreground"},Ie={key:2,class:"rounded-2xl border border-border/70 bg-card/60 p-4 text-sm text-muted-foreground"},je={key:3,class:"grid gap-3 sm:grid-cols-2 xl:grid-cols-3"},qe={class:"line-clamp-1 text-sm font-semibold text-foreground"},ze={class:"mt-3 flex items-center justify-between gap-2"},Pe={class:"inline-flex items-center gap-1 rounded-full bg-emerald-500/15 px-2.5 py-1 text-xs font-semibold text-emerald-700 dark:text-emerald-300"},Me={class:"text-xs font-medium text-muted-foreground"},Ge=N({__name:"TrendingGrid",props:{onFire:{},topTen:{},risingVenues:{},onFireLoading:{type:Boolean,default:!1},topTenLoading:{type:Boolean,default:!1},venuesLoading:{type:Boolean,default:!1},onFireError:{type:Boolean,default:!1},topTenError:{type:Boolean,default:!1},venuesError:{type:Boolean,default:!1},lastOnFireUpdatedAt:{default:null}},emits:["refresh-on-fire"],setup(w,{emit:p}){const t=w,f=p,b=n=>new Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(n),v=n=>n?new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(n)):"Date pending",m=n=>{const a=Math.round(n);return a>0?`+${a}`:String(a)},F=n=>{const a=Math.round(n);return a>0?`+${a}%`:`${a}%`},$=g(()=>{if(!t.lastOnFireUpdatedAt)return"Auto refresh every 5 min";const n=new Date(t.lastOnFireUpdatedAt);return Number.isNaN(n.getTime())?"Auto refresh every 5 min":`Updated ${new Intl.DateTimeFormat("en-US",{hour:"2-digit",minute:"2-digit"}).format(n)}`}),l=n=>n===0?"h-12 w-12 border-amber-500/45 bg-amber-500/20 text-amber-700 dark:text-amber-300":n===1?"h-11 w-11 border-slate-400/45 bg-slate-400/20 text-slate-700 dark:text-slate-200":n===2?"h-11 w-11 border-orange-500/45 bg-orange-500/20 text-orange-700 dark:text-orange-300":"h-9 w-9 border-primary/35 bg-primary/10 text-primary",i=g(()=>t.topTen.slice(0,10)),T=n=>({path:"/discovery/catalog",query:{type:"events",q:n}}),c=n=>({path:"/discovery/catalog",query:{type:"venues",q:n}});return(n,a)=>{const B=H;return r(),o("section",me,[e("section",null,[e("div",fe,[a[1]||(a[1]=e("div",null,[e("h2",{class:"text-lg font-semibold"},"On Fire"),e("p",{class:"text-xs text-muted-foreground"},"Last hour velocity")],-1)),e("div",xe,[e("span",he,u(d($)),1),e("button",{type:"button",class:"rounded-lg border border-border bg-card px-3 py-1.5 text-xs font-medium text-foreground transition-colors hover:bg-accent disabled:cursor-not-allowed disabled:opacity-60",disabled:t.onFireLoading,onClick:a[0]||(a[0]=s=>f("refresh-on-fire"))},u(t.onFireLoading?"Refreshing...":"Refresh"),9,be)])]),t.onFireLoading&&!t.onFire.length?(r(),o("div",ve,[(r(),o(x,null,k(3,s=>h(A,{key:`on-fire-skeleton-${s}`,class:"h-40"})),64))])):t.onFireError&&!t.onFire.length?(r(),o("div",ye," Could not load On Fire events. ")):t.onFire.length?(r(),o("div",ke,[(r(!0),o(x,null,k(t.onFire,s=>(r(),o("article",{key:s.id,class:"rounded-2xl border border-border/70 bg-card/70 p-4"},[e("div",Fe,[a[2]||(a[2]=e("span",{class:"rounded-full bg-orange-500/15 px-2.5 py-1 text-[11px] font-semibold uppercase tracking-wide text-orange-700 dark:text-orange-300"}," Last hour ",-1)),e("span",we,u(m(s.momentum_score)),1)]),h(B,{to:T(s.title),class:"line-clamp-2 text-sm font-semibold text-foreground transition hover:text-primary"},{default:O(()=>[L(u(s.title),1)]),_:2},1032,["to"]),e("p",Te,u(s.venue_name||"Venue pending"),1),e("div",Le,[e("div",null,[e("p",$e,u(b(s.going_count)),1),a[3]||(a[3]=e("p",{class:"text-xs text-muted-foreground"},"People Going",-1))]),e("p",Be,u(s.momentum_label||"On fire"),1)])]))),128))])):(r(),o("div",_e," No events are currently gaining momentum. "))]),e("section",null,[a[5]||(a[5]=e("div",{class:"mb-3 flex items-center justify-between gap-2"},[e("h2",{class:"text-lg font-semibold"},"Top 10 Leaderboard"),e("span",{class:"text-xs text-muted-foreground"},"Ranked by momentum and attendance")],-1)),t.topTenLoading&&!d(i).length?(r(),o("div",Se,[(r(),o(x,null,k(6,s=>h(A,{key:`top-ten-skeleton-${s}`,class:"h-16"})),64))])):t.topTenError&&!d(i).length?(r(),o("div",Ee," Could not load the Top 10 leaderboard. ")):d(i).length?(r(),o("ol",Ue,[(r(!0),o(x,null,k(d(i),(s,E)=>(r(),o("li",{key:s.id,class:"flex items-center gap-3 rounded-2xl border border-border/70 bg-card/70 p-3"},[e("div",{class:G(["flex shrink-0 items-center justify-center rounded-full border text-sm font-bold",l(E)])},u(E+1),3),e("div",Re,[h(B,{to:T(s.title),class:"block truncate text-sm font-semibold text-foreground transition hover:text-primary"},{default:O(()=>[L(u(s.title),1)]),_:2},1032,["to"]),e("p",Oe,u(s.venue_name||"Venue pending")+" - "+u(v(s.start_time)),1)]),e("div",Ae,[e("p",Ne,u(b(s.going_count)),1),a[4]||(a[4]=e("p",{class:"text-xs text-muted-foreground"},"People Going",-1))])]))),128))])):(r(),o("div",Ce," No leaderboard entries yet. "))]),e("section",null,[a[7]||(a[7]=e("div",{class:"mb-3 flex items-center justify-between gap-2"},[e("h2",{class:"text-lg font-semibold"},"Rising Venues"),e("span",{class:"text-xs text-muted-foreground"},"Fastest weekly growth")],-1)),t.venuesLoading&&!t.risingVenues.length?(r(),o("div",De,[(r(),o(x,null,k(3,s=>h(A,{key:`venue-skeleton-${s}`,class:"h-28"})),64))])):t.venuesError&&!t.risingVenues.length?(r(),o("div",Ve," Could not load rising venues. ")):t.risingVenues.length?(r(),o("div",je,[(r(!0),o(x,null,k(t.risingVenues,s=>(r(),M(B,{key:s.id,to:c(s.name),class:"rounded-2xl border border-border/70 bg-card/70 p-4 transition-colors hover:border-primary/40"},{default:O(()=>[e("p",qe,u(s.name),1),e("div",ze,[e("span",Pe,[a[6]||(a[6]=e("svg",{class:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M10 16.25a.75.75 0 01-.75-.75V6.81L6.53 9.53a.75.75 0 01-1.06-1.06l4-4a.75.75 0 011.06 0l4 4a.75.75 0 111.06 1.06l-2.72-2.72v8.69a.75.75 0 01-.75.75z","clip-rule":"evenodd"})],-1)),L(" "+u(F(s.growth_percentage)),1)]),e("span",Me,u(b(s.total_visitors))+" visitors",1)])]),_:2},1032,["to"]))),128))])):(r(),o("div",Ie," No venue momentum changes yet. "))])])}}}),He={class:"h-full overflow-y-auto rounded-3xl border border-border/60 bg-gradient-to-b from-background via-background to-muted/20 p-4 text-foreground sm:p-6"},Je={class:"mb-6 flex flex-col gap-2 border-b border-border/60 pb-5"},Ke={class:"text-sm text-muted-foreground"},We=N({__name:"TrendsMainBlock",props:{onFire:{},topTen:{},trendingSearches:{},risingVenues:{},onFireLoading:{type:Boolean,default:!1},topTenLoading:{type:Boolean,default:!1},searchesLoading:{type:Boolean,default:!1},venuesLoading:{type:Boolean,default:!1},onFireError:{type:Boolean,default:!1},topTenError:{type:Boolean,default:!1},searchesError:{type:Boolean,default:!1},venuesError:{type:Boolean,default:!1},lastOnFireUpdatedAt:{default:null}},emits:["refresh-on-fire"],setup(w,{emit:p}){const t=w,f=p,b=v=>new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(v));return(v,m)=>(r(),o("div",He,[e("header",Je,[m[2]||(m[2]=e("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-primary/80"},"The City Charts",-1)),m[3]||(m[3]=e("h1",{class:"text-2xl font-bold tracking-tight sm:text-3xl"},"Trends Right Now",-1)),e("p",Ke,[m[1]||(m[1]=L(" Real-time momentum across events, rankings, and tags. ",-1)),t.lastOnFireUpdatedAt?(r(),o(x,{key:0},[L(" Updated "+u(b(t.lastOnFireUpdatedAt))+". ",1)],64)):(r(),o(x,{key:1},[L(" Live updates every 5 minutes. ")],64))])]),h(Ge,{"on-fire":t.onFire,"top-ten":t.topTen,"rising-venues":t.risingVenues,"on-fire-loading":t.onFireLoading,"top-ten-loading":t.topTenLoading,"venues-loading":t.venuesLoading,"on-fire-error":t.onFireError,"top-ten-error":t.topTenError,"venues-error":t.venuesError,"last-on-fire-updated-at":t.lastOnFireUpdatedAt,onRefreshOnFire:m[0]||(m[0]=F=>f("refresh-on-fire"))},null,8,["on-fire","top-ten","rising-venues","on-fire-loading","top-ten-loading","venues-loading","on-fire-error","top-ten-error","venues-error","last-on-fire-updated-at"]),h(pe,{class:"mt-8",searches:t.trendingSearches,loading:t.searchesLoading,error:t.searchesError},null,8,["searches","loading","error"])]))}}),Qe={class:"page-wrapper"},Xe={class:"flex min-h-[calc(100dvh-9rem)] flex-col gap-4 lg:flex-row lg:items-start lg:gap-6"},Ye={class:"min-w-0 flex-1 overflow-hidden"},ct=N({__name:"index",async setup(w){let p,t;const f=ee(),b=[()=>f.token,()=>f.isAuthInitialized],v=()=>({onFire:!1,topTen:!1,searches:!1,venues:!1}),m=()=>({onFire:[],topTen:[],searches:[],venues:[],errors:v()}),F=async()=>f.apiFetch("/api/v1/discovery/trends/on-fire",{baseURL:R("/api/v1/discovery/trends/on-fire"),query:{limit:6}}),$=async()=>f.apiFetch("/api/v1/discovery/trends/top-10",{baseURL:R("/api/v1/discovery/trends/top-10")}),l=async()=>f.apiFetch("/api/v1/discovery/trends/searches",{baseURL:R("/api/v1/discovery/trends/searches"),query:{limit:18}}),i=async()=>f.apiFetch("/api/v1/discovery/trends/venues",{baseURL:R("/api/v1/discovery/trends/venues"),query:{limit:8}}),T=async()=>{if(!f.isAuthInitialized)return m();const[_,y,S,j]=await Promise.allSettled([F(),$(),l(),i()]);return{onFire:_.status==="fulfilled"?_.value:[],topTen:y.status==="fulfilled"?y.value:[],searches:S.status==="fulfilled"?S.value:[],venues:j.status==="fulfilled"?j.value:[],errors:{onFire:_.status==="rejected",topTen:y.status==="rejected",searches:S.status==="rejected",venues:j.status==="rejected"}}},{data:c,pending:n}=([p,t]=te(()=>ne("discovery-trends-analytics",T,{server:!1,default:m,watch:b})),p=await p,t(),p),a=g(()=>c.value?.onFire??[]),B=g(()=>c.value?.topTen??[]),s=g(()=>c.value?.searches??[]),E=g(()=>c.value?.venues??[]),C=g(()=>c.value?.errors??v()),D=q(null),V=q(!1),I=q(!1),J=g(()=>n.value||V.value),K=g(()=>n.value),W=g(()=>n.value),Q=g(()=>n.value),z=g(()=>C.value.onFire||I.value),X=g(()=>C.value.topTen),Y=g(()=>C.value.searches),Z=g(()=>C.value.venues);re(()=>[f.isAuthInitialized,n.value,z.value],([_,y,S])=>{_&&!y&&!S&&(D.value=new Date().toISOString())},{immediate:!0});const P=async()=>{if(f.isAuthInitialized){V.value=!0;try{const _=await F(),y=c.value??m();c.value={...y,onFire:_,errors:{...y.errors,onFire:!1}},I.value=!1,D.value=new Date().toISOString()}catch{I.value=!0}finally{V.value=!1}}};let U=null;return oe(()=>{U=window.setInterval(()=>{P()},300*1e3)}),se(()=>{U!==null&&(clearInterval(U),U=null)}),(_,y)=>(r(),o("div",Qe,[e("div",Xe,[h(ae,{items:d(ie),class:"shrink-0"},null,8,["items"]),e("div",Ye,[h(We,{class:"h-[calc(100dvh-12rem)] min-h-[34rem] lg:h-[calc(100dvh-8rem)]","on-fire":d(a),"top-ten":d(B),"trending-searches":d(s),"rising-venues":d(E),"on-fire-loading":d(J),"top-ten-loading":d(K),"searches-loading":d(W),"venues-loading":d(Q),"on-fire-error":d(z),"top-ten-error":d(X),"searches-error":d(Y),"venues-error":d(Z),"last-on-fire-updated-at":d(D),onRefreshOnFire:P},null,8,["on-fire","top-ten","trending-searches","rising-venues","on-fire-loading","top-ten-loading","searches-loading","venues-loading","on-fire-error","top-ten-error","searches-error","venues-error","last-on-fire-updated-at"])])])]))}});export{ct as default};
