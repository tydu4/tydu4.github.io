import{d as M,c as a,a as d,b as v,u as e,w as A,F as N,D as P,f as V,o as r,B as j,k as T,t as $,e as I,n as O,r as R,E as ae,j as f,g as ie,y as ue,s as Z,ab as de,O as J,J as ce,z as me,a2 as q,K as F,G as fe}from"./vvrMSRdc.js";import{E as ve,S as pe}from"./BX1I2TEN.js";import{M as ge}from"./DJepmivj.js";import{C as be}from"./BPnAJTcE.js";import{N as ye}from"./BWL4l5tP.js";import{L as K}from"./Dt4PFRCT.js";import{B as he}from"./Ci2-2dez.js";import{_ as we}from"./K80UCnzw.js";import{C as xe}from"./DVhUS8-e.js";import{C as _e}from"./BieWCu63.js";/* empty css        */import{_ as ke}from"./DlAUqK2U.js";import{e as $e}from"./Cv8_oF2L.js";import"./Idgo-c1n.js";const Ce={class:"space-y-4 rounded-3xl border border-border bg-card p-5 shadow-soft sm:p-6"},Le={class:"flex items-center justify-between gap-2"},Ie={key:0,class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},Re={key:1,class:"rounded-2xl border border-destructive/30 bg-destructive/10 p-4 text-sm text-destructive"},Se={key:2,class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},Ee={key:3,class:"rounded-2xl border border-border bg-muted/20 p-4 text-sm text-muted-foreground"},Be=M({__name:"VenueEventsList",props:{pending:{type:Boolean},hasError:{type:Boolean},events:{}},emits:["retry"],setup(o,{emit:l}){const t=l;return(p,n)=>(r(),a("section",Ce,[d("div",Le,[n[3]||(n[3]=d("h2",{class:"text-xl font-semibold text-foreground"},"Афиша площадки",-1)),v(e(j),{variant:"outline",size:"sm",onClick:n[0]||(n[0]=i=>t("retry"))},{default:A(()=>[...n[2]||(n[2]=[V("Обновить",-1)])]),_:1})]),o.pending?(r(),a("div",Ie,[(r(),a(N,null,P(3,i=>v(pe,{key:`venue-events-skeleton-${i}`})),64))])):o.hasError?(r(),a("div",Re,[n[4]||(n[4]=V(" Не удалось загрузить афишу площадки. ",-1)),d("button",{type:"button",class:"ml-2 underline",onClick:n[1]||(n[1]=i=>t("retry"))},"Обновить")])):o.events.length?(r(),a("div",Se,[(r(!0),a(N,null,P(o.events,i=>(r(),T(ve,{key:i.uuid,event:i,"show-tags":!0,"show-going-badge":!1},null,8,["event"]))),128))])):(r(),a("div",Ee," На этой площадке пока нет запланированных событий. "))]))}}),Ne={class:"space-y-4 rounded-3xl border border-border bg-card p-5 shadow-soft sm:p-6"},Ve={class:"flex flex-wrap items-start justify-between gap-4"},Me={class:"space-y-3"},ze={class:"text-2xl font-bold text-foreground sm:text-3xl"},Ae={class:"flex items-center gap-2 text-sm text-muted-foreground"},Pe={key:0,class:"flex items-center gap-2 text-sm text-muted-foreground"},je={class:"flex flex-wrap items-center gap-2 text-xs font-medium text-muted-foreground"},Oe={class:"rounded-full bg-muted px-3 py-1"},De={class:"rounded-full bg-muted px-3 py-1"},Ue={class:"flex flex-wrap gap-2"},Fe={key:0,class:"text-sm leading-relaxed text-muted-foreground"},Te=M({__name:"VenueHeader",props:{venueName:{},venueAddress:{},workingHours:{},followersLabel:{},eventsLabel:{},followPending:{type:Boolean},followState:{type:Boolean},followButtonLabel:{},venueDescription:{}},emits:["show-map","follow"],setup(o,{emit:l}){const t=l;return(p,n)=>(r(),a("section",Ne,[d("div",Ve,[d("div",Me,[d("h1",ze,$(o.venueName),1),d("p",Ae,[v(e(ge),{class:"h-4 w-4 text-primary"}),d("span",null,$(o.venueAddress),1)]),o.workingHours?(r(),a("p",Pe,[v(e(be),{class:"h-4 w-4 text-primary"}),d("span",null,$(o.workingHours),1)])):I("",!0),d("div",je,[d("span",Oe,$(o.followersLabel),1),d("span",De,$(o.eventsLabel),1)])]),d("div",Ue,[v(e(j),{variant:"outline",class:"gap-2",onClick:n[0]||(n[0]=i=>t("show-map"))},{default:A(()=>[v(e(ye),{class:"h-4 w-4"}),n[2]||(n[2]=V(" Показать на карте ",-1))]),_:1}),v(e(j),{class:"gap-2",disabled:o.followPending||o.followState,onClick:n[1]||(n[1]=i=>t("follow"))},{default:A(()=>[o.followPending?(r(),T(e(K),{key:0,class:"h-4 w-4 animate-spin"})):(r(),T(e(he),{key:1,class:"h-4 w-4"})),V(" "+$(o.followButtonLabel),1)]),_:1},8,["disabled"])])]),o.venueDescription?(r(),a("p",Fe,$(o.venueDescription),1)):I("",!0)]))}}),Ge={class:"space-y-4 rounded-3xl border border-border bg-card p-5 shadow-soft sm:p-6"},He={class:"flex items-center justify-between gap-2"},Ze={key:0,class:"rounded-full bg-muted px-2.5 py-1 text-xs font-semibold text-muted-foreground"},qe={class:"relative overflow-hidden rounded-2xl border border-border bg-muted/20"},Je={key:0,class:"flex gap-2 overflow-x-auto pb-1"},Ke=["aria-label","onClick"],Ye={key:1,class:"rounded-2xl border border-border bg-muted/20 p-4 text-sm text-muted-foreground"},Qe=M({__name:"VenueInfo",props:{galleryImages:{},venueName:{}},setup(o){const l=o,t=R(0),p=f(()=>l.galleryImages.length>0),n=f(()=>l.galleryImages.length>1),i=f(()=>l.galleryImages[t.value]||""),g=()=>{n.value&&(t.value=t.value>0?t.value-1:l.galleryImages.length-1)},h=()=>{n.value&&(t.value=t.value<l.galleryImages.length-1?t.value+1:0)},C=x=>{x<0||x>=l.galleryImages.length||(t.value=x)};return O(()=>l.galleryImages,()=>{t.value=0},{immediate:!0}),(x,y)=>{const _=we;return r(),a("section",Ge,[d("div",He,[y[0]||(y[0]=d("h2",{class:"text-xl font-semibold text-foreground"},"Галерея",-1)),e(p)?(r(),a("span",Ze,$(e(t)+1)+" / "+$(l.galleryImages.length),1)):I("",!0)]),e(p)?(r(),a(N,{key:0},[d("div",qe,[v(_,{src:e(i),alt:`${l.venueName} - фото ${e(t)+1}`,class:"h-[240px] w-full object-cover sm:h-[340px]",width:"1280",height:"720",sizes:"(max-width: 640px) 100vw, 1200px",loading:"lazy"},null,8,["src","alt"]),e(n)?(r(),a("button",{key:0,type:"button",class:"absolute left-3 top-1/2 inline-flex h-10 w-10 -translate-y-1/2 items-center justify-center rounded-full border border-white/30 bg-black/35 text-white transition hover:bg-black/55","aria-label":"Предыдущее фото",onClick:g},[v(e(xe),{class:"h-5 w-5"})])):I("",!0),e(n)?(r(),a("button",{key:1,type:"button",class:"absolute right-3 top-1/2 inline-flex h-10 w-10 -translate-y-1/2 items-center justify-center rounded-full border border-white/30 bg-black/35 text-white transition hover:bg-black/55","aria-label":"Следующее фото",onClick:h},[v(e(_e),{class:"h-5 w-5"})])):I("",!0)]),e(n)?(r(),a("div",Je,[(r(!0),a(N,null,P(l.galleryImages,(L,k)=>(r(),a("button",{key:`${L}-${k}`,type:"button",class:ae(["h-16 w-24 flex-shrink-0 overflow-hidden rounded-xl border transition",k===e(t)?"border-primary ring-1 ring-primary/60":"border-border hover:border-primary/40"]),"aria-label":`Открыть фото ${k+1}`,onClick:z=>C(k)},[v(_,{src:L,alt:`${l.venueName} - миниатюра ${k+1}`,class:"h-full w-full object-cover",width:"96",height:"64",sizes:"96px",loading:"lazy"},null,8,["src","alt"])],10,Ke))),128))])):I("",!0)],64)):(r(),a("div",Ye," Фотографии площадки скоро появятся. "))])}}}),We={class:"flex items-center justify-between gap-2"},Xe={key:0,class:"relative overflow-hidden rounded-2xl border border-border bg-muted/20"},et={key:0,class:"pointer-events-none absolute inset-0 flex items-center justify-center bg-card/50"},tt={key:1,class:"rounded-2xl border border-border bg-muted/20 p-4 text-sm text-muted-foreground"},ot={key:2,class:"text-sm text-destructive"},nt=M({__name:"VenueLocationSection",props:{lat:{default:null},lon:{default:null},address:{default:""},city:{default:""}},setup(o,{expose:l}){const t=o,p={version:8,sources:{osm:{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"&copy; OpenStreetMap contributors"}},layers:[{id:"osm",type:"raster",source:"osm"}]},n=R(null),i=R(null),g=Z(null),h=Z(null),C=R(!1),x=R(""),y=f(()=>{const u=Number(t.lat),m=Number(t.lon);return!Number.isFinite(u)||!Number.isFinite(m)?null:{lat:u,lon:m}}),_=f(()=>{const u=y.value;if(u){const c=`${u.lat},${u.lon}`;return`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(c)}`}const m=[t.address,t.city].filter(c=>!!c?.trim()).join(", ");return m?`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(m)}`:""}),L=()=>{const u=_.value;u&&window.open(u,"_blank","noopener,noreferrer")},k=()=>{h.value?.remove(),h.value=null,g.value?.remove(),g.value=null},z=()=>{const u=y.value;!u||!g.value||(h.value?.setLngLat([u.lon,u.lat]),g.value.setCenter([u.lon,u.lat]))},B=async()=>{if(!(!i.value||!y.value)){if(x.value="",g.value){z(),g.value.resize();return}C.value=!0;try{const u=(await de(async()=>{const{default:D}=await import("./kZj0XkdK.js").then(U=>U.m);return{default:D}},[],import.meta.url)).default,m=y.value,c=i.value;if(!m||!c)return;const b=new u.Map({container:c,style:p,center:[m.lon,m.lat],zoom:14,attributionControl:!1});b.scrollZoom.disable(),b.boxZoom.disable(),b.doubleClickZoom.disable(),b.dragRotate.disable(),b.dragPan.disable(),b.touchZoomRotate.disable(),b.touchZoomRotate.disableRotation(),b.keyboard.disable(),b.on("click",()=>{L()}),b.on("load",()=>{b.resize()}),h.value=new u.Marker({color:"#ef4444"}).setLngLat([m.lon,m.lat]).addTo(b),g.value=b}catch{x.value="Не удалось загрузить карту."}finally{C.value=!1}}};return l({showOnMap:()=>{if(!y.value){L();return}n.value?.scrollIntoView({behavior:"smooth",block:"start"}),B()}}),O(y,u=>{if(!u){k();return}if(g.value){z();return}i.value&&B()}),O(i,u=>{!u||!y.value||B()}),ie(()=>{y.value&&B()}),ue(()=>{k()}),(u,m)=>(r(),a("section",{ref_key:"mapSectionRef",ref:n,class:"space-y-4 rounded-3xl border border-border bg-card p-5 shadow-soft sm:p-6"},[d("div",We,[m[1]||(m[1]=d("h2",{class:"text-xl font-semibold text-foreground"},"Карта",-1)),v(e(j),{variant:"outline",size:"sm",disabled:!e(_),onClick:L},{default:A(()=>[...m[0]||(m[0]=[V(" Открыть навигатор ",-1)])]),_:1},8,["disabled"])]),e(y)?(r(),a("div",Xe,[d("div",{ref_key:"mapContainerRef",ref:i,class:"venue-map h-[320px] w-full"},null,512),m[2]||(m[2]=d("div",{class:"pointer-events-none absolute left-3 top-3 rounded-full bg-card/90 px-3 py-1 text-xs font-medium text-foreground"}," Нажмите на карту, чтобы открыть маршрут ",-1)),e(C)?(r(),a("div",et,[v(e(K),{class:"h-6 w-6 animate-spin text-primary"})])):I("",!0)])):(r(),a("div",tt," Координаты площадки пока не указаны. ")),e(x)?(r(),a("p",ot,$(e(x)),1)):I("",!0)],512))}}),st=ke(nt,[["__scopeId","data-v-eee048e8"]]),rt=o=>{const l=o.occurrences?.[0],t=l?.venue??null,p=o.default_venue??t,n=o.images?.[0]?.url??null;return{id:o.id,uuid:o.uuid,title:o.title,description:o.description??"",slug:o.slug,main_image:n,venue_name:p?.name??l?.location_name??null,city:p?.city?.trim()||"Не указан",start_time:l?.start_time??null,tags:o.tags?.map(i=>i.name).filter(i=>!!i?.trim())??[],price:null,rating:0,going_count:0,going_avatars:[],trending_score:0,friends_summary:null}},lt=(o,l)=>{if(!l)return!0;const t=o.default_venue_id;if(typeof t=="number")return t===l;const p=o.default_venue?.id;if(typeof p=="number")return p===l;const n=o.occurrences?.[0]?.venue?.id;return typeof n=="number"?n===l:!0},at={class:"mx-auto w-full max-w-6xl space-y-5 pb-10"},it={key:0,class:"space-y-4"},ut={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},dt={key:1,class:"rounded-2xl border border-destructive/30 bg-destructive/10 p-4 text-sm text-destructive"},ct=M({__name:"VenueMainBlock",setup(o){const l=J(),t=ce(),p=me(),n=R(null),i=R(!1),g=R(!1),h=f(()=>{const s=l.params.slug;return Array.isArray(s)?s[0]||"":String(s||"")}),C=f(()=>encodeURIComponent(h.value)),x=f(()=>`/api/v1/public/venues/${C.value}`),y=f(()=>`/api/v1/public/venues/${C.value}/events`),{data:_,pending:L,error:k,refresh:z}=q("public-venue-profile",async()=>h.value?await t.apiFetch(x.value,{baseURL:F(x.value)}):null,{server:!1,default:()=>null,watch:[h,()=>t.token,()=>t.isAuthInitialized]}),{data:B,pending:G,error:u,refresh:m}=q("public-venue-events",async()=>h.value?await t.apiFetch(y.value,{baseURL:F(y.value),query:{limit:24}}):[],{server:!1,default:()=>[],watch:[h,()=>t.token,()=>t.isAuthInitialized]}),c=f(()=>_.value??null);O(c,s=>{g.value=!!s?.is_following},{immediate:!0});const b=f(()=>c.value?.name?.trim()||"Площадка"),D=f(()=>{const s=c.value?.address?.trim(),w=c.value?.city?.trim();return s&&w&&!s.toLocaleLowerCase("ru-RU").includes(w.toLocaleLowerCase("ru-RU"))?`${s}, ${w}`:s||w||"Адрес уточняется"}),U=f(()=>c.value?.description?.trim()||""),Y=f(()=>{const s=c.value;if(!s)return"";const w=[s.working_hours,s.opening_hours,s.schedule,s.work_time];for(const E of w)if(typeof E=="string"&&E.trim())return E.trim();const S=s.social_links;if(S&&typeof S=="object"&&!Array.isArray(S)){const E=S.working_hours??S.hours;if(typeof E=="string"&&E.trim())return E.trim()}return""}),Q=f(()=>(c.value?.images??[]).filter(s=>typeof s=="string"&&s.trim().length>0).map(s=>s.trim())),H=s=>new Intl.NumberFormat("ru-RU").format(Math.max(0,s)),W=f(()=>`${H(c.value?.followers_count??0)} подписчиков`),X=f(()=>`${H(c.value?.events_count??0)} событий`),ee=f(()=>i.value?"Подписываем...":g.value?"Вы подписаны":"Подписаться"),te=async()=>{const s=encodeURIComponent(l.fullPath||`/venue/${h.value}`);await fe(`/login?redirect=${s}`)},oe=()=>{n.value?.showOnMap()},ne=f(()=>(B.value??[]).filter(s=>lt(s,c.value?.id??null)).map(rt)),se=async()=>{if(!(i.value||g.value||!h.value)){if(!t.isAuthenticated){await te();return}i.value=!0;try{const s=`/api/v1/public/venues/${C.value}/follow`;await t.apiFetch(s,{method:"POST",baseURL:F(s)}),g.value=!0,_.value&&(_.value={..._.value,is_following:!0,followers_count:Math.max(_.value.followers_count??0,0)+1}),p.push({level:"success",title:"Подписка оформлена",message:"Вы подписались на обновления площадки."})}catch(s){p.push({level:"error",title:"Ошибка подписки",message:$e(s,"Не удалось оформить подписку. Попробуйте еще раз.")})}finally{i.value=!1}}},re=()=>{z()},le=()=>{m()};return(s,w)=>(r(),a("div",at,[e(L)&&!e(c)?(r(),a("section",it,[w[0]||(w[0]=d("div",{class:"h-40 animate-pulse rounded-3xl bg-muted"},null,-1)),w[1]||(w[1]=d("div",{class:"h-72 animate-pulse rounded-3xl bg-muted"},null,-1)),d("div",ut,[(r(),a(N,null,P(6,S=>d("div",{key:`venue-page-skeleton-${S}`,class:"h-72 animate-pulse rounded-2xl bg-muted"})),64))])])):e(k)||!e(c)?(r(),a("section",dt,[w[2]||(w[2]=V(" Не удалось загрузить страницу площадки. ",-1)),d("button",{type:"button",class:"ml-2 underline",onClick:re},"Обновить")])):(r(),a(N,{key:2},[v(Te,{"venue-name":e(b),"venue-address":e(D),"working-hours":e(Y),"followers-label":e(W),"events-label":e(X),"follow-pending":e(i),"follow-state":e(g),"follow-button-label":e(ee),"venue-description":e(U),onShowMap:oe,onFollow:se},null,8,["venue-name","venue-address","working-hours","followers-label","events-label","follow-pending","follow-state","follow-button-label","venue-description"]),v(Qe,{"gallery-images":e(Q),"venue-name":e(b)},null,8,["gallery-images","venue-name"]),v(Be,{pending:e(G),"has-error":!!e(u),events:e(ne),onRetry:le},null,8,["pending","has-error","events"]),v(st,{ref_key:"venueLocationSectionRef",ref:n,lat:e(c)?.lat??null,lon:e(c)?.lon??null,address:e(c)?.address??"",city:e(c)?.city??""},null,8,["lat","lon","address","city"])],64))]))}}),mt={class:"page-wrapper"},It=M({__name:"index",setup(o){const l=J(),t=f(()=>l.params.slug);return(p,n)=>(r(),a("div",mt,[v(ct,{slug:e(t)},null,8,["slug"])]))}});export{It as default};
