import{d as P,q as M,x as R,z as q,o as r,c as l,u as e,h as t,j as m,F as K,t as n,f as i,e as f,_ as O,w as p,B as w,W,g as a,r as G}from"./BO0_OeXi.js";import{u as H}from"./D92jAQRS.js";const J={class:"mx-auto w-full max-w-4xl space-y-6 pb-10"},Q={key:0,class:"space-y-4"},X={key:1,class:"rounded-3xl border border-destructive/20 bg-destructive/10 p-6 text-sm text-destructive"},Y={key:2,class:"rounded-3xl border border-border bg-card p-6 text-sm text-muted-foreground shadow-soft"},Z={class:"rounded-3xl border border-border bg-card p-6 shadow-soft"},ee={class:"flex flex-col gap-6 sm:flex-row sm:items-start sm:justify-between"},te={class:"flex items-center gap-4"},se={class:"h-20 w-20 overflow-hidden rounded-full border-4 border-background bg-primary/10 shadow-soft"},oe=["src","alt"],re={key:1,class:"flex h-full w-full items-center justify-center text-2xl font-bold text-primary"},le={class:"min-w-0"},ae={class:"truncate text-2xl font-bold text-foreground"},ne={class:"truncate text-sm text-muted-foreground"},de={key:0,class:"mt-1 text-xs text-muted-foreground"},ie={class:"flex flex-wrap gap-2"},ue={key:0,class:"mt-4 text-sm text-muted-foreground"},ce={class:"rounded-3xl border border-border bg-card p-5 shadow-soft"},fe={class:"mt-2 text-2xl font-bold text-foreground"},me={key:0,class:"mt-1 text-xs text-muted-foreground"},pe={class:"rounded-3xl border border-border bg-card p-5 shadow-soft"},xe={class:"mt-2 text-2xl font-bold text-foreground"},_e={key:0,class:"mt-3 h-2 w-full rounded-full bg-muted"},ve={class:"rounded-3xl border border-border bg-card p-5 shadow-soft"},ge={class:"mt-2 text-2xl font-bold text-foreground"},be={class:"grid gap-4 sm:grid-cols-2"},he={class:"rounded-3xl border border-border bg-card p-5 shadow-soft"},ye={class:"mt-3 text-sm text-muted-foreground"},ke={class:"rounded-3xl border border-border bg-card p-5 shadow-soft"},we={class:"mt-3 space-y-1 text-sm text-muted-foreground"},Ne={key:0},Be={key:1},Ce={key:2},Ae={key:3},Pe=P({__name:"ProfileOverviewBlock",setup(T){const u=M(),_=H(),{data:V,pending:$,error:j,refresh:N}=R("profile-overview",async()=>!u.isAuthInitialized||!u.token?null:await u.apiFetch("/api/v1/me/profile",{baseURL:q("/api/v1/me/profile")}),{server:!1,default:()=>null,watch:[()=>u.token,()=>u.isAuthInitialized]}),o=a(()=>V.value??null),x=a(()=>o.value?.full_name?.trim()||o.value?.username||"Профиль"),z=a(()=>x.value.trim().charAt(0).toUpperCase()||"U"),B=a(()=>o.value?.city?.trim()||""),L=a(()=>o.value?.uuid?`/u/${o.value.uuid}`:"/profile/me"),v=d=>typeof d=="string"?d.trim():"",g=a(()=>{const d=o.value?.social_links;return!d||typeof d!="object"?{}:d}),b=a(()=>v(g.value.telegram)),h=a(()=>v(g.value.vk)),y=a(()=>v(g.value.instagram)),S=a(()=>o.value?.level??1),k=a(()=>o.value?.exp??0),c=a(()=>o.value?.next_level_exp??null),F=a(()=>c.value?Math.max(0,c.value-k.value):null),I=a(()=>c.value?Math.min(100,Math.round(k.value/c.value*100)):0),C=G(null),U=()=>{C.value?.scrollIntoView({behavior:"smooth",block:"start"})},D=async()=>{const d=o.value?.uuid?`${window.location.origin}/u/${o.value.uuid}`:window.location.href;try{if(navigator.share){await navigator.share({title:x.value,url:d});return}await navigator.clipboard.writeText(d),_.push({level:"success",message:"Ссылка на профиль скопирована."})}catch{_.push({level:"error",message:"Не удалось поделиться ссылкой."})}};return(d,s)=>{const A=O;return r(),l("div",J,[e($)?(r(),l("section",Q,[...s[1]||(s[1]=[t("div",{class:"h-40 animate-pulse rounded-3xl bg-muted"},null,-1),t("div",{class:"grid gap-4 sm:grid-cols-2"},[t("div",{class:"h-32 animate-pulse rounded-3xl bg-muted"}),t("div",{class:"h-32 animate-pulse rounded-3xl bg-muted"})],-1)])])):e(j)?(r(),l("section",X,[s[2]||(s[2]=m(" Не удалось загрузить профиль. ",-1)),t("button",{type:"button",class:"ml-2 underline",onClick:s[0]||(s[0]=(...E)=>e(N)&&e(N)(...E))},"Обновить")])):e(o)?(r(),l(K,{key:3},[t("section",Z,[t("div",ee,[t("div",te,[t("div",se,[e(o)?.avatar_url?(r(),l("img",{key:0,src:e(o).avatar_url,alt:e(x),class:"h-full w-full object-cover"},null,8,oe)):(r(),l("div",re,n(e(z)),1))]),t("div",le,[t("h1",ae,n(e(x)),1),t("p",ne,"@"+n(e(o)?.username||"user"),1),e(B)?(r(),l("p",de,n(e(B)),1)):i("",!0)])]),t("div",ie,[f(A,{to:"/profile/settings"},{default:p(()=>[f(e(w),{class:"rounded-full"},{default:p(()=>[...s[3]||(s[3]=[m("Редактировать",-1)])]),_:1})]),_:1}),f(e(w),{variant:"outline",class:"rounded-full",onClick:D},{default:p(()=>[...s[4]||(s[4]=[m(" Поделиться ",-1)])]),_:1}),f(e(w),{variant:"outline",class:"rounded-full",onClick:U},{default:p(()=>[...s[5]||(s[5]=[m(" Статистика ",-1)])]),_:1})])]),e(o)?.bio?(r(),l("p",ue,n(e(o).bio),1)):i("",!0),f(A,{to:e(L),class:"mt-3 inline-flex text-xs font-semibold uppercase tracking-[0.2em] text-primary/80 underline-offset-4 hover:underline"},{default:p(()=>[...s[6]||(s[6]=[m(" Перейти в публичный профиль ",-1)])]),_:1},8,["to"])]),t("section",{ref_key:"statsRef",ref:C,class:"grid gap-4 sm:grid-cols-3"},[t("div",ce,[s[7]||(s[7]=t("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground"},"Уровень",-1)),t("p",fe,n(e(S)),1),e(c)?(r(),l("p",me," До следующего уровня: "+n(e(F)),1)):i("",!0)]),t("div",pe,[s[8]||(s[8]=t("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground"},"Опыт",-1)),t("p",xe,n(e(k)),1),e(c)?(r(),l("div",_e,[t("div",{class:"h-2 rounded-full bg-primary",style:W({width:`${e(I)}%`})},null,4)])):i("",!0)]),t("div",ve,[s[9]||(s[9]=t("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground"},"Статус",-1)),t("p",ge,n(e(o)?.role==="organizer"?"Организатор":"Участник"),1),s[10]||(s[10]=t("p",{class:"mt-1 text-xs text-muted-foreground"},"Обновляется автоматически",-1))])],512),t("section",be,[t("div",he,[s[11]||(s[11]=t("h2",{class:"text-sm font-semibold text-foreground"},"Обо мне",-1)),t("p",ye,n(e(o)?.bio||"Пока нет описания."),1)]),t("div",ke,[s[12]||(s[12]=t("h2",{class:"text-sm font-semibold text-foreground"},"Соцсети",-1)),t("div",we,[e(b)?(r(),l("p",Ne,"Telegram: "+n(e(b)),1)):i("",!0),e(h)?(r(),l("p",Be,"VK: "+n(e(h)),1)):i("",!0),e(y)?(r(),l("p",Ce,"Instagram: "+n(e(y)),1)):i("",!0),!e(b)&&!e(h)&&!e(y)?(r(),l("p",Ae,"Ссылки не добавлены.")):i("",!0)])])])],64)):(r(),l("section",Y," Профиль недоступен. Попробуйте обновить страницу. "))])}}}),Te={class:"page-wrapper"},je=P({__name:"index",setup(T){return(u,_)=>(r(),l("div",Te,[f(Pe)]))}});export{je as default};
