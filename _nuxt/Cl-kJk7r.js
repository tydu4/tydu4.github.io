import{d as M,u as te,j as o,c as g,m as a,Z as ie,f as _,a as l,F as ae,b as s,w as v,t as oe,o as h,_ as re,B as R,J as ne,R as se,K as L}from"./DIpL79ME.js";import{H as le,p as ce}from"./DS9zloey.js";import{P as de,a as ue,b as pe,c as me,d as fe}from"./0PeIRoTG.js";import{_ as ve}from"./DlAUqK2U.js";import"./DSoaomjP.js";import"./Ck3zTzEc.js";import"./BTA2ybKl.js";import"./BwSGWVKi.js";import"./CnmEv5PP.js";import"./Dh-MwfXC.js";import"./NaR5TDkT.js";import"./5jP3ovOk.js";const ge={class:"mx-auto w-full max-w-5xl space-y-6 pb-10"},he={key:0,class:"space-y-4"},be={key:1,class:"rounded-3xl border border-destructive/20 bg-destructive/10 p-6 text-sm text-destructive shadow-soft"},ye={key:2,class:"rounded-3xl border border-border bg-card p-6 text-sm text-muted-foreground shadow-soft"},xe={class:"profile-highlights-grid grid gap-4 lg:grid-cols-2"},_e={class:"achievements-container"},we={class:"recent-activity-container"},ke={class:"grid gap-4 lg:grid-cols-[1.2fr,0.8fr]"},Pe={class:"rounded-3xl border border-border bg-card p-5 shadow-soft"},Ne={class:"mt-3 text-sm text-muted-foreground"},Ae=M({__name:"ProfileOverviewBlock",props:{profile:{},gamification:{},activity:{},pending:{type:Boolean},error:{}},emits:["refresh"],setup(T,{emit:c}){const d=T,w=c,m=te(),r=o(()=>d.profile??null),u=o(()=>d.gamification??null),k=o(()=>d.activity??null),P=o(()=>!!d.pending),x=o(()=>!!d.error),b=o(()=>r.value?.full_name?.trim()||r.value?.username||"Profile"),f=o(()=>r.value?.username?.trim()||""),U=o(()=>r.value?.city?.trim()||""),C=o(()=>r.value?.bio?.trim()||""),E=o(()=>f.value?`/u/${encodeURIComponent(f.value)}`:"/profile/me"),S=t=>typeof t=="string"?t.trim():"",$=o(()=>{const t=r.value?.social_links;return!t||typeof t!="object"?{}:t}),B=t=>t.replace(/^@/,"").trim(),F=(t,e)=>{if(e.startsWith("http://")||e.startsWith("https://"))return e;const i=B(e);return i?t==="telegram"?`https://t.me/${i}`:t==="vk"?`https://vk.com/${i}`:t==="instagram"?`https://instagram.com/${i}`:t==="twitter"||t==="x"?`https://x.com/${i}`:t==="youtube"?`https://youtube.com/@${i}`:"":""},D=t=>t.split(/[\s_-]+/g).filter(e=>!!e).map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "),I={telegram:"Telegram",vk:"VK",instagram:"Instagram",twitter:"Twitter",x:"X",youtube:"YouTube",tiktok:"TikTok",website:"Website"},z=o(()=>Object.entries($.value).flatMap(([t,e])=>{const i=t.trim().toLowerCase(),n=S(e);return!i||!n?[]:[{key:i,label:I[i]||D(i),value:n,href:F(i,n)||void 0}]})),V={organizer:"Organizer",participant:"Participant",user:"Participant",admin:"Admin",moderator:"Moderator"},p=o(()=>{const t=Number(u.value?.level??r.value?.level??1),e=Number(u.value?.exp??r.value?.exp??0),i=Number(u.value?.next_level_exp??r.value?.next_level_exp??1e3),n=Number(u.value?.reputation_score??t*100+e/10);return{level:Number.isFinite(t)&&t>0?Math.floor(t):1,tierName:u.value?.tier_name?.trim()||"Core",exp:Number.isFinite(e)&&e>=0?Math.floor(e):0,nextLevelExp:Number.isFinite(i)&&i>0?Math.max(Math.floor(i),1e3):1e3,role:r.value?.role?.trim()||"participant",roleLabel:V[r.value?.role?.trim().toLowerCase()||"participant"]||"Participant",reputation:Number.isFinite(n)&&n>=0?Math.round(n):0}}),N=t=>t.trim().toLowerCase().replace(/[_\s]+/g,"-"),H=o(()=>{const t=u.value?.achievements??[],e=new Map;for(const i of t){if(!i.is_unlocked)continue;const n=N(i.slug),y=N(i.name);n&&!e.has(n)&&e.set(n,i),y&&!e.has(y)&&e.set(y,i)}return e}),j=[{id:"early-adopter",title:"Early Adopter",description:"Joined before the first major release.",badge:"EA",tone:"gold",aliases:["early-adopter","early_adopter","early adopter"]},{id:"verified",title:"Verified",description:"Profile identity has been confirmed.",badge:"V",tone:"blue",aliases:["verified"]},{id:"event-master",title:"Event Master",description:"Shows consistent event participation.",badge:"EM",tone:"green",aliases:["event-master","event_master","event master"]}],K=o(()=>j.map(t=>{const e=t.aliases.map(i=>H.value.get(N(i))).find(i=>!!i);return e?{id:t.id,title:t.title,description:e.description?.trim()||t.description,badge:t.badge,tone:t.tone}:null}).filter(t=>!!t)),O={level_up:"Reached a new level",profile_update:"Updated profile details",streak_milestone:"Hit streak milestone"},W=t=>{if(!t)return"Recently";const e=new Date(t);if(Number.isNaN(e.getTime()))return"Recently";const i=new Date,n=1440*60*1e3,y=new Date(e.getFullYear(),e.getMonth(),e.getDate()),ee=new Date(i.getFullYear(),i.getMonth(),i.getDate()),A=Math.floor((ee.getTime()-y.getTime())/n);return A<=0?"Today":A<=7?"This week":A<=31?"This month":new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(e)},Y=o(()=>(k.value?.items??[]).slice(0,8).map(t=>{const e=t.title?.trim()||O[t.type]||"Activity update",i=t.description?.trim()||"";return{id:`activity-${t.id}`,title:e,details:i,timeLabel:W(t.created_at),createdAt:t.created_at}})),J=()=>typeof navigator.share=="function",X=()=>{const t=f.value?`/u/${encodeURIComponent(f.value)}`:window.location.pathname;try{return new URL(t,window.location.origin).toString()}catch{return`${window.location.origin}${t.startsWith("/")?t:`/${t}`}`}},Z=t=>{const e=document.createElement("textarea");e.value=t,e.setAttribute("readonly","true"),e.style.position="fixed",e.style.opacity="0",e.style.pointerEvents="none",e.style.left="-9999px",document.body.appendChild(e),e.focus(),e.select();const i=document.execCommand("copy");return document.body.removeChild(e),i},q=async t=>window.isSecureContext&&navigator.clipboard?.writeText?(await navigator.clipboard.writeText(t),!0):(console.warn("[profile] Clipboard API unavailable in the current context. Falling back to execCommand copy."),Z(t)),G=async()=>{const t=X();if(!t){m.push({level:"error",message:"Unable to share profile link."});return}if(J())try{await navigator.share({title:b.value,url:t});return}catch(e){if(e instanceof Error&&e.name==="AbortError")return;console.warn("[profile] Native share failed. Falling back to clipboard copy.",e)}try{if(await q(t)){m.push({level:"success",message:"Profile link copied."});return}m.push({level:"error",message:"Unable to copy profile link."})}catch(e){console.warn("[profile] Clipboard copy failed.",e),m.push({level:"error",message:"Unable to copy profile link."})}},Q=()=>w("refresh");return(t,e)=>{const i=re;return h(),g("div",ge,[a(P)?(h(),g("section",he,[...e[0]||(e[0]=[ie('<div class="h-48 animate-pulse rounded-3xl bg-muted/70" data-v-29dbce78></div><div class="grid gap-3 sm:grid-cols-2 xl:grid-cols-3" data-v-29dbce78><div class="h-32 animate-pulse rounded-3xl bg-muted/70" data-v-29dbce78></div><div class="h-32 animate-pulse rounded-3xl bg-muted/70" data-v-29dbce78></div><div class="h-32 animate-pulse rounded-3xl bg-muted/70" data-v-29dbce78></div></div>',2)])])):a(x)?(h(),g("section",be,[e[1]||(e[1]=_(" Unable to load profile data. ",-1)),l("button",{type:"button",class:"ml-2 underline",onClick:Q},"Refresh")])):a(r)?(h(),g(ae,{key:3},[s(de,{"avatar-url":a(r).avatar_url,"display-name":a(b),username:a(r).username,city:a(U),bio:a(C)},{actions:v(()=>[s(i,{to:"/profile/settings"},{default:v(()=>[s(a(R),{class:"rounded-full"},{default:v(()=>[...e[2]||(e[2]=[_("Edit Profile",-1)])]),_:1})]),_:1}),s(a(R),{variant:"outline",class:"rounded-full border-border bg-card",onClick:G},{default:v(()=>[...e[3]||(e[3]=[_(" Share ",-1)])]),_:1})]),footer:v(()=>[s(i,{to:a(E),class:"inline-flex text-xs font-semibold uppercase tracking-[0.18em] text-primary underline-offset-4 hover:underline"},{default:v(()=>[...e[4]||(e[4]=[_(" Open public profile ",-1)])]),_:1},8,["to"])]),_:1},8,["avatar-url","display-name","username","city","bio"]),s(ue,{level:a(p).level,"tier-name":a(p).tierName,exp:a(p).exp,"next-level-exp":a(p).nextLevelExp,role:a(p).role,status:a(p).roleLabel,reputation:a(p).reputation,"extra-stat-label":"Reputation","extra-stat-value":a(p).reputation},null,8,["level","tier-name","exp","next-level-exp","role","status","reputation","extra-stat-value"]),l("section",xe,[l("div",_e,[s(pe,{items:a(K)},null,8,["items"])]),l("div",we,[s(me,{items:a(Y)},null,8,["items"])])]),l("section",ke,[l("section",Pe,[e[5]||(e[5]=l("h2",{class:"text-sm font-semibold uppercase tracking-[0.18em] text-foreground"},"About",-1)),l("p",Ne,oe(a(C)||"No profile summary added yet."),1)]),s(fe,{items:a(z)},null,8,["items"])])],64)):(h(),g("section",ye," Profile is not available right now. Try refreshing this page. "))])}}}),Le=ve(Ae,[["__scopeId","data-v-29dbce78"]]),Te={class:"page-wrapper"},Ce={class:"flex min-h-[calc(100dvh-9rem)] flex-col gap-4 lg:flex-row lg:items-start lg:gap-6"},Re={class:"min-w-0 flex-1"},je=M({__name:"index",setup(T){const c=ne(),{data:d,pending:w,error:m,refresh:r}=se("profile-me-page-data",async()=>{if(!c.isAuthInitialized||!c.token)return{profile:null,gamification:null,activity:null};const[x,b,f]=await Promise.all([c.apiFetch("/api/v1/me/profile",{baseURL:L("/api/v1/me/profile")}),c.apiFetch("/api/v1/me/gamification",{baseURL:L("/api/v1/me/gamification")}),c.apiFetch("/api/v1/me/activity",{baseURL:L("/api/v1/me/activity")})]);return{profile:x,gamification:b,activity:f}},{server:!1,default:()=>({profile:null,gamification:null,activity:null}),watch:[()=>c.token,()=>c.isAuthInitialized]}),u=o(()=>d.value?.profile??null),k=o(()=>d.value?.gamification??null),P=o(()=>d.value?.activity??null);return(x,b)=>(h(),g("div",Te,[l("div",Ce,[s(le,{items:a(ce),class:"shrink-0"},null,8,["items"]),l("div",Re,[s(Le,{profile:a(u),gamification:a(k),activity:a(P),pending:a(w),error:a(m),onRefresh:a(r)},null,8,["profile","gamification","activity","pending","error","onRefresh"])])])]))}});export{je as default};
