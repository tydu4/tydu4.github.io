import{d as b,m as N,A as F,n as p,o as r,c as a,a as e,b as g,u as o,B as T,w as U,f as j,t as l,F as _,E as x,G as c,k as z,D as L,j as h,r as P}from"./BvmsJYLR.js";import{G as R}from"./DBxHthE1.js";import{U as E}from"./JUll6kn5.js";import{B as G}from"./B6Di9sXo.js";import"./5xDXAavj.js";const I={class:"space-y-6 pb-8"},V={class:"flex items-center justify-between"},$={key:0,class:"space-y-3"},S={key:1,class:"rounded-2xl border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive"},q={key:2,class:"rounded-2xl border border-border bg-card p-6 text-center"},H={key:3,class:"space-y-3"},J={class:"flex gap-3"},K={class:"flex-1"},M={class:"flex items-start justify-between gap-3"},O={class:"text-[11px] font-semibold uppercase tracking-[0.18em] text-muted-foreground"},Q=b({__name:"NotificationsList",setup(v){const i=N(),{data:f,pending:y,error:k,refresh:w}=F("me-notifications",()=>!i.isAuthInitialized||!i.token?{items:[],total:0,has_more:!1}:i.apiFetch("/api/v1/me/notifications",{baseURL:p("/api/v1/me/notifications"),query:{limit:50,offset:0}}),{server:!1,default:()=>({items:[],total:0,has_more:!1}),watch:[()=>i.token,()=>i.isAuthInitialized]}),u=h(()=>f.value?.items??[]),m=h(()=>u.value.filter(t=>!t.is_read).length),d=P(!1),A=async()=>{if(m.value){d.value=!0;try{await i.apiFetch("/api/v1/me/notifications/read-all",{method:"PATCH",baseURL:p("/api/v1/me/notifications/read-all")}),await w()}catch{}finally{d.value=!1}}},B=t=>t==="gift"?R:t==="buddy_invite"?E:G,C=t=>t==="gift"?"bg-primary/10 text-primary":t==="buddy_invite"?"bg-primary/15 text-primary":"bg-muted text-muted-foreground",D=t=>{const n=new Date(t);return Number.isNaN(n.getTime())?"":new Intl.DateTimeFormat("ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}).format(n)};return(t,n)=>(r(),a("div",I,[e("div",V,[n[0]||(n[0]=e("h1",{class:"text-xl font-bold text-foreground"},"Уведомления",-1)),g(o(T),{variant:"outline",size:"sm",disabled:o(d)||o(m)===0,onClick:A},{default:U(()=>[j(l(o(d)?"Секунду...":"Прочитать все"),1)]),_:1},8,["disabled"])]),o(y)?(r(),a("div",$,[(r(),a(_,null,x(4,s=>e("div",{key:`notif-skeleton-${s}`,class:"h-20 animate-pulse rounded-2xl bg-muted"})),64))])):o(k)?(r(),a("div",S," Не удалось загрузить уведомления. Попробуй обновить страницу. ")):o(u).length?(r(),a("div",H,[(r(!0),a(_,null,x(o(u),s=>(r(),a("article",{key:s.id,class:c(["rounded-2xl border border-border bg-card p-4 shadow-sm transition",s.is_read?"":"border-primary/20 bg-primary/10"])},[e("div",J,[e("div",{class:c(["flex h-10 w-10 items-center justify-center rounded-xl",C(s.type)])},[(r(),z(L(B(s.type)),{class:"h-5 w-5"}))],2),e("div",K,[e("div",M,[e("div",null,[e("p",{class:c(["text-sm font-semibold text-foreground",s.is_read?"":"font-bold"])},l(s.title),3),e("p",{class:c(["mt-1 text-sm",s.is_read?"text-muted-foreground":"text-foreground font-medium"])},l(s.message),3)]),e("span",O,l(D(s.created_at)),1)])])])],2))),128))])):(r(),a("div",q,[...n[1]||(n[1]=[e("p",{class:"text-sm font-semibold text-foreground"},"Тишина... Пока новостей нет",-1),e("p",{class:"mt-2 text-xs text-muted-foreground"},"Как только что-то появится — мы сразу дадим знать.",-1)])]))]))}}),W={class:"page-wrapper min-h-[80vh]"},se=b({__name:"index",setup(v){return(i,f)=>(r(),a("div",W,[g(Q)]))}});export{se as default};
