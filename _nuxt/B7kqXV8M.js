import{d as R,q as H,v as J,C as Q,i as X,s as T,x as Y,z,o as r,c as a,u as e,h as o,b as Z,w as B,j as F,B as P,f as d,F as ee,t as i,e as U,g as n,r as te}from"./BO0_OeXi.js";import{u as se}from"./D92jAQRS.js";import{e as oe}from"./Cv8_oF2L.js";const re={class:"mx-auto w-full max-w-4xl space-y-6 pb-10"},ae={key:0,class:"space-y-4"},le={key:1,class:"rounded-3xl border border-destructive/20 bg-destructive/10 p-6 text-sm text-destructive"},ne={class:"mt-3 flex flex-wrap items-center gap-3"},ie={key:2,class:"rounded-3xl border border-border bg-card p-6 text-sm text-muted-foreground shadow-soft"},ue={class:"rounded-3xl border border-border bg-card p-6 shadow-soft"},ce={class:"flex flex-col gap-6 sm:flex-row sm:items-start sm:justify-between"},de={class:"flex items-center gap-4"},pe={class:"h-20 w-20 overflow-hidden rounded-full border-4 border-background bg-primary/10 shadow-soft"},me=["src","alt"],fe={key:1,class:"flex h-full w-full items-center justify-center text-2xl font-bold text-primary"},ve={class:"min-w-0"},_e={class:"truncate text-2xl font-bold text-foreground"},he={class:"truncate text-sm text-muted-foreground"},ge={key:0,class:"mt-1 text-xs text-muted-foreground"},xe={class:"flex flex-wrap gap-2"},ye={key:0,class:"mt-4 text-sm text-muted-foreground"},be={class:"grid gap-4 sm:grid-cols-2"},we={class:"rounded-3xl border border-border bg-card p-5 shadow-soft"},ke={class:"mt-3 space-y-1 text-sm text-muted-foreground"},Ae={key:0},$e={key:1},Ce={key:2},Te={class:"rounded-3xl border border-border bg-card p-5 shadow-soft"},Be={class:"mt-3 space-y-1 text-sm text-muted-foreground"},Fe={key:0},Pe={key:1},Ue={key:2},Ne={key:3},Ie=R({__name:"PublicProfileMainBlock",async setup(L){let y,b;const c=H(),m=se(),w=J(),p=n(()=>{const t=w.params.uuid;return Array.isArray(t)?t[0]||"":t||""});c.isAuthInitialized||([y,b]=Q(()=>c.initAuth()),await y,b()),X(()=>[c.isAuthInitialized,c.user?.uuid,p.value],([t,s,u])=>{!t||!s||!u||s===u&&T("/profile/me",{replace:!0})},{immediate:!0});const{data:S,pending:D,error:E,refresh:N}=Y(()=>`public-profile-${p.value}`,async()=>p.value?await c.apiFetch(`/api/v1/me/users/${p.value}`,{baseURL:z(`/api/v1/me/users/${p.value}`)}):null,{server:!1,default:()=>null,watch:[p,()=>c.token,()=>c.isAuthInitialized]}),l=n(()=>S.value??null),k=n(()=>l.value?.full_name?.trim()||l.value?.username||"Пользователь"),W=n(()=>k.value.trim().charAt(0).toUpperCase()||"U"),I=n(()=>l.value?.bio?.trim()||""),x=n(()=>l.value?.city?.trim()||""),f=t=>typeof t=="string"?t.trim():"",A=n(()=>{const t=l.value?.social_links;return!t||typeof t!="object"?{}:t}),v=n(()=>f(A.value.telegram)),_=n(()=>f(A.value.vk)),h=n(()=>f(A.value.instagram)),q=n(()=>f(l.value?.social_contact_type)),V=n(()=>f(l.value?.social_contact_value)),j=n(()=>V.value?{type:q.value||"contact",value:V.value}:v.value?{type:"telegram",value:v.value}:_.value?{type:"vk",value:_.value}:h.value?{type:"instagram",value:h.value}:null),g=te(!1),M=()=>{if(c.isFullUser)return!0;const t=encodeURIComponent(w.fullPath||"/");return T(`/login?redirect=${t}`),!1},K=()=>{const t=encodeURIComponent(w.fullPath||"/");T(`/login?redirect=${t}`)},O=async()=>{if(!(!p.value||g.value)&&M()){g.value=!0;try{await c.apiFetch(`/api/v1/me/follow/${p.value}`,{method:"POST",baseURL:z(`/api/v1/me/follow/${p.value}`)}),m.push({level:"success",message:"Запрос отправлен."})}catch(t){m.push({level:"error",message:oe(t,"Не удалось отправить запрос.")})}finally{g.value=!1}}},$=t=>{window.open(t,"_blank","noopener")},G=async()=>{const t=j.value;if(!t){m.push({level:"info",message:"Контакты пользователя недоступны."});return}const s=t.value;if(t.type==="telegram"){const u=s.replace("@","");if(u)return $(`https://t.me/${u}`)}if(t.type==="vk"){const u=s.replace("@",""),C=s.startsWith("http")?s:`https://vk.com/${u}`;return $(C)}if(t.type==="instagram"){const u=s.replace("@",""),C=s.startsWith("http")?s:`https://instagram.com/${u}`;return $(C)}if(t.type==="email"){window.location.href=`mailto:${s}`;return}if(t.type==="phone"){window.location.href=`tel:${s}`;return}try{await navigator.clipboard.writeText(s),m.push({level:"success",message:"Контакт скопирован."})}catch{m.push({level:"error",message:"Не удалось скопировать контакт."})}};return(t,s)=>(r(),a("div",re,[e(D)?(r(),a("section",ae,[...s[1]||(s[1]=[o("div",{class:"h-40 animate-pulse rounded-3xl bg-muted"},null,-1),o("div",{class:"grid gap-4 sm:grid-cols-2"},[o("div",{class:"h-32 animate-pulse rounded-3xl bg-muted"}),o("div",{class:"h-32 animate-pulse rounded-3xl bg-muted"})],-1)])])):e(E)?(r(),a("section",le,[s[3]||(s[3]=o("p",null,"Не удалось загрузить профиль.",-1)),o("div",ne,[o("button",{type:"button",class:"underline",onClick:s[0]||(s[0]=(...u)=>e(N)&&e(N)(...u))},"Обновить"),e(c).isFullUser?d("",!0):(r(),Z(e(P),{key:0,variant:"outline",size:"sm",onClick:K},{default:B(()=>[...s[2]||(s[2]=[F(" Войти ",-1)])]),_:1}))])])):e(l)?(r(),a(ee,{key:3},[o("section",ue,[o("div",ce,[o("div",de,[o("div",pe,[e(l)?.avatar_url?(r(),a("img",{key:0,src:e(l).avatar_url,alt:e(k),class:"h-full w-full object-cover"},null,8,me)):(r(),a("div",fe,i(e(W)),1))]),o("div",ve,[o("h1",_e,i(e(k)),1),o("p",he,"@"+i(e(l)?.username||"user"),1),e(x)?(r(),a("p",ge,i(e(x)),1)):d("",!0)])]),o("div",xe,[U(e(P),{class:"rounded-full",disabled:e(g),onClick:O},{default:B(()=>[F(i(e(g)?"Отправляем...":"Добавить в друзья"),1)]),_:1},8,["disabled"]),U(e(P),{variant:"outline",class:"rounded-full",disabled:!e(j),onClick:G},{default:B(()=>[...s[4]||(s[4]=[F(" Написать ",-1)])]),_:1},8,["disabled"])])]),e(I)?(r(),a("p",ye,i(e(I)),1)):d("",!0)]),o("section",be,[o("div",we,[s[5]||(s[5]=o("h2",{class:"text-sm font-semibold text-foreground"},"О пользователе",-1)),o("div",ke,[e(l)?.level!==void 0?(r(),a("p",Ae,"Уровень: "+i(e(l)?.level??1),1)):d("",!0),e(l)?.exp!==void 0?(r(),a("p",$e,"Опыт: "+i(e(l)?.exp??0),1)):d("",!0),e(x)?(r(),a("p",Ce,"Город: "+i(e(x)),1)):d("",!0)])]),o("div",Te,[s[6]||(s[6]=o("h2",{class:"text-sm font-semibold text-foreground"},"Соцсети",-1)),o("div",Be,[e(v)?(r(),a("p",Fe,"Telegram: "+i(e(v)),1)):d("",!0),e(_)?(r(),a("p",Pe,"VK: "+i(e(_)),1)):d("",!0),e(h)?(r(),a("p",Ue,"Instagram: "+i(e(h)),1)):d("",!0),!e(v)&&!e(_)&&!e(h)?(r(),a("p",Ne,"Контакты не указаны.")):d("",!0)])])])],64)):(r(),a("section",ie," Пользователь не найден или профиль недоступен. "))]))}}),Ve={class:"page-wrapper"},Le=R({__name:"index",setup(L){return(y,b)=>(r(),a("div",Ve,[U(Ie)]))}});export{Le as default};
