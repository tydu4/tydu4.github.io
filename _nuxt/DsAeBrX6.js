import{d as ne,n as G,y as $e,c as a,F as _,a as e,D as M,t as g,b as h,u,w as D,e as H,f as L,q as te,r as m,j as k,o as r,E as Se,X as se,B as K,Y as Fe,U as Ee,Z as Ne,$ as Be,C as Ue,_ as De,J as Le,a0 as V,K as O,g as ze}from"./vvrMSRdc.js";import{H as Ie,c as Pe}from"./xy3-vlSP.js";import{u as Re}from"./9P0B7E0W.js";import Oe from"./BwBcj6tN.js";import{F as Ve}from"./BwauYN9y.js";import{U as je}from"./04tntqWT.js";import{T as qe}from"./CjLXx7ty.js";import{F as He}from"./Ba2NRgtU.js";import"./DlAUqK2U.js";import"./8R6Hccz8.js";import"./Idgo-c1n.js";import"./DK8pVjW8.js";import"./COfLoi9w.js";import"./DJepmivj.js";import"./D2JooQc7.js";import"./BWWOf5is.js";import"./CMEcg2KB.js";import"./nq_z6SHw.js";import"./Brevm6N2.js";const Ke={class:"pb-14"},Ge={class:"grid gap-6 lg:grid-cols-[minmax(0,1fr)_18.5rem]"},Je={class:"min-w-0 space-y-6"},Ye={class:"sticky top-2 z-20 rounded-2xl border border-border bg-card/95 p-2 backdrop-blur-sm"},Qe={class:"grid grid-cols-3 gap-1 rounded-xl bg-background p-1"},We=["onClick"],Xe={class:"block truncate"},Ze={key:0,class:"space-y-4"},et={key:1,class:"rounded-2xl border border-border bg-card p-6 text-center"},tt={class:"text-sm font-semibold text-foreground"},st={key:2,class:"rounded-2xl border border-border bg-card p-6 text-center"},ot={key:3,class:"space-y-4"},nt={key:0,class:"space-y-3 rounded-2xl border border-border bg-card p-4"},at={key:1,class:"rounded-2xl border border-border bg-card p-3 text-center"},rt={class:"text-xs text-muted-foreground"},it={class:"hidden lg:flex lg:flex-col lg:gap-6"},lt={class:"rounded-2xl border border-border bg-card p-4"},dt={class:"flex items-center gap-2 text-sm font-semibold text-foreground"},ut={key:0,class:"mt-4 space-y-3"},ct={key:1,class:"mt-4 space-y-3"},mt={class:"flex h-9 w-9 shrink-0 items-center justify-center overflow-hidden rounded-full border border-border bg-muted text-xs font-semibold text-foreground"},gt=["src","alt"],vt={key:1},ft={class:"min-w-0"},bt={class:"line-clamp-1 text-sm font-semibold text-foreground"},pt={class:"text-xs text-muted-foreground"},ht={key:2,class:"mt-4 text-xs text-muted-foreground"},xt={class:"rounded-2xl border border-border bg-card p-4"},yt={class:"flex items-center gap-2 text-sm font-semibold text-foreground"},wt={key:0,class:"mt-4 space-y-3"},_t={key:1,class:"mt-4 space-y-3"},kt={class:"h-14 w-16 shrink-0 overflow-hidden rounded-lg border border-border bg-muted"},Ct=["src","alt"],Mt={key:1,class:"h-full w-full bg-[linear-gradient(130deg,rgba(14,165,233,0.3),rgba(99,102,241,0.24),rgba(236,72,153,0.28))]"},Tt={class:"min-w-0 flex-1"},At={class:"line-clamp-1 text-sm font-semibold text-foreground transition hover:text-primary"},$t={class:"mt-0.5 text-[11px] text-muted-foreground"},St={class:"mt-1 inline-flex items-center gap-1 text-[11px] font-semibold text-primary"},Ft={key:2,class:"mt-4 text-xs text-muted-foreground"},Et={class:"flex h-[72vh] max-h-[72vh] flex-col"},Nt={class:"border-b border-border px-4 py-3"},Bt={class:"mt-1 text-sm font-semibold text-foreground"},Ut={class:"flex-1 space-y-3 overflow-y-auto p-4"},Dt={key:1,class:"rounded-xl border border-border bg-background p-4 text-center"},Lt={class:"text-sm text-muted-foreground"},zt={class:"flex items-center gap-2"},It={class:"flex h-7 w-7 items-center justify-center overflow-hidden rounded-full border border-border bg-muted text-[10px] font-semibold text-foreground"},Pt=["src","alt"],Rt={key:1},Ot={class:"min-w-0"},Vt={class:"line-clamp-1 text-xs font-semibold text-foreground"},jt={class:"text-[11px] text-muted-foreground"},qt={class:"mt-2 text-sm text-foreground"},Ht={key:3,class:"rounded-xl border border-border bg-background p-4 text-center"},Kt={class:"border-t border-border p-4"},Gt=["onKeydown"],Jt={class:"mt-2 flex items-center justify-between gap-3"},Yt=ne({__name:"CommunityFeedMainBlock",props:{activeTab:{},activities:{default:()=>[]},suggestions:{default:()=>[]},trendingEvents:{default:()=>[]},isInitialLoading:{type:Boolean,default:!1},isFetchingMore:{type:Boolean,default:!1},hasMore:{type:Boolean,default:!1},feedErrorMessage:{default:""},isSuggestionsLoading:{type:Boolean,default:!1},isTrendingLoading:{type:Boolean,default:!1},commentsOpen:{type:Boolean,default:!1},comments:{default:()=>[]},commentsPending:{type:Boolean,default:!1},commentsErrorMessage:{default:""},selectedCommentActivity:{default:null},submittingComment:{type:Boolean,default:!1}},emits:["update:activeTab","update:sentinel","open-comments","close-comments","submit-comment","retry-feed"],setup(d,{emit:T}){const A=d,b=T,v=[{label:"Pulse",value:"pulse"},{label:"Buddies",value:"buddies"},{label:"Global",value:"global"}],z=[1,2,3],$=[1,2,3,4],C=m(null),p=m(""),x=k({get:()=>A.commentsOpen,set:i=>{i||b("close-comments")}}),E=i=>{i!==A.activeTab&&b("update:activeTab",i)},S=i=>{const o=Math.max(0,Math.round(Number(i||0)));return`${o} mutual ${o===1?"buddy":"buddies"}`},N=i=>new Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(Math.max(0,Math.round(Number(i||0)))),I=i=>i.trim()[0]?.toUpperCase()||"?",P=i=>i.slug?`/e/${i.slug}`:"/discovery/catalog",w=i=>{const o=new Date(i);return Number.isNaN(o.getTime())?"Just now":new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}).format(o)},f=()=>{const i=p.value.trim();i&&(b("submit-comment",i),p.value="")},R=i=>{b("open-comments",i)};return G(C,i=>{b("update:sentinel",i)},{immediate:!0}),G(()=>A.commentsOpen,i=>{i||(p.value="")}),$e(()=>{b("update:sentinel",null)}),(i,o)=>{const B=De;return r(),a(_,null,[e("section",Ke,[e("div",Ge,[e("div",Je,[e("header",Ye,[o[4]||(o[4]=e("div",{class:"mb-2 px-2 pt-1"},[e("p",{class:"text-[11px] font-semibold uppercase tracking-[0.18em] text-muted-foreground"}," The Pulse ")],-1)),e("div",Qe,[(r(),a(_,null,M(v,t=>e("button",{key:t.value,type:"button",class:Se(["min-w-0 rounded-lg px-2 py-2 text-sm font-semibold transition sm:px-3",t.value===d.activeTab?"border border-border bg-card text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"]),onClick:F=>E(t.value)},[e("span",Xe,g(t.label),1)],10,We)),64))])]),d.isInitialLoading?(r(),a("section",Ze,[(r(),a(_,null,M(z,t=>e("article",{key:`feed-skeleton-${t}`,class:"rounded-2xl border border-border bg-card p-4"},[...o[5]||(o[5]=[se('<div class="animate-pulse space-y-4"><div class="flex items-center gap-3"><div class="h-11 w-11 rounded-full bg-muted"></div><div class="flex-1 space-y-2"><div class="h-3.5 w-40 rounded bg-muted"></div><div class="h-3 w-24 rounded bg-muted"></div></div></div><div class="h-24 rounded-xl bg-muted"></div><div class="flex gap-2"><div class="h-8 w-20 rounded-full bg-muted"></div><div class="h-8 w-24 rounded-full bg-muted"></div></div></div>',1)])])),64))])):d.feedErrorMessage&&!d.activities.length?(r(),a("section",et,[e("p",tt,g(d.feedErrorMessage),1),h(u(K),{class:"mt-3",variant:"outline",size:"sm",onClick:o[0]||(o[0]=t=>b("retry-feed"))},{default:D(()=>[...o[6]||(o[6]=[L(" Retry ",-1)])]),_:1})])):d.activities.length?(r(),a("section",ot,[(r(!0),a(_,null,M(d.activities,(t,F)=>(r(),a("article",{key:`feed-activity-${t.id}`,class:"animate-in fade-in",style:Fe({"--enter-delay":`${Math.min(F,10)*36}ms`})},[h(Ve,{activity:t,onOpenComments:R},null,8,["activity"])],4))),128)),d.isFetchingMore?(r(),a("div",nt,[...o[8]||(o[8]=[e("div",{class:"animate-pulse space-y-3"},[e("div",{class:"h-3.5 w-36 rounded bg-muted"}),e("div",{class:"h-16 rounded-xl bg-muted"})],-1)])])):H("",!0),d.feedErrorMessage&&d.activities.length?(r(),a("div",at,[e("p",rt,g(d.feedErrorMessage),1),h(u(K),{class:"mt-2",variant:"outline",size:"sm",onClick:o[1]||(o[1]=t=>b("retry-feed"))},{default:D(()=>[...o[9]||(o[9]=[L(" Retry ",-1)])]),_:1})])):H("",!0),d.hasMore?(r(),a("div",{key:2,ref_key:"sentinelEl",ref:C,class:"h-1 w-full","aria-hidden":"true"},null,512)):H("",!0)])):(r(),a("section",st,[...o[7]||(o[7]=[e("p",{class:"text-sm text-muted-foreground"}," No activity yet. Check back in a moment. ",-1)])]))]),e("aside",it,[e("section",lt,[e("header",dt,[h(u(je),{class:"h-4 w-4"}),o[10]||(o[10]=L(" Who to follow ",-1))]),d.isSuggestionsLoading?(r(),a("div",ut,[(r(),a(_,null,M($,t=>e("article",{key:`follow-skeleton-${t}`,class:"flex items-center gap-2"},[...o[11]||(o[11]=[se('<div class="h-9 w-9 animate-pulse rounded-full bg-muted"></div><div class="flex-1 space-y-1.5"><div class="h-3.5 w-20 animate-pulse rounded bg-muted"></div><div class="h-3 w-24 animate-pulse rounded bg-muted"></div></div><div class="h-7 w-16 animate-pulse rounded-full bg-muted"></div>',3)])])),64))])):d.suggestions.length?(r(),a("div",ct,[(r(!0),a(_,null,M(d.suggestions,t=>(r(),a("article",{key:`suggestion-${t.id}`,class:"flex items-center justify-between gap-2"},[h(B,{to:`/u/${t.id}`,class:"flex min-w-0 items-center gap-2.5"},{default:D(()=>[e("div",mt,[t.avatar_url?(r(),a("img",{key:0,src:t.avatar_url,alt:t.username,class:"h-full w-full object-cover",loading:"lazy"},null,8,gt)):(r(),a("span",vt,g(I(t.username)),1))]),e("div",ft,[e("p",bt,g(t.username),1),e("p",pt,g(S(t.mutual_count||0)),1)])]),_:2},1032,["to"]),o[12]||(o[12]=e("button",{type:"button",class:"shrink-0 rounded-full border border-border bg-background px-3 py-1 text-xs font-semibold text-foreground transition hover:bg-muted"}," Follow ",-1))]))),128))])):(r(),a("p",ht," New suggestions will appear soon. "))]),e("section",xt,[e("header",yt,[h(u(qe),{class:"h-4 w-4"}),o[13]||(o[13]=L(" Trending Events ",-1))]),d.isTrendingLoading?(r(),a("div",wt,[(r(),a(_,null,M($,t=>e("article",{key:`trend-skeleton-${t}`,class:"rounded-xl border border-border bg-background p-3"},[...o[14]||(o[14]=[e("div",{class:"animate-pulse space-y-2"},[e("div",{class:"h-16 rounded-lg bg-muted"}),e("div",{class:"h-3.5 w-24 rounded bg-muted"}),e("div",{class:"h-3 w-20 rounded bg-muted"})],-1)])])),64))])):d.trendingEvents.length?(r(),a("div",_t,[(r(!0),a(_,null,M(d.trendingEvents,t=>(r(),a("article",{key:`trend-${t.id}`,class:"rounded-xl border border-border bg-background p-3"},[h(B,{to:P(t),class:"flex items-start gap-3"},{default:D(()=>[e("div",kt,[t.image?(r(),a("img",{key:0,src:t.image,alt:t.title,class:"h-full w-full object-cover",loading:"lazy"},null,8,Ct)):(r(),a("div",Mt))]),e("div",Tt,[e("p",At,g(t.title),1),e("p",$t,g(t.dateLabel)+" - "+g(t.city),1),e("p",St,[h(u(He),{class:"h-3.5 w-3.5"}),L(" "+g(N(t.pulse))+" pulse ",1)])])]),_:2},1032,["to"])]))),128))])):(r(),a("p",Ft," No trending events right now. "))])])])]),h(u(Oe),{modelValue:u(x),"onUpdate:modelValue":o[3]||(o[3]=t=>te(x)?x.value=t:null),class:"max-h-[88vh] overflow-hidden border-border bg-card text-foreground sm:max-w-xl"},{default:D(()=>[e("div",Et,[e("header",Nt,[o[15]||(o[15]=e("p",{class:"text-xs uppercase tracking-[0.18em] text-muted-foreground"}," Comment Thread ",-1)),e("p",Bt," Activity #"+g(d.selectedCommentActivity?.id||"N/A"),1)]),e("div",Ut,[d.commentsPending?(r(),a(_,{key:0},M($,t=>e("article",{key:`comment-skeleton-${t}`,class:"rounded-xl border border-border bg-background p-3"},[...o[16]||(o[16]=[e("div",{class:"animate-pulse space-y-2"},[e("div",{class:"h-3.5 w-24 rounded bg-muted"}),e("div",{class:"h-3 w-full rounded bg-muted"}),e("div",{class:"h-3 w-4/5 rounded bg-muted"})],-1)])])),64)):d.commentsErrorMessage?(r(),a("section",Dt,[e("p",Lt,g(d.commentsErrorMessage),1)])):d.comments.length?(r(!0),a(_,{key:2},M(d.comments,t=>(r(),a("article",{key:`comment-${t.id}`,class:"rounded-xl border border-border bg-background p-3"},[e("div",zt,[e("div",It,[t.user.avatar_url?(r(),a("img",{key:0,src:t.user.avatar_url,alt:t.user.username,class:"h-full w-full object-cover"},null,8,Pt)):(r(),a("span",Rt,g(I(t.user.username)),1))]),e("div",Ot,[e("p",Vt,g(t.user.username),1),e("p",jt,g(w(t.created_at)),1)])]),e("p",qt,g(t.text),1)]))),128)):(r(),a("section",Ht,[...o[17]||(o[17]=[e("p",{class:"text-sm text-muted-foreground"}," No comments yet. Start the thread. ",-1)])]))]),e("footer",Kt,[Ee(e("textarea",{"onUpdate:modelValue":o[2]||(o[2]=t=>te(p)?p.value=t:null),rows:"3",placeholder:"Add a comment...",class:"w-full resize-none rounded-xl border border-border bg-background px-3 py-2 text-sm text-foreground outline-none transition focus:border-primary/40",onKeydown:Be(Ue(f,["ctrl","prevent"]),["enter"])},null,40,Gt),[[Ne,u(p)]]),e("div",Jt,[o[18]||(o[18]=e("p",{class:"text-xs text-muted-foreground"}," Press Ctrl+Enter to send ",-1)),h(u(K),{size:"sm",disabled:d.submittingComment||!u(p).trim(),onClick:f},{default:D(()=>[L(g(d.submittingComment?"Sending...":"Send"),1)]),_:1},8,["disabled"])])])])]),_:1},8,["modelValue"])],64)}}}),Qt={class:"page-wrapper"},Wt={class:"flex min-h-[calc(100dvh-9rem)] flex-col gap-4 lg:flex-row lg:items-start lg:gap-6"},Xt={class:"min-w-0 flex-1"},oe=10,hs=ne({__name:"index",setup(d){const T=Le(),A=k(()=>T.token?{Authorization:`Bearer ${T.token}`}:void 0),b=m("pulse"),v=m([]),z=m(0),$=m(0),C=m(!0),p=m(!0),x=m(!1),E=m(""),S=m(0),N=m(0),I=m(null),P=m(!1),w=m(null),f=m([]),R=m(!1),i=m(""),o=m(!1),B=s=>!s||typeof s!="object"?{}:s,t=(s,n="")=>typeof s!="string"?n:s.trim()||n,F=(s,n=0)=>{const l=Number(s);return Number.isFinite(l)?l:n},ae=s=>{const n=t(s);if(!n)return"Date TBA";const l=new Date(n);return Number.isNaN(l.getTime())?"Date TBA":new Intl.DateTimeFormat("en-US",{weekday:"short",month:"short",day:"numeric"}).format(l)},re=k(()=>({tab:b.value,limit:oe,offset:$.value})),{data:ie,error:J,execute:le}=V("/api/v1/community/feed",{server:!1,immediate:!1,lazy:!0,watch:!1,query:re,headers:A,baseURL:O("/api/v1/community/feed")},"$p6WbSY5SfU"),{data:Y,pending:de,execute:ue}=V("/api/v1/community/suggestions",{server:!1,immediate:!1,lazy:!0,watch:!1,query:{limit:6,offset:0},headers:A,baseURL:O("/api/v1/community/suggestions"),default:()=>[]},"$oFM24Q_0t8"),{data:ce,pending:me,execute:ge}=V("/api/v1/community/trending",{server:!1,immediate:!1,lazy:!0,watch:!1,headers:A,baseURL:O("/api/v1/community/trending"),default:()=>[]},"$U-MbON20fG"),ve=k(()=>w.value?.id??0),{data:fe,error:Q,execute:be}=V(()=>`/api/v1/community/feed/${ve.value}/comments`,{server:!1,immediate:!1,lazy:!0,watch:!1,query:{limit:50,offset:0},headers:A,baseURL:O("/api/v1/community/feed/1/comments")},"$J3C91Xsbkg"),W=k(()=>Array.isArray(Y.value)?Y.value:[]),pe=s=>{if(Array.isArray(s))return s.map(y=>B(y));const n=B(s),c=[n.items,n.events,n.results,n.trending].find(y=>Array.isArray(y));return Array.isArray(c)?c.map(y=>B(y)):[]},X=k(()=>pe(ce.value).slice(0,8).map((s,n)=>{const l=s.id??s.event_id??s.slug??`trend-${n}`,c=F(s.pulse_score??s.pulse??s.momentum??s.score??s.trending_score,0);return{id:typeof l=="number"?l:t(l,`trend-${n}`),slug:t(s.slug??s.event_slug)||null,title:t(s.title,"Trending event"),city:t(s.city??s.venue_name,"City TBA"),dateLabel:ae(s.start_time??s.starts_at??s.created_at),pulse:Math.max(0,Math.round(c)),image:t(s.main_image??s.image_url??s.cover_image)||null}}).sort((s,n)=>n.pulse-s.pulse)),he=k(()=>de.value&&!W.value.length),xe=k(()=>me.value&&!X.value.length),ye=s=>{if(!v.value.length){v.value=[...s];return}const n=new Set(v.value.map(c=>c.id)),l=s.filter(c=>!n.has(c.id));v.value=[...v.value,...l]},j=async(s=S.value)=>{if(x.value||!C.value)return;x.value=!0;const n=N.value+1;N.value=n,E.value="";try{if(await le(),s!==S.value)return;if(J.value)throw J.value;const l=ie.value??null,c=Array.isArray(l?.items)?l.items:[];$.value?ye(c):v.value=[...c],z.value=Math.max(0,Math.round(F(l?.total,v.value.length))),$.value+=c.length,C.value=c.length>=oe&&v.value.length<z.value}catch{if(s!==S.value)return;E.value=v.value.length?"Could not load more feed items.":"Could not load your feed right now."}finally{n===N.value&&(x.value=!1)}},q=async()=>{S.value+=1;const s=S.value;N.value+=1,x.value=!1,v.value=[],z.value=0,$.value=0,C.value=!0,E.value="",p.value=!0,await j(s),s===S.value&&(p.value=!1)},we=async s=>{w.value=s,P.value=!0,R.value=!0,i.value="",f.value=[];try{if(await be(),Q.value)throw Q.value;const n=fe.value??null,l=Array.isArray(n?.items)?n.items:[];f.value=[...l].sort((c,y)=>new Date(y.created_at).getTime()-new Date(c.created_at).getTime())}catch{i.value="Could not load comments right now.",f.value=[]}finally{R.value=!1}},Z=(s,n)=>{let l=w.value;v.value=v.value.map(c=>{if(c.id!==s)return c;const y=Math.max(0,Math.round(F(c.comments_count,0)+n)),U={...c,comments_count:y};return l?.id===s&&(l=U),U}),l&&w.value?.id===s&&(w.value=l)},_e=k(()=>({id:0,username:T.user?.username?.trim()||"You",avatar_url:T.user?.avatar_url??null,level:Math.max(1,Math.round(F(T.user?.level,1)))})),ke=async s=>{const n=w.value,l=s.trim();if(!n||!l||o.value)return;const c=-Date.now(),y={id:c,activity_id:n.id,text:l,created_at:new Date().toISOString(),user:_e.value};f.value=[y,...f.value],Z(n.id,1),i.value="",o.value=!0;try{const U={text:l},Ae=await T.apiFetch(`/api/v1/community/feed/${n.id}/comments`,{method:"POST",baseURL:O(`/api/v1/community/feed/${n.id}/comments`),body:U});f.value=f.value.map(ee=>ee.id===c?Ae:ee)}catch{f.value=f.value.filter(U=>U.id!==c),Z(n.id,-1),i.value="Could not send comment. Try again."}finally{o.value=!1}},Ce=()=>{P.value=!1,w.value=null,i.value="",f.value=[]},Me=s=>{I.value=s},Te=()=>{if(!v.value.length){q();return}j()};return G(b,()=>{q()}),ze(()=>{q(),ue(),ge()}),Re(I,()=>{p.value||x.value||!C.value||j()},{rootMargin:"320px 0px",enabled:k(()=>!p.value&&!x.value&&C.value)}),(s,n)=>(r(),a("div",Qt,[e("div",Wt,[h(Ie,{items:u(Pe),class:"shrink-0"},null,8,["items"]),e("div",Xt,[h(Yt,{"active-tab":u(b),activities:u(v),suggestions:u(W),"trending-events":u(X),"is-initial-loading":u(p),"is-fetching-more":u(x),"has-more":u(C),"feed-error-message":u(E),"is-suggestions-loading":u(he),"is-trending-loading":u(xe),"comments-open":u(P),comments:u(f),"comments-pending":u(R),"comments-error-message":u(i),"selected-comment-activity":u(w),"submitting-comment":u(o),"onUpdate:activeTab":n[0]||(n[0]=l=>b.value=l),"onUpdate:sentinel":Me,onOpenComments:we,onCloseComments:Ce,onSubmitComment:ke,onRetryFeed:Te},null,8,["active-tab","activities","suggestions","trending-events","is-initial-loading","is-fetching-more","has-more","feed-error-message","is-suggestions-loading","is-trending-loading","comments-open","comments","comments-pending","comments-error-message","selected-comment-activity","submitting-comment"])])])]))}});export{hs as default};
