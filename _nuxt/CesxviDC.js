import{d as C,c as l,a as e,b as m,_ as R,w as y,F as k,D,o as i,f as x,k as G,t as u,e as P,u as d,g as ue,y as me,X as ce,Y as pe,r as fe,j as h,a7 as W,J as ge,ad as T,K as X}from"./vvrMSRdc.js";import{F as J}from"./Ba2NRgtU.js";import{U as K}from"./04tntqWT.js";import{T as Q}from"./CjLXx7ty.js";import{M as xe}from"./8R6Hccz8.js";import{s as be}from"./BKwQwG4h.js";import{T as _e}from"./nq_z6SHw.js";import{G as he}from"./-Y9HtMJ_.js";import{C as ye}from"./BPnAJTcE.js";import{S as ve}from"./D2JooQc7.js";import{P as O}from"./D79CYQsO.js";import{_ as Z}from"./DlAUqK2U.js";import{M as we}from"./DJepmivj.js";import"./Idgo-c1n.js";const $e={class:"space-y-3"},ke={class:"flex items-center justify-between gap-3"},Ne={class:"flex items-center gap-2"},Se={class:"space-y-2.5"},Fe={key:1,class:"rounded-xl border border-dashed border-border bg-card p-4 text-sm text-muted-foreground shadow-sm"},Me={class:"flex items-start gap-3"},Pe={class:"flex -space-x-2"},Ae=["src","alt"],Be={class:"min-w-0 flex-1"},De={class:"text-sm leading-5 text-foreground"},Le={class:"font-medium"},Te={key:0,class:"ml-1 font-semibold"},Ce={key:0,class:"mt-1 text-sm font-semibold text-foreground"},Ee={class:"mt-1 text-xs text-muted-foreground"},He={key:0,class:"inline-flex items-center gap-1 rounded-full border border-primary/20 bg-primary/10 px-2 py-1 text-xs font-medium text-primary"},je={class:"mt-3 flex flex-wrap items-center gap-2 text-xs"},Ue={class:"inline-flex items-center gap-1 rounded-full border border-border bg-background px-2.5 py-1 text-muted-foreground"},Ie={class:"inline-flex items-center gap-1 rounded-full border border-border bg-background px-2.5 py-1 text-muted-foreground"},Xe={class:"inline-flex items-center gap-1 rounded-full border border-border bg-background px-2.5 py-1 text-muted-foreground"},Ge=C({__name:"HomeHappeningNowFeed",props:{activities:{},loading:{type:Boolean}},setup(S){const t=S,g=new Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}),b=a=>`${g.format(a)} views/hr`,f=a=>{const p=new Date(a).getTime();if(!Number.isFinite(p))return"Starting soon";const _=Math.ceil((p-Date.now())/6e4);if(_<=0)return"Starts now";if(_<60)return`Starts in ${_}m`;const s=Math.floor(_/60),c=_%60;return c?`Starts in ${s}h ${c}m`:`Starts in ${s}h`},w=a=>{if(a.friendsSummary?.trim())return a.friendsSummary;const p=Math.max(0,a.friendCount-1);return p?`${a.leadFriend} + ${p} friend${p===1?"":"s"} are going to`:`${a.leadFriend} is going to`},M=a=>!!a.isHot||a.velocity>=120;return(a,p)=>{const _=R;return i(),l("section",$e,[e("header",ke,[p[2]||(p[2]=e("div",null,[e("p",{class:"text-xs font-medium text-muted-foreground"},"Live Activity"),e("h2",{class:"text-lg font-semibold text-foreground"},"Happening Now")],-1)),e("div",Ne,[m(_,{to:"/community/feed",class:"rounded-full border border-border bg-card px-3 py-1 text-xs font-medium text-foreground transition hover:bg-muted"},{default:y(()=>[...p[0]||(p[0]=[x(" Community ",-1)])]),_:1}),m(_,{to:"/events",class:"rounded-full border border-border bg-card px-3 py-1 text-xs font-medium text-foreground transition hover:bg-muted"},{default:y(()=>[...p[1]||(p[1]=[x(" Events ",-1)])]),_:1})])]),e("div",Se,[t.loading?(i(),l(k,{key:0},D(3,s=>e("article",{key:`live-activity-skeleton-${s}`,class:"rounded-xl border border-border bg-card p-4 shadow-sm"},[...p[3]||(p[3]=[e("div",{class:"h-4 w-3/4 animate-pulse rounded bg-muted"},null,-1),e("div",{class:"mt-2 h-3 w-1/2 animate-pulse rounded bg-muted"},null,-1),e("div",{class:"mt-4 h-7 w-full animate-pulse rounded bg-muted"},null,-1)])])),64)):t.activities.length?(i(!0),l(k,{key:2},D(t.activities,s=>(i(),G(_,{key:s.id,to:s.to,class:"group block rounded-xl border border-border bg-card p-4 shadow-sm transition hover:border-primary/40 hover:bg-muted/30"},{default:y(()=>[e("article",null,[e("div",Me,[e("div",Pe,[(i(!0),l(k,null,D(s.friendAvatars.slice(0,3),(c,$)=>(i(),l("img",{key:`${s.id}-${$}`,src:c,alt:`Friend ${$+1}`,class:"h-9 w-9 rounded-full border-2 border-background object-cover ring-1 ring-border",loading:"lazy"},null,8,Ae))),128))]),e("div",Be,[e("p",De,[e("span",Le,u(w(s)),1),s.friendsSummary?P("",!0):(i(),l("span",Te,u(s.eventTitle),1))]),s.friendsSummary?(i(),l("p",Ce,u(s.eventTitle),1)):P("",!0),e("p",Ee,u(f(s.startsAt))+" - "+u(s.venue),1)]),M(s)?(i(),l("span",He,[m(d(J),{class:"h-3.5 w-3.5"}),p[4]||(p[4]=x(" Hot ",-1))])):P("",!0)]),e("footer",je,[e("span",Ue,[m(d(K),{class:"h-3.5 w-3.5"}),x(" "+u(s.friendCount)+" going together ",1)]),e("span",Ie,[m(d(Q),{class:"h-3.5 w-3.5"}),x(" "+u(b(s.velocity)),1)]),e("span",Xe,[m(d(xe),{class:"h-3.5 w-3.5"}),x(" "+u(s.comments)+" comments ",1)])])])]),_:2},1032,["to"]))),128)):(i(),l("article",Fe," No live activity yet. Community updates will appear here. "))])])}}}),Re={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Ye={class:"rounded-xl border border-border bg-card p-4 shadow-sm"},ze={class:"flex items-start justify-between gap-3"},Ve={class:"mt-1 flex items-center gap-2 text-xl font-semibold text-foreground"},Oe={class:"rounded-full border border-border bg-muted px-3 py-1 text-xs font-medium text-foreground"},qe={class:"mt-4 h-2 overflow-hidden rounded-full bg-muted"},We={class:"mt-3 text-sm text-muted-foreground"},Je={class:"mt-4 flex items-center gap-3 rounded-lg border border-border bg-background p-3"},Ke={class:"flex h-9 w-9 items-center justify-center rounded-lg bg-muted text-foreground"},Qe={class:"min-w-0 flex-1"},Ze={class:"truncate text-sm font-medium text-foreground"},et={class:"rounded-xl border border-border bg-card p-4 shadow-sm"},tt={class:"flex items-start justify-between gap-3"},rt={class:"min-w-0"},nt={class:"mt-1 line-clamp-2 text-lg font-semibold leading-tight text-foreground"},ot={class:"mt-1 truncate text-sm text-muted-foreground"},st={class:"rounded-full border border-border bg-muted px-2.5 py-1 text-xs text-muted-foreground"},at={class:"mt-4 rounded-lg border border-border bg-background p-3"},it={class:"flex items-center gap-2 text-sm font-medium text-foreground"},dt={class:"mt-1 text-xs text-muted-foreground"},lt={class:"mt-4 flex flex-wrap items-center gap-2"},ut={class:"mt-1 text-lg font-semibold leading-tight text-foreground"},mt={class:"mt-2 text-sm text-muted-foreground"},ct={class:"mt-4 inline-flex items-center gap-2 rounded-full border border-border bg-muted px-3 py-1.5 text-xs font-medium text-foreground"},pt={class:"mt-4"},q=C({__name:"HomePersonalPulseWidget",props:{pulse:{},nextEvent:{},recommendation:{},loading:{type:Boolean}},setup(S){const t=S,g=fe(Date.now());let b=null;const f=(s,c)=>{const $=new Date(s).getTime();if(!Number.isFinite($))return"--";const A=$-c;if(A<=0)return"starting now";const L=Math.ceil(A/6e4);if(L<60)return`${L}m`;const B=Math.floor(L/60),U=L%60;if(B<24)return U?`${B}h ${U}m`:`${B}h`;const E=Math.floor(B/24),I=B%24;return I?`${E}d ${I}h`:`${E}d`},w=h(()=>Math.max(0,t.pulse.nextLevelXp-t.pulse.currentXp)),M=h(()=>{const s=Math.max(1,t.pulse.nextLevelXp);return Math.min(100,Math.max(0,Math.round(t.pulse.currentXp/s*100)))}),a=h(()=>`You are ${w.value} XP away from Level ${t.pulse.level+1}!`),p=h(()=>t.nextEvent?f(t.nextEvent.startsAt,g.value):""),_=h(()=>t.nextEvent?t.nextEvent.friendsSummary?.trim()?t.nextEvent.friendsSummary:t.nextEvent.friendNames.length?`${t.nextEvent.friendNames.join(", ")} already synced plans in community.`:t.nextEvent.friendCount>0?`${t.nextEvent.friendCount} friends already synced plans in community.`:"Your community is warming up for this event.":"");return ue(()=>{b=be(()=>{g.value=Date.now()},1e3)}),me(()=>{b&&(clearInterval(b),b=null)}),(s,c)=>{const $=R;return i(),l("section",Re,[t.loading?(i(),l(k,{key:0},[c[0]||(c[0]=ce('<article class="rounded-xl border border-border bg-card p-4 shadow-sm"><div class="h-5 w-28 animate-pulse rounded bg-muted"></div><div class="mt-3 h-7 w-36 animate-pulse rounded bg-muted"></div><div class="mt-4 h-2 w-full animate-pulse rounded bg-muted"></div><div class="mt-3 h-4 w-56 animate-pulse rounded bg-muted"></div><div class="mt-4 h-16 w-full animate-pulse rounded-lg bg-muted"></div></article><article class="rounded-xl border border-border bg-card p-4 shadow-sm"><div class="h-5 w-24 animate-pulse rounded bg-muted"></div><div class="mt-3 h-6 w-48 animate-pulse rounded bg-muted"></div><div class="mt-2 h-4 w-40 animate-pulse rounded bg-muted"></div><div class="mt-4 h-16 w-full animate-pulse rounded-lg bg-muted"></div><div class="mt-4 h-9 w-32 animate-pulse rounded-full bg-muted"></div></article>',2))],64)):(i(),l(k,{key:1},[e("article",Ye,[e("header",ze,[e("div",null,[c[1]||(c[1]=e("p",{class:"text-xs font-medium text-muted-foreground"},"Personal Pulse",-1)),e("h2",Ve,[m(d(_e),{class:"h-5 w-5 text-primary"}),x(" Level "+u(t.pulse.level),1)])]),e("span",Oe,u(t.pulse.currentXp)+"/"+u(t.pulse.nextLevelXp)+" XP ",1)]),e("div",qe,[e("div",{class:"h-full rounded-full bg-primary",style:pe({width:`${d(M)}%`})},null,4)]),e("p",We,u(d(a)),1),e("div",Je,[e("span",Ke,[m(d(he),{class:"h-4 w-4"})]),e("div",Qe,[c[2]||(c[2]=e("p",{class:"text-xs text-muted-foreground"},"Next Reward",-1)),e("p",Ze,u(t.pulse.nextReward),1)]),m($,{to:"/community/leaderboard",class:"rounded-full border border-border bg-card px-3 py-1 text-xs font-medium text-foreground transition hover:bg-muted"},{default:y(()=>[...c[3]||(c[3]=[x(" Boost XP ",-1)])]),_:1})])]),e("article",et,[t.nextEvent?(i(),l(k,{key:0},[e("header",tt,[e("div",rt,[c[4]||(c[4]=e("p",{class:"text-xs font-medium text-muted-foreground"},"Next Event",-1)),e("h3",nt,u(t.nextEvent.title),1),e("p",ot,u(t.nextEvent.venue),1)]),e("span",st,u(t.nextEvent.friendCount)+" friends ",1)]),e("div",at,[e("p",it,[m(d(ye),{class:"h-4 w-4 text-muted-foreground"}),x(" Starts in "+u(d(p)),1)]),e("p",dt,u(d(_)),1)]),e("div",lt,[m($,{to:t.nextEvent.to,class:"rounded-full bg-primary px-4 py-2 text-xs font-medium text-primary-foreground transition hover:opacity-90"},{default:y(()=>[...c[5]||(c[5]=[x(" Open Event ",-1)])]),_:1},8,["to"]),m($,{to:"/community/feed",class:"rounded-full border border-border bg-card px-4 py-2 text-xs font-medium text-foreground transition hover:bg-muted"},{default:y(()=>[...c[6]||(c[6]=[x(" See Activity ",-1)])]),_:1})])],64)):(i(),l(k,{key:1},[e("header",null,[c[7]||(c[7]=e("p",{class:"text-xs font-medium text-muted-foreground"},"Recommended for You",-1)),e("h3",ut,u(t.recommendation.title),1),e("p",mt,u(t.recommendation.reason),1)]),e("div",ct,[m(d(ve),{class:"h-3.5 w-3.5 text-primary"}),x(" "+u(t.recommendation.startsInLabel),1)]),e("div",pt,[m($,{to:t.recommendation.to,class:"rounded-full bg-primary px-4 py-2 text-xs font-medium text-primary-foreground transition hover:opacity-90"},{default:y(()=>[...c[8]||(c[8]=[x(" View Picks ",-1)])]),_:1},8,["to"])])],64))])],64))])}}}),ft={class:"rounded-xl border border-border bg-card p-4 shadow-sm"},gt={class:"flex items-center justify-between gap-3 px-1"},xt={class:"hide-scrollbar mt-3 flex snap-x snap-mandatory gap-3 overflow-x-auto pb-1"},bt={class:"relative"},_t={class:"absolute -bottom-0.5 -right-0.5 flex h-5 w-5 items-center justify-center rounded-full border border-background bg-primary text-primary-foreground"},ht={class:"relative"},yt={class:"flex h-14 w-14 items-center justify-center overflow-hidden rounded-full border-2 border-background bg-muted ring-1 ring-border transition group-hover:ring-primary/40"},vt=["src","alt"],wt={key:1,class:"text-sm font-semibold text-foreground"},$t={key:0,class:"absolute -bottom-0.5 -right-0.5 flex h-5 w-5 items-center justify-center rounded-full border border-background bg-primary text-primary-foreground"},kt={key:1,class:"absolute -bottom-0.5 -right-0.5 flex h-5 w-5 items-center justify-center rounded-full border border-background bg-muted text-foreground"},Nt={class:"w-full truncate text-xs font-medium text-foreground"},St={class:"w-full truncate text-xs text-muted-foreground"},Ft=C({__name:"HomeStoriesRail",props:{stories:{},loading:{type:Boolean},canAddStory:{type:Boolean}},setup(S){const t=S,g=b=>b.trim().slice(0,1).toUpperCase()||"S";return(b,f)=>{const w=R,M=W;return i(),l("section",ft,[e("header",gt,[f[1]||(f[1]=e("div",null,[e("p",{class:"text-xs font-medium text-muted-foreground"},"Stories"),e("h2",{class:"text-base font-semibold text-foreground"},"People you follow")],-1)),m(w,{to:"/community",class:"rounded-full border border-border bg-background px-3 py-1 text-xs font-medium text-foreground transition hover:bg-muted"},{default:y(()=>[...f[0]||(f[0]=[x(" Open Community ",-1)])]),_:1})]),e("div",xt,[t.loading?(i(),l(k,{key:0},D(6,a=>e("div",{key:`story-skeleton-${a}`,class:"flex w-20 shrink-0 snap-start flex-col items-center gap-1 text-center"},[...f[2]||(f[2]=[e("span",{class:"h-14 w-14 animate-pulse rounded-full bg-muted"},null,-1),e("span",{class:"h-3 w-16 animate-pulse rounded bg-muted"},null,-1),e("span",{class:"h-3 w-12 animate-pulse rounded bg-muted"},null,-1)])])),64)):(i(),l(k,{key:1},[m(M,null,{default:y(()=>[t.canAddStory?(i(),G(w,{key:0,to:"/community/feed",class:"group flex w-20 shrink-0 snap-start flex-col items-center gap-1 text-center"},{default:y(()=>[e("span",bt,[f[3]||(f[3]=e("span",{class:"flex h-14 w-14 items-center justify-center overflow-hidden rounded-full border-2 border-background bg-muted ring-1 ring-border transition group-hover:ring-primary/40"},[e("span",{class:"text-sm font-semibold text-foreground"},"You")],-1)),e("span",_t,[m(d(O),{class:"h-3.5 w-3.5"})])]),f[4]||(f[4]=e("span",{class:"w-full truncate text-xs font-medium text-foreground"},"Add Story",-1)),f[5]||(f[5]=e("span",{class:"w-full truncate text-xs text-muted-foreground"},"Your update",-1))]),_:1})):P("",!0)]),_:1}),(i(!0),l(k,null,D(t.stories,a=>(i(),G(w,{key:a.id,to:a.to,class:"group flex w-20 shrink-0 snap-start flex-col items-center gap-1 text-center"},{default:y(()=>[e("span",ht,[e("span",yt,[a.avatar?(i(),l("img",{key:0,src:a.avatar,alt:a.name,class:"h-full w-full object-cover transition duration-300 group-hover:scale-105",loading:"lazy"},null,8,vt)):(i(),l("span",wt,u(g(a.name)),1))]),a.isAddStory?(i(),l("span",$t,[m(d(O),{class:"h-3.5 w-3.5"})])):a.isHot?(i(),l("span",kt,[m(d(J),{class:"h-3.5 w-3.5"})])):P("",!0)]),e("span",Nt,u(a.name),1),e("span",St,u(a.subtitle),1)]),_:2},1032,["to"]))),128))],64))])])}}}),Mt=Z(Ft,[["__scopeId","data-v-ec8da47d"]]),Pt={class:"space-y-3"},At={class:"flex items-center justify-between gap-3"},Bt={class:"text-xs font-medium text-muted-foreground"},Dt={class:"text-lg font-semibold text-foreground"},Lt={class:"hide-scrollbar flex snap-x snap-mandatory gap-4 overflow-x-auto pb-2"},Tt={key:1,class:"rounded-xl border border-dashed border-border bg-card px-4 py-6 text-sm text-muted-foreground"},Ct={class:"relative aspect-video overflow-hidden bg-muted"},Et=["src","alt"],Ht={key:1,class:"h-full w-full bg-[linear-gradient(135deg,rgba(148,163,184,0.25),rgba(148,163,184,0.08))]"},jt={class:"absolute left-3 top-3 inline-flex items-center gap-1 rounded-full border border-border bg-card/95 px-2 py-1 text-xs font-medium text-foreground"},Ut={class:"space-y-2 p-4"},It={class:"line-clamp-2 text-sm font-semibold text-foreground"},Xt={class:"flex items-center gap-1 text-xs text-muted-foreground"},Gt={class:"flex items-center justify-between gap-2 text-xs"},Rt={class:"rounded-full border border-border bg-background px-2.5 py-1 text-muted-foreground"},Yt={class:"inline-flex items-center gap-1 rounded-full border border-border bg-background px-2.5 py-1 text-muted-foreground"},zt=C({__name:"HomeTrendingNearYou",props:{events:{},isGuest:{type:Boolean},loading:{type:Boolean}},setup(S){const t=S,g=new Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}),b=a=>g.format(Math.max(0,Math.round(a))),f=h(()=>t.isGuest?"Trending Now":"You Might Like"),w=h(()=>t.isGuest?"Trending":"Personalized Picks"),M=a=>a.friendsSummary?.trim()?a.friendsSummary:a.friendCount===1?"1 friend is interested":a.friendCount>1?`${a.friendCount} friends are interested`:"People are bookmarking this now";return(a,p)=>{const _=R;return i(),l("section",Pt,[e("header",At,[e("div",null,[e("p",Bt,u(d(w)),1),e("h2",Dt,u(d(f)),1)]),m(_,{to:"/discovery/catalog",class:"rounded-full border border-border bg-card px-3 py-1 text-xs font-medium text-foreground transition hover:bg-muted"},{default:y(()=>[...p[0]||(p[0]=[x(" Explore More ",-1)])]),_:1})]),e("div",Lt,[t.loading?(i(),l(k,{key:0},D(3,s=>e("article",{key:`trending-skeleton-${s}`,class:"w-72 shrink-0 overflow-hidden rounded-xl border border-border bg-card p-4 shadow-sm"},[...p[1]||(p[1]=[e("div",{class:"aspect-video w-full animate-pulse rounded bg-muted"},null,-1),e("div",{class:"mt-4 h-4 w-3/4 animate-pulse rounded bg-muted"},null,-1),e("div",{class:"mt-2 h-3 w-1/2 animate-pulse rounded bg-muted"},null,-1),e("div",{class:"mt-3 h-7 w-full animate-pulse rounded bg-muted"},null,-1)])])),64)):t.events.length?(i(!0),l(k,{key:2},D(t.events,s=>(i(),G(_,{key:s.id,to:s.to,class:"group block w-72 shrink-0 snap-start overflow-hidden rounded-xl border border-border bg-card shadow-sm transition hover:-translate-y-0.5 hover:border-primary/40"},{default:y(()=>[e("article",null,[e("div",Ct,[s.image?(i(),l("img",{key:0,src:s.image,alt:s.title,class:"h-full w-full object-cover transition duration-500 group-hover:scale-105",loading:"lazy"},null,8,Et)):(i(),l("div",Ht)),e("span",jt,[m(d(Q),{class:"h-3.5 w-3.5"}),x(" "+u(b(s.viewsLastHour))+"/hr ",1)])]),e("div",Ut,[e("h3",It,u(s.title),1),e("p",Xt,[m(d(we),{class:"h-3.5 w-3.5"}),x(" "+u(s.venue),1)]),e("div",Gt,[e("span",Rt,u(s.startLabel),1),e("span",Yt,[m(d(K),{class:"h-3.5 w-3.5"}),x(" "+u(M(s)),1)])])])])]),_:2},1032,["to"]))),128)):(i(),l("div",Tt," No trending events right now. Check back in a bit. "))])])}}}),Vt=Z(zt,[["__scopeId","data-v-31b5d1ff"]]),Ot={class:"min-h-screen bg-background"},qt={class:"mx-auto w-full max-w-5xl space-y-4 px-4 pb-16 pt-4 sm:px-6 lg:px-8"},Wt={class:"rounded-xl border border-border bg-card p-4 shadow-sm"},Jt={key:0,class:"mt-2 h-7 w-56 animate-pulse rounded-md bg-muted"},Kt={key:0,class:"mt-1 text-2xl font-semibold text-foreground"},Qt={key:0,class:"mt-1 text-2xl font-semibold text-foreground"},Zt=C({__name:"HomeMainBlock",props:{stories:{},pulse:{},nextEvent:{},recommendation:{},happeningNow:{},trendingNearYou:{},welcomeName:{},isGuest:{type:Boolean},showAddStory:{type:Boolean},loadingProfile:{type:Boolean},loadingStories:{type:Boolean},loadingPulse:{type:Boolean},loadingTrending:{type:Boolean},loadingHappening:{type:Boolean}},setup(S){const t=S;return(g,b)=>{const f=W;return i(),l("div",Ot,[e("div",qt,[m(Mt,{stories:t.stories,loading:t.loadingStories,"can-add-story":t.showAddStory},null,8,["stories","loading","can-add-story"]),e("section",Wt,[b[0]||(b[0]=e("p",{class:"text-sm text-muted-foreground"},"Welcome back",-1)),t.loadingProfile?(i(),l("div",Jt)):P("",!0),m(f,null,{fallback:y(()=>[t.loadingProfile?P("",!0):(i(),l("h1",Qt," Good Morning, Guest "))]),default:y(()=>[t.loadingProfile?P("",!0):(i(),l("h1",Kt," Good Morning, "+u(t.welcomeName),1))]),_:1})]),m(f,null,{fallback:y(()=>[m(q,{pulse:t.pulse,"next-event":t.nextEvent,recommendation:t.recommendation,loading:!0},null,8,["pulse","next-event","recommendation"])]),default:y(()=>[m(q,{pulse:t.pulse,"next-event":t.nextEvent,recommendation:t.recommendation,loading:t.loadingPulse},null,8,["pulse","next-event","recommendation","loading"])]),_:1}),m(Vt,{events:t.trendingNearYou,"is-guest":t.isGuest,loading:t.loadingTrending},null,8,["events","is-guest","loading"]),m(Ge,{activities:t.happeningNow,loading:t.loadingHappening},null,8,["activities","loading"])])])}}}),er={class:"page-wrapper bg-background"},gr=C({__name:"index",setup(S){const t=ge(),g=h(()=>t.isFullUser),b=h(()=>!g.value),f=async(n,r={})=>{const o=X(n);return t.token?await t.apiFetch(n,{...r,baseURL:o}):await $fetch(n,{...r,baseURL:o})},w=n=>{if(!n)return 0;const r=n.match(/\d+/);if(!r)return 0;const o=Number.parseInt(r[0],10);return Number.isFinite(o)?o:0},M=n=>{if(!n)return"Date TBA";const r=new Date(n);return Number.isNaN(r.getTime())?"Date TBA":new Intl.DateTimeFormat("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}).format(r)},a=n=>{if(!n)return"Friends";const[r]=n.split(/[+,]/);return r?.trim()||"Friends"},p=n=>{const r=n.owner_name?.trim();return r||(n.owner_type==="organizer"?"Organizer":"User")},_={following:[],open_community:[]},s=()=>({generated_at:new Date().toISOString(),window_minutes:30,clusters:[]}),{data:c,pending:$}=T("home-me-profile",async()=>{if(!g.value)return null;try{return await t.apiFetch("/api/v1/me/profile",{baseURL:X("/api/v1/me/profile")})}catch{return null}},{default:()=>null,watch:[g,()=>t.token]}),{data:A,pending:L}=T("home-me-gamification",async()=>{if(!g.value)return null;try{return await t.apiFetch("/api/v1/me/gamification",{baseURL:X("/api/v1/me/gamification")})}catch{return null}},{default:()=>null,watch:[g,()=>t.token]}),{data:B,pending:U}=T("home-me-timeline",async()=>{if(!g.value)return null;try{return await t.apiFetch("/api/v1/me/timeline",{baseURL:X("/api/v1/me/timeline")})}catch{return null}},{default:()=>null,watch:[g,()=>t.token]}),{data:E,pending:I}=T("home-community-stories",async()=>{try{return await f("/api/v1/community/stories")}catch{return _}},{default:()=>_,watch:[()=>t.token]}),{data:ee,pending:te}=T("home-discovery-feed",async()=>{try{return await f("/api/v1/discovery/feed",{query:{limit:12}})}catch{return[]}},{default:()=>[],watch:[()=>t.token]}),{data:z,pending:re}=T("home-live-activity",async()=>{try{return await f("/api/v1/discovery/live-activity",{query:{limit:8}})}catch{return s()}},{default:()=>s(),watch:[()=>t.token]}),ne=h(()=>{if(b.value)return"Guest";const n=c.value?.full_name?.trim();return n||c.value?.username?.trim()||t.user?.username?.trim()||"Guest"}),oe=h(()=>{const n=E.value?.following??[],r=E.value?.open_community??[];return[...n,...r].filter((o,v,F)=>F.findIndex(N=>N.id===o.id)===v).slice(0,10).map(o=>{const v=new Date(o.expires_at).getTime(),F=Number.isFinite(v)?v-Date.now()<=10800*1e3:!1;return{id:`story-${o.id}`,name:p(o),subtitle:o.owner_type==="organizer"?"Organizer":"Community",avatar:o.owner_avatar_url??"",to:"/community/feed",isHot:F}})}),se=h(()=>{const n=Number(A.value?.level??t.user?.level??1),r=Number(A.value?.exp??t.user?.exp??0),o=Number(A.value?.next_level_exp??r+100),v=Number.isFinite(o)&&o>0?o:r+100;return{level:Number.isFinite(n)&&n>0?n:1,currentXp:Number.isFinite(r)&&r>=0?r:0,nextLevelXp:v,nextReward:A.value?.next_reward_title?.trim()||"Next reward unlocks soon"}}),ae=h(()=>{const n=B.value?.upcoming??[],[r]=[...n].sort((N,H)=>{const j=new Date(N.start_time||N.created_at).getTime(),Y=new Date(H.start_time||H.created_at).getTime();return Number.isNaN(j)&&Number.isNaN(Y)?0:Number.isNaN(j)?1:Number.isNaN(Y)?-1:j-Y});if(!r)return null;const o=Array.isArray(r.friend_names)?r.friend_names.map(N=>N.trim()).filter(N=>!!N):[],v=r.friends_summary?.trim()||null,F=Math.max(Number(r.friend_count??0)||0,o.length,w(v));return{id:`timeline-${r.event_id}`,title:r.event_title,venue:r.venue_name?.trim()||r.venue?.trim()||"Venue TBA",startsAt:r.start_time||r.created_at,friendCount:F,friendNames:o,friendsSummary:v??void 0,to:`/e/${r.event_slug}`}}),V=h(()=>[...ee.value??[]].sort((n,r)=>Number(r.trending_score??0)-Number(n.trending_score??0)).slice(0,8).map(n=>{const r=n.friends_summary?.trim()||null,o=Math.max(Number(n.going_count??0),w(r));return{id:`trend-${n.id}`,title:n.title,venue:n.venue_name?.trim()||n.city||"Venue TBA",image:n.main_image??"",viewsLastHour:Math.max(0,Math.round(Number(n.trending_score??0))),friendCount:o,friendsSummary:r??void 0,startLabel:M(n.start_time),to:n.slug?`/e/${n.slug}`:"/discovery/catalog"}})),ie=h(()=>{const[n]=V.value;return n?{title:n.title,reason:n.friendsSummary||"Picked from your local trends.",startsInLabel:n.startLabel,to:n.to}:{title:"Recommended for You",reason:"Explore trending events in your city.",startsInLabel:"Live updates",to:"/discovery/catalog"}}),de=h(()=>(z.value?.clusters??[]).flatMap(r=>(r.events??[]).map(o=>({cluster:r,event:o}))).map(({cluster:r,event:o})=>{const v=o.friends_summary?.trim()||null,F=Math.max(Number(o.friend_presence_count??0),Number(o.going_count??0),w(v)),N=Math.max(0,Math.round(Number(o.trending_score??o.social_cluster_score??0))),H=Number(o.comments??o.comments_count??o.comment_count??0),j=Number.isFinite(H)?Math.max(0,Math.round(H)):0;return{id:`live-${o.id}`,leadFriend:a(v),friendCount:F,friendAvatars:o.going_avatars??[],eventTitle:o.title,venue:o.venue_name?.trim()||o.city||r.title,startsAt:o.start_time||z.value?.generated_at||new Date().toISOString(),comments:j,velocity:N,isHot:!!(o.is_hot??o.is_live)||N>=120,friendsSummary:v??void 0,to:o.slug?`/e/${o.slug}`:"/events"}}).sort((r,o)=>{const v=+!!o.isHot-+!!r.isHot;if(v!==0)return v;const F=o.velocity-r.velocity;return F!==0?F:new Date(r.startsAt).getTime()-new Date(o.startsAt).getTime()}).slice(0,8)),le=h(()=>L.value||U.value);return(n,r)=>(i(),l("div",er,[m(Zt,{stories:d(oe),pulse:d(se),"next-event":d(ae),recommendation:d(ie),"happening-now":d(de),"trending-near-you":d(V),"welcome-name":d(ne),"is-guest":d(b),"show-add-story":d(g),"loading-profile":d($),"loading-stories":d(I),"loading-pulse":d(le),"loading-trending":d(te),"loading-happening":d(re)},null,8,["stories","pulse","next-event","recommendation","happening-now","trending-near-you","welcome-name","is-guest","show-add-story","loading-profile","loading-stories","loading-pulse","loading-trending","loading-happening"])]))}});export{gr as default};
