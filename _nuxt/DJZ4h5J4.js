import{d as N,q as ge,x as xe,z as V,G as ye,o as n,c as i,h as o,D as U,u as t,e as l,B as m,w as c,j as y,W as _,f as v,Y as A,t as f,Z as ke,R as he,H as _e,F as we,A as Ce,r as k,g as w}from"./BO0_OeXi.js";import Se from"./C94ZD2ww.js";import{u as ze}from"./Bsr6Qi3e.js";import Pe from"./DPasnuvX.js";import{u as Le,S as De}from"./B4EFBzzi.js";import"./ChLhOB94.js";import"./kDTr-kfK.js";import"./COC0__mb.js";import"./BaFub9o4.js";import"./DLAxxCvb.js";const Me={class:"fixed inset-0 overflow-hidden bg-background text-foreground"},Ie={class:"relative flex h-full w-full min-h-0 flex-col px-2 pb-2"},Te={class:"relative z-10 flex h-full w-full min-h-0 flex-col"},Ue={key:0,class:"relative z-10 flex h-full items-center justify-center rounded-3xl border border-border/60 bg-card/70 backdrop-blur-sm"},Fe={key:1,class:"relative z-10 flex h-full items-center justify-center rounded-3xl border border-border/60 bg-card/60"},Oe={class:"space-y-4 text-center"},je={class:"flex flex-wrap justify-center gap-2"},Be={key:2,class:"relative z-10 flex h-full min-h-0 flex-col"},Re={class:"relative min-h-0 flex-1 h-full"},Ve={class:"absolute left-6 top-6"},Ae={class:"absolute right-6 top-6"},Ne={class:"absolute left-1/2 top-6 -translate-x-1/2"},Ee={key:0,class:"absolute left-1/2 top-10 -translate-x-1/2 rounded-xl border border-emerald-400/30 bg-emerald-500/20 px-5 py-2.5 backdrop-blur-md"},$e={class:"absolute bottom-0 left-0 right-0 space-y-4 p-6 text-white"},qe={class:"text-3xl font-bold leading-tight tracking-tight"},He={class:"flex items-center gap-2 text-sm text-white/80"},Ye={class:"font-medium"},Ge={class:"px-2 pt-3",style:{"padding-bottom":"calc(env(safe-area-inset-bottom) + 0.35rem)"}},Ke={class:"w-full rounded-3xl border border-border bg-card p-6 text-foreground shadow-2xl"},We={class:"flex items-start justify-between gap-4"},Xe={key:0,class:"space-y-6"},Ze={class:"flex items-start justify-between gap-4 pb-4 border-b border-border/60"},Je={class:"flex-1 space-y-2"},Qe={class:"text-2xl font-bold leading-tight"},et={class:"flex items-center gap-2 text-sm text-muted-foreground"},tt={class:"space-y-4"},ot={class:"space-y-3"},st={class:"text-base leading-relaxed text-muted-foreground"},rt={key:0,class:"flex items-center gap-2 text-sm text-muted-foreground"},at={key:0,class:"flex flex-wrap gap-2"},nt={class:"flex items-center gap-3 pt-2"},it={key:0,class:"fixed bottom-8 left-1/2 z-50 -translate-x-1/2 rounded-xl border border-border/60 bg-card px-5 py-3 text-sm font-medium text-foreground shadow-2xl backdrop-blur-md"},lt=N({__name:"SwipeDeck",setup(E){const b=ge(),{data:F,pending:$,refresh:q}=xe("discovery-feed",()=>b.isAuthInitialized?b.apiFetch("/api/v1/discovery/feed",{baseURL:V("/api/v1/discovery/feed"),query:{limit:30}}):[],{server:!1,default:()=>[],watch:[()=>b.token,()=>b.isAuthInitialized]}),g=k([]),h=k(!1),a=k(null),C=k(""),O=ze("discovery_onboarding_seen",!1),H=w(()=>!O.value),P=()=>{O.value=!0},L=w(()=>a.value?g.value.includes(a.value.id):!1),Y=s=>{C.value=s,setTimeout(()=>{C.value=""},2200)},j=async(s,e)=>{const u={event_id:s.id,type:e,weight:1,device_type:"mobile"};try{await b.apiFetch("/api/v1/me/interactions",{method:"POST",baseURL:V("/api/v1/me/interactions"),body:u})}catch{}},G=async({direction:s,type:e,item:u})=>{e==="like"&&s==="right"&&!g.value.includes(u.id)&&(g.value=[...g.value,u.id]),await j(u,e)},D=k(!1),M=k("");let x=null;const K=s=>{M.value=s==="like"?"bg-green-500/10":s==="dislike"?"bg-red-500/10":"bg-blue-500/10",x&&clearTimeout(x),x=setTimeout(()=>{M.value="",x=null},300)},W=()=>{D.value=!0,setTimeout(()=>{D.value=!1},600)},X=()=>{Se({particleCount:100,spread:70,origin:{y:.6},colors:["#22c55e","#3b82f6","#eab308"]})};ye(()=>{x&&clearTimeout(x)});const{activeItem:d,nextItem:Z,cardStyle:J,nextCardStyle:Q,indicators:I,handlers:p,actions:S,isAnimating:z,isDragging:ee,didDrag:B,offsetX:te,offsetY:oe,cardMotionClass:se}=Le(w(()=>F.value||[]),{enableSwipeUp:!0,onSwipe:({direction:s,item:e,meta:u})=>{const r=u?.type||(s==="left"?"dislike":s==="up"?"bookmark":"like"),T=s==="left"?"left":"right",be=u?.feedback||(r==="bookmark"?"super":T==="right"?"like":"dislike");K(be),T==="right"&&W(),G({direction:T,type:r,item:e})}}),re=()=>{S.swipeLeft({type:"dislike",feedback:"dislike"})},ae=()=>{S.superLike({type:"bookmark",feedback:"super"}),X()},ne=()=>{S.swipeRight({type:"like",feedback:"like"})},ie=()=>{S.rewind()},le=async()=>{if(!d.value||z.value)return;const s=`/e/${d.value.slug}`,e=new URL(s,window.location.origin).toString(),u={title:d.value.title,text:d.value.description||void 0,url:e};try{if(typeof navigator.share=="function"){await navigator.share(u);return}navigator.clipboard&&await navigator.clipboard.writeText(e)}catch{}},de=w(()=>z.value||!d.value),ue=()=>{if(!(!d.value||z.value)){if(B.value){B.value=!1;return}ee.value||Math.abs(te.value)>10||Math.abs(oe.value)>10||fe(d.value)}},ce=w(()=>J.value),pe=s=>s?.main_image?{backgroundImage:`url(${s.main_image})`}:{backgroundImage:"linear-gradient(160deg, rgba(139,92,246,0.6), rgba(30,27,75,0.9))"},fe=s=>{a.value=s,h.value=!0},R=()=>{h.value=!1},me=async()=>{!a.value||L.value||(g.value=[...g.value,a.value.id],await j(a.value,"like"))},ve=s=>s?new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"long",hour:"2-digit",minute:"2-digit"}).format(new Date(s)):"Дата уточняется";return(s,e)=>{const u=ke;return n(),i("div",Me,[o("div",{class:U(["pointer-events-none fixed inset-0 z-0 transition-colors duration-300",t(M)])},null,2),e[24]||(e[24]=o("div",{class:"pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(99,102,241,0.16),transparent_55%)] dark:bg-[radial-gradient(circle_at_top,_rgba(99,102,241,0.28),transparent_55%)]"},null,-1)),o("div",Ie,[o("div",Te,[t($)?(n(),i("div",Ue,[...e[7]||(e[7]=[o("div",{class:"space-y-4 text-center"},[o("div",{class:"mx-auto h-10 w-10 animate-spin rounded-full border-2 border-primary/20 border-t-primary"}),o("p",{class:"text-sm font-medium text-muted-foreground"},"Loading events...")],-1)])])):t(d)?(n(),i("div",Be,[o("div",Re,[t(Z)?(n(),i("div",{key:0,class:"absolute inset-0 translate-y-4 scale-[0.96] rounded-[2.5rem] border border-border/50 bg-card/70 backdrop-blur-sm",style:_(t(Q))},null,4)):v("",!0),o("div",{class:U(["absolute inset-0 touch-none overflow-hidden rounded-[2.5rem] border border-border/40 bg-cover bg-center shadow-2xl",[t(se),t(z)?"pointer-events-none":""]]),style:_([pe(t(d)),t(ce)]),onPointerdown:e[1]||(e[1]=(...r)=>t(p).onPointerDown&&t(p).onPointerDown(...r)),onPointermove:e[2]||(e[2]=(...r)=>t(p).onPointerMove&&t(p).onPointerMove(...r)),onPointerup:e[3]||(e[3]=(...r)=>t(p).onPointerUp&&t(p).onPointerUp(...r)),onPointercancel:e[4]||(e[4]=(...r)=>t(p).onPointerUp&&t(p).onPointerUp(...r)),onPointerleave:e[5]||(e[5]=(...r)=>t(p).onPointerLeave&&t(p).onPointerLeave(...r)),onClick:ue},[e[15]||(e[15]=o("div",{class:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"},null,-1)),o("div",Ve,[o("div",{class:"flex items-center gap-2 rounded-xl border-2 border-emerald-400 bg-emerald-500/20 px-4 py-2 backdrop-blur-sm",style:_({opacity:t(I).likeOpacity})},[...e[12]||(e[12]=[o("span",{class:"text-sm font-bold uppercase tracking-wider text-emerald-200"},"LIKE",-1)])],4)]),o("div",Ae,[o("div",{class:"flex items-center gap-2 rounded-xl border-2 border-rose-400 bg-rose-500/20 px-4 py-2 backdrop-blur-sm",style:_({opacity:t(I).nopeOpacity})},[...e[13]||(e[13]=[o("span",{class:"text-sm font-bold uppercase tracking-wider text-rose-200"},"NOPE",-1)])],4)]),o("div",Ne,[o("div",{class:"rounded-xl border-2 border-blue-400 bg-blue-500/20 px-4 py-2 text-xs font-bold uppercase tracking-[0.2em] text-blue-200 backdrop-blur-sm",style:_({opacity:t(I).superLikeOpacity})}," SUPER ",4)]),l(A,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":"-translate-y-2 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-200 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"-translate-y-2 opacity-0"},{default:c(()=>[t(D)?(n(),i("div",Ee,[...e[14]||(e[14]=[o("span",{class:"text-sm font-semibold text-emerald-200"},"Saved",-1)])])):v("",!0)]),_:1}),o("div",$e,[o("h2",qe,f(t(d).title),1),o("div",He,[o("span",Ye,f(t(d).venue_name||t(d).city),1)])])],38)]),o("div",Ge,[l(De,{type:"event",disabled:t(de),onRewind:ie,onDislike:re,onSuper:ae,onLike:ne,onAction:le},null,8,["disabled"])])])):(n(),i("div",Fe,[o("div",Oe,[e[10]||(e[10]=o("h3",{class:"text-lg font-semibold"},"No more events",-1)),e[11]||(e[11]=o("p",{class:"text-sm text-muted-foreground"},"Try refreshing or changing filters.",-1)),o("div",je,[l(t(m),{variant:"outline",size:"sm",onClick:t(q)},{default:c(()=>[...e[8]||(e[8]=[y(" Refresh ",-1)])]),_:1},8,["onClick"]),l(t(m),{variant:"outline",size:"sm",onClick:e[0]||(e[0]=r=>Y("Map is coming soon"))},{default:c(()=>[...e[9]||(e[9]=[y(" Open map ",-1)])]),_:1})])])]))])]),l(u,null,{default:c(()=>[t(H)?(n(),i("div",{key:0,class:"fixed inset-0 z-40 flex items-end bg-black/60 px-4 pb-6",onClick:he(P,["self"])},[o("div",Ke,[o("div",We,[e[17]||(e[17]=o("div",{class:"space-y-1"},[o("h3",{class:"text-lg font-semibold"},"Как работают рекомендации"),o("p",{class:"text-sm text-muted-foreground"}," Алгоритм учится по вашим свайпам: вправо — “нравится”, влево — “пропустить”. Чем больше действий, тем точнее лента. ")],-1)),l(t(m),{variant:"ghost",size:"sm",class:"-mr-2 -mt-2",onClick:P},{default:c(()=>[...e[16]||(e[16]=[y("Закрыть",-1)])]),_:1})]),l(t(m),{class:"mt-4 w-full",size:"lg",onClick:P},{default:c(()=>[...e[18]||(e[18]=[y("Понятно",-1)])]),_:1})])])):v("",!0)]),_:1}),l(t(Pe),{modelValue:t(h),"onUpdate:modelValue":e[6]||(e[6]=r=>_e(h)?h.value=r:null),class:"max-h-[90vh] overflow-y-auto border-border bg-card text-foreground backdrop-blur-xl shadow-2xl"},{default:c(()=>[t(a)?(n(),i("div",Xe,[o("div",Ze,[o("div",Je,[e[20]||(e[20]=o("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-primary/80"}," Детали события ",-1)),o("h3",Qe,f(t(a).title),1),o("div",et,[e[19]||(e[19]=o("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),o("span",null,f(ve(t(a).start_time)),1)])]),l(t(m),{variant:"ghost",size:"sm",class:"text-muted-foreground hover:text-foreground -mr-2",onClick:R},{default:c(()=>[...e[21]||(e[21]=[o("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),_:1})]),o("div",tt,[o("div",ot,[o("p",st,f(t(a).description||"Описание события скоро появится."),1),t(a).venue_name||t(a).city?(n(),i("div",rt,[e[22]||(e[22]=o("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),o("span",null,f(t(a).venue_name||t(a).city),1)])):v("",!0)]),t(a).tags?.length?(n(),i("div",at,[(n(!0),i(we,null,Ce(t(a).tags,r=>(n(),i("span",{key:r,class:"rounded-lg bg-muted/60 px-3 py-1.5 text-xs font-medium text-muted-foreground backdrop-blur-sm"},f(r),1))),128))])):v("",!0)]),o("div",nt,[l(t(m),{class:U(["flex-1 font-medium",t(L)?"bg-muted text-foreground hover:bg-muted/80":"bg-gradient-to-r from-primary to-primary/80 text-primary-foreground hover:from-primary/90 hover:to-primary"]),size:"lg",onClick:me},{default:c(()=>[y(f(t(L)?"Вы идёте":"Я иду"),1)]),_:1},8,["class"]),l(t(m),{variant:"outline",size:"lg",class:"flex-1 border-border/70 bg-card/60 font-medium hover:bg-card",onClick:R},{default:c(()=>[...e[23]||(e[23]=[y(" Назад ",-1)])]),_:1})])])):v("",!0)]),_:1},8,["modelValue"]),l(A,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":"translate-y-2 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-200 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-2 opacity-0"},{default:c(()=>[t(C)?(n(),i("div",it,f(t(C)),1)):v("",!0)]),_:1})])}}}),dt={class:"page-wrapper h-full w-full overflow-hidden"},kt=N({__name:"index",setup(E){return(b,F)=>(n(),i("div",dt,[l(lt,{class:"h-full"})]))}});export{kt as default};
